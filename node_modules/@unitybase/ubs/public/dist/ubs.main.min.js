/*! For license information please see ubs.main.min.js.LICENSE.txt */
var unitybase_ubs;(()=>{var __webpack_modules__={320:(t,e,n)=>{const r=n(215),i=/\[.*]/,o={equal:"isNull",notEqual:"notIsNull",custom:"custom"},s=[];for(let t=0;t<100;t++)s.push(`c${t}`);const a=new Set(["__mip_ondate","__mip_recordhistory","__mip_recordhistory_all","__mip_disablecache","__skipOptimisticLock","__allowSelectSafeDeleted","__skipSelectAfterUpdate","__skipSelectAfterInsert","__skipSelectBeforeUpdate","__skipRls","__skipAclRls","lockType"]);class c{constructor(t){this.fieldList=[],this.groupList=[],this.whereList={},this._whereLength=0,this.logicalPredicates=[],this.joinAs=[],this.orderList=[],this.options={},this.method="select",this.__misc={},this.entityName=t}using(t){return this.method=t,this}attrs(...t){const e=t.length;for(let n=0;n<e;n++)Array.isArray(t[n])?this.fieldList=this.fieldList.concat(t[n]):this.fieldList.push(t[n]);return this}attrsIf(t,...e){return t?this.attrs.apply(this,e):this}where(t,e,n,a){const l=this.UBQLv2;let u=a&&"object"==typeof a?a.clauseName:a;if(!u)for(u=s[++this._whereLength];this.whereList[u];)u+="_";const p=e,d=c.prototype.WhereCondition;if(e=d[e],t&&"custom"!==e&&!i.test(t)&&(t=`[${t}]`),!e)throw new Error("Unknown condition "+p);let h;if(("in"===e||"notIn"===e)&&n instanceof c)h=e,e="subquery",n=n.ubql();else if("subquery"===e)h=p,n instanceof c&&(n=n.ubql());else if("in"!==e&&"notIn"!==e||null!=n)if("in"!==e||Array.isArray(n))if("in"!==e||n&&n.length)if("notIn"!==e||n&&n.length){if(null===n&&("isNull"!==e||"notIsNull"!==e)){const t=e;if(n=void 0,!(e=o[t]))throw new Error(`Condition ${t} is passed to CustomRepository.where but value is null`);console.warn(`Condition ${t} is passed to CustomRepository.where but value is null -> condition transformed to ${e}. Check where logic`)}}else console.warn('Condition "notIn" is passed to CustomRepository.where but value is empty array -> condition transformed to "1=1". Check where logic'),t="1",e=d.equal,n=l?1:{a:1};else console.warn('Condition "in" is passed to CustomRepository.where but value is empty array -> condition transformed to "0=1". Check where logic'),t="0",e=d.equal,n=l?1:{a:1};else console.debug('Condition "in" is passed to CustomRepository.where but value is not an array -> condition transformed to equal. Check where logic'),e=d.equal;else console.warn('Condition "in" is passed to CustomRepository.where but value is null or undefined -> condition transformed to (0=1). Check where logic'),t="0",e=d.equal,n=l?1:{a:1};if("in"===e&&n&&1===n.length&&(e=d.equal,n=n[0]),!l&&void 0!==n&&("object"!=typeof n||Array.isArray(n)||r.isDate(n))){const t={};t[u]=n,n=t}const f={expression:t,condition:e};return"subquery"===e&&(f.subQueryType=h),void 0!==n&&(l?f.value=n:f.values=n),this.whereList[u]=f,a&&"object"==typeof a&&!1===a.clearable&&(this._unclearable||(this._unclearable={}),this._unclearable[u]=!0),this}whereIf(t,e,n,r,i){return t?this.where(e,n,r,i):this}exists(t,e){return this.where("","exists",t,e)}notExists(t,e){return this.where("","notExists",t,e)}correlation(t,e,n,r){return i.test(t)||(t="["+t+"]"),n||(n="="),this.where(t+n+"[{master}."+e+"]","custom",void 0,r)}logic(t){return this.logicalPredicates.push(t),this}join(t){return this.joinAs.push(t),this}joinCondition(t,e,n,r){if(!r)for(r=s[++this._whereLength];this.whereList[r];)r+="_";if(this.joinAs.includes(r))throw new Error(`Join condition with clause name ${r} already exists`);return this.where(t,e,n,r),this.joinAs.push(r),this}orderBy(t,e){const n=this.orderList.findIndex((e=>e.expression===t));return null===e?-1!==n&&this.orderList.splice(n,1):(e=e||"asc",-1===n?this.orderList.push({expression:t,order:e}):this.orderList[n].order=e),this}orderByDesc(t){return this.orderList.push({expression:t,order:"desc"}),this}groupBy(t){return Array.isArray(t)?this.groupList=this.groupList.concat(t):"string"==typeof t&&this.groupList.push(t),this}start(t){return this.options.start=t,this}limit(t){return 0===t?delete this.options.limit:this.options.limit=t,this}ubql(){const t={entity:this.entityName,method:this.method,fieldList:this.fieldList};this.groupList.length>0&&(t.groupList=this.groupList),Object.keys(this.whereList).length&&(t.whereList=this.whereList);const e=this.orderList.length;if(e>0){t.orderList={};for(let n=0;n<e;n++)t.orderList[n]=this.orderList[n]}return Object.keys(this.options).length&&(t.options=this.options),this.logicalPredicates.length&&(t.logicalPredicates=this.logicalPredicates),this.joinAs.length&&(t.joinAs=this.joinAs),Object.assign(t,this.__misc),t}fromUbql(t){const e=r.cloneDeep(t);if(this.entityName=e.entity,e.method&&(this.method=e.method),this.fieldList=e.fieldList,this.groupList=e.groupList||[],this.whereList=e.whereList||{},e.orderList){const t=Object.keys(e.orderList);this.orderList=[],t.forEach((t=>{this.orderList.push(e.orderList[t])}))}return this.options=e.options||{},this.logicalPredicates=e.logicalPredicates||[],this.joinAs=e.joinAs||[],this.__misc={},Object.keys(e).forEach((t=>{!0===e[t]&&a.has(t)&&(this.__misc[t]=!0)})),this}selectAsObject(t){throw new Error("abstract")}selectAsArray(){throw new Error("abstract")}selectAsArrayOfValues(){throw new Error("abstract")}selectAsStore(t){throw new Error("abstract")}select(t){throw new Error("abstract")}selectSingle(t){throw new Error("abstract")}selectScalar(){throw new Error("abstract")}selectById(t,e){throw new Error("abstract")}misc(t){for(const e in t)t.hasOwnProperty(e)&&(t[e]?this.__misc[e]=t[e]:delete this.__misc[e]);return this}miscIf(t,e){return t?this.misc(e):this}withTotal(t=!0){return!1===t?delete this.options.totalRequired:this.options.totalRequired=!0,this}clone(){const t=r.cloneDeep(this);return Object.defineProperty(t,"connection",{enumerable:!1,writable:!1,value:this.connection}),t}clearWhereList(){return this.logicalPredicates=[],this.joinAs.length||this._unclearable?Object.keys(this.whereList).forEach((t=>{this._unclearable&&!this._unclearable[t]&&-1===this.joinAs.indexOf(t)&&delete this.whereList[t]})):this.whereList={},this}}c.prototype.getRunListItem=c.prototype.ubql,c.prototype.ubRequest=c.prototype.ubql,c.prototype.WhereCondition={gt:"more",">":"more",more:"more",lt:"less","<":"less",less:"less",eq:"equal","=":"equal",equal:"equal",ge:"moreEqual",geq:"moreEqual",">=":"moreEqual",moreEqual:"moreEqual",le:"lessEqual",leq:"lessEqual","<=":"lessEqual",lessEqual:"lessEqual",ne:"notEqual",neq:"notEqual","<>":"notEqual","!=":"notEqual","!==":"notEqual",notEqual:"notEqual",contains:"like",like:"like",notContains:"notLike",notLike:"notLike",isNull:"isNull",null:"isNull",notNull:"notIsNull",notIsNull:"notIsNull",isNotNull:"notIsNull",beginWith:"startWith",startWith:"startWith",startsWith:"startWith",startswith:"startWith",notBeginWith:"notStartWith",notStartWith:"notStartWith",notStartsWith:"notStartWith",includes:"in",in:"in",notIncludes:"notIn",notIn:"notIn",match:"match",subquery:"subquery",exists:"subquery",notExists:"subquery",custom:"custom"},c.prototype.UBQLv2=!0,c.prototype.CONSTANTS={selectSingleMoreThanOneRow:"Query for selectSingle returns more than 1 row. MUST be fixed by adding a correct where clause",selectScalarMoreThanOneRow:"Query for selectScalar returns more than 1 row. MUST be fixed by adding a correct where clause"},t.exports=c},605:(t,e,n)=>{const r=n(215),i=n(111).collationCompare;function o(t,e,n){Object.keys(t);const r=t.whereList;if(!r&&!t.ID)return[];const o=[],s=function(t){return t?(""+t).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""};function a(r){let a=r.expression||"";if("custom"===r.condition)throw new Error('Condition "custom" is not supported for cached entities');a=(a.replace(/(\[)|(])/gi,"")||"").trim();const c=e.indexOf(a);if(-1===c)throw new Error(`Filtering by attribute "${a}" which is not in fieldList is not allowed for cached entity "${t.entity}"`);let l;void 0!==r.value?l=r.value:void 0!==r.values&&(l=r.values[Object.keys(r.values)[0]]);const u=function(t,e,r){let o;const a="string"==typeof r;let c=a?r.toUpperCase():r;if(n&&"subquery"===e)return null;switch(e){case"like":return o=new RegExp(s(r),"i"),function(e){const n=e[t];return n&&o.test(n)};case"equal":return function(e){return e[t]===r};case"notEqual":return function(e){return e[t]!==r};case"more":return a?function(e){return 1===i(e[t],r)}:function(e){return e[t]>r};case"moreEqual":return a?function(e){return i(e[t],r)>=0}:function(e){return e[t]>=r};case"less":return a?function(e){return-1===i(e[t],r)}:function(e){return e[t]<r};case"lessEqual":return a?function(e){return i(e[t],r)<=0}:function(e){return e[t]<=r};case"isNull":return function(e){return null===e[t]};case"notIsNull":return function(e){return null!==e[t]};case"notLike":return o=new RegExp(s(r),"i"),function(e){const n=e[t];return n&&!o.test(n)};case"startWith":return function(e){const n=e[t];return!!n&&0===n.toUpperCase().indexOf(c)};case"notStartWith":return function(e){const n=e[t];return!n||0!==n.toUpperCase().indexOf(c)};case"in":return function(e){const n=e[t];return n&&r.indexOf(n)>=0};case"notIn":return function(e){const n=e[t];return n&&r.indexOf(n)<0};default:throw new Error("Unknown whereList condition")}}(c,r.condition,l);u&&o.push(u)}const c=t.ID;c&&a({expression:"[ID]",condition:"equal",values:{ID:c}});for(const t in r)r.hasOwnProperty(t)&&a(r[t]);return o}t.exports.doFilterAndSort=function(t,e){let n,r=this.doFiltration(t,e);const i=r.length;return this.doSorting(r,t,e),e.options&&(n=e.options.start||0,r=e.options.limit?r.slice(n,n+e.options.limit):r.slice(n)),{resultData:{data:r,fields:t.fields},total:i}},t.exports.byID=function(t,e){return this.doFilterAndSort(t,{ID:e})},t.exports.doFiltration=function(t,e,n){let r,i;const s=t.data,a=Boolean(e.ID),c=o(e,t.fields,n),l=c.length;if(0===l)return s;const u=[],p=s.length;let d=-1;for(;++d<p;){for(i=!0,r=-1;++r<l&&!0===i;)i=c[r](s[d]);if(i&&(u.push(s[d]),a))return u}return u},t.exports.doSorting=function(t,e,n){const o=[];if(n.orderList){r.each(n.orderList,(function(t){const n=e.fields.indexOf(t.expression);if(n<0)throw new Error(`Ordering by "${t.expression}" attribute that not in fieldList is not allowed`);o.push({idx:n,modifier:"desc"===t.order?-1:1})}));const s=o.length;if(s){const e=function(t,e){let n=0,r=-1;for(;++r<s&&0===n;){const s=o[r].idx;t[s]!==e[s]&&(n=i(t[s],e[s])*o[r].modifier)}return n};t.sort(e)}}},t.exports.whereListToFunctions=o,t.exports.selectResultToArrayOfObjects=function(t,e){const n=t.resultData.data,i=t.resultData.fields,o=n.length,s=o?new Array(o):[];e&&r.forEach(e,(function(t,e){const n=i.indexOf(e);n>=0&&(i[n]=t)}));for(let t=0;t<o;t++)s[t]=r.zipObject(i,n[t]);return s},t.exports.flatten=function(t,e){const n=[],r=e.fields;let i=-1,o=-1,s=0;const a=[],c=e.data.length;if(!t||!t.length)throw new Error("fieldList not exist or empty");1===t.length&&"*"===t[0]&&(t=e.fields),t.forEach((function(t){const e=r.indexOf(t);if(-1===e)throw new Error("Invalid field list. Attribute "+t+" not found in local data store");n.push(e)}));const l=t.length;for(a.length=c*(l+1);++o<l;)a[s]=t[s],s++;for(;++i<c;){o=-1;const t=e.data[i];for(;++o<l;)a[s++]=t[n[o]]}return{fieldCount:l,rowCount:c,values:a}},t.exports.arrayOfObjectsToSelectResult=function(t,e){const n=[];return t.forEach((function(t){const r=[];e.forEach((function(e){r.push(t[e])})),n.push(r)})),n},t.exports.truncTimeToUtcNull=function(t){if(!t)return t;let e=t.getMonth()+1;e=e<10?"0"+e:""+e;let n=t.getDate();return n=n<10?"0"+n:""+n,new Date(`${t.getFullYear()}-${e}-${n}T00:00:00Z`)},t.exports.iso8601ParseAsDate=function(t){const e=t?new Date(t):null;return e?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e},t.exports.convertResponseDataToJsTypes=function(t,e){if(e.entity&&e.resultData&&!e.resultData.notModified&&e.resultData.fields&&e.resultData.data&&e.resultData.data.length){const n=t.get(e.entity).getConvertRules(e.resultData.fields),r=n.length,i=e.resultData.data;if(r)for(let t=0,e=i.length;t<e;t++)for(let e=0;e<r;e++){const r=n[e].index;i[t][r]=n[e].convertFn(i[t][r])}}return e.resultLock&&e.resultLock.lockTime&&(e.resultLock.lockTime=e.resultLock.lockTime?new Date(e.resultLock.lockTime):null),e}},525:(t,e,n)=>{const r=n(215),i=n(605).iso8601ParseAsDate;function o(t){const e=this,n=Object.keys(t.domain),r=void 0===t.entityMethods;this.entities={},this.connections=t.connections,this.defaultConnection=void 0,this.connections&&this.connections.forEach((t=>{t.isDefault&&(this.defaultConnection=t)}));for(let i=0,o=n.length;i<o;i++){const o=n[i],s=t.domain[o];if(s.i18n&&s.i18n.attributes&&Array.isArray(s.i18n.attributes)){const t=s.i18n.attributes,e={};for(let n=0,r=t.length;n<r;n++){const r=t[n],i=r.name;if(!i)throw new Error("Invalid localization JSON for entity "+o);delete r.name,e[i]=r}s.i18n.attributes=e}e.entities[o]=r?new l(s,s.entityMethods||{},s.i18n,o,e):new l(s,t.entityMethods[o]||{},t.i18n[o],o,e)}this.orderedModels=[],this.models={},Object.keys(t.models).forEach((function(n){const r=t.models[n];e.models[n]=new s(r,n),e.orderedModels.push(e.models[n])})),e.orderedModels.sort(((t,e)=>t.order-e.order)),this.vendorModels=t.vendorModels?t.vendorModels.split(":"):[],this.customerModels=t.customerModels?t.customerModels.split(":"):[]}function s(t,e){this.name=e,this.path=t.path,t.needInit&&(this.needInit=t.needInit),t.needLocalize&&(this.needLocalize=t.needLocalize),this.order=t.order,this.moduleName=t.moduleName,this.clientRequirePath=t.moduleSuffix&&t.moduleName&&t.moduleName.startsWith("@")?this.moduleName+"/"+t.moduleSuffix:this.path,t.realPublicPath&&(this.realPublicPath=t.realPublicPath),t.realPath&&(this.realPath=t.realPath),this.version=t.version}function a(){}function c(t){this.selectName=t.selectName||"",this.execName=t.execName||this.selectName,this.pkGenerator=t.pkGenerator}function l(t,e,n,i,s){const l=this;let u,p;if(!n||"undefined"!=typeof process&&process.isServer||(r.merge(t,n),r.forEach(t.attributes,((t,e)=>{if(!t.dataType)throw new Error(`Invalid i18n for entity "${i}" - attribute "${e}" not exist in meta or it's dataType is empty`)}))),Object.defineProperty(this,"domain",{enumerable:!1,value:s}),this.code=i,this.modelName=t.modelName,this.overriddenBy=t.overriddenBy,this.name=t.name,t.caption&&(this.caption=t.caption),t.description&&(this.description=t.description),t.documentation&&(this.documentation=t.documentation),t.descriptionAttribute&&(this.descriptionAttribute=t.descriptionAttribute),t.cacheType&&(this.cacheType=t.cacheType),t.dsType&&(this.dsType=t.dsType),t.isUnity&&(this.isUnity=!0),t.isManyManyRef&&(this.isManyManyRef=!0),t.isFTSDataTable&&(this.isFTSDataTable=!0),this.sqlAlias=t.sqlAlias,this.connectionName=t.connectionName,this.connectionConfig=this.connectionName&&this.domain&&this.domain.connections?r.find(this.domain.connections,{name:this.connectionName}):void 0,this.mapping=void 0,t.mapping){const e=Object.keys(t.mapping);if(e.forEach((t=>{if(!o.dialectsPriority[t])throw new Error(`Invalid dialect ${t} in ${this.code} mapping`)})),e.length){const e=this,n=o.dialectsPriority[this.connectionConfig.dialect];r.forEach(n,(function(n){if(t.mapping[n])return e.mapping=new c(t.mapping[n]),!1}))}}this.dbKeys=t.dbKeys&&Object.keys(t.dbKeys).length?t.dbKeys:void 0,this.dbExtensions=t.dbExtensions&&Object.keys(t.dbExtensions).length?t.dbExtensions:void 0,this.attributes=new a,this.blobAttributes=[];const d=Array.isArray(t.attributes);r.forEach(t.attributes,((t,e)=>{d&&(e=t.code||t.name);const n=new y(t,e,l);"mi_dateTo"===n.code&&"undefined"!=typeof window&&(n.allowNull=!0),l.attributes[e]=n,n.dataType===o.ubDataTypes.Document&&this.blobAttributes.push(n)}));const h=Object.keys(t.mixins||{});this.mixins={},h.forEach((function(e){switch(u=t.mixins[e],p=n&&n.mixins?n.mixins[e]:null,e){case"mStorage":l.mixins[e]=new b(u,p,e);break;case"dataHistory":l.mixins[e]=new w(u,p,e);break;case"aclRls":l.mixins[e]=new x(u,p,e);break;case"fts":l.mixins[e]=new E(u,p,e);break;case"als":l.mixins[e]=new _(u,p,e);break;default:l.mixins[e]=new g(u,p,e)}})),this.entityMethods=e||{},t.privateSettings&&(this.privateSettings=t.privateSettings)}o.prototype.isEntityMethodsAccessible=function(t,e){const n=this.entities[t];return!!n&&(Array.isArray(e)?n.haveAccessToMethods(e):n.haveAccessToMethod(e))},o.prototype.get=function(t,e){const n=this.entities[t];if(!1!==e&&!n)throw new Error(`Entity with code '${t}' does not exist or not accessible`);return n},o.prototype.has=function(t){return!!this.entities[t]},o.prototype.eachEntity=function(t){return r.forEach(this.entities,t)},o.prototype.filterEntities=function(t){return r.isFunction(t)?r.filter(this.entities,t):r.filter(this.entities,(function(e){let n=!0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n=n&&e[r]===t[r]);return n}))},o.ubDataTypes={String:"String",Int:"Int",BigInt:"BigInt",Float:"Float",Currency:"Currency",Boolean:"Boolean",DateTime:"DateTime",Text:"Text",ID:"ID",Entity:"Entity",Document:"Document",Many:"Many",TimeLog:"TimeLog",Enum:"Enum",BLOB:"BLOB",Date:"Date",Json:"Json"},o.prototype.ubDataTypes=o.ubDataTypes,o.FLOATING_SCALE_PRECISION=o.prototype.FLOATING_SCALE_PRECISION=6,o.ExpressionType={Field:"Field",Expression:"Expression"},o.ubMixins={dataHistory:"dataHistory",mStorage:"mStorage",unity:"unity",treePath:"treePath"},o.ubServiceFields={dateFrom:"mi_datefrom",dateTo:"mi_dateto"},o.EntityDataSourceType={Normal:"Normal",External:"External",System:"System",Virtual:"Virtual"},o.EntityCacheTypes={None:"None",Entity:"Entity",Session:"Session",SessionEntity:"SessionEntity"},o.dialectsPriority={MSSQL2012:["MSSQL2012","MSSQL","AnsiSQL"],MSSQL2008:["MSSQL2008","MSSQL","AnsiSQL"],MSSQL:["MSSQL","AnsiSQL"],Oracle11:["Oracle11","Oracle","AnsiSQL"],Oracle10:["Oracle10","Oracle","AnsiSQL"],Oracle9:["Oracle9","Oracle","AnsiSQL"],Oracle:["Oracle","AnsiSQL"],PostgreSQL:["PostgreSQL","AnsiSQL"],AnsiSQL:["AnsiSQL"],Firebird:["Firebird","AnsiSQL"],SQLite3:["SQLite3","AnsiSQL"]},o.getPhysicalDataType=function(t){const e=o.ubDataTypes,n={};return this.physicalTypeMap||(n[e.Int]="int",n[e.Entity]="int",n[e.ID]="int",n[e.BigInt]="int",n[e.String]="string",n[e.Text]="string",n[e.Enum]="string",n[e.Float]="float",n[e.Currency]="float",n[e.Boolean]="boolean",n[e.Date]="date",n[e.DateTime]="date",this.physicalTypeMap=n),this.physicalTypeMap[t]||"auto"},o.jsonReplacer=function(t,e){const n=this.__proto__.forJSONReplacer;if(n){if(Object.prototype.hasOwnProperty.call(n,t)&&null===n[t])return;if("boolean"==typeof e&&e===n[t])return}if(("boolean"==typeof e||e)&&("customSettings"!==t||Object.keys(e).length))return e},s.prototype.needInit=!1,s.prototype.needLocalize=!1,s.prototype.realPublicPath="",a.prototype.asPlainJSON=function(){return JSON.parse(JSON.stringify(this,o.jsonReplacer))},l.prototype.forJSONReplacer={code:null,modelName:null,cacheType:"None",isFTSDataTable:null,isManyManyRef:null,blobAttributes:null,entityMethods:null},l.prototype.caption="",l.prototype.description="",l.prototype.documentation="",l.prototype.descriptionAttribute="",l.prototype.cacheType="None",l.prototype.dsType="Normal",l.prototype.isUnity=!1,l.prototype.isManyManyRef=!1,l.prototype.isFTSDataTable=!1,l.prototype.getEntityCaption=function(){return this.caption||this.description},l.prototype.attr=function(t,e){let n=this.attributes[t];return n||e||(n=this.getEntityAttribute(t)),n},l.prototype.getAttribute=function(t){const e=this.attributes[t];if(!e)throw new Error(`Attribute ${this.code}.${t} doesn't exist`);return e},l.prototype.eachAttribute=function(t){return r.forEach(this.attributes,t)},l.prototype.mixin=function(t){return this.mixins[t]},l.prototype.hasMixin=function(t){const e=this.mixins[t];return"audit"===t&&!e||!!e&&e.enabled},l.prototype.checkMixin=function(t){if(!this.hasMixin(t))throw new Error("Entity "+this.code+" does not have mixin "+t)};const u=["mi_owner","mi_createDate","mi_createUser","mi_modifyDate","mi_modifyUser","mi_deleteDate","mi_deleteUser","mi_data_id","mi_dateFrom","mi_dateTo","mi_unityEntity","mi_treePath"];function p(t){return t?new Date(t):null}function d(t){return"boolean"==typeof t?t:null==t||""===t?null:1===t||"1"===t}function h(t){return t?JSON.parse(t):null}function f(t){return"number"==typeof t?String(t):t||null}function m(t){this.expressionType=t.expressionType,this.expression=t.expression}function y(t,e,n){if(this.code=e,this.name=t.name,Object.defineProperty(this,"entity",{enumerable:!1,value:n}),this.dataType=t.dataType||"String",this.associatedEntity=t.associatedEntity,this.associationAttr=t.associationAttr,this.caption=t.caption||"",this.description=t.description||"",this.documentation=t.documentation||"",this.size=t.size||0,this.allowNull=!1!==t.allowNull,this.allowSort=!1!==t.allowSort,this.isUnique=!0===t.isUnique,this.defaultValue=t.defaultValue,this.readOnly=!0===t.readOnly,this.isMultiLang=!0===t.isMultiLang,this.cascadeDelete=!0===t.cascadeDelete,this.enumGroup=t.enumGroup,this.customSettings=t.customSettings||{},this.associationManyData=t.associationManyData,this.storeName=t.storeName,this.generateFK=!1!==t.generateFK,this.defaultView=!1!==t.defaultView,this.mapping=void 0,t.mapping){const e=this,i=Object.keys(t.mapping);if(i.forEach((function(t){if(!o.dialectsPriority[t])throw new Error(`Invalid dialect ${t} in ${n.code}.${e.code} mapping`)})),i.length){const n=o.dialectsPriority[this.entity.connectionConfig.dialect];r.forEach(n,(function(n){if(t.mapping[n])return e.mapping=new m(t.mapping[n]),!1}))}}this.physicalDataType=o.getPhysicalDataType(this.dataType||"String"),this.hasCatalogueIndex=!0===t.hasCatalogueIndex,t.privateSettings&&(this.privateSettings=t.privateSettings)}function g(t,e,n){this.code=n,r.assign(this,t),e&&r.assign(this,e)}function b(t,e,n){g.apply(this,arguments)}function w(t,e,n){g.apply(this,arguments)}function x(t,e,n){g.apply(this,arguments)}function E(t,e,n){g.apply(this,arguments)}function _(t,e,n){g.apply(this,arguments)}l.prototype.asPlainJSON=function(t=!0,e=!0){const n=JSON.parse(JSON.stringify(this,o.jsonReplacer));if(e&&"Virtual"!==n.dsType&&r.forEach(n.attributes,((t,e)=>{e.startsWith("mi_")&&u.includes(e)&&delete n.attributes[e]})),!t)return n;const i=[];for(const t in n.attributes){const e=Object.assign({name:t},n.attributes[t]);if(e.mapping&&!Array.isArray(e.mapping)){const t=[];for(const n in e.mapping){const r=e.mapping[n],i=Object.assign({name:n},r);t.push(i)}e.mapping=t}i.push(e)}return n.attributes=i,n},l.prototype.haveAccessToMethod=function(t){return"undefined"!=typeof App&&App.els?App.els(this.code,t):1===this.entityMethods[t]},l.prototype.filterAttribute=function(t){return r.isFunction(t)?r.filter(this.attributes,t):r.filter(this.attributes,(function(e){let n=!0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n=n&&e[r]===t[r]);return n}))},l.prototype.haveAccessToAnyMethods=function(t){const e=this;let n=!1;return(t||[]).forEach((function(t){n=UB.isServer&&process.isServer?n||App.els(e.code,t):n||1===e.entityMethods[t]})),n},l.prototype.haveAccessToMethods=function(t){const e=this;let n=!0;return(t||[]).forEach((function(t){n=UB.isServer&&process.isServer?n&&App.els(e.code,t):n&&1===e.entityMethods[t]})),n},l.prototype.addMethod=function(t){throw new Error("UBEntity.addMethod implemented only in HTTP worker thread")},l.prototype.getConvertRules=function(t){const e=this,n=[],r=o.ubDataTypes;return t.forEach((function(t,o){const s=e.attr(t);s&&(s.dataType===r.DateTime?n.push({index:o,convertFn:p}):s.dataType===r.Date?n.push({index:o,convertFn:i}):s.dataType===r.Boolean?n.push({index:o,convertFn:d}):s.dataType===r.Json?n.push({index:o,convertFn:h}):s.dataType===r.Enum&&n.push({index:o,convertFn:f}))})),n},l.prototype.getDescriptionAttribute=function(t){let e=this.descriptionAttribute||"caption";if(!this.attr(e)){if(!1!==t)throw new Error(`Missing description attribute for entity '${this.code}'`);e=void 0}return e},l.prototype.getEntityAttributeInfo=function(t,e){let n,r,i=this,s=this.code,a=null,c=null,l=[];if(-1===t.indexOf(".")?(r=t,n=1):(l=t.split("."),n=l.length,r=l[0]),e&&e>0)return{entity:s,attribute:i.attr(r),parentAttribute:null,attributeCode:r};-1===e&&(n-=1);let u=0;for(;i&&u<n;){if(r.indexOf("@")>-1){const t=r.split("@");s=t[1],i=this.domain.get(s),r=t[0]}if(a=c,c=i.attributes[r],!c)return;if("Enum"===c.dataType)break;if(c.dataType===o.ubDataTypes.Json&&u+1<n){a=c,c=void 0;break}u+=1,u<n&&(r=l[u],s=c.associatedEntity,i=c.getAssociatedEntity())}return{entity:s,attribute:c,parentAttribute:a,attributeCode:r}},l.prototype.getEntityAttribute=function(t,e){const n=this.getEntityAttributeInfo(t,e);return n?n.attribute:void 0},l.prototype.getAttributeNames=function(t){const e=[];return t?(r.forEach(this.filterAttribute(t),(function(t){e.push(t.code)})),e):Object.keys(this.attributes)},l.prototype.getEntityRequirements=function(t){const e=[];for(let n=0,r=(t=t||this.getAttributeNames()).length;n<r;++n){const r=this.getEntityAttribute(t[n]);r&&r.dataType===o.ubDataTypes.Entity&&-1===e.indexOf(r.associatedEntity)&&e.push(r.associatedEntity)}return e},l.prototype.checkAttributeExist=function(t,e){const n=this;(t=Array.isArray(t)?t:[t]).forEach((function(t){if(!n.getEntityAttributeInfo(t))throw new Error(e+(e?" ":"")+'The entity "'+n.code+'" does not have attribute "'+t+'"')}))},l.prototype.getEntityDescription=function(){return this.description||this.caption},l.prototype.getDetailsForUI=function(){const t=/^ID|mi_/,e=this.name,n=[];return this.domain.eachEntity((function(r){r.name!==e&&r.haveAccessToMethod("select")&&r.eachAttribute((function(r){r.associatedEntity!==e||r.customSettings&&r.customSettings.hiddenInDetails||t.test(r.name)||n.push(r)}))})),n},y.prototype.forJSONReplacer={code:null,name:null,allowNull:!0,allowSort:!0,isUnique:!1,readOnly:!1,isMultiLang:!1,cascadeDelete:!1,generateFK:!0,defaultView:!0,physicalDataType:null,hasCatalogueIndex:null},y.prototype.getAssociatedEntity=function(){return this.associatedEntity?this.entity.domain.get(this.associatedEntity):null},y.prototype.asPlainJSON=function(){return JSON.parse(JSON.stringify(this,o.jsonReplacer))},g.prototype.forJSONReplacer={enabled:!0,code:null},g.prototype.enabled=!0,b.prototype=Object.create(g.prototype),b.prototype.constructor=b,b.prototype.simpleAudit=!1,b.prototype.safeDelete=!1,w.prototype=Object.create(g.prototype),w.prototype.constructor=w,w.prototype.historyType="common",x.prototype=Object.create(g.prototype),x.prototype.constructor=x,x.prototype.aclRlsUseUnityName=!1,x.prototype.aclRlsSelectionRule="exists",E.prototype=Object.create(g.prototype),E.prototype.constructor=E,E.prototype.scope="connection",E.prototype.dataProvider="mixin",_.prototype=Object.create(g.prototype),_.prototype.constructor=_,_.prototype.alsOptimistic=!0,o.UBEntity=l,o.UBModel=s,o.UBEntity.UBEntityAttribute=y,t.exports=o},183:t=>{function e(t,e,r){const i=t,s=n(i.result.split("+")[0]),a=i.uData?JSON.parse(i.uData):{lang:"en",login:"anonymous"},c=i.result,l=e||"",u="undefined"!=typeof ncrc32?ncrc32(0,c+l):null;a.login||(a.login=i.logonname),Object.defineProperty(this,"sessionID",{enumerable:!0,writable:!1,value:s}),this.logonname=i.logonname,this.userData=a,this.authSchema=r||"UB",this.signature=function(t){let e;switch(this.authSchema){case"None":return"";case"UBIP":return this.logonname;case"ROOT":return process.rootOTP();default:return e=n(t?1:Math.floor(Date.now()/1e3)),t?s+e+n(1):s+e+n("undefined"!=typeof ncrc32?ncrc32(u,e):o(c+l+e))}},this.isAnonymous=function(){return"None"===this.authSchema},this.authHeader=function(t){return this.isAnonymous()?"":("Negotiate"===this.authSchema?"UB":this.authSchema)+" "+this.signature(t)}}t.exports=e,e.prototype.hexa8=function(t){const e=parseInt(t,10);return isNaN(e)?"00000000":e.toString(16).padStart(8,"0")};const n=e.prototype.hexa8,r={};let i;e.prototype.crc32=function(t,e,n,o){o=o||4294967295;let s=n=n||4294967295,a=r[e=e||79764919];a||(i=new TextEncoder,a=r[e]=function(){let t,n,r;const i=[],o=function(t,e){let n=0;for(;e;)n=2*n+t%2,t/=2,t-=t%1,e--;return n};for(t=255;t>=0;t--){for(r=o(t,32),n=0;n<8;n++)r=(2*r^(r>>>31)%2*e)>>>0;i[t]=o(r,32)}return i}());const c=i.encode(t);for(let t=0,e=c.length;t<e;t++)s=(s/256^a[s%256^c[t]])>>>0;return(s^o)>>>0};const o=e.prototype.crc32},273:(t,e,n)=>{const r=n(320),i=n(605),o=n(525),s=n(183),a=n(111);t.exports={CustomRepository:r,LocalDataStore:i,UBDomain:o,UBSession:s,formatByPattern:a}},111:t=>{const e={date:{month:"2-digit",day:"2-digit",year:"numeric"},dateFull:{month:"2-digit",day:"2-digit",year:"2-digit"},dateShort:{month:"2-digit",year:"2-digit"},dateFullLong:{month:"long",day:"2-digit",year:"numeric"},dateMYY:{month:"2-digit",year:"numeric"},dateMYLong:{month:"long",year:"numeric"},time:{hour:"2-digit",minute:"2-digit"},timeFull:{hour:"2-digit",minute:"2-digit",second:"2-digit"},dateTime:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"},dateTimeFull:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}},n={sum:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},numberGroup:{style:"decimal",useGrouping:!0,maximumFractionDigits:0},sumDelim:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},number:{style:"decimal",useGrouping:!1,maximumFractionDigits:0},decimal1:{style:"decimal",useGrouping:!0,maximumFractionDigits:1,minimumFractionDigits:1},decimal2:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},decimal3:{style:"decimal",useGrouping:!0,maximumFractionDigits:3,minimumFractionDigits:3},decimal4:{style:"decimal",useGrouping:!0,maximumFractionDigits:4,minimumFractionDigits:4},decimal5:{style:"decimal",useGrouping:!0,maximumFractionDigits:5,minimumFractionDigits:5},decimal6:{style:"decimal",useGrouping:!0,maximumFractionDigits:6,minimumFractionDigits:6}};let r=null;const i={en:"en-US",ru:"ru-RU",uk:"uk-UA",az:"az"};function o(t){return r?r(t):(t=t||_defaultLang).length<3&&i[t]?i[t]:t+"-"+t.toUpperCase()}"undefined"==typeof _defaultLang&&(_defaultLang="en"),_collator=void 0;let s={},a={};t.exports.formatDate=function(t,n,r=_defaultLang){if(!t)return"";if(t instanceof Date||(t=new Date(t)),a[r]||(a[r]={}),!a[r][n]){const t=e[n];if(!t)throw new Error(`Unknown date pattern ${n}`);const i=o(r);a[r][n]=new Intl.DateTimeFormat(i,t)}return a[r][n].format(t)},t.exports.formatNumber=function(t,e,r=_defaultLang){if(!t&&0!==t)return"";const i="number"==typeof t?t:parseFloat(t);if(Number.isNaN(i))return"";if(s[r]||(s[r]={}),!s[r][e]){const t=n[e];if(!t)throw new Error(`Unknown number pattern ${e}`);const i=o(r);s[r][e]=new Intl.NumberFormat(i,t)}return s[r][e].format(t)},t.exports.setLang2LocaleHook=function(t){r=t,s={},a={}},t.exports.datePatterns=Object.keys(e),t.exports.numberPatterns=Object.keys(n),t.exports.setDefaultLang=function(t){_defaultLang!==t&&(_defaultLang=t,_collator=void 0,"object"==typeof Intl&&Intl.Collator&&(_collator=new Intl.Collator(t,{numeric:!0})))},t.exports.collationCompare=function(t,e){return _collator?_collator.compare(t,e):t===e?0:t>e?1:-1}},84:()=>{Ext.define("UBS.ReportParamForm",{extend:"Ext.form.Panel",xtype:"reportparamform",layout:{type:"vbox",align:"stretch"},title:UB.i18n("reportParametersHeader"),collapsible:!0,initComponent:function(){var t=this;t.buttons=[{text:UB.i18n("BuildReport"),handler:function(){var e,n;n=t.up("form").isValid(),t.validateForm&&(n=t.validateForm()),n&&(t.getParameters&&(e=t.getParameters(t)),t.collapse(Ext.Component.DIRECTION_TOP,!1),t.fireEvent("buildReport",e,t))}}],t.addEvents("buildReport"),t.callParent(arguments)}})},31:(t,e,n)=>{const r=n(215);n(897);const i=n(67),o=new RegExp("\x3c!-- pagebreak --\x3e","gi");function s(t,e){let n=t.getElementsByTagName("head")[0],r=t.createElement("style");r.setAttribute("type","text/css");try{r.appendChild(t.createTextNode(e))}catch(t){r.cssText=e}n.appendChild(r)}Ext.define("UBS.ReportViewer",{extend:"Ext.form.Panel",layout:{type:"vbox",align:"stretch"},width:700,height:500,reportCSSAdded:!1,paramForm:null,contextMenu:null,initComponent:function(){let t,e,n=this;if(n.report&&!n.reportType&&(n.reportType=n.report.reportType),!n.reportType)throw new Error("config parameter reportType is undefined");let r=null;switch(n.reportType){case"pdf":e=t=Ext.create("UB.ux.PDFComponent",{flex:1});break;case"html":e=Ext.create("Ext.Component",{flex:1,margin:0,autoEl:{tag:"iframe"}}),n.contextMenu=Ext.create("Ext.menu.Menu"),n.report.allowExportToExcel&&(r={xtype:"button",ui:"default-toolbar",text:i.i18n("Excel"),handler:function(){n.exportToXLSX(n.report.allowExportToExcel)}}),t=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"stretch"},flex:1,items:[e,{padding:"2 0 2 0",layout:{type:"hbox"},items:[{flex:1},{xtype:"button",ui:"default-toolbar",text:i.i18n("Print"),handler:function(){n.reportControl.getEl().dom.contentWindow.print()}},r]}]});break;default:throw new Error("Unknown value "+n.reportType+" for reportType.")}n.items=[t],n.reportControl=e,n.report.init().then((function(){if(n.report.onParamPanelConfig){let t=n.report.onParamPanelConfig();return t&&n.addParamForm(t),!0}return!1})).then((function(t){if(t){if(!n.report.incomeParams||0===Object.keys(n.report.incomeParams).length||n.report.showParamForm)return!1;n.down("reportparamform").collapse(Ext.Component.DIRECTION_TOP,!1)}return n.report.makeReport(n.report.incomeParams)})).then((function(t){t&&t.reportData&&n.showReport(t.reportData),n.getEl()&&n.getEl().unmask(),n.reportDone=!0})),n.callParent(arguments)},exportToXLSX:function(t="xlsx"){let e,n=this;if(!0===t&&(t="xlsx"),!n.paramForm||n.report.incomeParams&&0!==Object.keys(n.report.incomeParams).length)e=n.report.incomeParams;else{if(!n.paramForm.isValid())return void $App.dialogInfo("reportParamsRequired");e=n.paramForm.getParameters(n.paramForm)}Ext.create("UBS.UBReport",{code:n.report.reportCode,type:t,params:e,language:$App.connection.userLang()}).makeReport().then((function(e){let r=new Blob([e.reportData],{type:"xls"===t.toLowerCase()?"application/vnd.ms-excel":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});window.saveAs(r,n.report.reportCode+"."+t)}))},addParamForm:function(t){var e=this;if(t instanceof Array){let e=t;t=Ext.create("UBS.ReportParamForm",{items:t,getParameters:function(t){let n={},i=t.getForm();return r.forEach(e,(function(t){n[t.name]=i.findField(t.name).getValue()})),n}})}e.paramForm=t,e.insert(0,t),t.on("buildReport",(function(t,n){e.getEl().mask(i.i18n("pleaseWait")),e.report.makeReport(t).then((function(t){e.showReport(t.reportData)}))}))},htmlReportDocClick:function(t){this.contextMenu&&this.contextMenu.isVisible&&this.contextMenu.hide()},showReport:function(t){let e=this;switch(e.reportType){case"pdf":if("string"==typeof t){let e=t.length,n=new Uint8Array(new ArrayBuffer(e));for(let r=0;r<e;r++)n[r]=t.charCodeAt(r);t=new Blob([n],{type:"application/pdf"})}else"object"==typeof t&&t instanceof ArrayBuffer&&(t=new Blob([t],{type:"application/pdf"}));e.reportControl.setSrc({blobData:t});break;case"html":let n=e.reportControl.getEl().dom,r=n.contentDocument;if(r.body.innerHTML=t.replace(o,'<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="mce-pagebreak"/>'),!e.reportCSSAdded){s(r,"body {\n    background-color: #FFFFFF;\n    color: #000000;\n    font-family: Verdana, Arial, Helvetica, sans-serif;\n    font-size: 14px;\n    line-height: 1.3;\n}\n.word-wrap {\n    word-wrap: break-word;\n    hyphens: auto\n}\n.mce-pagebreak {\n    cursor: default;\n    display: block;\n    border: 0;\n    width: 100%;\n    height: 5px;\n    border: 1px dashed #666;\n    margin-top: 15px;\n    page-break-before: always\n}\n@media print {\n    .mce-pagebreak {\n      border: 0\n    }\n    a {\n      text-decoration: none\n    }\n    @page { margin: 1cm; }\n    #Header, #Footer { display: none !important; }\n}@media screen{th { resize: both; overflow: auto; }}");let t=e.report.reportOptions.pageOrientation;"landscape"===t?s(r,"@page{size: landscape;}"):"portrait"===t&&s(r,"@page{size: portrait;}"),e.reportCSSAdded=!0}if(e.report.onReportClick){let t=r.getElementsByTagName("a");for(let n=0,r=t.length;n<r;n++)t[n].addEventListener("click",e.report.onReportClick.bind(e),!0)}r.addEventListener("click",e.htmlReportDocClick.bind(e),!0),e.report.onAfterRender&&e.report.onAfterRender(n)}e.getEl()&&e.getEl().unmask()},afterRender:function(){this.callParent(),this.reportDone||this.getEl().mask(i.i18n("pleaseWait"))},beforeDestroy:function(){this.contextMenu&&this.contextMenu.destroy(),this.callParent(arguments)}})},897:(t,e,n)=>{const r=n(411);SystemJS.has("mustache")||SystemJS.set("mustache",SystemJS.newModule(r));const i=n(619),o=n(67),s=n(575),a=n(215);function c(t,e,n,r){this.reportCode=t,this.reportType=e||"html",this.incomeParams=n||{},this.reportOptions={},this.lang=r,this.showParamForm=!1,"object"==typeof t&&(this.reportCode=t.code,this.reportType=t.type||"html",this.incomeParams=t.params,this.allowExportToExcel=t.allowExportToExcel,this.showParamForm=t.showParamForm||!1,this.lang=t.language,this.debug=t.debug)}c.makeReport=function(t,e,n){return new c(t,e,n).makeReport()},c.prototype.init=function(){const t=this;return t.isInited?Promise.resolve(!0):s.connection.Repository("ubs_report").attrs(["ID","report_code","name","template","code","model"]).where("[report_code]","=",t.reportCode).selectSingle().then((function(e){t.reportRW=e;const n=s.domainInfo.models[e.model],r=`${n.clientRequirePath}/reports/${t.reportCode}.js`,i=`clientRequire/${n.clientRequirePath}/reports/${t.reportCode}.template`;return Promise.all([s.connection.get(i),SystemJS.import(r)]).then((function([e,n]){return t.reportRW.templateData=e.data,t.prepareTemplate(),t.prepareCode(n),t.isInited=!0,!0}))}))},c.prototype.prepareTemplate=function(){this.reportRW.templateData=this.reportRW.templateData.replace(/<!--({{.+?}})-->/g,"$1"),this.reportRW.templateData=this.reportRW.templateData.replace(/<!--@\w+?[ ]*?".+?"-->/g,"");const t=this.reportRW.templateData.match(/(<!--%\w+?:(.+?)-->)/gi);t&&t.length&&t.forEach((t=>{let e=t.match(/<!--%(\w+?:.+?)-->/)[1];e=e.split(":"),this.reportOptions[e[0]]=e[1]}))},c.prototype.makeReport=function(t){const e=this;let n=a.clone(e.incomeParams);return t&&(n=a.assign(n,t)),e.init().then((function(){return e.buildReport(n)})).then((function(t){return e.makeResult(t)}))},c.prototype.buildXLSX=function(t,e){if(!t||"object"!=typeof t||t instanceof Array)throw new Error("reportData must be of type Object");return i.addBaseMustacheSysFunction(t),i.addMustacheSysFunction(t,this.lang),System.import("@unitybase/xlsx").then((i=>{let o;(e=e||{}).disableOptimization?(i.XLSXfromHTML.addMustacheSysFunction(t),o=r.render(this.reportRW.templateData,t)):o=i.XLSXfromHTML.mustacheRenderOptimization(this.reportRW.templateData,t,e.minLenOptimization);const s=new i.XLSXWorkbook({useSharedString:!!e.useSharedString});return new i.XLSXfromHTML(n.g.DOMParser,s,e.sheetConfig||[{name:"Sheet"}]).writeHtml({html:o,sourceData:t}),s.render()}))},c.prototype.buildHTML=function(t){if(!t||"object"!=typeof t||t instanceof Array)throw new Error("reportData must be of type Object");i.addBaseMustacheSysFunction(t);const e=s.connection.userLang();return i.addMustacheSysFunction(t,e),r.render(this.reportRW.templateData,t)},c.prototype.transformToPdf=function(t,e){return e=e||{},System.import("@unitybase/pdf").then((t=>t.PrintToPdf.requireFonts({fonts:e.fonts?e.fonts:[{fontName:"TimesNewRoman",fontStyle:"Normal"},{fontName:"TimesNewRoman",fontStyle:"Bold"},{fontName:"TimesNewRoman",fontStyle:"Italic"},{fontName:"TimesNewRoman",fontStyle:"BoldItalic"}]}).then((()=>t)))).then((n=>{let r={orientation:"landscape"===this.reportOptions.pageOrientation?"l":"p",font:{name:"TimesNewRoman",type:"Normal",size:12},margin:{top:5,right:5,bottom:8,left:5}};this.onTransformConfig&&(r=this.onTransformConfig(r));const i=new n.PrintToPdf(r);return i.writeHtml({html:t,orientation:this.reportOptions.pageOrientation,onPositionDetermine:e.onPositionDetermine}),this.pdf=i,!1===e.outputPdf?i:i.output("arrayBuffer").buffer}))},c.prototype.makeResult=function(t){if(!t)throw new Error(`Report ${this.reportCode} return empty report`);return{reportCode:this.reportCode,reportType:this.reportType,incomeParams:this.incomeParams,reportOptions:this.reportOptions,reportData:t}},c.prototype.prepareCode=function(t){const e=this;if(!t.reportCode)throw new Error("Report code is invalid or empty. You should use code like: exports.reportCode={ prepareData:function }; ");a.forEach(t.reportCode,(function(t,n){e[n]=t}))},c.prototype.buildReport=function(t){throw new o.UBError('Function "buildReport" not defined in the report code block')},c.prototype.getDocument=function(t){const e=JSON.parse(this.reportRW[t]),n={entity:"ubs_report",attribute:t,id:this.reportRW.ID,isDirty:!0===e.isDirty};return s.connection.getDocument(n,{resultIsBinary:!1})},c.cellInfo=function(t){let e=t.target;for(;e&&"TD"!==e.tagName;)e=e.parentNode;const n=e.cellIndex;let r=e;for(;r&&"TR"!==r.tagName;)r=r.parentNode;const i=r.rowIndex;let o=r;for(;o&&"TABLE"!==o.tagName;)o=o.parentNode;return{table:o,row:r,cell:e,colIndex:n,rowIndex:i}},window.UBS=window.UBS||{},window.UBS.UBReport=c,t.exports=c},885:()=>{Ext.define("UBS.cliUtils",{singleton:!0,atLeastOne:!0,ask:function(t,e,n){Ext.MessageBox.show({title:t,msg:e,buttons:Ext.MessageBox.OKCANCEL,fn:function(t){Ext.isFunction(n)?n(t):n&&Ext.isFunction(n.focus)&&setTimeout((function(){n.focus(!0)}),500)}})},showMessage:function(t,e,n){Ext.MessageBox.show({title:t,msg:e,buttons:Ext.Msg.OK,fn:function(t){Ext.isFunction(n)?n(t):n&&Ext.isFunction(n.focus)&&setTimeout((function(){n.focus(!0)}),500)}})},clearDirty:function(t){for(var e=0,n=t.fields.length;e<n;++e)t.fields[e].resetOriginalValue()},closeForm:function(t){t&&(t.isDirty()&&this.clearDirty(t),t.up("window").close())},browse:function(t){var e={entity:t.entityName,cmdType:UB.core.UBCommand.commandType.showList,cmdData:{params:[{entity:t.entityName,method:"select",fieldList:t.fieldList||"*",whereList:t.whereList}]},description:$App.domainInfo.get(t.entityName,!0).getEntityDescription(),isModal:!Ext.isDefined(t.isModal)||t.isModal,onItemSelected:t.onItemselected};UB.core.UBCommand.getCommandByEntityAndType(t.entityName,UB.core.UBCommand.commandType.showList),UB.core.UBApp.doCommand(e)},loadEntityByID:function(t,e,n,r,i){var o=this,s=[{entity:t,requestName:"entityByID",method:"select",fieldList:n||"*",whereList:{ID:{expression:"[ID]",condition:"equal",values:{ID:e}}}}];UB.core.UBDataLoader.loadStoresSimple({ubRequests:s,setStoreId:!0,callback:function(t){var n=t.entityByID.getAt(0);n?r.call(i,n):o.showMessage("cliUtils.loadEntityByID","Не знайдено запис з кодом "+e)},scope:i})},userIsMemberOf:function(t,e){var n=UB.core.UBApp.getUserData().roles.split(","),r=!0;if(!Ext.isArray(t))return-1!==n.indexOf(t);for(var i=0,o=t.length;i<o;++i)if(r=-1!==n.indexOf(t[i]),e){if(r)break}else if(!r)break;return r}})},332:()=>{Ext.define("UBS.dataBinder",{singleton:!0,applyBinding:function(frm){var bindedAttr,bindingObj,bindedProp,preparedList,curParsedExpr,curParsedExprForCheck,formAttrName,formAttr,parseRegexp=/\{((\w+)\.?([\.\w]+)?)\}/gi,callStack=[],prepareOne=function(val,fullAttr,firstAttr,thAttr){if(formAttrName="attr"+Ext.String.capitalize(firstAttr),formAttr=frm.getUBCmp(formAttrName),!formAttr)throw new Error("unexisted attribute ["+firstAttr+"] in dataBinding for "+bindedAttr+"."+bindedProp);if(preparedList[firstAttr]||(preparedList[firstAttr]={}),preparedList[firstAttr][bindedAttr]||(preparedList[firstAttr][bindedAttr]={}),!preparedList[firstAttr][bindedAttr][bindedProp]){try{eval(curParsedExprForCheck)}catch(t){console.error("INVALID expression in binding: "+bindedAttr+"."+bindedProp+"\n parsed expression: "+curParsedExpr+"\n error: "+t.message)}preparedList[firstAttr][bindedAttr][bindedProp]={method:"set"+Ext.String.capitalize(bindedProp),expr:curParsedExpr,forEval:'this.getUBCmp("attr'+Ext.String.capitalize(bindedAttr)+'").set'+Ext.String.capitalize(bindedProp)+"("+curParsedExpr+")"}}},expressionParser=function(t,e,n,r){return r?"NOT SUPPORTED YET!":'this.getUBCmp("attr'+Ext.String.capitalize(n)+'").getValue()'},expressionForCheckParser=function(t,e,n,r){return r?"NOT SUPPORTED YET!":'frm.getUBCmp("attr'+Ext.String.capitalize(n)+'").getValue()'},onBindedAttrChange=function(sender,newVal,oldVal){var dependentAttr,dependentProp,curAttrProps,nVal,stackPos,depList=this.dataBind._preparedList[sender.attributeName];for(dependentAttr in callStack.push(sender.attributeName),depList)if(stackPos=Ext.Array.indexOf(callStack,dependentAttr),-1===stackPos)for(dependentProp in curAttrProps=depList[dependentAttr],curAttrProps)nVal=eval(curAttrProps[dependentProp].expr),this.getUBCmp("attr"+Ext.String.capitalize(dependentAttr))[curAttrProps[dependentProp].method](nVal);stackPos=callStack.pop(),stackPos!==sender.attributeName&&console.error("pop %s but expect %s",stackPos,sender.attributeName)};for(bindedAttr in frm.dataBind._preparedList={},preparedList=frm.dataBind._preparedList,frm.dataBind)if("_"!==bindedAttr[0])for(bindedProp in bindingObj=frm.dataBind[bindedAttr],bindingObj)curParsedExpr=bindingObj[bindedProp].replace(parseRegexp,expressionParser),curParsedExprForCheck=bindingObj[bindedProp].replace(parseRegexp,expressionForCheckParser),bindingObj[bindedProp].replace(parseRegexp,prepareOne);for(bindedAttr in preparedList)frm.getUBCmp("attr"+Ext.String.capitalize(bindedAttr)).addListener("change",onBindedAttrChange,frm)}})},619:(t,e,n)=>{const{formatNumber:r,formatDate:i}=n(273).formatByPattern;function o(t,e,n){return function(o,s){const a=this,c=s(o),l=null!==a&&"object"==typeof a&&!(a instanceof Date);if(!c)return c;let u,p;if('""'===c)u=[];else if(u=JSON.parse("["+c+"]"),u<1)throw new Error('$format function require one or two parameter. {{#$f}}"amount"{{/f}} {{#$f}}"amount","sum"{{/f}} ');if(p=l?function(t,e){let n=t;return e.split(".").forEach((function(t){if(!n)throw new Error("Invalid property "+t);n=n[t]})),n}(a,u[0]):a,n&&null!=p&&("number"===n?p=Number(p):"date"!==n||p instanceof Date||(p=p?new Date(p):"")),"number"==typeof p){let n=r(p,u.length>1?u[1]:e||"sum",t);return"sumDelim"===e&&p<0&&(n='<span style="color: #ff0000;">'+n+"</span>"),n}return p&&p instanceof Date?i(p,u.length>1?u[1]:e||"date",t):p?""+p:""}}t.exports={addBaseMustacheSysFunction:function(t,e){t.i18n=function(){return UB.isServer?function(t){return UB.i18n(t,e)}:UB.i18n}},addMustacheSysFunction:function(t,e){e=e||"en",t.$f=t.$$f=function(){return o(e)},t.$fn=t.$$fn=function(){return o(e,"number","number")},t.$fs=t.$$fs=function(){return o(e,"sumDelim","number")},t.$crn=t.crn=function(){return o(e,"sum","number")},t.$fd=t.$$fd=function(){return o(e,"date","date")},t.$ft=t.$$ft=function(){return o(e,"time","date")},t.$fdt=t.$$fdt=function(){return o(e,"dateTime","date")},t.$fdts=t.$$fdts=function(){return o(e,"dateTimeFull","date")}}}},470:(t,e,n)=>{const r=n(67),i=n(575);let o=[];r.ns("UBS.Settings").findByKey=function(t){const e=o.find((e=>e.settingKey===t));return void 0===e&&r.logDebug(`value fom UBS.Settings[${t}] not found`),e},i.modelLoadedPromise=i.modelLoadedPromise.then((()=>r.Repository("ubs_settings").attrs(["ID","settingKey","name","description","type","settingValue","defaultValue"]).selectAsObject().then((function(t){return o=t,!0}))))},595:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(361),i=n.n(r)()((function(t){return t[1]}));i.push([t.id,".history-message-row-actual {\n    color: #2a36d3\n;\n}\n\n.history-message-cell-accept {\n    /*border-left-style: solid;\n    border-left-color: #0000C0;\n    border-left-width: 3px;*/\n    width:  5px;\n    background-color: #0000C0;\n}\n\n@keyframes blink-red {\n    0% { color: red; }\n    50% { color: rgba(255, 255, 255, 0.870588); }\n    100% { color: red; }\n}\n\n.message-menu-exists .x-btn-icon-el {\n    color: #ff4081 !important;\n    animation: blink-red 3s linear infinite;\n}\n\n.history-message-msg-div {\n    max-height: 150px;\n    overflow-y: hidden;\n}\n\n\n\n",""]);const o=i},361:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(i[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);r&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},455:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(487),i=n.n(r),o=n(595);i()(o.Z,{insert:"head",singleton:!1});const s=o.Z.locals||{}},487:(t,e,n)=>{"use strict";var r,i=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),o=[];function s(t){for(var e=-1,n=0;n<o.length;n++)if(o[n].identifier===t){e=n;break}return e}function a(t,e){for(var n={},r=[],i=0;i<t.length;i++){var a=t[i],c=e.base?a[0]+e.base:a[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var p=s(u),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==p?(o[p].references++,o[p].updater(d)):o.push({identifier:u,updater:m(d,e),references:1}),r.push(u)}return r}function c(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var o=n.nc;o&&(r.nonce=o)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var s=i(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var l,u=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function p(t,e,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=u(e,i);else{var o=document.createTextNode(i),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function d(t,e,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var h=null,f=0;function m(t,e){var n,r,i;if(e.singleton){var o=f++;n=h||(h=c(e)),r=p.bind(null,n,o,!1),i=p.bind(null,n,o,!0)}else n=c(e),r=d.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=a(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<n.length;r++){var i=s(n[r]);o[i].references--}for(var c=a(t,e),l=0;l<n.length;l++){var u=s(n[l]);0===o[u].references&&(o[u].updater(),o.splice(u,1))}n=c}}}},411:function(t,e){var n,r,i,o;o=function(t){var e=Object.prototype.toString,n=Array.isArray||function(t){return"[object Array]"===e.call(t)};function r(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}var s=RegExp.prototype.test,a=/\S/;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},l=/\s*/,u=/\s+/,p=/\s*=/,d=/\s*\}/,h=/#|\^|\/|>|\{|&|=|!/;function f(t){this.string=t,this.tail=t,this.pos=0}function m(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function y(){this.cache={}}f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},f.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},m.prototype.push=function(t){return new m(t,this)},m.prototype.lookup=function(t){var e,n,i,s=this.cache;if(s.hasOwnProperty(t))e=s[t];else{for(var a,c,l,u=this,p=!1;u;){if(t.indexOf(".")>0)for(a=u.view,c=t.split("."),l=0;null!=a&&l<c.length;)l===c.length-1&&(p=o(a,c[l])||(n=a,i=c[l],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(i))),a=a[c[l++]];else a=u.view[t],p=o(u.view,t);if(p){e=a;break}u=u.parent}s[t]=e}return r(e)&&(e=e.call(this.view)),e},y.prototype.clearCache=function(){this.cache={}},y.prototype.parse=function(e,r){var o=this.cache,c=e+":"+(r||t.tags).join(":"),m=o[c];return null==m&&(m=o[c]=function(e,r){if(!e)return[];var o,c,m,y,g=[],b=[],w=[],x=!1,E=!1;function _(){if(x&&!E)for(;w.length;)delete b[w.pop()];else w=[];x=!1,E=!1}function S(t){if("string"==typeof t&&(t=t.split(u,2)),!n(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(i(t[0])+"\\s*"),c=new RegExp("\\s*"+i(t[1])),m=new RegExp("\\s*"+i("}"+t[1]))}S(r||t.tags);for(var A,v,T,D,L,k,P=new f(e);!P.eos();){if(A=P.pos,T=P.scanUntil(o))for(var O=0,C=T.length;O<C;++O)y=D=T.charAt(O),function(t,e){return s.call(t,e)}(a,y)?E=!0:w.push(b.length),b.push(["text",D,A,A+1]),A+=1,"\n"===D&&_();if(!P.scan(o))break;if(x=!0,v=P.scan(h)||"name",P.scan(l),"="===v?(T=P.scanUntil(p),P.scan(p),P.scanUntil(c)):"{"===v?(T=P.scanUntil(m),P.scan(d),P.scanUntil(c),v="&"):T=P.scanUntil(c),!P.scan(c))throw new Error("Unclosed tag at "+P.pos);if(L=[v,T,A,P.pos],b.push(L),"#"===v||"^"===v)g.push(L);else if("/"===v){if(!(k=g.pop()))throw new Error('Unopened section "'+T+'" at '+A);if(k[1]!==T)throw new Error('Unclosed section "'+k[1]+'" at '+A)}else"name"===v||"{"===v||"&"===v?E=!0:"="===v&&S(T)}if(k=g.pop())throw new Error('Unclosed section "'+k[1]+'" at '+P.pos);return function(t){for(var e,n=[],r=n,i=[],o=0,s=t.length;o<s;++o)switch((e=t[o])[0]){case"#":case"^":r.push(e),i.push(e),r=e[4]=[];break;case"/":i.pop()[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}(function(t){for(var e,n,r=[],i=0,o=t.length;i<o;++i)(e=t[i])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(r.push(e),n=e));return r}(b))}(e,r)),m},y.prototype.render=function(t,e,n,r){var i=this.parse(t,r),o=e instanceof m?e:new m(e);return this.renderTokens(i,o,n,t,r)},y.prototype.renderTokens=function(t,e,n,r,i){for(var o,s,a,c="",l=0,u=t.length;l<u;++l)a=void 0,"#"===(s=(o=t[l])[0])?a=this.renderSection(o,e,n,r):"^"===s?a=this.renderInverted(o,e,n,r):">"===s?a=this.renderPartial(o,e,n,i):"&"===s?a=this.unescapedValue(o,e):"name"===s?a=this.escapedValue(o,e):"text"===s&&(a=this.rawValue(o)),void 0!==a&&(c+=a);return c},y.prototype.renderSection=function(t,e,i,o){var s=this,a="",c=e.lookup(t[1]);if(c){if(n(c))for(var l=0,u=c.length;l<u;++l)a+=this.renderTokens(t[4],e.push(c[l]),i,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(t[4],e.push(c),i,o);else if(r(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(e.view,o.slice(t[3],t[5]),(function(t){return s.render(t,e,i)})))&&(a+=c)}else a+=this.renderTokens(t[4],e,i,o);return a}},y.prototype.renderInverted=function(t,e,r,i){var o=e.lookup(t[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(t[4],e,r,i)},y.prototype.renderPartial=function(t,e,n,i){if(n){var o=r(n)?n(t[1]):n[t[1]];return null!=o?this.renderTokens(this.parse(o,i),e,n,o):void 0}},y.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},y.prototype.escapedValue=function(e,n){var r=n.lookup(e[1]);if(null!=r)return t.escape(r)},y.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="3.0.1",t.tags=["{{","}}"];var g=new y;return t.clearCache=function(){return g.clearCache()},t.parse=function(t,e){return g.parse(t,e)},t.render=function(t,e,r,i){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(o=t)?"array":typeof o)+'" was given as the first argument for mustache#render(template, view, partials)');var o;return g.render(t,e,r,i)},t.to_html=function(e,n,i,o){var s=t.render(e,n,i);if(!r(o))return s;o(s)},t.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,(function(t){return c[t]}))},t.Scanner=f,t.Context=m,t.Writer=y,t},e&&"string"!=typeof e.nodeName?o(e):(r=[e],void 0===(i="function"==typeof(n=o)?n.apply(e,r):n)||(t.exports=i))},575:t=>{"use strict";t.exports=$App},67:t=>{"use strict";t.exports=UB},215:t=>{"use strict";t.exports=_}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={id:t,exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__(332),__webpack_require__(885),__webpack_require__(455),__webpack_require__(470),__webpack_require__(897),__webpack_require__(84),__webpack_require__(31),unitybase_ubs=__webpack_exports__})();