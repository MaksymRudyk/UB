/*! For license information please see adminui.app.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.adminUI=t():e.adminUI=t()}(self,(function(){return function(){var e,t,n,i,o={385:function(e,t,n){const i=n(1972),o=n(1070);n(7631),n(5642),n(9897),e.exports={launchApp:function(){Ext.Window.prototype.floating={shadow:!1},Ext.util.Floating.prototype.shadow=!1,Ext.tip.QuickTip.prototype.shadow=!1,Ext.tip.Tip.prototype.shadow=!1,Ext.LoadMask.prototype.floating.shadow=!1,Ext.menu.Menu.prototype.shadow=!1,Ext.Editor.prototype.shadow=!1,Ext.form.field.ComboBox.prototype.defaultListConfig.shadow=!1,Ext.picker.Date.prototype.shadow=!1;const e=i.addResourceVersion;Ext.Loader.loadScriptBase=Ext.Loader.loadScript,Ext.Loader.loadScript=function(t){let n=t;this.getConfig().disableCaching||("string"==typeof t?n=e(n):(n=Ext.clone(t),n.url=e(n.url))),this.loadScriptBase(n)},Ext.Loader.loadScriptFileBase=Ext.Loader.loadScriptFile,Ext.Loader.loadScriptFile=function(e,t,n,i,o){try{throw new Error('Component "'+e+'" is loaded directly using Ext.require or inderectly by one of Ext.create({"requires":.., "extend": ..., "mixins": ...}) directive) - in UB>=4 use require() instead')}catch(e){console.warn(e)}Ext.Loader.isLoading=!0,SystemJS.import(e).then((function(){return t.call(i)}),(function(){return n.call(i)}))},Ext.onReady((function(){Ext.tip.QuickTipManager.init(),Ext.override(Ext.ZIndexManager,{_showModalMask:function(e){const t=this,n=e.el.getStyle("zIndex")-4,i=e.floatParent?e.floatParent.getTargetEl():e.container;let o=t.mask;o||(o=t.mask=Ext.getBody().createChild({role:"presentation",cls:"ub-mask"}),o.setVisibilityMode(Ext.Element.DISPLAY),o.on("click",t._onMaskClick,t)),o.maskTarget=i,o.setStyle("zIndex",n),o.show()}}),Ext.override(Ext.AbstractManager,{unregister:function(e){e.id?this.all.removeAtKey(e.id):this.all.remove(e)}}),Ext.override(Ext.LoadMask,{getMaskEl:function(){return(this.maskEl||this.el)&&(this.maskEl||this.el).setVisibilityMode(Ext.Element.DISPLAY),this.callParent(arguments)}}),Ext.override(Ext.menu.Menu,{onMouseLeave:function(e){let t=!1;this.items.each((function(e){e.menu&&e.menu.isVisible()&&(t=!0)})),t||(this.deactivateActiveItem(),this.disabled||this.fireEvent("mouseleave",this,e))}}),Ext.override(Ext.layout.component.field.Field,{beginLayoutFixed:function(e,t,n){const i=e.target,o=i.inputEl,r=i.inputWidth;i.el.setStyle("table-layout","fixed"),100!==t&&"%"!==n&&i.bodyEl.setStyle("width",t+n),o&&r&&o.setStyle("width",r+"px"),e.isFixed=!0}}),Ext.override(Ext.form.field.Text,{initComponent:function(){this.requiredCls="ub-require-control-u",this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.allowBlank||this.setAllowBlank(this.allowBlank)},fieldSubTpl:['<input id="{id}" type="{type}" role="{role}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','{%if (values.maxLength !== undefined){%} maxlength="{maxLength}"{%}%}','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' class="{fieldCls} {typeCls} {editableCls} {inputCls} x-form-field-text" />',{disableFormats:!0}],requireText:"",setAllowBlank:function(e){this.allowBlank=e,this.labelEl&&(e?this.labelEl.removeCls("x-label-required"):this.labelEl.addCls("x-label-required")),this.inputEl&&(e?(this.inputEl.removeCls(this.requiredCls),this.inputEl.dom.removeAttribute("placeholder")):(this.allowOnlyWhitespace=!1,this.inputEl.addCls(this.requiredCls),this.requireText&&this.inputEl.dom.setAttribute("placeholder",i.i18n(this.requireText))))}}),Ext.override(Ext.grid.plugin.RowEditing,{validateEdit:function(){const e=this,t=e.context;return!1!==e.fireEvent("validateedit",e,t)&&!t.cancel&&this.getEditor().completeEdit()}}),Ext.override(Ext.form.field.Base,{leftIndent:15,rightIndent:15,margin:"3 15 2 15",withoutIndent:!0,getLabelableRenderData:function(){const e=this.callParent(arguments);return this.withoutIndent||(e.leftIndent=this.leftIndent,e.rightIndent=this.rightIndent),e},labelableRenderTpl:['<tr role="presentation" id="{id}-inputRow" <tpl if="inFormLayout">id="{id}"</tpl> class="{inputRowCls}">','<tpl if="leftIndent">','<td class="labelable-left-indent" style="width: {leftIndent}px;" ></td>',"</tpl>",'<tpl if="labelOnLeft">','<td role="presentation" id="{id}-labelCell" style="{labelCellStyle}" {labelCellAttrs}>',"{beforeLabelTpl}",'<label id="{id}-labelEl" {labelAttrTpl}','<tpl if="inputId && !(boxLabel && !fieldLabel)"> for="{inputId}"</tpl>',' class="{labelCls}',"<tpl if=\"allowBlank !== undefined && !allowBlank && (extraFieldBodyCls !== 'x-form-cb-wrap')\"> x-label-required</tpl>",'"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="fieldLabel">{fieldLabel}','<tpl if="labelSeparator">','<span role="separator">{labelSeparator}</span>',"</tpl>","</tpl>","{afterLabelTextTpl}","</label>","{afterLabelTpl}","</td>","</tpl>",'<td role="presentation" class="{baseBodyCls} {fieldBodyCls} {extraFieldBodyCls}" id="{id}-bodyEl" colspan="{bodyColspan}">',"{beforeBodyEl}","<tpl if=\"labelAlign=='top'\">","{beforeLabelTpl}",'<div role="presentation" id="{id}-labelCell" style="{labelCellStyle}">','<label id="{id}-labelEl" {labelAttrTpl}<tpl if="inputId"> for="{inputId}"</tpl> class="{labelCls}',"<tpl if=\"allowBlank !== undefined && !allowBlank && (extraFieldBodyCls !== 'x-form-cb-wrap')\"> x-label-required</tpl>",'"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="fieldLabel">{fieldLabel}','<tpl if="labelSeparator">','<span role="separator">{labelSeparator}</span>',"</tpl>","</tpl>","{afterLabelTextTpl}","</label>","</div>","{afterLabelTpl}","</tpl>","{beforeSubTpl}","{[values.$comp.getSubTplMarkup(values)]}","{afterSubTpl}","<tpl if=\"msgTarget==='side'\">","{afterBodyEl}","</td>","<td role=\"presentation\" id=\"{id}-sideErrorCell\" vAlign=\"{[values.labelAlign==='top' && !values.hideLabel ? 'bottom' : 'middle']}\" style=\"{[values.autoFitErrors ? 'display:none' : '']}\" width=\"{errorIconWidth}\">",'<div role="alert" aria-live="polite" id="{id}-errorEl" class="{errorMsgCls}" style="display:none"></div>',"</td>","<tpl elseif=\"msgTarget=='under'\">",'<div role="alert" aria-live="polite" id="{id}-errorEl" class="{errorMsgClass}" colspan="2" style="display:none"></div>',"{afterBodyEl}","</td>","</tpl>",'<tpl if="rightIndent">','<td class="labelable-right-indent" style="width: {rightIndent}px;" ></td>',"</tpl>","</tr>",{disableFormats:!0}]}),Ext.override(Ext.form.FieldContainer,{margin:"0 15 0 15"}),Ext.override(Ext.layout.container.Accordion,{beforeRenderItems:function(e){for(let t=0,n=e.length;t<n;t++)e[t].simpleCollapse=!0;this.callParent([e])}}),Ext.define("Ext.ux.form.CheckboxGroupFix",{override:"Ext.form.CheckboxGroup",initComponent:function(){const e=this;e.invalidCls=e.invalidCls?e.invalidCls:Ext.baseCSSPrefix+"form-invalid",e.callParent(arguments)}}),Ext.define("UB.ux.UBToolTipOverride",{override:"Ext.tip.ToolTip",getTargetXY:function(){const e=this,t=this.callParent(arguments),n=Ext.getBody().getViewSize();return e.targetXY&&t[1]+e.getHeight()>n.height&&(t[1]=e.targetXY[1]-15-e.getHeight()),t}}),Ext.override(Ext.panel.Panel,{initTools:function(){const e=this;if(e.simpleCollapse){e.tools=[],e.toggleCmp=Ext.widget({xtype:"component",autoEl:{tag:"div"},height:15,width:35,isHeader:!0,id:e.id+"-legendToggle",style:"float: left; font-size: 1.4em; padding-left: 12px; cursor: pointer;",scope:e}),e.toggleCmp.on("boxready",(function(){})),e.collapsed?e.toggleCmp.addCls(["fa","fa-angle-right"]):e.toggleCmp.addCls(["fa","fa-angle-down"]);const t="left"===e.headerPosition||"right"===e.headerPosition;e.header=Ext.widget(Ext.apply({xtype:"header",title:e.title,titleAlign:e.titleAlign,orientation:t?"vertical":"horizontal",dock:e.headerPosition||"top",textCls:e.headerTextCls,iconCls:e.iconCls,icon:e.icon,glyph:e.glyph,baseCls:e.baseCls+"-header",tools:[e.toggleCmp],ui:e.ui,id:e.id+"_header",overCls:e.headerOverCls,indicateDrag:e.draggable,frame:(e.frame||e.alwaysFramed)&&e.frameHeader,ignoreParentFrame:e.frame||e.overlapHeader,ignoreBorderManagement:e.frame||e.ignoreHeaderBorderManagement,headerRole:e.headerRole,ownerCt:e,listeners:e.collapsible&&e.titleCollapse?{click:e.toggleCollapse,scope:e}:null},e.header)),e.header.titleCmp.flex=void 0,e.header.addCls(["accordion-header"]),e.addDocked(e.header,0)}else e.callParent(arguments)},toggleC:function(){this.toggleCmp&&(this.collapsed?(this.toggleCmp.removeCls("fa-angle-down"),this.toggleCmp.addCls("fa-angle-right")):(this.toggleCmp.removeCls("fa-angle-right"),this.toggleCmp.addCls("fa-angle-down")))},expand:function(e){this.callParent(arguments),this.toggleC()},collapse:function(e,t){this.callParent(arguments),this.toggleC()},updateCollapseTool:function(){this.simpleCollapse||this.callParent(arguments)}}),delete Ext.tip.Tip.prototype.minWidth,Ext.Ajax.timeout=12e4,"onHashChange"in window?window.addEventListener("hashchange",i.core.UBApp.locationHashChanged,!1):window.onhashchange=i.core.UBApp.locationHashChanged,Ext.state.Manager.setProvider(Ext.create("Ext.state.LocalStorageProvider")),o.launch().finally((function(){Ext.get(Ext.query("html.loading")).removeCls("loading")})),new Ext.util.KeyMap({target:window.document.body,binding:[{ctrl:!0,shift:!1,key:Ext.EventObject.R,fn:function(e,t){return t.stopEvent(),!1}}]}),Ext.EventManager.addListener(Ext.getBody(),"keydown",(function(e){const t=(e.getTarget().tagName||"").toLocaleLowerCase();e.getKey()===Ext.EventObject.BACKSPACE&&"textarea|input".indexOf(t)<0&&e.preventDefault()})),i.view.UBDropZone.init(),window.onbeforeunload=function(){const e=!("undefined"==typeof window||!window.localStorage)&&window.localStorage;e&&"true"===e.getItem(i.LDS_KEYS.PREVENT_CALL_LOGOUT_ON_UNLOAD)?e.setItem(i.LDS_KEYS.PREVENT_CALL_LOGOUT_ON_UNLOAD,"false"):(window.onbeforeunload=null,window.toLog=null,window.onerror=null,o.connection&&o.connection.logout())},document.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)})),Ext.JSON.encodeDate=JSON.stringify,window.toLog=function(e,t){console&&console.debug&&(t?console.debug(e.replace("%","%s"),t):console.debug(e))}},$App:o}},1070:function(e,t,n){const i=n(1972);n(287),n(475),n(4353),n(6872);const o=n(6486);Ext.define("UB.core.UBApp",{singleton:!0,uses:["UB.core.UBCommand"],mixins:{observable:"Ext.util.Observable"},core:null,__scanService:null,constructor:function(){return this.requireEncription=!1,this.credeltionalRequireCount=0,this.mixins.observable.constructor.call(this),this.connection=null,this.ubNotifier=null,this.domain=null,this.domainInfo=null,this.viewport=null,window.$App=this,this.modelLoadedPromise=Promise.resolve(!0),this.addEvents("portal:sidebar:desktopChanged","appInitialize","applicationReady","getDomainInfo","updateCenterPanel","windowActivated","windowDestroyed","buildMainMenu"),this},onPasswordChange:function(e){$App.dialogInfo("Your password is expired. Please change password").then((function(){$App.logout()}))},launch:function(){const e=this,t="function"==typeof window.redirectToLogin;return i.connect({host:window.location.origin,path:window.UB_API_PATH||window.location.pathname,onCredentialRequired:(t,n)=>{if(n)throw window.localStorage.setItem(i.LDS_KEYS.USER_DID_LOGOUT,"true"),new i.UBAbortError("Invalid credential (isRepeat === true)");const o="true"===window.localStorage.getItem(i.LDS_KEYS.SILENCE_KERBEROS_LOGIN);e.credeltionalRequireCount++;const r=t.authMethods.indexOf("Negotiate")>=0;if(o&&e.credeltionalRequireCount>16&&r)throw window.localStorage.removeItem(i.LDS_KEYS.SILENCE_KERBEROS_LOGIN),e.credeltionalRequireCount=0,new i.UBError("To many Negotiate authentication attempts. Most likely this is invalid network configuration. Try to reload page");if(o&&r)return Promise.resolve({authSchema:"Negotiate",login:"",password:"",registration:0});throw window.localStorage.setItem(i.LDS_KEYS.USER_DID_LOGOUT,"true"),new i.UBAbortError("UB.connection.setRequestAuthParamsFunction() not called")},allowSessionPersistent:t,onAuthorized:function(e){t&&window.localStorage.removeItem(e.__sessionPersistKey),window.localStorage.setItem(i.LDS_KEYS.USER_DID_LOGOUT,"false")},onAuthorizationFail:function(e,n){t&&window.localStorage.getItem(n.__sessionPersistKey)?window.redirectToLogin(e):i.showErrorWindow(e)},onNeedChangePassword:$App.onPasswordChange.bind($App),onGotApplicationConfig:function(e){o.defaultsDeep(e.appConfig,{comboPageSize:30,maxMainWindowTabOpened:40,storeDefaultPageSize:100,gridHeightDefault:400,gridWidthDefault:600,gridParentChangeEventTimeout:200,gridDefaultDetailViewHeight:150,formMinHeight:100,formMinWidth:300,formDefaultAutoFormWidth:300,formSaveMaskDelay:100,scanRecognizeProgressInterval:1e3,maxSearchLength:62,uiSettings:{adminUI:{defaultPasswordForDebugOnly:""}}}),i.appConfig=e.appConfig}}).then((function(t){e.connection=t,e.ubNotifier=t.ubNotifier;const n=t.preferredLocale;return e.domainInfo=t.domain,e.domainInfo.orderedModels.forEach((function(e){e.path&&"UB"!==e.name&&Ext.Loader.setPath(e.name,e.path)})),i.inject("allLocales?lang="+n).then((function(){let e=Promise.resolve(!0);return window.__modelInit.forEach((function(t){e=e.then((function(){return window.System.import(t)})).then((()=>$App.modelLoadedPromise))})),e}))})).then((function(){e.fireEvent("appInitialize",e)})).then((function(){return i.core.UBDataLoader.loadStores({ubRequests:[i.Repository("ubm_form").attrs(i.core.UBStoreManager.formAttributes).ubql(),i.Repository("ubm_enum").attrs(i.core.UBStoreManager.enumAttributes).ubql()],setStoreId:!0}).then((function(){return i.core.UBDataLoader.loadStores({ubRequests:[i.Repository("ubm_navshortcut").attrs(i.core.UBStoreManager.shortcutAttributes).orderBy("desktopID").orderBy("parentID").orderBy("displayOrder").orderBy("caption").ubql()],setStoreId:!0})}))})).then((function(){e.setLocalStorageProviderPrefix(e.connection.userLogin()),e.viewport=Ext.create("UB.view.Viewport"),e.viewport.show(),e.fireEvent("applicationReady"),e.locationHashChanged(),e.hideLogo()})).catch((function(t){throw e.hideLogo(),i.logError("Got error from getAppInfo %o",t),t}))},getImagePath:function(e){return"models/adminui-pub/themes/"+(i.connection.appConfig.uiSettings.adminUI.themeName||"UBGrayTheme")+"/ubimages/"+e},dialog:function(e,t,n){let o;switch((n=n||{}).icon||"QUESTION"){case"QUESTION":o=Ext.window.MessageBox.QUESTION;break;case"ERROR":o=Ext.window.MessageBox.ERROR;break;case"WARNING":o=Ext.window.MessageBox.WARNING;break;case"INFO":o=Ext.window.MessageBox.INFO}return new Promise((function(r){Ext.MessageBox.show({modal:!0,title:i.i18n(e),msg:i.i18n(t),buttons:n.buttons||Ext.MessageBox.YESNOCANCEL,icon:o,fn:function(e){r(e)}})}))},dialogYesNo:function(e,t){return new Promise((function(n){Ext.MessageBox.show({modal:!0,title:i.i18n(e),msg:i.i18n(t),buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(e){n("yes"===e)}})}))},dialogInfo:function(e,t){return new Promise((function(n){Ext.MessageBox.show({modal:!0,title:i.i18n(t||"info"),msg:i.i18n(e),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function(e){n("ok"===e)}})}))},notify:function(e,t,n){Ext.create("widget.uxNotification",{title:i.i18n(t),position:"t",slideInDuration:n||800,useXAxis:!0,autoShow:!0,cls:"ux-notification-light",bodyPadding:5,items:[{xtype:"component",autoEl:{tag:"div",html:i.i18n(e)}}]})},dialogError:function(e,t){return new Promise((function(n){Ext.MessageBox.show({modal:!0,title:i.i18n(t||"error"),msg:i.i18n(e),icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK,fn:function(){n(!0)}})}))},pdfSigner:function(){const e="@ub-e/nm-pdfsign"+(window.isDeveloperMode?"":"/dist/nm-pdfsign.min.js");return SystemJS.import(e).then((function(e){return e.connect()}))},docEdit:function(){const e="@ub-e/nm-docedit"+(window.isDeveloperMode?"":"/dist/nm-docedit.min.js");return SystemJS.import(e).then((function(e){return e.connect()}))},editDocument:function(e){return this.docEdit().then((function(t){return t.editDocument(e)}))},scanService:function(){const e="@ub-e/nm-scanner"+(window.isDeveloperMode?"":"/dist/nm-scanner.min.js");return SystemJS.import(e).then((function(e){return e.connect()}))},scannerSettings:function(){$App.scanService().then((function(e){return e.getDefaultSettings()})).then((function(e){$App.showModal({formCode:"ubm_desktop-scanerSettings",description:i.i18n("scannerSettings"),isClosable:!0,customParams:e}).then((function(e){"ok"===e.action&&$App.scanService().then((function(t){t.setDefaultSettings(e.params)}))}))}))},scan:function(e,t,n){const r={"image/jpeg":"JPEG","application/jpg":"JPEG",JPEG:"JPEG",PDF:"PDF",TIFF:"TIFF","PDF/A":"PDF/A"}[n]||n;return $App.scanService().then((function(n){$App.__scanService=n;let a=!1;const s=Ext.create("UB.view.StatusWindow",{title:e});function l(e){e&&"scan"===e.action&&e.pageNum>=0?s.setStatus(i.format(i.i18n("doScanPages"),e.pageNum+1)):e&&"recognize"===e.action&&e.pageNum>=0&&s.setStatus(i.format(i.i18n("doRecognizePages"),e.pageNum+1))}function c(e){return e>0?(s.setStatus(i.format(i.i18n("doScanPages"),e)),a?$App.dialog("scan","doYouWantResume",{buttons:14}).then((function(e){if("yes"===e)return u();if("no"===e)return s.setStatus(i.i18n("doFinishScan")),n.finishScan().then(null,null,l);if("cancel"===e)throw new i.UBAbortError})):(s.setStatus(i.i18n("doFinishScan")),n.finishScan().then(null,null,l))):$App.dialog("scan","noPaperInScanner",{buttons:9,icon:"INFO"}).then((function(e){if("ok"===e)return u();if("cancel"===e)throw new i.UBAbortError}))}function u(){return s.setStatus(i.i18n("doStartScan")),n.continueScan().then(c,null,l)}return n.getDefaultSettings().then((function(e){const l=o.merge(e,t||{});if(!l?.UBScan?.ScanSettings?.length)throw new i.UBError(i.format(i.i18n("setScannerSettings"),"$App.scannerSettings(); "));return"UnityBase"!==l.CurrentScanType&&l.FRScan&&l.FRScan.LastUsedScanner&&(r?(l.CurrentScanType="UnityBase",l.UBScan.LastUsedScanner=l.FRScan.LastUsedScanner):o.forEach(l.FRScan.ScanSettings,(function(e){e.Source===l.FRScan.LastUsedScanner&&(a=!!e.AllowAddPages)}))),"UnityBase"===l.CurrentScanType&&l.UBScan&&l.UBScan.LastUsedScanner&&(o.forEach(l.UBScan.ScanSettings,(function(e){e.Source===l.UBScan.LastUsedScanner&&(a=!!e.AllowAddPages)})),r&&(l.UBScan.OutputFormat=r)),s.setStatus(i.i18n("doStartScan")),n.lastScanedFormat=l.UBScan?.OutputFormat,n.startScan(l)})).then(c,null,l).finally((function(){s.close()})).catch((function(e){return n.cancelScan().then((function(){throw s.close(),e}))}))})).then((function(t){const n=$App.connection.appConfig.uiSettings.adminUI.recognitionEndpoint;return n&&"TIFF"===$App.__scanService.lastScanedFormat?function(t){let o=null;const r=i.base64toArrayBuffer(t),a=Ext.create("UB.view.StatusWindow",{title:e});return a.setStatus(i.i18n("doRecognizeDocument")),$App.connection.post(`${n}upload`,r,{headers:{"Content-Type":"application/octet-stream"}}).then((e=>{if(o=e&&e.data&&e.data.item,o)return $App.connection.post(`${n}transform`,{item:o,to:"pdf",blobInResponse:!0},{responseType:"arraybuffer",headers:{"Content-Type":"application/json"},timeout:6e5});throw new i.UBError("Error upload data to recognition server.")})).then((e=>($App.__scanService.lastScanedFormat="PDF",$App.connection.post(`${n}clean`,{item:o}).then((()=>e.data))))).finally((()=>{a.close()}))}(t):t}))},getViewport:function(){return this.viewport},getLogin:function(){return i.logDebug("UB.core.UBApp.getLogin is deprecated. Use $App.connection.userLogin() instead)"),this.connection.userLogin()},checkQueryString:function(){this.runLink(window.location.search)},runLink:function(e){const t=Ext.isString(e)?Ext.Object.fromQueryString(e.toLowerCase()):e;t&&(t.command&&t.command.length||t.cmdData)&&this.doCommand({commandCode:t.command,cmdData:t.cmdData,instanceID:parseInt(t.id,10),onDesktop:t.ondesktop,parent:t.parent,parentID:t.parentid})},doCommand:function(e){if(Ext.isString(e)&&(e=Ext.JSON.decode(e)),!Ext.isObject(e))throw new Error("invalid config passed to UBApp.doCommand");Ext.create("UB.core.UBCommand",e)},async runShortcutCommand(e,t){let n=e;if("number"!=typeof e){const t=i.core.UBStoreManager.getNavigationShortcutStore(),o=t.findExact("code",e);if(-1===o)throw new Error(`Shortcut with code ${e} not found`);n=t.getAt(o).get("ID")}const r=await i.core.UBStoreManager.getNavshortcutCommandText(n);if(!r)return void console.error(`Command for shortcut ${e} is empty or this is empty folder`);const a=o.clone(r);t?a.isModal=!0:(a.tabId="navigator"+n,a.target=$App.viewport.centralPanel),$App.doCommand(a)},showModal:function(e){return new Promise(((t,n)=>{const i={cmdType:"showForm",isModal:!0,isResizable:!1,isMaximizable:!1,isMinimizable:!1,isClosable:!!e.isClosable,description:e.description,formCode:e.formCode,customParams:e.customParams,deferred:{resolve:t,reject:n}};i.formCode||n(new Error("invalid config for showModal. formCode if undefined")),this.doCommand(i)}))},showAuditTrail({entityCode:e,instanceID:t,isModal:n}){$App.doCommand({renderer:"vue",isModal:n||!1,tabId:n?void 0:`${e}${t}-auditTrail`,title:`${i.i18n("Audit")} (${i.i18n(e)})`,cmdType:"showList",cmdData:{repository:()=>i.Repository("uba_auditTrail").attrs(["ID","actionTime","actionType","actionUserName","remoteIP","entity","parentEntity","request_id"]).where("parentEntityInfo_id","=",t,"parent").where("entityinfo_id","=",t,"instance").logic("([parent] OR [instance])").orderByDesc("actionTime"),columns:[{id:"actionTime",format:({value:e})=>i.formatter.formatDate(e,"dateTimeFull")},"actionType","actionUserName","remoteIP","entity","parentEntity","request_id"]},shortcutCode:`audit-${e}`})},setLocalStorageProviderPrefix:function(e){const t=Ext.state.Manager.getProvider();e+=i.core.UBLocalStorageManager.separator,t&&t.prefix!==e&&(t.prefix=e,t.state=t.readLocalStorage())},getUserData:function(){return i.logDebug("UB.core.UBApp.getUserData is deprecated. Use connection.userData() instead"),this.connection.userData()},getUiLanguage:function(){return i.logDebug("$App.getUiLanguage is DEPRECATED. Use $App.connection.userLang()"),this.connection.userLang()},logout:function(){(this.connection?this.connection.logout():Promise.resolve(!0)).catch((()=>!0)).then((function(){document.location&&document.location.href&&document.location.href.indexOf("#")>0?document.location.href=document.location.href.split("#")[0]:document.location.reload(!0)}))},locationHashChanged:function(){if(window.location.href&&window.location.href.indexOf("#")>0){if(!window.location.href.split("#")[1])return;const e=i.core.UBCommand.getCommandByUrl(window.location.href,$App.getViewport().centralPanel);e.instanceID?(e.tabId=e.entity+e.instanceID,e.instanceID=+e.instanceID):e.tabId="navigator"+function(e){const t=i.core.UBStoreManager.getNavigationShortcutStore(),n=t.findExact("code",e);return-1!==n?t.getAt(n).get("ID"):Ext.id()}(e.entity),i.core.UBApp.doCommand(e)}},hideLogo:function(){document.getElementById("UBLogo").style.display="none"},generateTabId:function(e){let t;return t=void 0===e.formCode?"-":"function"==typeof e.formCode?"func":e.formCode,e.entity+t+(e.instanceID?e.instanceID:"ext"+Ext.id(null,"addNew"))},downloadDocument:async function(e,t){const n=Object.assign({revision:1},e);t&&(t.isDirty&&(n.isDirty=t.isDirty,n.fileName=t.origName),t.revision&&(n.revision=t.revision)),await this.connection.xhr({url:"checkDocument",method:"GET",params:n});const i=await this.connection.getDocumentURL(n),o=document.createElement("A");o.href=i,o.download=t&&(t.origName||t.fName)||"downloadedFile",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}),e.exports=i.core.UBApp},6411:function(){Ext.define("UB.core.UBAppConfig",{singleton:!0,systemEntities:{desktop:{name:"ubm_desktop",fields:{caption:"caption",url:"url",isDefault:"isDefault"}},navigationShortcut:{name:"ubm_navshortcut",fields:{code:"code",desktopID:"desktopID",folderID:"parentID",isFolder:"isFolder",caption:"caption",commandCode:"cmdCode",inWindow:"inWindow",isCollapsed:"isCollapsed",displayOrder:"displayOrder",ubTreePath:"mi_treePath"}},form:{name:"ubm_form",fields:{code:"code",description:"description",caption:"caption",formType:"formType",formDef:"formDef",formCode:"formCode",entity:"entity",isDefault:"isDefault"}},_enum_:{name:"ubm_enum",fields:{eGroup:"eGroup",code:"code",name:"name",shortName:"shortName",sortOrder:"sortOrder"}}}})},4421:function(e,t,n){n(6411),n(6872),n(8623),n(375),n(5122),n(9368),n(6830);const i=n(6486);Ext.define("UB.core.UBCommand",{uses:["UB.core.UBApp","UB.view.ErrorWindow","UB.core.UBFormLoader","UB.view.BasePanel","UB.view.EntityGridPanel"],statics:{ubComponentNamePrefix:"attr",whereListParentID:"__parent",whereListInstanceID:"__parent",allPublicAttributesMask:"*",commandType:{showList:"showList",showForm:"showForm",showReport:"showReport"},errCode:{MODIFIED_BY_ANOTHER_USER:25},methodName:{SELECT:"select",INSERT:"insert",UPDATE:"update",DELETE:"delete",ADDNEW:"addnew",UNLOCK:"unlock",NEWVERSION:"newversion"},condition:{sqlecEqual:"equal",sqlecNotEqual:"notEqual",sqlecMore:"more",sqlecMoreEqual:"moreEqual",sqlecLess:"less",sqlecLessEqual:"lessEqual",sqlecIn:"in",sqlecNotIn:"notIn",sqlecIsNull:"isNull",sqlecNotIsNull:"notIsNull",sqlecLike:"like",sqlecNotLike:"notLike",sqlecStartWith:"startWith",sqlecNotStartWith:"notStartWith",sqlecCustom:"custom"},order:{sqlotAsc:"asc",sqlotDesc:"desc"},showAutoForm:function(){this.uiTag||(this.uiTag=`afm-${this.entity}`);const e=UB.core.UBCommand.createDefaultItems(this.entity,this.parentContext);this.windowCommandCode=UB.core.UBUtil.getNameMd5(this.entity+Ext.String.capitalize(this.commandType),e),this.description=$App.domainInfo.get(this.entity).caption,this.isDefaultForm=!0,this.onShowFormRun(e)},createDefaultItems:function(e,t){const n=[],o=$App.domainInfo.get(e),r=/^ID|^mi_/;if(!o)throw new Error("invalid entity "+e);return i.forEach(o.attributes,(function(e,i){!1===e.defaultView||r.test(i)||t&&t.hasOwnProperty(i)||n.push({attributeName:i,anchor:"100%"})})),{items:n}},getUBCmpUBName:function(e){return UB.core.UBCommand.ubComponentNamePrefix+Ext.String.capitalize(e)},getCommandByEntityAndType:function(e,t,n){return n&&t===UB.core.UBCommand.commandType.showList?{params:[{entity:e,method:UB.core.UBCommand.methodName.SELECT,fieldList:"*"}]}:null},addWhereListItemSelect:function(e,t,n,i,o){return e=e||{},i=i||"c"+(Ext.Object.getSize(e)+1),o=o||UB.core.UBCommand.condition.sqlecEqual,UB.connection.UBQLv2?e[i]={expression:"["+t+"]",condition:o,value:n}:(e[i]={expression:"["+t+"]",condition:o,values:{}},e[i].values[t]=n),e},resultDataRow2Object:function(e,t,n){const i=e.resultData.data[t||0],o=e.resultData.fields,r=o.length;let a=-1;const s={};for(;++a<r;)(!n||n.indexOf(o[a])>=0)&&(s[o[a]]=i[a]);return s},addMasterDetailRelation:function(e,t,n,i){const o=e||{};if(Object.keys(o).forEach((function(e){"__MD"===e.substring(0,4)&&delete o[e]})),t&&n)for(let e=0,r=Math.min(t.length,n.length);e<r;++e){let r=n[e];r&&r.indexOf("[")<0&&(r="["+r+"]");const a=o["__MD"+e]={expression:r,condition:"equal"},s=i&&i.get(t[e])?i.get(t[e]):0;UB.connection.UBQLv2?a.value=s:(a.values||(a.values={}),a.values[n[e]]=s)}return o},getCommandByUrl:function(e,t){const n=function(){throw new Error("Incorrect parameter for getCommandByUrl")};if((!e||e.indexOf("#")<0)&&n(),!(e=e.split("#")[1]))return;const i=function e(t){const i={};return t.forEach((function(t){t||n();const o=t.split("=");2!==o.length&&n();const r=o[0];let a=window.decodeURIComponent(o[1]);a&&a.indexOf("&")>=0?a=e(a.split("&")):a&&a.indexOf("=")>=0&&(a=e([a])),i[r]=a})),i}(e.split("&"));return i.params&&(i.cmdData={params:[JSON.parse(i.params)]},delete i.params),t&&!i.tabId&&(i.target=t,i.tabId=Ext.id()),i}},initialFieldValues:{},customParams:{},constructor:function(e){const t=this;if(t.commandConfig=e,t.commandType=e.cmdType||t.commandType,t.commandData=e.cmdData,t.commandCode=e.cmdCode,t.formCode=e.formCode,t.entity=e.entity,t.commandContext=e.commandContext,t.instanceID=e.instanceID||e.instanceId,Ext.isDefined(t.instanceID)&&Ext.isString(t.instanceID))try{t.instanceID=parseFloat(t.instanceID)}catch(e){}switch(t.callback=e.callback,t.eventHandler=e.eventHandler,t.scope=e.scope,t.store=e.store,t.requestStore=e.requestStore,t.addByCurrent=e.addByCurrent,t.__mip_ondate=e.__mip_ondate,t.target=e.target,t.openInBackgroundTab=e.openInBackgroundTab,t.__mip_recordhistory=e.__mip_recordhistory,t.detailAttribute=e.detailAttribute,t.parentID=e.parentID,t.description=e.description,t.title=e.title,t.stateId=e.stateId,t.createOnly=e.createOnly,t.columns=e.columns,t.scriptCode=e.scriptCode,t.hideHeaders=e.hideHeaders||!1,t.summary=e.summary,t.isModal=e.isModal||!1,t.isModalDialog=e.isModalDialog||!1,t.isResizable=void 0===e.isResizable||e.isResizable,t.isMaximizable=void 0===e.isMaximizable||e.isMaximizable,t.isClosable=void 0===e.isClosable||e.isClosable,t.onItemSelected=e.onItemSelected||Ext.emptyFn,t.initValue=e.initValue,t.applyValues=e.applyValues,t.initialFieldValues=e.initialFieldValues,t.customParams=e.customParams||{},t.isDetail=e.isDetail,t.parentContext=e.parentContext,t.filters=e.filters,t.autoFilter=e.autoFilter,t.details=e.details,t.selectedInstanceID=e.selectedInstanceID,t.tabId=e.tabId?""+e.tabId:e.tabId,t.customActions=e.customActions,t.sender=e.sender,t.onClose=e.onClose,t.pageSize=e.pageSize||UB.appConfig.storeDefaultPageSize,i.isFunction(e.cmpInitConfig)&&(e.cmpInitConfig=e.cmpInitConfig()),t.cmpInitConfig=Ext.clone(e.cmpInitConfig||{}),t.focusOnUpdate=e.focusOnUpdate,t.hideActions=e.hideActions,e.shortcutCode?t.uiTag=`nsc-${e.shortcutCode}`:e.formCode?t.uiTag=`frm-${e.formCode}`:t.uiTag=e.uiTag,Ext.isDefined(t.commandData)?(Ext.isString(t.commandData)&&(t.commandData=Ext.JSON.decode(t.commandData)),t.entity=t.entity||t.commandData.entity||(t.commandData.params?t.commandData.params[0].entity:null),t.commandConfig.entity=t.entity):t.commandData={params:[{entity:t.entity,method:UB.core.UBCommand.methodName.SELECT,fieldList:"*"}]},t.commandType){case"showList":t.showList();break;case"showForm":t.showForm();break;case"showReport":t.showReport();break;default:const e=UB.format('{0}: "{1}"',UB.i18n("unknownCommandType"),t.commandType);throw new Error(e)}},getFormParamFromCommandData:function(e){const t={};return e&&(e.formCode&&(t.formCode=e.formCode),e.formTitle&&(t.description=e.formTitle)),0===Object.keys(t).length?null:t},getFormParam:function(){const e=this;if(this.formParam)return this.formParam;if(this.commandData&&(this.formParam=this.getFormParamFromCommandData(this.commandData)))return this.formParam;if(e.formCode){const t=UB.core.UBStoreManager.getFormStore().findRecord("code",e.formCode,0,!1,!0,!0);if(!t)throw new Error('Unknown form code "'+e.formCode+'"');return this.formParam={formCode:e.formCode,caption:t.get("caption")?UB.i18n(t.get("caption").toString()):"",description:t.get("description")?UB.i18n(t.get("description").toString()):""},this.formParam}const t=UB.core.UBFormLoader.getFormByEntity(this.entity);return t?(this.formCode=t.get("code"),this.formParam={formCode:this.formCode,caption:t.get("caption")?UB.i18n(t.get("caption").toString()):"",description:t.get("description")?UB.i18n(t.get("description").toString()):""},this.formParam):void 0},showList(){const e=this,t=i.find(e.commandData.params,["entity",e.entity]);if(e.showListParam=t,!t){const t=UB.format(UB.i18n("unknownEntityInCommand"),"showList",e.entity);throw new UB.UBError(t)}("*"===t.fieldList||Array.isArray(t.fieldList)&&1===t.fieldList.length&&"*"===t.fieldList[0])&&(t.fieldList=$App.domainInfo.get(e.entity).getAttributeNames({defaultView:!0})),e.windowCommandCode=e.commandCode||UB.core.UBUtil.getNameMd5(e.entity+Ext.String.capitalize(e.commandType),t.fieldList),this.detailAttribute&&this.parentID&&-1===t.fieldList.indexOf(this.detailAttribute)&&t.fieldList.push({name:this.detailAttribute,visibility:!1}),e.instanceID&&(t.ID=e.instanceID,t.whereList=t.whereList||{},UB.core.UBCommand.addWhereListItemSelect(t.whereList,"ID",e.instanceID,UB.core.UBCommand.whereListInstanceID)),t.__mip_recordhistory=e.__mip_recordhistory;const n=e.cmpInitConfig||{};if(Ext.applyIf(n,{entityConfig:t,loadStoreImmediately:!0,filters:e.filters,store:e.requestStore,summary:e.summary,commandContext:e.commandContext,commandConfig:e.commandConfig,commandCode:e.commandCode,commandData:e.commandData,openInBackgroundTab:e.openInBackgroundTab,autoFilter:e.autoFilter,details:e.details,target:e.target,parentContext:e.parentContext,detailAttribute:e.detailAttribute,parentID:e.parentID,stateful:!0,stateId:e.stateId||UB.core.UBLocalStorageManager.getKeyUI(UB.core.UBUtil.gatherStr(e.windowCommandCode,"_","grid")),columns:e.columns,hideHeaders:e.hideHeaders,isModal:e.isModal,isModalDialog:e.isModalDialog,onClose:e.onClose,onItemSelected:e.onItemSelected,isDetail:e.isDetail,customActions:e.customActions,selectedRecordID:e.selectedInstanceID,focusOnUpdate:e.focusOnUpdate}),e.hideActions&&!n.hideActions&&(n.hideActions=e.hideActions),e.isDetail&&(n.height=UB.appConfig.gridDefaultDetailViewHeight),e.tabId){let t=Ext.getCmp(e.tabId);if(t&&t.activateByCommand&&t.activateByCommand(n),t=t&&t.getMainContainer?t.getMainContainer():t,t)return void t.ownerCt.setActiveTab(t);n.id=e.tabId,n.closable=!0}const o=Ext.create("UB.view.EntityGridPanel",n);e.bindFocus(o),"function"==typeof o.customInit&&(console.error("Function customInit is deprecated. You should use callback function initComponentStart in script file"),o.customInit()),e.showCommandResult(o,{isGrid:!0,title:e.description})},showForm:function(){const e=this;if(e.formCode=e.formCode||(e.formParam?e.formParam.formCode:void 0),"function"==typeof e.formCode)e.windowCommandCode=UB.core.UBUtil.getNameMd5(e.entity+Ext.String.capitalize(e.commandType),e.formCode.toString()),e.formCode(e.entity,e.instanceID,e.onFormCodeRun,e);else{const t=e.commandConfig;void 0!==t.instanceId&&(t.instanceID=t.instanceId),t.tabId||(t.tabId=$App.generateTabId({entity:t.entity,instanceID:t.instanceID,formCode:e.formCode}));let n=Ext.getCmp(t.tabId);if(n||(n=$App.viewport.centralPanel.down(`panel[tabID=${t.tabId}]`)),n)return void $App.viewport.centralPanel.setActiveTab(n);e.formParam=e.getFormParam(),e.caption=e.commandConfig&&e.commandConfig.description||e.caption||(e.formParam?e.formParam.caption:void 0),Ext.isDefined(e.formCode)?(e.windowCommandCode=e.formCode,UB.core.UBFormLoader.getFormViewAndController({formCode:e.formCode}).then((function(t){"vue"===t.formType?($App.connection.domain.models["adminui-vue"]||Error("To show a Vue forms @unitybase/adminui-vue model should be in application domain"),t.formController.mount(Object.assign({},e.commandConfig,{title:e.commandConfig.title||e.formParam.caption,rootComponent:t.formController.default,uiTag:e.uiTag}))):"module"===t.formType?t.formController.mount(Object.assign({},e.commandConfig,{uiTag:e.uiTag})):e.onShowFormRun(t.formView,t.formController)}))):UB.core.UBCommand.showAutoForm.call(e)}},onFormCodeRun:function(){const e=this;UB.core.UBFormLoader.getFormViewAndController({formCode:e.formCode}).then((function(t){e.onShowFormRun(t.formView,t.formController)}))},showReport:function(){const e=this,t=e.commandData,n=e.reportOptions||t.reportOptions||{};e.uiTag=`rpt-${t.reportCode}`;const o=Ext.create("UBS.UBReport",i.defaults(n,{code:t.reportCode,type:t.reportType,params:t.reportParams,language:$App.connection.userLang()}));o.init().then((function(){const n=Ext.create("UBS.ReportViewer",{report:o});n.target=e.target,e.showCommandResult(n,{stateId:t.code+(t.params?JSON.stringify(t.params):""),title:UB.i18n(o.reportRW.name)})}))},onShowFormRun:function(e,t){const n=this,i=n.cmpInitConfig||{};let o;n.entity=n.entity||e.entity,Ext.apply(i,{formCode:n.formCode,entityName:n.entity,instanceID:n.instanceID,commandContext:n.commandContext,commandConfig:n.commandConfig,sender:n.sender,store:n.store,addByCurrent:n.addByCurrent,__mip_ondate:n.__mip_ondate,commandCode:n.commandCode,commandData:n.commandData,target:n.target,openInBackgroundTab:n.openInBackgroundTab,parentContext:n.parentContext,isDetail:n.isDetail,initValue:n.initValue,applyValues:n.applyValues,initialFieldValues:n.initialFieldValues,customParams:n.customParams,eventHandler:n.eventHandler,isModal:n.isModal,onClose:n.onClose,tabID:n.tabId,hideActions:n.hideActions}),n.isDetail&&(i.height=UB.appConfig.gridDefaultDetailViewHeight),"function"!=typeof e?(i.dfm=e,i.functions=t,o=Ext.create("UB.view.BasePanel",i)):o=Ext.create(e,i),n.bindFocus(o),n.showCommandResult(o)},bindFocus:function(e){const t=this;t.sender&&e.on("destroy",(function(){t.sender&&Ext.callback(t.sender.focus,t.sender,[],10)}))},showCommandResult:function(e,t){const n=this,i=n.detailAttribute?UB.format(" ({0}: {1})",UB.i18n("Filter"),$App.domainInfo.get(n.entity).attr(n.detailAttribute).caption):"",o=n.__mip_recordhistory?" ("+UB.i18n("ChangesHistory")+")":"",r=e.disableAutoShow;t=t||{},e.uiTag=n.uiTag;const a=t.title||(n.caption||(n.formParam?n.formParam.caption||n.formParam.description:null)||$App.domainInfo.get(n.entity).caption)+i+o;if(!n.createOnly)if(e.target)if(e.target instanceof Ext.grid.Panel)e.dock="bottom",e.height||(e.height=Math.round(e.target.getHeight()/3)),n.title&&(e.title=n.title),e.target.addDocked(e);else if(e.title=n.title||a,e.tooltip=e.title,e.isBasePanel&&e.setTitle(e.title),e.target.setActiveTab)e.closable=!0,this.checkTabsCount(e.target)?(e.uiTag=n.uiTag,e.target.add(e),n.openInBackgroundTab||e.target.setActiveTab(e)):e.destroy();else if(e.target.add)e.target.removeAll(),e.target.add(e);else{for(;e.target.firstChild;)e.target.firstChild.remove();const t=e.target?.offsetParent?.getBoundingClientRect().height||$App.viewport.height-60;Ext.create("Ext.panel.Panel",{header:!1,layout:"fit",height:t,renderTo:e.target}).add(e)}else{const i={title:a,autoScroll:!0,border:0,layout:"fit",autoDestroy:!0,items:[e],dfm:e.dfm,isGrid:t.isGrid,stateful:!0,stateId:t.stateId||UB.core.UBLocalStorageManager.getKeyUI(UB.core.UBUtil.gatherStr(n.windowCommandCode,"_","window"))};if(!t.isGrid){const e=n.entity,t=n.instanceID||"new-"+Date.now(),o=UB.format("ub-wnd-{0}-{1}",n.entity,t);let r=Ext.WindowManager.get(o);if(r&&Ext.WindowManager.each((function(t){return t.entity!==e||!t.newInstance||(r=t,!1)})),r&&r.destroying&&(r.destroy(),r=null),r)return Ext.WindowManager.bringToFront(r),void r.getHeader().body.highlight("#FF9933");n.instanceID||(i.newInstance=!0,i.entity=n.entity),i.id=o}n.isDefaultForm&&(i.width=UB.appConfig.formDefaultAutoFormWidth),i.modal=UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditFormstrue||n.isModal||n.isModalDialog,i.resizable=n.isResizable,i.maximizable=n.isMaximizable,i.closable=n.isClosable,i.minWidth||(i.minWidth=300),i.minHeight||(i.minHeight=200),e.window=Ext.create("UB.view.BaseWindow",i),n.isModal&&(e.window.onItemSelect=i.onItemSelect)}if(e.window&&!r&&e.window.show(),e.window&&$App.connection.domain.models["adminui-vue"]&&void 0!==window.Vue&&n.commandConfig.isModal&&$App.connection.appConfig.uiSettings.adminUI.vueAutoForms){const t=window.Vue.prototype.$zIndex();e.window.addListener("statesave",(()=>{e.setZIndex(t)}))}Ext.callback(n.callback,n.scope||n,[e])},checkTabsCount:function(e){return!(e.items.getCount()>=UB.appConfig.maxMainWindowTabOpened&&(Ext.create("widget.uxNotification",{title:UB.i18n("info"),position:"t",slideInDuration:800,slideBackDuration:1500,slideInAnimation:"elasticIn",slideBackAnimation:"elasticIn",useXAxis:!0,autoShow:!0,cls:"ux-notification-light",iconCls:"ux-notification-icon-error",bodyPadding:5,items:[{html:UB.i18n("tabsCountLimitExceeded")}]}),1))}})},4353:function(e,t,n){n(2136),n(4421),n(6411),n(8623),Ext.define("UB.core.UBDataLoader",{singleton:!0,loadInstance:function(e){var t={entity:e.entityName,method:UB.core.UBCommand.methodName.SELECT,fieldList:e.fieldList,alsNeed:e.alsNeed,ID:e.id};e.lockType&&(t.lockType=e.lockType);var n=Ext.create("UB.ux.data.UBStore",{ubRequest:t,autoDestroy:!0,autoLoad:!1});return n.load().then((function(){var t;return n.getCount()>0&&((t=n.getAt(0)).resultLock=n.resultLock,t.resultAls=n.resultAls),e.callback&&(UB.logDebug("UBDataLoader.loadInstance with callback is DEPRECATED. Use UBDataLoader.loadInstance(..).then(..).catch(..) style"),Ext.callback(e.callback,e.scope,[t])),t}))},loadStores:function(e){var t,n,i={},o=[],r=e.ubRequests;if(Array.isArray(r)&&r.length){for(var a=0,s=r.length;a<s;++a)n=(t={ubRequest:r[a],autoLoad:!1,disablePaging:!0}).ubRequest.requestName||UB.core.UBUtil.getNameMd5(t.ubRequest.entity,t.ubRequest.fieldList,t.ubRequest.whereList),e.setStoreId&&(t.storeId=n),i[n]=Ext.create("UB.ux.data.UBStore",t),o.push(i[n].load());return Promise.all(o).then((function(t){if(!e.callback)return t;UB.logDebug("callback style of UBDataLoader.loadStores is deprecated. loadStores().then(...) or UBConnection methods or store.load().then(...)"),Ext.callback(e.callback,e.scope||this,[i])}))}throw new Error("Non-empty array must be passed to loadStores")},loadStoresSimple:function(e){var t,n,i,o;for(i=0,o=e.ubRequests.length;i<o;++i)n=(t=e.ubRequests[i]).requestName?t.requestName:"req"+ ++UB.core.UBService.TRANSACTION_ID,t.model||(t.model=Ext.define(n,{extend:"Ext.data.Model",idProperty:"ID",fields:t.fieldList}));return UB.core.UBDataLoader.loadStores(e)}})},2455:function(e,t,n){n(6411),n(6872),Ext.define("UB.core.UBEnumManager",{singleton:!0,uses:[],getArrayStore:function(e){var t,n=UB.core.UBUtil.getNameMd5("ubm_enum",e),i=UB.ux.data.UBStore.entityModelName(n);return Ext.ModelManager.getModel(i)||Ext.define(i,{extend:"Ext.data.Model",idProperty:"code",fields:["code","name","shortName","sortOrder"]}),(t=Ext.create("Ext.data.ArrayStore",{model:i,autoDestroy:!0,data:this.getGroupData(e)})).sort("sortOrder"),t},getDictionary:function(e,t){var n={};return UB.core.UBStoreManager.getEnumStore().each((function(i){i.get("eGroup")===e&&(n[i.get("code")]=i.get(t||"name"))})),n},getStore:function(e){return this.getArrayStore(e)},getUBStore:function(e,t){var n=Ext.create("UB.ux.data.UBStore",_.defaults(t||{},{ubRequest:{entity:"ubm_enum",method:UB.core.UBCommand.methodName.SELECT,fieldList:["eGroup","code","name","shortName","sortOrder"],whereList:{eGroup:{expression:"[eGroup]",condition:"equal",values:{eGroup:e}}},orderList:{byName:{expression:"name",order:"asc"}}},autoLoad:!1,autoDestroy:!0,disablePaging:!0,idProperty:"code"}));return n.load(),n},getGroupData:function(e){var t=[];return UB.core.UBStoreManager.getEnumStore().each((function(n){n.get("eGroup")===e&&t.push([n.get("code"),n.get("name"),n.get("shortName"),n.get("sortOrder")])})),t},getById:function(e,t){return UB.core.UBEnumManager.getStore(e).getById(t)}})},9628:function(e,t,n){n(6411),n(7027),n(8623),n(4421);const i=n(1972);Ext.define("UB.core.UBFormLoader",{uses:["UB.core.UBApp"],singleton:!0,formType:{auto:"auto",custom:"custom"},definedClasses:[],getComponentClassName:function(e){return this.getComponentPart(e,/(?:Ext.define\s*?\(\s*?["'])([\w.]+?)(?=["'])/,1)},getComponentPart:function(e,t,n){let o=t.exec(e);return o&&o.length>n?i.core.UBUtil.removeWhitespaces(o[n]):void 0},getFormByEntity:function(e,t){let n=i.core.UBStoreManager.getFormStore(),o=[],r=[];n.each((function(t){t.get("entity")===e&&(o.push(t),!0===t.get("isDefault")&&r.push(t))})),o.sort((function(e,t){let n=e.get("code"),i=t.get("code");return n<i?-1:n===i?0:1}));let a=i.connection.domain.models;r.sort((function(e,t){return a[t.get("model")].order-a[e.get("model")].order}));let s=r.length?r[0]:o[0];return t?o:s},undefineExtClass:function(e){let t,n=e.split("."),i=window;if(Ext.ClassManager.get(e)&&(delete Ext.ClassManager.classes[e],delete Ext.ClassManager.existCache[e],n.length)){t=n.pop();for(let e=0,t=n.length;e<t&&(i=i[n[e]],i);e++);i&&delete i[t]}},getFormViewAndController:function(e){let t=this,n=i.core.UBStoreManager.getFormStore().findRecord("code",e.formCode,0,!1,!0,!0);if(!n)throw new Error(`Unknown form code "${e.formCode}"`);let o,r,a=n.get("formType").toString(),s=n.get("formDef"),l=n.get("formCode"),c=n.get("model"),u=$App.domainInfo.models[c],d=`${u.clientRequirePath}/forms/${e.formCode}-fm.def`,f=`${u.clientRequirePath}/forms/${e.formCode}-fm.${"vue"===a?"vue":"js"}`;return"custom"===a?f="":"vue"!==a&&"module"!==a||(d=""),l||(f=""),s||(d=""),f&&(o=SystemJS.import(f)),d&&(r=SystemJS.import(d)),Promise.all([r,o]).then((([e,n])=>("auto"===a&&e.requires&&e.requires.length&&console.warn(`"requires" section in "${d}" form definition should be removed and replaced by require()`),"custom"===a&&("string"!=typeof e.formDef&&console.error(`Custom form "${d}" must export a Ext class name as string (Example: exports.formDef = 'UBM.userSettings')`),e=t.getExtClassByName(e.formDef)),{formType:a,formView:e?e.formDef?e.formDef:e:null,formController:n?n.formCode?n.formCode:n:null})))},getExtClassByName:function(e){let t=Ext.ClassManager.get(e);return i.core.UBFormLoader.definedClasses.find((t=>t===e))||i.core.UBFormLoader.definedClasses.push(e),t}})},9455:function(e,t,n){n(6411),n(8623),Ext.define("UB.core.UBLocalStorageManager",{singleton:!0,uses:["UB.core.UBApp"],separator:":",getKey:function(e,t){return UB.core.UBUtil.gatherStr(e,"_",t)},getKeyUI:function(e){return this.getKey(e,"UI")},getFullKey:function(e){var t=$App.connection.userLogin();return t&&t.length?t+this.separator+e:void 0},getItem:function(e,t,n,i){var o=this.getFullKey(e),r=o?UB.core.UBUtil.getLocalStorageItem(o):void 0;return(i||t)&&(r=Ext.JSON.decode(r,!0)),Ext.callback(t,n||this,[r]),r},setItem:function(e,t,n,i){var o=this.getFullKey(e);Ext.isObject(t)&&(t=Ext.JSON.encode(t)),o&&UB.core.UBUtil.setLocalStorageItem(o,t),Ext.callback(n,i||this)},removeItem:function(e,t,n){var i;(i=this.getFullKey(e))&&UB.core.UBUtil.removeLocalStorageItem(i),Ext.callback(t,n||this)},clear:function(e,t){UB.core.UBUtil.clearLocalStorage(),Ext.callback(e,t||this)},getUserKeys:function(e,t,n){var i,o,r=[],a=UB.core.UBUtil.getLocalStorageKeys();e=e||$App.connection.userLogin(),i=new RegExp(Ext.util.Format.format("(?:{0}{1})(.*)",e,this.separator));for(var s=0,l=a.length;s<l;++s)(o=UB.core.UBUtil.getRegExpGroup(a[s],i,1))&&r.push(o);return Ext.callback(t,n||this,[r]),r},getKeys:function(e,t){var n=UB.core.UBUtil.getLocalStorageKeys();return Ext.callback(e,t||Ext.global,[n]),n},removeUserItemsRegExp:function(e,t,n){var i=this.getUserKeys();t=t||this.removeItem,n=n||this;for(var o=0,r=i.length;o<r;++o)e.test(i[o])&&t.call(n,i[o])},removeUserDataUI:function(){var e=this.getKeys(),t=/_UI$/;e.forEach((function(e){t.test(e)&&localStorage.removeItem(e)}))}})},7093:function(e,t,n){n(8623),Ext.define("UB.core.UBPanelMixin",{statics:{orderIdAttributeName:"orderId",menuIdAttributeName:"menuId",actionIdAttributeName:"actionId",actionsArrayName:"actions",addBaseActionsMethodName:"addBaseActions",addBaseDockedItemsMethodName:"addBaseDockedItems",addBaseListenersMethodName:"addBaseListeners",actionId:{showDetail:"showDetail"},eventId:{showdetail:"showdetail"}},buildDetailList:function(){var e=[],t=this.details||[];if(t.length>0)e=t;else{if(!this.entityName)return[];e=$App.domainInfo.get(this.entityName).getDetailsForUI().map((e=>({entityName:e.entity.name,attribute:e.name})))}return e},preprocessPanel:function(){var e=this,t=UB.core.UBPanelMixin;e.entityDetails=e.buildDetailList(),e.addFunctions(),Ext.isDefined(e[t.actionsArrayName])||(e[t.actionsArrayName]=[]),Ext.callback(e[t.addBaseActionsMethodName],e),Ext.callback(e[t.addBaseDockedItemsMethodName],e),e.createActions(),e.mergeDockedItems(),Ext.callback(e[t.addBaseListenersMethodName],e),e.addAdditionalListeners()},addFunctions:function(){var e,t=this;if(t.functions)for(var n in Ext.isString(t.functions)&&(t.functions=Ext.decode(t.functions)),e=t.functions)t.functions.hasOwnProperty(n)&&("function"==typeof t[n]&&(e[n].$previous=t[n]),t[n]=e[n])},createActions:function(){var e,t,n=this;if(n.dfm&&n.dfm.actions)for(var i=0,o=n.dfm.actions.length;i<o;++i)t=n.dfm.actions[i],e=new Ext.Action({actionId:t.actionId,eventId:t.eventId,handler:n.onAction,scope:n}),t.iconCls&&e.setIconCls(t.iconCls),t.text&&e.setText(t.text),n.actions[t.actionId]=e},getDockedItemsByFilter:function(e){var t,n=[];if(!this.dockedItems)return n;for(var i=0,o=(t=Ext.isArray(this.dockedItems)?this.dockedItems:this.dockedItems.items).length;i<o;++i)UB.core.UBUtil.allPropsEqual(t[i],e)&&n.push(t[i]);return n},prepareMenu:function(e){for(var t,n,i=this,o=UB.core.UBPanelMixin,r=0,a=e.length;r<a;++r)n=e[r][o.orderIdAttributeName],(t=e[r][o.actionIdAttributeName])&&i.actions[t]&&(e[r]=i.actions[t],void 0!==n&&(e[r][o.orderIdAttributeName]=n)),e[r].menu&&i.prepareMenu(e[r].menu)},getMenu:function(e,t,n){var i,o;e=Ext.isArray(e)?e:e.menu?Ext.isArray(e.menu)?e.menu:e.menu.items.items:e.items.items,n=n||UB.core.UBPanelMixin.menuIdAttributeName;for(var r=0,a=e.length;r<a;++r)if((o=e[r]).menu){if(o[n]===t){i=o;break}if(i=this.getMenu(o,t,n))break}return i},mergeDockedItems:function(){var e,t,n,i;if(this.dfm&&this.dfm.dockedItems)for(var o=0,r=this.dfm.dockedItems.length;o<r;++o){var a=this.dfm.dockedItems[o];if(n={xtype:a.xtype,dock:a.dock},a.ui&&(n.ui=a.ui),(e=this.getDockedItemsByFilter(n)).length>0)for(var s=0,l=e.length;s<l;++s)for(var c=0,u=a.items.length;c<u;++c)if((t=a.items[c]).menu)if(this.prepareMenu(t.menu),t[UB.core.UBPanelMixin.menuIdAttributeName])if(i=this.getMenu(e[s].items,t[UB.core.UBPanelMixin.menuIdAttributeName])){t.text&&(i.text=t.text);for(var d=0,f=t.menu.length;d<f;++d)i.menu.splice(t.menu[d][UB.core.UBPanelMixin.orderIdAttributeName]<i.menu.length?t.menu[d][UB.core.UBPanelMixin.orderIdAttributeName]:i.menu.length,0,t.menu[d])}else e[s].items.push(t);else e[s].items.push(t);else e[s].items.splice(t[UB.core.UBPanelMixin.orderIdAttributeName]<e[s].items.length?t[UB.core.UBPanelMixin.orderIdAttributeName]:e[s].items.length,0,t[UB.core.UBPanelMixin.actionIdAttributeName]&&this.actions[t[UB.core.UBPanelMixin.actionIdAttributeName]]?this.createButtonAction(this.actions[t[UB.core.UBPanelMixin.actionIdAttributeName]]):t)}},onAction:function(e,t){Ext.callback(this.eventHandler,this,[this,e.eventId]),this.fireEvent(e.eventId,e)},addAdditionalListeners:function(){var e=this;e.dfm&&e.dfm.listeners&&Ext.Object.each(e.dfm.listeners,(function(t,n){"function"==typeof n&&e.addListener(t,n,e)}))},createButtonsWOText:function(e){for(var t=[],n=0,i=e.length;n<i;++n)t.push(this.createButtonWOText(e[n]));return t},createButtonAction:function(e){return Ext.apply(Ext.create("Ext.button.Button",e),{text:e.initialConfig.actionText||"",tooltip:e.getText()})},createButtonWOText:function(e){return Ext.apply(Ext.create("Ext.button.Button",e),{height:32,text:e.initialConfig.showText?e.initialConfig.actionText:"",tooltip:e.getText()})},createMenuItemLink:function(){return this.actions.commandLink=new Ext.Action({actionId:"commandLink",text:UB.i18n("link"),hideOnClick:!1,iconCls:"u-icon-share",menu:{showSeparator:!1,items:[{xtype:"textfield",isFormField:!1,selectOnFocus:!0,readOnly:!0,minWidth:200,fieldLabel:UB.i18n("External")}]},listeners:{activate:function(e){e.menu.items.getAt(0).setValue(UB.format("{0}//{1}{2}#{3}",window.location.protocol,window.location.host,window.location.pathname,this.createCommandLink()))},scope:this}}),Ext.create("Ext.menu.Item",this.actions.commandLink)},createCommandLink:function(){var e,t,n=this,i=[],o=n.commandConfig;return n.commandConfig&&(i.push("cmdType="+n.commandConfig.cmdType),n.commandConfig.entity&&i.push("entity="+n.commandConfig.entity),n.commandConfig.formCode&&i.push("formCode="+n.commandConfig.formCode),n.instanceID&&i.push("instanceID="+n.instanceID),o.cmdData&&o.cmdData.params&&o.cmdData.params.length>0&&(e=o.cmdData.params[0],t=_.clone(e),i.push("params="+encodeURIComponent(JSON.stringify(t))))),i.join("&")},createMenuItemDetails:function(){var e,t,n=[],i=this.entityDetails;for(let o=0,r=i.length;o<r;++o)t=i[o],e=$App.domainInfo.get(t.entityName),n.push(new Ext.Action({actionId:UB.core.UBPanelMixin.actionId.showDetail,text:t.caption||`${e.caption} (${e.attr(t.attribute).caption})`,entityName:t.entityName,attribute:t.attribute,eventId:UB.core.UBPanelMixin.eventId.showdetail,handler:this.onAction,scope:this}));return Ext.create("Ext.menu.Item",{text:UB.i18n("Details"),hideOnClick:!1,actionId:UB.core.UBPanelMixin.actionId.showDetail,menu:{items:n}})}})},7027:function(e,t,n){n(1070),n(6411),Ext.define("UB.core.UBService",{singleton:!0,TRANSACTION_ID:0,method:{runList:"runList",getDocument:"getDocument"},enableBuffer:20,callTask:null,callBuffer:[],getUrl:function(){throw new Error("deprecated. Use methods from $App.connection \r\n $App.connection.authorize().then(function(session){\r\n me.dom.href = Ext.String.urlAppend( me.href, 'session_signature='+session.signature())\r\n})\r\n")},runList:function(e,t,n){UB.logDebug("UBService.runList is deprecated. Use $App.connection.run({entity:...}).then(..) or runTrans([{entity:...}])");var i=this,o=i.enableBuffer;Ext.isArray(e)||(e=[e]),o&&1===e.length?(i.callBuffer.push({transactionId:++UB.core.UBService.TRANSACTION_ID,params:e[0],callback:t,scope:n}),i.callTask||(i.callTask=new Ext.util.DelayedTask(i.combineAndSend,i)),i.callTask.delay(Ext.isNumber(o)?o:10)):i.sendRequest(e,t,n)},combineAndSend:function(){var e=this;e.callBuffer.length>0&&(e.sendRequest(),e.callBuffer=[])},sendRequest:function(e,t,n){var i=[],o={};e?i=e:Ext.each(this.callBuffer,(function(e){o[e.transactionId]={fn:e.callback,scope:e.scope},e.params.transactionId=e.transactionId,i.push(e.params)})),$App.connection.post("ubql",i).then((function(i){let r=i.data,a=i.config.data;e?Ext.callback(t,n,[r,a]):Ext.each(r,(function(e,t){var n=o[e.transactionId];Ext.callback(n.fn,n.scope,[[e],a[t]],0)}))}),(function(i){throw e?Ext.callback(t,n,[{serverFailure:!0}]):Ext.Object.each(o,(function(e,t){Ext.callback(t.fn,t.scope,[{serverFailure:!0}],0)})),i.data&&i.data.errMsg?new Error(i.data.errMsg):i}))},getDocument:function(e,t,n,i){var o,r=this,a=Ext.apply({},i),s=["entity","attribute","ID","id","isDirty","forceMime","fileName","store","revision"],l={url:"getDocument",method:a.usePostMethod?"POST":"GET"};return i&&i.binary&&(l.responseType="arraybuffer"),a.usePostMethod?(l.data=_.clone(e),Object.keys(l.data).forEach((function(e){-1===s.indexOf(e)&&(delete l.data[e],UB.logDebug('invalid parameter "'+e+'" passed to getDocument request'))}))):l.params=e,o=$App.connection.xhr(l).then((function(i){return t&&Ext.callback(t,n||r,[i.data,e]),i.data})).catch((function(){UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>")})),t?null:o},setDocument:function(){throw new Error("UBService.setDocument is deprecated!!")},setUserData:function(){throw new Error("deprecated. Use uba_user.changeLanguage")}})},6872:function(e,t,n){n(6411),n(8623),Ext.define("UB.core.UBStoreManager",{singleton:!0,getStore:function(e,t,n){return Ext.data.StoreManager.lookup(UB.core.UBUtil.getNameMd5(e,t,n))},getSystemEntityStoreGetterName:function(e){return"get"+Ext.String.capitalize(e)+"Store"},getSystemEntityStore:function(e){return this[this.getSystemEntityStoreGetterName(e)]()},shortcutCommandCache:{},shortcutAttributes:["ID","desktopID","parentID","code","isFolder","caption","inWindow","isCollapsed","displayOrder","iconCls"],formAttributes:["ID","code","description","caption","formType","formDef","formCode","entity","model","isDefault"],enumAttributes:["ID","eGroup","code","name","shortName","sortOrder"],updateNavshortcutCacheForItem:function(e,t=!0){if(!e.cmdCode)return;const n=Ext.JSON.decode(e.cmdCode);return n.title||(n.title=e.caption),n.shortcutCode=e.code,(UB.core.UBStoreManager.shortcutCommandCache[e.ID]||t)&&(UB.core.UBStoreManager.shortcutCommandCache[e.ID]=n),n},async getNavshortcutCommandText(e){return UB.core.UBStoreManager.shortcutCommandCache[e]||UB.Repository("ubm_navshortcut").attrs(["ID","cmdCode","caption","code"]).where("ID","=",e).selectSingle().then(this.updateNavshortcutCacheForItem)},getNavigationShortcutStore:function(){return this.getStore("ubm_navshortcut",this.shortcutAttributes)},getFormStore:function(){return this.getStore("ubm_form",this.formAttributes)},getEnumStore:function(){return this.getStore("ubm_enum",this.enumAttributes)},get_enum_Store:function(){return this.getEnumStore()}})},8623:function(e,t,n){const i=n(6486);n(6411);const o=n(9274).UBDomain,r=n(1972),a=["__mip_ondate ","__mip_recordhistory","__mip_recordhistory_all","__mip_disablecache","__allowSelectSafeDeleted"];Ext.define("UB.core.UBUtil",{singleton:!0,getLocalStorageKeys:function(){let e=[],t=window.localStorage;if(t)for(var n=0,i=t.length;n<i;++n)e.push(t.key(n));return e},getLocalStorageItem:function(e){return window.localStorage?window.localStorage.getItem(e):void 0},setLocalStorageItem:function(e,t){window.localStorage&&window.localStorage.setItem(e,t)},removeLocalStorageItem:function(e){window.localStorage&&window.localStorage.removeItem(e)},clearLocalStorage:function(){window.localStorage&&window.localStorage.clear()},extractfromBrackets:function(e){return Array.isArray(e)&&(e=e.join(",")),"string"==typeof e?e.replace(/\[([^\]]*?)]/g,"$1"):e},removeWhitespaces:function(e){return"string"==typeof e?e.replace(/\s/g,""):e},gatherStr:function(e,t,n){return t=t||"",n=n||"",(e=e||"").length?n.length?e+t+n:e:n},getWindowHeight:function(){return(window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight?document.body.clientHeight:400)-200},getWindowWidth:function(){return(window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth?document.body.clientWidth:800)-200},allPropsEqual:function(e,t){for(let n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0},getNameMd5:function(e,t){let n="";if(0!==arguments.length){e=arguments[0];for(let e=1,t=arguments.length;e<t;++e){let t=arguments[e],i=JSON.stringify(t);n=this.gatherStr(n,"_",i)}return this.gatherStr(e,"_",n&&n.length?r.MD5(n).toString():"")}},getRegExpGroup:function(e,t,n){var i=t.exec(e);return i&&i.length>n?i[n]:void 0},getByPropertyValue:function(e,t,n){throw new Error("UBUtils.getByPropertyValue is obsolete. Use _.find(array, [propertyName, propertyValue])")},getProperty:function(e,t){var n=Ext.isString(e)?Ext.JSON.decode(e,!0):e;return n?n[t]:void 0},isEqual:function(e,t){return Ext.isDate(e)&&Ext.isDate(t)?Ext.Date.isEqual(e,t):e===t},dateISO8601Parse:function(e){var t;return Ext.isDate(e)?e:isNaN(t=Date.parse(e))?null:new Date(t)},addPrefix:function(e,t,n){var i=[];if(!Array.isArray(e))return i;for(var o=0,r=e.length;o<r;++o)i.push(this.gatherStr(t,n,e[o]));return i},isObjectEqual:function(e,t){throw new Error("UBUtils.isObjectEqual is obsolete")},isArrayEqual:function(e,t){throw new Error("UBUtils.isArrayEqual is obsolete")},base64String:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64fromArrayBuffer:function(){throw new Error("UB.core.UBUtil.base64fromArrayBuffer deprecated. Use UB.base64fromArrayBuffer")},base64toArrayOfFloats:function(e){for(var t=this.toArrayBuffer(e),n=new Float32Array(t),i=[],o=0,r=n.length;o<r;o++)i.push(n[o]);return i},truncTimeToUtcNull:function(e){return r.truncTimeToUtcNull(e)},truncTime:function(e){return e?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e},addDays:function(e,t){if(!e)return e;var n=new Date;return n.setTime(e.getTime()),n.setDate(e.getDate()+t),n},convertDate:function(e,t){return e&&Ext.isDate(e)&&t===o.ubDataTypes.Date?r.truncTimeToUtcNull(e):e},escapeForRegexp:function(e){return"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},convertFieldListToNameList:function(e,t){var n=[];return i.forEach(e,(function(e){"string"==typeof e?n.push(e):(!t||t&&!1!==e.visibility)&&n.push(e.name)})),n},convertFieldListToExtended:function(e){return e.map((function(e){return"string"==typeof e?{name:e}:e}))},attribute2cmpConfig:function(e,t){var n,i,o;return(o=(i="string"==typeof e?$App.domainInfo.get(e):e).attr(t.attributeName))&&((n=this.ubDt2Ext(o,t)).name=t.attributeName,n.fieldLabel=o.caption||t.attributeName,Ext.isDefined(o.isMultiLang)&&(n.isMultiLang=o.isMultiLang),Ext.isDefined(o.allowNull)&&(n.allowBlank=o.allowNull),n.entityName=i.code),n},ubDt2Ext:function(e,t){const n=o.ubDataTypes;let i;switch(e.dataType){case n.Enum:i=this.getComponentConfig4Enum(e.enumGroup,t);break;case n.Entity:i=this.getComponentConfig4Entity(e.associatedEntity,t);break;case n.Many:let a=Array.isArray(t.fieldList)&&t.fieldList.length>0,s=a?t.fieldList[0]:$App.domainInfo.get(e.associatedEntity).getDescriptionAttribute(),l=["ID"].concat(a?t.fieldList:[s]),c=t?t.whereList:void 0;l=(t?t.fieldList:null)||l;let u=(t?t.orderList:void 0)||{_asc:{expression:s,order:r.core.UBCommand.order.sqlotAsc}};i={xtype:"ubboxselect",store:Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:e.associatedEntity,method:"select",fieldList:l,orderList:u,whereList:c},autoLoad:!1,autoDestroy:!0}),valueField:"ID",displayField:s,queryMode:"remote",editable:!0,forceSelection:!0,grow:!1};break;case n.Document:i={xtype:"ubdocument"},e.documentMIME&&(i.documentMIME=e.documentMIME);break;case n.Text:i={xtype:"textareafield"};break;case n.Json:i={xtype:"ubcodemirror",valueIsJson:!0};break;case n.Date:i={xtype:"ubdatefield",fieldType:n.Date,format:Ext.util.Format.dateFormat};break;case n.DateTime:i={xtype:"ubdatetimefield",fieldType:n.DateTime};break;case n.Currency:case n.Float:let d=e.dataType===n.Currency?2:o.FLOATING_SCALE_PRECISION,f=e.dataType===n.Currency?-8999e12:-8999e9,h=e.dataType===n.Currency?8999e12:8999e9;i={xtype:"numberfield",enforceMaxLength:!0,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,decimalPrecision:d,validator:function(e){if(Number(e.replace(/[^0-9,.]/,"").replace(",","."))<h&&Number(e.replace(/[^0-9,.]/,"").replace(",","."))>f){let t=e.replace("-","").match(/[0-9]*[^0-9]{1}([0-9]+)/);if(t&&t.length>1&&t[1].length<=this.decimalPrecision||!t||1===t.length)return!0}return r.i18n("numberOfSignificantDigits")},valueToRaw:r.core.UBUtil.formatAsCurrency,maxValue:h,minValue:f};break;default:i=this.getComponentConfigByDataType(e.dataType,e.size)}return e.readOnly&&(i.readOnly=!0),i},formatAsCurrency:function(e){return i.isNumber(e)?Ext.util.Format.currency(e,"",this.decimalPrecision||2).replace(/ /g,""):""},getComponentConfigByDataType:function(e,t){let n={int:{xtype:"numberfield",allowDecimals:!1,hideTrigger:!0},float:{xtype:"numberfield",hideTrigger:!0},date:{xtype:"ubdatefield",format:Ext.util.Format.dateFormat},boolean:{xtype:"checkboxfield"},string:{xtype:"ubtextfield",enforceMaxLength:!0}},i=o.getPhysicalDataType(e),r=n[i]||{xtype:"ubtextfield"};return"string"===i&&(r=t>256?{xtype:"ubtextareafield",rows:3}:{xtype:"ubtextfield"},t&&Ext.apply(r,{maxLength:t,enforceMaxLength:!0})),r},getComponentConfig4Entity:function(e,t){let n,o=t?t.whereList:void 0,s=t?t.fieldList:null,l=t?t.orderList:void 0;n="string"==typeof e?$App.domainInfo.get(e):e,s=s||[n.getDescriptionAttribute()],s.indexOf("ID")<0&&(s=["ID"].concat(s));let c={entity:n.code,method:r.core.UBCommand.methodName.SELECT,fieldList:s,whereList:o,orderList:l||{_asc:{expression:s[1],order:r.core.UBCommand.order.sqlotAsc}}};return i.forEach(a,(function(e){t&&void 0!==t[e]&&(c[e]=t[e])})),{xtype:"ubcombobox",store:Ext.create("UB.ux.data.UBStore",{ubRequest:c,autoLoad:!1,autoDestroy:!0}),valueField:"ID",displayField:s[1],fieldList:s,entityName:n.code}},getComponentConfig4Enum:function(e,t){let n=t&&t.whereList?t.whereList:{},o=t&&t.orderList?t.orderList:{byOrder:{expression:"sortOrder",order:"asc"}};r.connection.UBQLv2?n.enumGroupFilter={expression:"[eGroup]",condition:"equal",value:e}:n.enumGroupFilter={expression:"[eGroup]",condition:"equal",values:{eGroup:e}};let a=Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:"ubm_enum",method:r.core.UBCommand.methodName.SELECT,fieldList:t&&t.fieldList?i.union(t.fieldList,["eGroup","sortOrder"]):["eGroup","code","name","shortName","sortOrder"],whereList:n,orderList:o,idProperty:"code"},disablePaging:!0,autoLoad:!1,autoDestroy:!0});return a.load(),{xtype:"ubbasebox",disableContextMenu:!0,store:a,valueField:"code",displayField:"name",queryMode:"local",editable:!1,forceSelection:!0,grow:!1}},getEntityAttributesTree:function(e){var t=$App.domainInfo.get(e);return t?{leaf:!1,id:e,expanded:!0,text:t.caption||e,children:r.core.UBUtil.getEntityAttributesTreeData(t,"",1)}:void 0},getEntityAttributesTreeData:function(e,t,n){const i=[];let a;return a="string"==typeof e?$App.domainInfo.get(e):e,!a||n>3||a.eachAttribute((function(a,s){let l=a.allowNull?s:`<strong>${s}</storng>`;a.dataType===o.ubDataTypes.Entity&&(l+=` -> ${a.getAssociatedEntity().name}`),a.caption&&a.caption.toUpperCase()!==s.toUpperCase()&&(l+=`<span class="u-form-row__description"> - ${a.caption}</span>`);const c={id:(t?t+".":"")+s,text:l,leaf:a.dataType!==o.ubDataTypes.Entity,parentId:t||e};a.dataType===o.ubDataTypes.Entity&&e!==a.associatedEntity&&(c.children=r.core.UBUtil.getEntityAttributesTreeData(a.associatedEntity,c.id,n+1)),i.push(c)})),i}},(function(){Ext.ns("UB.Utils"),r.Utils=r.core.UBUtil}))},9897:function(){UB.core.UBUtilTree={arrayToTreeRootNode:function(e){let t={leaf:!1,id:0,expanded:!0},n={0:t};for(let t=0,i=e.length;t<i;++t){let i=e[t],o=n[i.id];o?Ext.applyIf(o,i):o=n[i.id]=i;let r=n[i.parentId||0];r||(r=n[i.parentId]={id:i.parentId}),r.children||(r.children=[]),r.children.push(o)}return t},addToParent:function(e,t){t.forEach((function(t){let n=e.appendChild(t);t.children&&t.children.length&&UB.core.UBUtilTree.addToParent(n,t.children)}))}}},7959:function(){Ext.ns("UB.ux.LockManager"),UB.ux.LockManager.lockTimeout=4e4,UB.ux.LockManager.entities={},UB.ux.LockManager.schedulers={},UB.ux.LockManager.getContext=function(e,t,n){let i=$App.domainInfo.get(e);i.checkMixin("softLock");let o,r=i.mixins.softLock,a=r.lockEntity,s=r.lockIdentifier.split("."),l=this.entities[a];if(l||(l=this.entities[a]={}),"object"!=typeof t)o=t;else{if(t.fields.indexOfKey(s[0])<0)throw new Error("Form record of "+e+" entity must have "+s[0]+" in fieldList");o=t.get(s[0])}let c=l[o];return!c&&n&&(c=l[o]=[]),{idCtx:c,lockEntity:a,id:o,hasEntityALS:!!i.mixins.als}},UB.ux.LockManager.existLock=function(e,t){let n=$App.domainInfo.get(e);n.checkMixin("softLock");let i=n.mixins.softLock,o=this.entities[i.lockEntity];if(!o)return!1;let r=o[t];return r&&r.length>0},UB.ux.LockManager.addLock=function(e){let t=this.getContext(e.entity,e.instance,!0),n=t.idCtx,i=new Date;return t.lockIdentifier=e.lockIdentifier,t.lockID=i.getTime()+"_"+n.length,t.onLockLoss=e.onLockLoss,t.scope=e.scope,t.entity=e.entity,n.push(t),this.initUpdateLock(t),t},UB.ux.LockManager.checkUnlock=function(e,t){let n=this,i=n.addLock({entity:e,instance:t,scope:n});!0===n.deleteLock(i)&&$App.connection.query({entity:e,method:UB.core.UBCommand.methodName.UNLOCK,ID:t},!0)},UB.ux.LockManager.deleteLock=function(e){let t=this.entities[e.lockEntity];if(!t)return!1;let n=t[e.id];if(!n)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t].lockID===e.lockID){n.splice(t,1);break}return 0===n.length&&(this.stopUpdateLock(e),delete t[e.id],!0)},UB.ux.LockManager.initUpdateLock=function(e){let t=this;e.schedulerID=e.lockEntity+e.id;let n=this.schedulers[e.schedulerID];n||(t.schedulers[e.schedulerID]=n={lockCtx:e},n.updateLockID=setInterval((function(){t.updateLock(e)}),t.lockTimeout))},UB.ux.LockManager.stopUpdateLock=function(e){if(!e.schedulerID)return;let t=this.schedulers[e.schedulerID];t&&(clearInterval(t.updateLockID),delete this.schedulers[e.schedulerID])},UB.ux.LockManager.fireOnLockLoss=function(e){let t=this.entities[e.lockEntity];if(!t)return!1;let n=t[e.id];if(!n)return!1;for(let e=0,t=n.length;e<t;e++){let t=n[e];t.onLockLoss&&Ext.callback(t.onLockLoss,t.scope||this,[t])}},UB.ux.LockManager.updateLock=function(e){let t=this;$App.connection.query({entity:e.lockEntity,method:"renewLock",lockID:e.lockIdentifier}).then((function(n){if(!n.resultLock.success){if(n.resultLock.lockUser!==$App.connection.userLogin())throw new UB.UBError(UB.i18n("lockedBy")+" "+n.resultLock.lockUser);t.fireOnLockLoss(e),t.stopUpdateLock(e)}})).catch((function(){t.fireOnLockLoss(e)}))},UB.ux.LockManager.forceUpdateAllLock=function(){let e=this;for(let t in e.entities)if(e.entities.hasOwnProperty(t)){let n=e.entities[t];for(let t in n)if(n.hasOwnProperty(t)){let i=n[t];if(i&&i.lentgth>0){let t=i[0];e.stopUpdateLock(t),e.updateLock(t),e.initUpdateLock(t)}}}}},9943:function(e,t,n){n(6872),n(8623),n(9516),n(5658),n(2077);const i=n(1972),o=n(9274).UBDomain,r=n(6486);Ext.define("UB.ux.Multifilter",{extend:"Ext.toolbar.Toolbar",alias:"plugin.multifilter",border:!1,margin:"0 0 0 3",padding:0,cls:"ub-multi-filter",bodyStyle:"background: none;",filtersList:{},selectedColumn:null,filterMenu:null,topFilterPanel:null,init:function(e){let t=this,n=0;t.gridOwner=e,t.gridOwner.on({afterrender:t.onParentAfterRenderer,columnmove:t.onGridChaged,columnhide:t.onGridChaged,columnshow:t.onGridChaged,selectionchange:function(e,i,o){clearTimeout(n),n=setTimeout((function(){t.onSelectionChange(e,i,o)}),350)},scope:t}),t.gridOwner.store.on({load:t.filtersDescription,filterchange:t.onFilterChange,scope:t}),t.fieldsConfig={},r.forEach(t.gridOwner.autoFilter&&t.gridOwner.autoFilter.params||{},(function(e,n){t.fieldsConfig[n]=e})),r.forEach(t.gridOwner.extendedFieldList||[],(function(e){e.filter&&(t.fieldsConfig[e.name]=e.filter)})),t.filterPrefix="context_"+Ext.id(),t.filtersPanel={},t.buttonSelectFilter=new Ext.button.Button({tooltip:i.i18n("Filter by"),scale:"medium",iconCls:"u-icon-filter",handler:function(){t.filterMenu||(t.filterMenu=t.createSelectFilterMenu(t.selectColumnMenuClick)),t.filterMenu.showBy(t.buttonSelectFilter.el,t.menuAlign)}}),t.add(this.buttonSelectFilter)},selectColumnMenuClick:function(e,t){let n=this;Ext.suspendLayouts();try{n.hideAllPanel(),n.selectedColumn=t.column,n.createFilterPanel(t.column.dataIndex,t.column)}finally{Ext.resumeLayouts(!0)}n.topFilterPanel.layout.overflowHandler.menuItems.length>0&&n.showContexFilterPanel()},getItemMargin:function(){return"0 10 0 10"},createSelectFilterMenu:function(e){let t,n,o,a=this,s=[],l={};return r.forEach(a.gridOwner.columns,(function(e){(a.fieldsConfig[e.dataIndex]||{}).disabled||!1===e.filterable||(n=e.dataIndex.split("."),n.length>1&&!e.simpleFilter&&(o=a.gridOwner.store.ubRequest.fieldList,o.indexOf(n[0])>=0)?l[n[0]]||(s.push({text:$App.domainInfo.get(a.gridOwner.entityName).getEntityAttribute(n[0]).caption,column:e}),l[n[0]]=!0):s.push({text:e.filterCaption||e.text||$App.domainInfo.get(a.gridOwner.entityName).getEntityAttribute(e.dataIndex).caption,column:e}))})),t=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",items:s,listeners:{click:function(t,n,o,r){n&&(n.showAllItem&&i.ux.UBPreFilter.makeFilters({options:a.gridOwner.autoFilter||{},entityCode:a.gridOwner.entityName,store:a.gridOwner.getStore(),onFilterReady:function(){a.gridOwner.filtersDescription&&a.gridOwner.filtersDescription()}}),e.apply(a,arguments))}}}),t},initComponent:function(){this.callParent()},destroy:function(){this.filterMenu&&this.filterMenu.destroy(),this.clearFilterPanel()},onFilterChange:function(e){e.totalRequired=!1},showContexFilterPanel:function(){var e,t,n,o,r,a,s,l,c=this,u=c.activeFilterPanel;function d(t,i){var a;return e=$App.domainInfo.get(u.ubEntity).getEntityAttribute(t),a=c.getFilterControls(u.ubEntity,t,e),(o=a[a.length-1]).isButton&&(a.splice(a.length-1,1),r=o.handler,o.handler=function(){r(),n.close()}),a[0].hideLabel=!0,a.unshift(Ext.create("Ext.form.Label",{shrinkWrap:1,margin:"0 10 0 3",text:i||a[0].fieldLabel})),a}s=c.createSelectFilterMenu((function(e,t,n,i){Ext.suspendLayouts();try{l.removeAll(),l.add(d(t.column.dataIndex,t.column.filterCaption||t.column.text))}finally{Ext.resumeLayouts(!0)}})),a=new Ext.button.Button({tooltip:i.i18n("search"),iconCls:"u-icon-filter",handler:function(){s.showBy(a.el,c.menuAlign)}}),t=d(u.ubAttrName,u.columnText),(n=Ext.create("Ext.window.Window",{padding:"10 5 10 5",height:160,minWidth:550,modal:!0,overflowX:"scroll",layout:{type:"hbox",align:"middle"},title:i.i18n("search"),items:[a,l=Ext.create("Ext.toolbar.Toolbar",{items:t})],buttons:[o,{xtype:"button",margin:"0 0 0 15",text:i.i18n("cancel"),handler:function(){n.close()}}]})).center(),n.show()},onParentAfterRenderer:function(){var e,t=this,n=t.gridOwner,o=n.getView(),r=n.getDockedItems('toolbar[dock="top"]')[0];t.baseToolbar=r,t.topFilterPanel=Ext.create("Ext.toolbar.Toolbar",{border:0,margin:0,padding:0,flex:30,enableOverflow:!0,items:[t]}),t.topFilterPanel.layout&&(e=t.topFilterPanel.layout.overflowHandler)&&(e.getSuffixConfig=function(){var e=this.layout,n=e.owner,o=n.id;return this.menuTrigger=new Ext.button.Button({id:o+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+t.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item",plain:n.usePlainButtons,ownerCt:n,ownerLayout:e,ui:n instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",tooltip:i.i18n("search"),iconCls:"u-icon-filter",handler:function(){t.activeFilterPanel&&t.showContexFilterPanel()}}),this.menuTrigger.getRenderTree()}),r.insert(r.items.getCount()-2,t.topFilterPanel),o&&o.on({itemkeydown:function(e,n,i,o,r,a){if(!(r.isNavKeyPress()||r.isSpecialKey()||r.ctrlKey)){var s=t.down("field");if(s){var l=s.next();l?l.focus():s.focus()}}}})},hideAllPanel:function(){Ext.Object.each(this.filtersPanel,(function(e,t){t.hide()}))},getFilterControls:function(e,t,n,i){var r,a,s=this;if((a=$App.domainInfo.get(e).getEntityAttribute(t,!0)).customSettings&&a.customSettings.UIGridColumnClass)r=s.getEnumFilterInput(e,t,a.customSettings.UIGridColumnClass,i);else if(n.associatedEntity)r=s.getAssociationFilterInput(e,t,i);else if(n.dataType===o.ubDataTypes.Enum)r=s.getEnumFilterInput(e,t);else{var l=n.physicalDataType;switch(l){case"float":case"int":r=s.getNumericFilterInput(e,t,"float"===l||"currency"===l);break;case"date":r=s.getDateFilterInput(e,t);break;case"boolean":r=s.getBooleanFilterInput(e,t);break;default:r=s.getPlainTextFilter(e,t)}}return r},onGridChaged:function(){this.clearFilterPanel()},clearFilterPanel:function(){var e=this;r.forEach(e.filtersPanel||[],(function(t,n){e.remove(t)})),e.filtersPanel={}},getInitParam:function(e){return this.fieldsConfig[e]||null},createFilterPanel:function(e,t){var n,i,o,r,a=this,s=a.gridOwner,l=s.entityName,c=!1;if((n=e.split(".")).length>1&&!t.simpleFilter&&s.store.ubRequest.fieldList.indexOf(n[0])>=0&&(e=n[0],c=!0),r=$App.domainInfo.get(l).attr(e),i=a.filtersPanel[e])return a.activeFilterPanel=i,void i.show();(o=a.getFilterControls(l,e,r,void 0))[0].hideLabel=!0;let u=t.filterCaption||(c?r.caption:null)||t.text;o.unshift(Ext.create("Ext.form.Label",{shrinkWrap:0,margin:"0 0 0 3",width:100,text:u,autoEl:{tag:"label","data-qtip":u},style:"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"})),(i=Ext.create("Ext.toolbar.Toolbar",{border:0,margin:0,padding:0,flex:2,items:o})).ubEntity=l,i.ubAttrName=e,i.columnText=t.filterCaption||t.text,a.filtersPanel[e]=i,a.add(i),a.activeFilterPanel=i},onSelectionChange:function(e,t,n){var i,o,r=this,a=r.gridOwner.getSelectionModel().getCurrentPosition()||{};if(Ext.isDefined(a.column)&&t.length&&a.column!==r.selectedColumn&&(i=a.columnHeader)){o=r.gridOwner.getColumnManager().getHeaderAtIndex(a.column)||{},r.activeFilterPanel=null,Ext.suspendLayouts();try{if(r.hideAllPanel(),r.selectedColumn=a.column,!1===o.filterable)return;var s=i.dataIndex;if(!s)return;if((r.fieldsConfig[s]||{}).disabled)return;r.createFilterPanel(s,o)}finally{Ext.resumeLayouts(!0)}}},getAssociationFilterInput:function(e,t,n){return i.ux.Multifilter.getAssociationFilterInputS(e,t,n,this)},getEnumFilterInput:function(e,t,n,o){return i.ux.Multifilter.getEnumFilterInputS(e,t,n,o,this)},getBooleanFilterInput:function(e,t){return i.ux.Multifilter.getBooleanFilterInputS(e,t,this)},getNumericFilterInput:function(e,t,n){return i.ux.Multifilter.getNumericFilterInputS(e,t,n,this)},getPlainTextFilter:function(e,t){return i.ux.Multifilter.getPlainTextFilterS(e,t,this)},getDateFilterInput:function(e,t){return i.ux.Multifilter.getDateFilterInputS(e,t,this)},clearFilter:function(){var e=this,t=e.gridOwner.store,n=t.filters,i=e.filtersList,o=!1;e.selectedColumn=null,Ext.Object.each(i,(function(e,t){var r=n.getByKey(e);r&&r.relatedFilter&&n.removeAtKey(r.relatedFilter.id),n.removeAtKey(e),o=!0,delete i[e]})),t.filters.length?(o&&t.filter(),e.gridOwner.onPrefilter()):t.clearFilter(),e.filtersDescription()},filtersDescription:function(){var e=this,t=e.gridOwner,n=t.store,o=t.entityName,r=n.filters,a=i.core.UBCommand.condition,s=[],l=!0,c={},u={},d=!1,f={};(r.length||e.filterPenel)&&(e.initBarControls(),e.filterPenelFilters.items.each((function(e){c[e.filterID]=1,u[e.filterID]=e}),e),r.sort("property"),r.each((function(t){var n,r,h,p,m,g;if(l=!0,d=!1,t&&t.property&&t.id&&"between"!==t.condition&&t.id!==i.core.UBCommand.whereListParentID&&!(t&&t.relatedFilter&&t.relatedFilter.id&&f[t.relatedFilter.id])){if(f[t.id]=1,n=(r=$App.domainInfo.get(o).attr(t.property)).caption,h=t.userValue||t.value,p=t.id&&t.id.substr(0,i.ux.UBPreFilter.basePrefix.length)===i.ux.UBPreFilter.basePrefix,g="match"===t.condition,m=!(t.id&&e.filtersList[t.id]),c[t.id]&&(c[t.id]=0,d=!0),g)n=i.format(i.i18n("ftsFilterName"),t.value),h="";else if(r.associatedEntity)h=t.text;else if("Enum"===r.dataType)h=t.text;else switch(r.physicalDataType){case"date":if("period"===t.filterType)if(">="===t.operator){t.value&&(h=i.i18n("s")+" "+Ext.Date.format(t.value,"d-m-Y"));let e=t.relatedFilter.value;e&&(h+=" "+i.i18n("po")+" "+Ext.Date.format(t.isTime?i.core.UBUtil.addDays(e,-1):e,"d-m-Y"))}else l=!1;else"to_date"===t.filterType?h=i.i18n("po")+" "+Ext.Date.format(t.isTime?i.core.UBUtil.addDays(t.value,-1):t.value,"d-m-Y"):"from_date"===t.filterType?h=i.i18n("s")+" "+Ext.Date.format(t.value,"d-m-Y"):"date"===t.filterType?h=Ext.Date.format(t.value,"d-m-Y"):(h={today:i.i18n("today"),yesterday:i.i18n("yesterday"),current_week:i.i18n("current_week"),this_month:i.i18n("this_month"),this_year:i.i18n("this_year")}[t.filterType],"<="!==t.operator&&"<"!==t.operator||(l=!1));break;case"boolean":break;case"float":case"int":switch(t.filterType){case"range":if(">="===t.operator){t.value&&(h=t.value+"");let e=t.relatedFilter.value;e&&(h+=" - "+e)}else l=!1;break;case"br":case"isNull":break;default:h=(t.operator||"")+t.value}break;case"string":h="equal"===t.filterType?t.userValue||t.value:i.i18n(t.filterType)+" "+(t.userValue||t.value)}if(Ext.isEmpty(h)&&t.condition===a.sqlecIsNull&&(h=i.i18n("isNull")),l){var y=n+(h?": "+Ext.String.ellipsis(h,70):"")+' <b class="ub-rem-filter">&#x2716;</b>';d?u[t.id].setText(y):s.push(Ext.create("Ext.button.Button",{xtype:"button",text:y,filterID:t.id,filterValue:t.value,cls:m?"ub-btn-ftr-disabled":"ub-btn-ftr",scope:e,handler:function(n){p?e.gridOwner.onPrefilter():m||(n.hide(),e.removeFilter(t.id))}}))}}})),e.filterPenelFilters.items.each((function(t){1===c[t.filterID]&&e.filterPenelFilters.remove(t,!0)}),e),s.length+e.filterPenelFilters.items.getCount()>0?(Ext.Array.each(s,(function(t){e.filterPenelFilters.add(t)}),e),e.filterPenel.show(),e.filterPenel.mustBeVisibled=!0):(e.filterPenel.hide(),e.filterPenel.mustBeVisibled=!1),e.gridOwner.updateVisibleBBar())},initBarControls:function(){var e=this,t=e.gridOwner;e.filterPenel||(e.filterPenel=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1,items:[{xtype:"button",style:"text-weight: bolder",margin:"0 0 0 0",tooltip:i.i18n("clear"),text:" <b>&#x2716;</b>",handler:e.clearFilter,scope:e},{xtype:"label",html:i.i18n("filter")+": "},e.filterPenelFilters=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1,enableOverflow:!0})]}),t.filterBar.add(e.filterPenel))},removeFilter:function(e,t){var n=this.gridOwner.store,i=n.filters.getByKey(e);i&&i.relatedFilter&&n.filters.removeAtKey(i.relatedFilter.id),n.filters.removeAtKey(e),this.filtersList[e]=void 0,n.filters.length?n.filter():n.clearFilter()},storeFiltered:function(){var e=this.gridOwner.getSelectionModel();e.getSelection().length||e.setCurrentPosition({row:0,column:this.selectedColumn})},getPrevFilter:function(e,t){var n;return(n=this.gridOwner.store.filters.getByKey(e))&&n.relatedFilter?[n,n.relatedFilter]:n},getFilterPrefix:function(e){return this.filterPrefix+e},setFilter:function(e,t){var n=this,i=n.gridOwner.store,o=n.getFilterPrefix(e);i&&(i.filters.removeAtKey(o),i.filters.removeAtKey(o+"_to"),i.filter(t),n.filtersList[o]=!0)},statics:{dateValidator:function(e){return!e||(!!e.match(/^\d{2}([./-])\d{2}\1\d{4}$/)||" ")},getWeekRange:function(e,t){var n,o,r=new Date;return n=i.core.UBUtil.addDays(r,-1*((r.getDay()||7)-1)),o=i.core.UBUtil.addDays(r,7-(r.getDay()||7)),t||(n=i.core.UBUtil.truncTimeToUtcNull(n),o=i.core.UBUtil.truncTimeToUtcNull(o)),[n,o]},getMonthRange:function(e,t){var n=new Date,o=n.getFullYear(),r=n.getMonth(),a=new Date(o,r,1),s=i.core.UBUtil.addDays(new Date(o,r+1,1),-1);return t||(a=i.core.UBUtil.truncTimeToUtcNull(a),s=i.core.UBUtil.truncTimeToUtcNull(s)),[a,s]},getYearRange:function(e,t){var n=(new Date).getFullYear(),o=new Date(n,0,1),r=i.core.UBUtil.addDays(new Date(n+1,0,1),-1);return t||(o=i.core.UBUtil.truncTimeToUtcNull(o),r=i.core.UBUtil.truncTimeToUtcNull(r)),[o,r]},getfilterFuncIsNull:function(e){return function(t){return null===t.get(e)}},isNullFilterType:"isNull",predefinedFilters:{today:"date",yesterday:"date",current_week:"date",this_month:"date",this_year:"date",isNull:"no_filter"},filterTypeWidth:150,getNumericFilterInputS:function(e,t,n,o){var r,a,s,l,c,u,d,f,h,p,m,g,y,x=this,b=$App.domainInfo.get(e).attr(t),v=!1;r=o.getFilterPrefix(t),(a=o.getPrevFilter(r,t))&&Ext.isArray(a)?Ext.Array.each(a,(function(e){switch(e.controlID){case"number":l=e;break;case"numberTo":s=e}})):l=a||{filterType:"equal"},o.getInitParam&&(m=o.getInitParam(t)),m=m||{},Ext.isEmpty(m.required)||(v=m.required),Ext.isEmpty(m.filterType)||(g=m.filterType),y=l?l.filterType:g||"equal",d={hideTrigger:!0,isFormField:o.isPreFilter,controlID:"number",allowDecimals:n,width:90,margin:o.getItemMargin(),labelWidth:100,withoutIndent:!0},o.isPreFilter&&(d.hideLabel=!0),Ext.isEmpty(m.valueFrom)||(d.value=m.valueFrom),Ext.isEmpty(m.value)||(d.value=m.value),l&&(d.value=l.value),f=Ext.create("Ext.form.field.Number",d),d={fieldLabel:" -",labelSeparator:"",isFormField:o.isPreFilter,hideTrigger:!0,controlID:"numberTo",width:115,margin:o.getItemMargin(),labelWidth:20,allowDecimals:n,withoutIndent:!0},Ext.isEmpty(m.valueTo)||(d.value=m.valueTo),s&&(d.value=s.value),h=Ext.create("Ext.form.field.Number",d),p=function(e,n){h.hide(),f.hide(),h.allowBlank=!0,f.allowBlank=!0,"no_filter"===n||"isNull"===n?(f.reset(),h.reset(),f.setValue(null),h.setValue(null)):(f.allowBlank=!v,f.show()),"no_filter"!==n||o.isPreFilter?"isNull"!==n||o.isPreFilter?"range"===n?(h.allowBlank=!v,h.show()):(h.reset(),h.setValue(null)):c():o.removeFilter(r,t)};var E=Ext.create("Ext.form.ComboBox",{fieldLabel:b.caption,hideLabel:o.isPreFilter,labelWidth:100,isFormField:o.isPreFilter,store:x.createFilterItems("number",b.allowNull),queryMode:"local",displayField:"text",valueField:"type",margin:o.getItemMargin(),width:this.filterTypeWidth,value:y,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function(e,t,n,i){p(0,t)}},validator:function(e){return!v||"no_filter"!==this.getValue()||i.i18n("filterIsRequired")}});p(0,y),u=function(){var e,n,o,a,s,l,c;if(a=i.core.UBCommand.condition,o=E.getValue(),e=f.getValue(),l=h.getValue(),"no_filter"===o||Ext.isEmpty(e)&&o!==x.isNullFilterType)return null;switch(s={id:r,root:"data",controlID:"number",property:t,filterType:o,value:e},o){case"more":s.operator=">";break;case"less":s.operator="<";break;case"equal":s.operator="=";break;case"range":s.operator=">=",c=Ext.create("Ext.util.Filter",{id:r+"_to",root:"data",property:t,controlID:"numberTo",operator:"<=",filterType:o,value:l});break;case"isNull":s.filterFn=function(e){return null===e.get(t)},s.condition=a.sqlecIsNull}return n=Ext.create("Ext.util.Filter",s),c?(n.relatedFilter=c,c.relatedFilter=n,[n,c]):n},c=function(){var e=u();e?o.setFilter(t,e):o.removeFilter(r,t)},o.isPreFilter?(o.initFilterControl(t,"value",f),o.initFilterControl(t,"valueto",h),o.initFilterControl(t,"filterType",E),o.initFilterFunc(t,u)):(f.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),c())}),x),h.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),c())}),x));var w=[E,f,h];return o.isPreFilter||w.push(this.createSearchButton(c)),w},getBooleanFilterInputS:function(e,t,n){var o,r,a,s=this,l=$App.domainInfo.get(e).attr(t),c=n.getFilterPrefix(t),u=n.getPrevFilter(c,t);let d={addnoFilterValue:!0,fieldLabel:l.caption,isFormField:n.isPreFilter,labelWidth:100,filterEmptyValue:"no_filter",value:"no_filter",margin:n.getItemMargin(),width:this.filterTypeWidth,withoutIndent:!0,addEmptyValue:l.allowNull};u&&(d.value=0===u.value?0:u.value||u.filterType||"no_filter"),n.isPreFilter&&(d.hideLabel=!0),o=Ext.widget("ubboolbox",d),r=function(){var e=o.getValue(),n=i.core.UBCommand.condition;return Ext.isEmpty(e)||"no_filter"===e?null:"isNull"===e?Ext.create("Ext.util.Filter",{id:c,root:"data",property:t,filterType:e,filterFn:s.getfilterFuncIsNull(t),condition:n.sqlecIsNull,value:null,userValue:o.inputEl?o.inputEl.getValue():""}):Ext.create("Ext.util.Filter",{id:c,root:"data",property:t,filterType:e,exactMatch:!0,operator:"=",value:1===e,userValue:o.inputEl?o.inputEl.getValue():e})},a=function(){var e=r();e?n.setFilter(t,e):n.removeFilter(c,t)},n.isPreFilter?(n.initFilterFunc(t,r),n.initFilterControl(t,null,o)):o.on("change",(function(e,t){n.isPreFilter||a()}),s);var f=[o];return n.isPreFilter||f.push(this.createSearchButton(a)),f},getEnumFilterInputS:function(e,t,n,o,a){var s,l,c,u,d,f,h,p,m,g,y,x=this,b=$App.domainInfo.get(e).attr(t),v=i.core.UBUtil.getComponentConfig4Enum(n||b.enumGroup,o),E=a.getFilterPrefix(t),w=a.getPrevFilter(E,t),C=!1;a.getInitParam&&(f=a.getInitParam(t)),f=f||{},Ext.isEmpty(f.required)||(C=f.required),Ext.isEmpty(f.filterType)||(h=f.filterType),p=w?w.filterType:h||"by_value",w&&"no_filter"===h&&Ext.isEmpty(w.value)&&(p="no_filter"),v.width=180,v.labelWidth=100,v.isFormField=a.isPreFilter,v.allowBlank=!C,v.withoutIndent=!0,v.margin=a.getItemMargin(),Ext.isEmpty(f.value)||(y=f.value),w&&(y=w.value,v.hidden="by_several_value"===w.filterType),v.disableModifyEntity=!0,v.hideEntityItemInContext=!0,g=s=Ext.widget(v.xtype,v),v.hidden=!w||"by_several_value"!==w.filterType||"no_filter"===p,m=Ext.widget("ubmultiselecbox",v),y&&(w&&"by_several_value"===w.filterType&&(g=m),g!==m&&r.isArray(w.value)||g.setValue(w.value)),d=function(e,n){if(s.hide(),m.hide(),s.allowBlank=!0,"no_filter"===n&&!a.isPreFilter)return s.reset(),m.reset(),void a.removeFilter(E,t);"isNull"!==n||a.isPreFilter?"no_filter"===n||"isNull"===n?(s.reset(),m.reset()):"by_several_value"===n?(m.allowBlank=!C,m.show()):(s.allowBlank=!C,s.show()):u()},l=Ext.create("Ext.form.ComboBox",{fieldLabel:b.caption,hideLabel:a.isPreFilter,isFormField:a.isPreFilter,labelWidth:100,store:x.createFilterItems("association",b.allowNull),queryMode:"local",displayField:"text",valueField:"type",value:p,margin:a.getItemMargin(),width:this.filterTypeWidth,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function(e,t,n,i){d(0,t)}},validator:function(e){return!C||"no_filter"!==this.getValue()||i.i18n("filterIsRequired")}}),d(0,p),c=function(){var e,n,o=s.getValue(),r=i.core.UBCommand.condition;if(o="by_several_value"===(e=l.getValue())?m.getValue():s.getValue(),"no_filter"===e||Ext.isEmpty(o)&&e!==x.isNullFilterType)return null;switch(n={id:E,root:"data",filterType:e,property:t},e){case"isNull":n.filterFn=x.getfilterFuncIsNull(t),n.condition=r.sqlecIsNull,n.value=null;break;case"by_value":n.text=s.getDisplayValue(),n.anyMatch=!0,n.value=o;break;case"by_several_value":n.text=m.getDisplayValue(),n.condition=r.sqlecIn,n.value=o}return Ext.create("Ext.util.Filter",n)},u=function(){var e=c();e?a.setFilter(t,e):a.removeFilter(E,t)},a.isPreFilter?(a.initFilterFunc(t,c),a.initFilterControl(t,"filterType",l),a.initFilterControl(t,null,s),a.initFilterControl(t,"multi",m)):(s.on("change",(function(e,t){e.findRecordByDisplay(t)&&u()}),x),m.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),u())}),x),m.on("itemSelected",(function(){u()}),x));var I=[l,s,m];return a.isPreFilter||I.push(this.createSearchButton(u)),I},getAssociationFilterInputS:function(e,t,n,o){var r,a,s,l,c,u,d,f,h,p,m,g=this,y=$App.domainInfo.get(e).attr(t),x=i.core.UBUtil.getComponentConfig4Entity(y.associatedEntity,n),b=o.getFilterPrefix(t),v=o.getPrevFilter(b,t),E=!1;n=n||{},o.getInitParam&&(f=o.getInitParam(t)),f=f||{},Ext.isEmpty(f.required)||(E=f.required),Ext.isEmpty(f.filterType)||(h=f.filterType),p=(v?v.filterType:null)||h||"by_value",v&&"no_filter"===h&&Ext.isEmpty(v.value)&&(p="no_filter"),x.width=180,x.labelWidth=100,x.isFormField=o.isPreFilter,x.allowBlank=!E,x.withoutIndent=!0,x.margin=o.getItemMargin(),Ext.isEmpty(f.value)||(m=f.value),v&&(m=v.value,x.hidden="by_several_value"===v.filterType),x.hidden=x.hidden||"no_filter"===p,x.disableModifyEntity=!0,x.hideEntityItemInContext=!0,s=r=Ext.widget(x.xtype,x),x.hidden=!v||"by_several_value"!==v.filterType||"no_filter"===p,a=Ext.widget("ubmultiselecbox",x),m&&(v&&"by_several_value"===v.filterType&&(s=a),s.setValueById?s.setValueById(v.value):s.setValue(v.value)),d=function(e,n){if(r.hide(),a.hide(),r.allowBlank=!0,"no_filter"===n&&!o.isPreFilter)return r.reset(),a.reset(),void o.removeFilter(b,t);"isNull"!==n||o.isPreFilter?"no_filter"===n||"isNull"===n?(r.reset(),a.reset()):"by_several_value"===n?(a.allowBlank=!E,a.show()):(r.allowBlank=!E,r.show()):l()},(u=Ext.create("Ext.form.ComboBox",{fieldLabel:y.caption,isFormField:o.isPreFilter,hideLabel:o.isPreFilter,labelWidth:100,store:g.createFilterItems("association",y.allowNull),queryMode:"local",displayField:"text",valueField:"type",value:p,margin:o.getItemMargin(),width:this.filterTypeWidth,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function(e,t,n,i){d(0,t)}}})).setValue(p),c=function(){var e,n,o,s=i.core.UBCommand.condition;if(e="by_several_value"===(n=u.getValue())?a.getValue():r.getValue(),"no_filter"===n||Ext.isEmpty(e)&&n!==g.isNullFilterType)return null;switch(o={id:b,root:"data",filterType:n,property:t},n){case"isNull":o.filterFn=g.getfilterFuncIsNull(t),o.condition=s.sqlecIsNull,o.value=null;break;case"by_value":"Many"===y.dataType?(o.condition=s.sqlecIn,o.value=[e]):(o.anyMatch=!0,o.value=e),o.text=r.getDisplayValue();break;case"by_several_value":o.text=a.getDisplayValue(),o.condition=s.sqlecIn,o.value=e}return Ext.create("Ext.util.Filter",o)},l=function(){var e=c();e?o.setFilter(t,e):o.removeFilter(b,t)},o.isPreFilter?(o.initFilterFunc(t,c),o.initFilterControl(t,"filterType",u),o.initFilterControl(t,null,r),o.initFilterControl(t,"multi",a)):(r.on("change",(function(e,t){e.findRecordByDisplay(t)&&l()}),g),r.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),l())}),g),a.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),l())}),g),a.on("itemSelected",(function(){l()}),g));var w=[u,r,a];return o.isPreFilter||w.push(this.createSearchButton(l)),w},filterTypeStores:{},createFilterItems:function(e,t){var n,o=[{type:"no_filter",text:"no_filter"}],a=e+String(t);if(!(n=this.filterTypeStores[a])){switch(e){case"date":o.push({type:"today",text:"today"},{type:"yesterday",text:"yesterday"},{type:"current_week",text:"current_week"},{type:"this_month",text:"this_month"},{type:"this_year",text:"this_year"},{type:"from_date",text:"from_date"},{type:"to_date",text:"to_date"},{type:"date",text:"date"},{type:"period",text:"period"});break;case"string":o.push({type:"startWith",text:"startWith"},{type:"contains",text:"contains"},{type:"equal",text:"equal"});break;case"number":o.push({type:"more",text:"more"},{type:"less",text:"less"},{type:"equal",text:"equal"},{type:"range",text:"range"});break;case"association":o.push({type:"by_value",text:"by_value"},{type:"by_several_value",text:"by_several_value"})}t&&o.push({type:"isNull",text:"isNull"}),r.forEach(o,(function(e){e.text=i.i18n(e.text)})),this.filterTypeStores[a]=n=Ext.create("Ext.data.Store",{fields:["type","text"],data:o})}return n},createSearchButton:function(e){return Ext.create("Ext.button.Button",{scale:"medium",iconCls:"u-icon-search",tooltip:i.i18n("search"),margin:"0 0 0 8",handler:e})},getPlainTextFilterS:function(e,t,n){var o,r,a,s,l,c,u,d,f,h,p,m=this,g=$App.domainInfo.get(e).attr(t),y=!1;r=n.getFilterPrefix(t),a=n.getPrevFilter(r,t),n.getInitParam&&(d=n.getInitParam(t)),d=d||{},Ext.isEmpty(d.required)||(y=d.required),Ext.isEmpty(d.filterType)||(f=d.filterType),h=a?a.filterType:f||"contains",a&&"no_filter"===f&&Ext.isEmpty(a.value)&&(h="no_filter"),s={isFormField:n.isPreFilter,labelCls:"ub-overflow-elips",labelWidth:100,enforceMaxLength:!0,margin:n.getItemMargin(),maxLength:g.size||2e3,width:this.filterTypeWidth,withoutIndent:!0},Ext.isEmpty(d.value)||(s.value=d.value),a&&(s.value=a.value),n.isPreFilter&&(s.hideLabel=!0),s.enforceMaxLength=!!i.appConfig.maxSearchLength,s.enforceMaxLength&&(s.maxLength=i.appConfig.maxSearchLength),l=Ext.create("Ext.form.field.Text",s),o=function(e,i){l.hide(),l.allowBlank=!0,"no_filter"!==i||n.isPreFilter?"isNull"!==i||n.isPreFilter?"no_filter"===i||"isNull"===i?l.reset():(l.allowBlank=!y,l.show()):c():n.removeFilter(r,t)},p=g.caption;var x=Ext.create("Ext.form.ComboBox",{fieldLabel:p,hideLabel:n.isPreFilter,isFormField:n.isPreFilter,labelWidth:100,margin:n.getItemMargin(),store:m.createFilterItems("string",g.allowNull),queryMode:"local",displayField:"text",valueField:"type",width:this.filterTypeWidth,value:h,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function(e,t,n,i){o(0,t)}},validator:function(e){return!y||"no_filter"!==this.getValue()||i.i18n("filterIsRequired")}});o(0,h),u=function(){var e,n,o,a,s;if(a=i.core.UBCommand.condition,o=x.getValue(),e=l.getValue(),"no_filter"===o||(!e||!e.trim())&&o!==m.isNullFilterType)return null;switch(s={id:r,root:"data",property:t,filterType:o,value:e,userValue:e},o){case"contains":n=new RegExp(i.Utils.escapeForRegexp(e),"i"),s.filterFn=function(e){var i=e.get(t);return i&&null!==i.match(n)},s.condition=a.sqlecLike;break;case"startWith":s.filterFn=function(n){var i=n.get(t);return i&&0===i.toLowerCase().indexOf(e)},s.condition=a.sqlecStartWith;break;case"equal":n=new RegExp("^"+i.Utils.escapeForRegexp(e)+"$","i"),s.filterFn=function(e){var i=e.get(t);return n.test(i)},s.condition=a.sqlecEqual;break;case"isNull":s.filterFn=function(e){return null===e.get(t)},s.condition=a.sqlecIsNull;break;case"no_filter":return null}return Ext.create("Ext.util.Filter",s)},c=function(){var e=u();e?n.setFilter(t,e):n.removeFilter(r,t)},n.isPreFilter?(n.initFilterFunc(t,u),n.initFilterControl(t,null,l),n.initFilterControl(t,"filterType",x)):l.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),c())}),m);var b=[x,l];return n.isPreFilter||b.push(this.createSearchButton(c)),b},getOnChangeHandler:function(e,t,n){return function(e,t){e.isValid()&&("fromDate"===e.dateRole?e.relatedPiker.setMinValue(t):e.relatedPiker.setMaxValue(t))}},getDateFilterInputS:function(e,t,n){var o,r,a,s,l,c,u,d,f,h,p,m,g,y,x,b,v=this,E=n.getFilterPrefix(t),w=n.getPrevFilter(E,t),C=$App.domainInfo.get(e).attr(t),I=!1;b=C.dataType,x="DateTime"===b,n.getInitParam&&(p=n.getInitParam(t)),p=p||{},Ext.isEmpty(p.required)||(I=p.required),Ext.isEmpty(p.filterType)||(m=p.filterType),w&&Ext.isArray(w)?Ext.Array.each(w,(function(e){switch(r=e,e.controlID){case"date":d=e;break;case"dateFrom":f=e;break;case"dateTo":h=e}})):d=r=w||{filterType:m||"date"},g=(r=r||{filterType:m||"date"}).filterType||m||"date",x&&("date"===r.filterType||"today"===r.filterType||"yesterday"===r.filterType)&&f&&(d=f),r&&"no_filter"===m&&Ext.isEmpty(r.valueFrom)&&Ext.isEmpty(r.value)&&(g="no_filter"),y=null,Ext.isEmpty(p.valueFrom)||(y=p.valueFrom),f&&(y=f.value),a=this.getOnChangeHandler(E,t,n),s=Ext.widget("ubdatefield",{isFormField:n.isPreFilter,value:y,hidden:"period"!==g,allowBlank:!I,dateRole:"fromDate",fieldType:b,withoutIndent:!0,margin:n.getItemMargin(),listeners:{scope:n,change:a}}),y=null,Ext.isEmpty(p.valueTo)||(y=p.valueTo),h&&(y=x?i.core.UBUtil.addDays(h.value,-1):h.value),l=Ext.widget("ubdatefield",{labelWidth:10,isFormField:n.isPreFilter,labelSeparator:"",fieldLabel:" -",value:y,allowBlank:!I,dateRole:"toDate",hidden:"period"!==g,fieldType:b,withoutIndent:!0,margin:n.getItemMargin(),listeners:{scope:n,change:a}}),y=null,Ext.isEmpty(p.value)||(y=p.value),d&&(y=d.value,x&&"to_date"===r.filterType&&(y=i.core.UBUtil.addDays(y,-1))),c=Ext.widget("ubdatefield",{isFormField:n.isPreFilter,value:y,allowBlank:!I,fieldType:b,margin:n.getItemMargin(),withoutIndent:!0,hidden:!("date"===g||"from_date"===g||"to_date"===g)}),s.relatedPiker=l,l.relatedPiker=s;var S=function(e,i){if(s.hide(),l.hide(),c.hide(),s.reset(),l.reset(),c.reset(),s.allowBlank=!0,l.allowBlank=!0,c.allowBlank=!0,"no_filter"!==i){if("isNull"!==i)return"period"===i?(s.allowBlank=!I,l.allowBlank=!I,s.show(),void l.show()):void("date"!==i&&"from_date"!==i&&"to_date"!==i||(c.allowBlank=!I,c.show()));n.isPreFilter||u()}else n.isPreFilter||n.removeFilter(E,t)},B=Ext.create("Ext.form.ComboBox",{fieldLabel:C.caption,hideLabel:n.isPreFilter,isFormField:n.isPreFilter,labelWidth:100,store:v.createFilterItems("date",C.allowNull),queryMode:"local",displayField:"text",valueField:"type",margin:n.getItemMargin(),width:this.filterTypeWidth,value:g,forceSelection:!0,withoutIndent:!0,editable:!1,validator:function(){return!I||"no_filter"!==this.getValue()||i.i18n("filterIsRequired")},listeners:{change:function(e,t,n,i){S(0,t)}}});S(0,g),o=function(){var e,n,o,r,a,u,d,f,h,p,m=[];if(p=i.core.UBCommand.condition,e=B.getValue(),n=s.getValue(),r=l.getValue(),o=c.getValue(),!s.isValid()||!l.isValid()||!c.isValid())return null;switch(e){case"no_filter":return null;case"today":a=new Date,x?(d=[a=i.core.UBUtil.truncTime(a),i.core.UBUtil.addDays(a,1)],a=null):(a=i.core.UBUtil.truncTimeToUtcNull(a),u="=");break;case"yesterday":a=i.core.UBUtil.addDays(new Date,-1),x?(d=[i.core.UBUtil.truncTime(a),i.core.UBUtil.truncTime(new Date)],a=null):(a=i.core.UBUtil.truncTimeToUtcNull(a),u="=");break;case"current_week":x?((d=i.ux.Multifilter.getWeekRange(b,!0))[0]=i.core.UBUtil.truncTime(d[0]),d[1]=i.core.UBUtil.addDays(i.core.UBUtil.truncTime(d[1]),1)):d=i.ux.Multifilter.getWeekRange(b);break;case"this_month":x?((d=i.ux.Multifilter.getMonthRange(b,!0))[0]=i.core.UBUtil.truncTime(d[0]),d[1]=i.core.UBUtil.addDays(i.core.UBUtil.truncTime(d[1]),1)):d=i.ux.Multifilter.getMonthRange(b);break;case"this_year":x?((d=i.ux.Multifilter.getYearRange(b,!0))[0]=i.core.UBUtil.truncTime(d[0]),d[1]=i.core.UBUtil.addDays(i.core.UBUtil.truncTime(d[1]),1)):d=i.ux.Multifilter.getYearRange(b);break;case"from_date":a=i.core.UBUtil.truncTimeToUtcNull(o),x&&(a=i.core.UBUtil.truncTime(o)),u=">=";break;case"to_date":a=i.core.UBUtil.truncTimeToUtcNull(o),u="<=",x&&(u="<",a=i.core.UBUtil.addDays(i.core.UBUtil.truncTime(o),1));break;case"date":x?(d=[a=i.core.UBUtil.truncTime(o),i.core.UBUtil.addDays(a,1)],a=null):(a=i.core.UBUtil.truncTimeToUtcNull(o),u="=");break;case"period":d=[i.core.UBUtil.truncTimeToUtcNull(n),i.core.UBUtil.truncTimeToUtcNull(r)],x&&(d=[i.core.UBUtil.truncTime(n),i.core.UBUtil.addDays(i.core.UBUtil.truncTime(r),1)]);break;case"isNull":m.push(Ext.create("Ext.util.Filter",{id:E,root:"data",filterType:e,property:t,filterFn:v.getfilterFuncIsNull(t),condition:p.sqlecIsNull,value:null}))}return a&&m.push(Ext.create("Ext.util.Filter",{id:E,root:"data",filterType:e,property:t,operator:u,controlID:"date",exactMatch:!0,isTime:x,value:a})),d&&d[0]&&d[1]&&(f=Ext.create("Ext.util.Filter",{id:E,root:"data",filterType:e,property:t,controlID:"dateFrom",operator:">=",isTime:x,value:d[0]}),h=Ext.create("Ext.util.Filter",{id:E+"_to",root:"data",property:t,filterType:e,controlID:"dateTo",operator:x?"<":"<=",isTime:x,value:d[1]}),f.relatedFilter=h,h.relatedFilter=f,m.push(f,h)),m},u=function(){var e=o();e?n.setFilter(t,e):n.removeFilter(E,t)},n.isPreFilter?(n.initFilterFunc(t,o),n.initFilterControl(t,"date",c),n.initFilterControl(t,"fromDate",s),n.initFilterControl(t,"toDate",l),n.initFilterControl(t,"filterType",B)):(c.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),u())}),v),s.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),u())}),v),l.on("specialkey",(function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),u())}),v));var D=[B,s,l,c];return n.isPreFilter||D.push(this.createSearchButton(u)),D}}})},293:function(e,t,n){n(3006),Ext.define("UB.ux.PDFComponent",{extend:"UB.ux.UBObject",alias:"widget.ubpdf",type:"application/pdf",constructor:function(){this.useBlobForData=!0,this.dataBlob=null,this.dataUrl=null,this.objUrl=null,this.data=null,this.callParent(arguments)},getElConfig:function(){let e=this.callParent();return e.cn=[{tag:"div",width:this.width,height:this.height}],e},afterRender:function(){this.callParent(arguments),this.data&&this.afterSetUrl()},useBlobForData:!0,getDataBlob:function(){return this.useBlobForData||Ext.Error.raise("object does not use Blob"),this.dataBlob},updateDataBlob:function(e){this.useBlobForData||Ext.Error.raise("object does not use Blob"),this.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),this.data=null,this.dataBlob=e,this.objUrl=window.URL.createObjectURL(e);let t,n=UB.connection.appConfig.uiSettings.adminUI.pdfViewer;t=n?void 0===n.uriSuffix?"#view=Fit":n.uriSuffix:"#view=Fit",this.data=this.objUrl+t},onDestroy:function(){var e=this;e.dataBlob=null,e.data=null,e.useBlobForData&&!Ext.isEmpty(e.objUrl)&&window.URL.revokeObjectURL(e.objUrl),e.objUrl=null,this.callParent()},updateDataUrl:function(){var e=this.data;this.data="",this.data=e},afterSetUrl:function(){const e=UB.connection.appConfig.uiSettings.adminUI.pdfViewer;let t;if(e&&e.customURI){let n=this.up("form");t=UB.format(e.customURI,encodeURIComponent(this.data),$App.connection.userData("lang"),n&&n.instanceID,n&&n.entityName)}else t=this.data;let n={tag:"iframe",type:this.type,src:t,width:this.width,height:this.height},i=this.getEl();i&&i.setHTML("").appendChild(n)},setSrc:function(e){var t=this,n=e.url,i=e.blobData;if(t.dataUrl=n,t.useBlobForData){if(!i)return $App.connection.get(t.dataUrl,{responseType:"arraybuffer"}).then((function(e){var n=e.data;t.updateDataBlob(new Blob([n],{type:"application/pdf"})),t.afterSetUrl()})).catch((function(t){401!==t.status&&(e.onContentNotFound?e.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"))})).then();t.updateDataBlob(i),t.afterSetUrl()}else t.data=t.dataUrl,t.afterSetUrl();return Promise.resolve(!0)}})},4979:function(e,t,n){const i=n(6486);Ext.define("UB.ux.UBBadge",{extend:Ext.Component,mixins:[Ext.form.field.Field],alias:"widget.ub-badge",statics:{setupRenderer:function(e,t,n,i,o){let r=e.find((e=>e.name===t));if(!r)return;o||(o=UB.ux.UBBadge.getCssMap(n));let a=null==i?UB.ux.UBBadge._invertedEnums[n]:i;r.format=UB.ux.UBBadge.formatEnum(n,o,a)},formatEnum:function(e,t,n){return t||(t=UB.ux.UBBadge.getCssMap(e)),function(i,o){if(null==i)return null;if(null==o){const t=e?UB.core.UBEnumManager.getById(e,i):null;return t?t.data.name:i}return UB.ux.UBBadge.styleBadgeColumn(o),UB.ux.UBBadge.renderEnum(e,i,t,n)}},styleBadgeColumn:function(e,t){e.innerCls=t||"ub-badge-parent-paddings"},renderEnum:function(e,t,n,i){let o=e?UB.core.UBEnumManager.getById(e,t):null;return UB.ux.UBBadge.renderBadge(o?o.data.name:t,n&&n[t]?n[t]:"default",i)},renderBadge:function(e,t,n){return null==e?null:Ext.String.format('<span style="margin-left: 3px; " class="ub-badge-component {2}ub-badge-{0}">{1}</span>',t,i.escape(UB.i18n(e)),n?"ub-badge-invert ":"")},getCssMap:function(e){if(!UB.ux.UBBadge._enumClasses.hasOwnProperty(e))throw new Error("Cannot setup renderer for field, because no css maps available for enum group "+e+".");return UB.ux.UBBadge._enumClasses[e]},isEnumInverted:function(e){return!!UB.ux.UBBadge._invertedEnums[e]},setCssMap:function(e,t,n){UB.ux.UBBadge._enumClasses[e]=t,n&&(UB.ux.UBBadge._invertedEnums[e]=!0)},_enumClasses:{},_invertedEnums:{}},tpl:'<tpl><span<tpl if="invert"> class="ub-badge-component ub-badge-field ub-badge-{cssClass} ub-badge-invert"></tpl><tpl if="!invert"> class="ub-badge-component ub-badge-field ub-badge-{cssClass}"></tpl>{text}</span></tpl>',enumGroup:"",cssMap:null,defaultCssClass:"default",invert:null,config:{value:null,readOnly:!0},applyReadOnly:()=>!0,initComponent:function(){this.on("added",(function(){"x-toolbar"!==this.up().componentCls&&this.addCls("ub-badge-parent-paddings")}),this,{single:!0}),this.callParent(arguments),this.text&&this.cssClass&&this.update({cssClass:this.cssClass,text:this.text,invert:this.invert})},applyValue:function(e){!this.enumGroup&&this.attributeName&&(this.enumGroup=this._determineEnumGroup()),null==this.invert&&(this.invert=!!UB.ux.UBBadge._invertedEnums[this.enumGroup]);let t=this.enumGroup?UB.core.UBEnumManager.getById(this.enumGroup,e):null,n=this.cssMap||this.enumGroup?UB.ux.UBBadge.getCssMap(this.enumGroup):{};return this.update({cssClass:n[e]||this.defaultCssClass,text:t?t.data.name:e,invert:this.invert}),e},_determineEnumGroup:function(){let e=this.up("basepanel");if(!e||!e.domainEntity)return console.warn("Impossible to determine enumGroup, because control is not inside basepanel or the paneldoes not have entity set."),null;let t=e.domainEntity.attributes[this.attributeName];return t?t.enumGroup?t.enumGroup:(console.warn("Impossible to determine enumGroup, because attribute "+this.attributeName+" is no enum"),null):(console.warn("Impossible to determine enumGroup, because entity does not have attribute "+this.attributeName),null)}}),Ext.define("UB.ux.UBBadgeField",{extend:Ext.form.field.Base,alias:"widget.ub-badge-field",enumGroup:"",cssMap:null,defaultCssClass:"default",invert:null,initComponent:function(){this.callParent(arguments),!this.map&&this.enumGroup&&(this.map=UB.ux.UBBadge.getCssMap(this.enumGroup)),null===this.invert&&(this.invert=this.enumGroup&&UB.ux.UBBadge.isEnumInverted(this.enumGroup)),this.on("afterrender",(function(){this._node=this.inputEl.dom.parentNode,this._renderBadge()})),this.on("change",(function(){this._renderBadge()}))},beforeDestroy:function(){delete this._node,this.callParent(arguments)},_renderBadge:function(){this._node.innerHTML=UB.ux.UBBadge.renderEnum(this.enumGroup,this.getValue(),this.map,this.invert)}})},6933:function(){Ext.define("UB.ux.UBCodeMirror",{extend:"Ext.Component",mixins:{field:"Ext.form.field.Field"},statics:{editorQTip:"\n<h5>Helpers</h5>\n<ul>\n  <li>Ctrl+Q - code templates</li>\n  <li>Ctrl+Space - code competition</li>\n  <li>Ctrl+B - Beautify content</li>\n</ul>\n<h5>Search</h5><ul>\n  <li>Ctrl+F  - Start searching</li>\n  <li>Ctrl+G  - Find next</li>\n  <li>Shift-Ctrl+G - Find previous</li>\n  <li>Shift-Ctrl+F - Replace</li>\n  <li>Shift-Ctrl+R - Replace all</li>\n  <li>Alt+F - Persistent search (dialog does not autoclose, enter to find next, Shift-Enter to find previous)</li>\n  <li>Alt+G - Jump to line</li>\n</ul>\n<h5>Edit</h5><ul>\n  <li>Ctrl+A - Select the whole content of the editor</li>\n  <li>Ctrl+D - Deletes the whole line under the cursor</li>\n  <li>Ctrl+Z - Undo the last change</li>\n  <li>Ctrl+Y - Redo the last undone change</li>\n  <li>Ctrl+U - Undo the last change to the selection</li>\n  <li>Alt-Left / Alt-Right - Move the cursor to the start/end  of the line</li>\n  <li>Tab / Shift + Tab - If something is selected, indent/dedent it</li>\n</ul>"},alias:"widget.ubcodemirror",border:1,codeMirrorInstance:void 0,codeSnippetsGetter:null,editorMode:"javascript",valueIsJson:!1,jsonChanged:!1,getValue:function(){return this.valueIsJson?this.rawValue:this.codeMirrorInstance?this.codeMirrorInstance.getValue():this.rawValue},setValue:function(e){this.rawValue=e,this.codeMirrorInstance&&(this.valueIsJson?this.codeMirrorInstance.setValue(e?JSON.stringify(e):""):this.codeMirrorInstance.setValue(""+e),this.editorMode!==this.codeMirrorInstance.getOption("mode")&&this.codeMirrorInstance.setOption("mode",this.editorMode))},isEqual:function(e,t){return this.valueIsJson?JSON.stringify(e)==JSON.stringify(t):String(e)===String(t)},setSrc:function(e){var t=this,n=e.blobData,i=e.resetOriginalValue;function o(e){return t.setValue(e),i&&(t.resetOriginalValue(),t.fireEvent("setOriginalValue",e,t)),e}let r=e.contentType||"";return r.endsWith("yaml")?this.editorMode="yaml":r.endsWith("x-vue")?this.editorMode={name:"vue"}:this.editorMode="javascript",n?new Promise((function(e,t){var i=new window.FileReader;i.addEventListener("loadend",(function(){e(o(i.result))})),i.addEventListener("error",(function(){t(o(i.error))})),i.readAsText(n)})):e.params?UB.core.UBService.getDocument(e.params).then((function(e){return o(e)})):Promise.resolve(o(e.rawValue))},initComponent:function(){this.callParent(arguments)},onShowSnippets:function(e){var t=this;t.codeSnippetsGetter&&e.showHint({hint:function(){var n=e.getCursor(),i=e.options.tabSize||2,o=n.ch/i>1?"\t".repeat(n.ch/2):"";return{list:t.codeSnippetsGetter(o),from:CodeMirror.Pos(n.line,n.ch),to:CodeMirror.Pos(n.line,n.ch)}}})},doBeautify:function(){var e=this;this.codeMirrorInstance&&SystemJS.import("js-beautify/js/lib/beautify").then((function(t){var n=e.codeMirrorInstance.getValue();n=t.js_beautify(n,{indent_size:2,indent_char:" "}),e.codeMirrorInstance.setValue(n)}))},listeners:{render:function(){var e=this.getEl().dom,t=this;SystemJS.import("@unitybase/codemirror-full").then((n=>{window.CodeMirror=n,n.commands.codeSnippets=n.showHint,this.codeMirrorInstance=this.editor=n(e,{mode:this.editorMode,value:this.valueIsJson?this.rawValue?JSON.stringify(this.rawValue):"":this.rawValue||"",lineNumbers:!0,lint:Object.assign({asi:!0,esversion:8},$App.connection.appConfig.uiSettings.adminUI.linter),readOnly:!1,tabSize:2,highlightSelectionMatches:{annotateScrollbar:!0},matchBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Q":this.onShowSnippets.bind(this),"Ctrl-B":this.doBeautify.bind(this)}});let i=document.createElement("i");i.style="position: absolute;right: 15px; z-index: 10000",i.className="u-icon-circle-question",e.firstChild.insertBefore(i,e.firstChild.firstChild),t.editorTip=Ext.create("Ext.tip.ToolTip",{target:i,html:UB.ux.UBCodeMirror.editorQTip}),t.on("destroy",(function(){this.editorTip&&this.editorTip.destroy()}),t),this.codeMirrorInstance.on("change",(function(e){if(t.valueIsJson)try{let n=e.getValue();t.rawValue=JSON.parse(n),t.checkChange()}catch(e){}else t.checkChange()}))}))}}})},8230:function(e,t,n){n(6830),Ext.define("UB.ux.UBDetailGrid",{extend:"UB.view.EntityGridPanel",alias:"widget.ubdetailgrid",uses:["UB.core.UBApp","UB.core.UBCommand"],layout:"fit",readOnly:!1,masterFields:[],detailFields:[],forceDataLoad:!1,initComponent:function(){let e;if(this.cmpInitConfig&&(console.warn("cmpInitConfig parameter is deprecated. You can set parameters from cmpInitConfig into UBDetailGrid config."),Ext.apply(this,this.cmpInitConfig)),this.disableAutoLoadStore=!0,e=this.cmdData&&this.cmdData.params?this.cmdData.params[0]:null,e&&!this.entityConfig&&(this.entityConfig=e),this.cmdData&&console.debug("UBDetailGrid: cmdData cfg parameter is deprecated. Use entityConfig"),this.cmdType&&"showList"!==this.cmdType)throw new Error("UB.ux.UBDetailGrid show only grid");if(this.grid=this,this.gridCreated=!0,this.callParent(arguments),_.isFunction(this.customInit)&&this.customInit(),$App.domainInfo.get(this.entityConfig.entity).checkAttributeExist(this.detailFields,"UB.ux.UBDetailGrid, detailFields:"),this.addEvents("gridCreated"),this.isDesignMode)try{this.setValue(null)}catch(e){}},on:function(e,t,n,i){"gridCreated"===e?(console.error("Deprecated. Grid is created immediately"),t.bind(n||this).apply([this])):this.callParent(arguments)},setValue:function(e,t){let n=this;t&&$App.domainInfo.get(t).checkAttributeExist(n.masterFields,"UB.ux.UBDetailGrid, masterFields:"),n.masterFields&&n.detailFields&&(n.parentContext=n.parentContext||{},_.forEach(n.masterFields,(function(i,o){if(!e.fields.findBy((function(e){return e.name===i})))throw new Error('Master entity record does not contains field "'+i+'". This field used as parent field in UBDetailGrid. Detail entity = '+n.entityConfig.entity+", master entity "+t);n.parentContext[n.detailFields[o]]=e.get(i)}))),n.onRefreshDetail(e)},onRefreshDetail:function(e){let t;e&&e.isModel&&(t=this.store.ubRequest,t.whereList=UB.core.UBCommand.addMasterDetailRelation(t.whereList,this.masterFields,this.detailFields,e),(this.rendered||this.forceDataLoad)&&(this.rowEditing&&this.editingPlugin.editing&&this.editingPlugin.cancelEdit(),this.store.reload()))}})},7937:function(e,t,n){n(8980),Ext.define("UB.ux.UBDetailTree",{extend:"Ext.tree.Panel",alias:"widget.ubdetailtree",cls:"ub-tree",useArrows:!0,hideHeaders:!0,layout:"fit",localXY:[0,0],behaviors:{},expandedNodes:{},lastSelectionId:null,mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},statics:{actionId:{addNew:"addNew",edit:"edit",deleteItem:"deleteItem",refresh:"refresh",up:"up",down:"down"},eventId:{addnew:"addnew",edit:"edit",deleteItem:"deleteitem",afterdel:"afterdel",refresh:"refresh",up:"up",down:"down"}},forceDataLoad:!1,listeners:{resize:function(){this.editPanel.resizer&&(this.editPanel.resizer.resizeTracker.maxHeight=this.getHeight()),this.editPanel.setHeight(Math.min(this.getHeight(),this.editPanel.getHeight()))},boxready:function(){this.forceDataLoad||this.reloadTree()}},readOnly:!1,initComponent:function(){var e=this;e.columns=[{xtype:"ubdetailtreecolumn",width:"100%",dataIndex:"text",sortable:!1,hideable:!1,draggable:!1,resizable:!1,templates:null,renderer:function(e,t,n){var i=this.templates[n.raw.nodeType];if(!i){var o=Ext.util.Format.format(UB.i18n("nodeTemplateNotFound"),n.raw.ID,n.raw.nodeType);throw UB.showErrorWindow(o),new Error(o)}return i.apply(n.raw)}}],e.editPanel=Ext.widget({xtype:"panel",header:!1,dock:"bottom",hidden:!0,resizable:!0,resizeHandles:"n",minHeight:200,layout:"fit",parent:this,listeners:{show:function(){this.resizer.resizeTracker.maxHeight=this.parent.getHeight()},remove:function(){var t=e.getDockedItems('toolbar[dock="top"]')[0];this.hide(),t&&t.enable(),e.editing=!1}}}),e.actions=e.actions||{},e.preprocessPanel(),e.dockedItems=e.dockedItems||[],e.dockedItems.push(e.editPanel),e.callParent(arguments),e.on({beforeselect:e.onBeforeSelect,scope:e})},addBaseActions:function(){var e=this,t=UB.ux.UBDetailTree.actionId,n=UB.ux.UBDetailTree.eventId;e.actions[t.addNew]=new Ext.Action({actionId:t.addNew,iconCls:"u-icon-add",cls:"add-new-action",tooltip:UB.i18n("actionAdd"),eventId:n.addnew,disabled:!0,menu:[],scope:e}),e.actions[t.refresh]=new Ext.Action({actionId:t.refresh,iconCls:"u-icon-refresh",cls:"refresh-action",tooltip:UB.i18n("refresh"),eventId:n.refresh,handler:e.onAction,scope:e}),e.actions[t.edit]=new Ext.Action({actionId:t.edit,iconCls:"u-icon-edit",cls:"edit-action",tooltip:UB.i18n("Edit"),eventId:n.edit,handler:e.onAction,scope:e}),e.actions[t.deleteItem]=new Ext.Action({actionId:t.deleteItem,iconCls:"u-icon-delete",cls:"delete-action",tooltip:UB.i18n("Delete"),eventId:n.deleteItem,handler:e.onAction,scope:e}),e.actions[t.up]=new Ext.Action({actionId:t.up,iconCls:"u-icon-arrow-up",cls:"up-action",hidden:!0,eventId:n.up,handler:e.onAction,scope:e}),e.actions[t.down]=new Ext.Action({actionId:t.down,iconCls:"u-icon-arrow-down",cls:"down-action",hidden:!0,eventId:n.down,handler:e.onAction,scope:e})},addBaseDockedItems:function(){var e=this,t=UB.ux.UBDetailTree.actionId,n=[e.actions[t.refresh],e.actions[t.addNew],e.actions[t.edit],e.actions[t.deleteItem],e.actions[t.up],e.actions[t.down]];e.dockedItems=[{xtype:"toolbar",dock:"top",items:n}]},addBaseListeners:function(){var e=this,t=UB.ux.UBDetailTree.eventId;e.on("itemdblclick",e.onEditItem,e),e.on(t.addnew,e.onAddItem,e),e.on(t.edit,e.onEditItem,e),e.on(t.deleteItem,e.onDeleteItem,e),e.on(t.refresh,e.reloadTree,e),e.on(t.up,e.moveUp,e),e.on(t.down,e.moveDown,e),e.readOnly&&e.setReadOnly(e.readOnly)},hideAction:function(e){var t;(t=this.actions[e])&&(t.blocked=!0,t.disable(),t.hide())},showAction:function(e){var t;(t=this.actions[e])&&(t.blocked=!0,t.setDisabled(!1),t.show())},setReadOnly:function(e){var t=this;t.readOnly=e,e?(t.hideAction("addNew"),t.hideAction("deleteItem"),t.hideAction("edit")):(t.showAction("addNew"),t.showAction("deleteItem"),t.showAction("edit"))},onAction:function(e){var t=this;Ext.callback(t.eventHandler,t,[t,e.eventId]),t.fireEvent(e.eventId,e)},onBeforeSelect:function(e,t){var n=this,i=UB.ux.UBDetailTree.actionId,o=t.raw.nodeType,r=n.behaviors[o];if(!n.editing&&(n.lastSelectionId=t.raw.ID,r)){if(n.actions[i.edit].setDisabled(!r.onEdit),Ext.isDefined(t.raw.deletable)||(t.raw.deletable=!0),n.actions[i.deleteItem].setDisabled(!t.raw.deletable),r.allowedMove){var a=t.parentNode;a&&a.childNodes&&(n.actions[i.up].setDisabled(a.childNodes.indexOf(t)<=0),n.actions[i.down].setDisabled(a.childNodes.indexOf(t)>=a.childNodes.length-1))}else n.actions[i.up].setDisabled(!0),n.actions[i.down].setDisabled(!0);var s=n.actions[i.addNew];if(!r.allowedChildren||!r.allowedChildren.length)return void s.disable();s.enable(),s.each((function(e){var t=e.menu;t.removeAll(!0),Ext.Array.each(r.allowedChildren||[],(function(e){t.add({xtype:"menuitem",text:n.behaviors[e].title,handler:function(){var t=n.actions[i.addNew].items[0];n.fireEvent(t.eventId,t,e)}})}))}))}},applyData:function(e,t,n){var i=this,o=UB.ux.UBDetailTree.actionId,r=n.some((function(e){return e.allowedMove}));i.actions[o.up].setHidden(!r),i.actions[o.down].setHidden(!r),i.behaviors={},Ext.Array.each(n,(function(e){i.behaviors[e.nodeType]=e})),i.setTemplates(t),i.expandNode(e),i.setRootNode(e),i.rendered&&i.getView().scrollBy(i.localXY);var a=i.editing;if(i.editing=!1,i.lastSelectionId){var s=null;i.getRootNode().cascadeBy((function(e){e&&e.raw.ID===i.lastSelectionId&&(s=e)}),!0),s&&i.getSelectionModel().select([s])}else i.getSelectionModel().select([i.getRootNode()]);i.editing=a,i.unmaskTree(),i.fireEvent("applyData"),this.on("afterrender",(function(){i.getSelectionModel().select([i.getRootNode()])}))},setTemplates:function(e){this.columns[0].templates=e},expandNode:function(e){var t=this.expandedNodes||{},n={},i=function(e){var o,r,a;if(t[e.ID]&&(e.expanded=!0),n[e.ID]=!0,e.children)for(o=0,r=(a=e.children).length;o<r;++o)i(a[o])};i(e),Ext.Object.each(t,(function(e){n[e]||delete t[e]}))},onDeleteItem:function(){const e=this,t=e.behaviors,n=e.getSelectionModel().getSelection()[0];if(n)return $App.dialogYesNo("deletionDialogConfirmCaption","areYouSure").then((i=>{if(i){const i={entity:t[n.raw.nodeType].entity,method:UB.core.UBCommand.methodName.DELETE,execParams:{ID:n.raw.ID}};e.maskTree(),UB.core.UBService.runList([i],Ext.Function.bind(e.afterDelete,e,[i.entity],!0),e)}}))},afterDelete:function(e,t,n){var i=this;e.serverFailure?i.unmaskTree():(i.lastSelectionId=null,i.reloadTree(),i.fireEvent(UB.ux.UBDetailTree.eventId.afterdel))},onEditItem:function(){var e,t=this,n=t.up("basepanel"),i=t.getSelectionModel().getSelection()[0],o=i?i.parentNode:null,r=t.getRootNode(),a=t.editPanel,s=t.getDockedItems('toolbar[dock="top"]')[0],l={};(n?n.saveForm():Promise.resolve(1)).then((function(n){if(!(n<0)&&(i&&i.raw&&(l=t.behaviors[i.raw.nodeType]),!t.editing&&i&&(r!==i||t.rootVisible)&&l.onEdit)){e=i.raw.ID;var c={};"window"===t.formViewType?(c={instanceID:e,entity:l.entity,formCode:l.onEdit,method:"select",cmdType:UB.core.UBCommand.commandType.showForm,isModal:!0,sender:t,eventHandler:Ext.Function.bind(t.eventHandler,t,[],!0),customParams:{parentNode:o}},l.onEditTitle&&(c.description=l.onEditTitle),UB.core.UBApp.doCommand(c)):(a.show().expand(),c={instanceID:e,entity:l.entity,formCode:l.onEdit,method:"select",cmdType:UB.core.UBCommand.commandType.showForm,isModal:!0,sender:t,cmpInitConfig:{closable:!0},eventHandler:Ext.Function.bind(t.eventHandler,t,[],!0),target:a,customParams:{parentNode:o}},l.onEditTitle&&(c.description=l.onEditTitle),UB.core.UBApp.doCommand(c),s.disable(),t.editing=!0)}}))},onAddItem:function(e,t){var n=this,i=n.up("basepanel"),o=n.editPanel,r=n.getSelectionModel().getSelection()[0],a=n.getRootNode(),s=n.getDockedItems('toolbar[dock="top"]')[0],l=n.behaviors[t],c={};(i?i.saveForm():Promise.resolve(1)).then((function(e){if(!(e<0)){r.expand(),c[l.parentField]=r.raw.ID,c.docID=a.raw.ID;var t={};switch(n.formViewType){case"window":t={formCode:l.onAdd,cmdType:UB.core.UBCommand.commandType.showForm,entity:l.entity,initValue:c,isModal:!0,sender:n,eventHandler:Ext.Function.bind(n.eventHandler,n,[],!0),customParams:{parentNode:r}},l.onAddTitle&&(t.description=l.onAddTitle),UB.core.UBApp.doCommand(t);break;default:o.show().expand(),t={formCode:l.onAdd,cmdType:UB.core.UBCommand.commandType.showForm,entity:l.entity,cmpInitConfig:{closable:!0},initValue:c,sender:n,eventHandler:Ext.Function.bind(n.eventHandler,n,[],!0),target:o,customParams:{parentNode:r}},l.onAddTitle&&(t.description=l.onAddTitle),UB.core.UBApp.doCommand(t),s.disable(),n.editing=!0}}}))},expandToCurrentNode:function(e){if(e){for(var t=e.parentNode;t&&t!==this.getRootNode();)t.expand(),t=t.parentNode;return!0}return!1},eventHandler:function(e,t){"aftersave"===t?this.reloadTree():"afterdelete"===t&&(this.lastSelectionId=null,this.reloadTree())},reloadTree:function(){var e=this,t={},n=e.getRootNode(),i=function(e){var n,o,r;if(t[e.raw.ID]=e.isExpanded(),e.childNodes)for(n=0,o=(r=e.childNodes).length;n<o;++n)i(r[n])};if(e.maskTree(),n&&(i(n),e.expandedNodes=t,e.rendered)){var o=e.getView().el.dom;e.localXY=[o.scrollLeft,o.scrollTop]}e.fireEvent("reloadtree")},maskTree:function(){this.rendered&&this.getEl().mask(UB.i18n("loadingData"))},unmaskTree:function(){this.rendered&&this.getEl().unmask()},moveUp:function(){var e=this.getSelectionModel().getSelection()[0],t=e.parentNode;if(t){var n=t.childNodes.indexOf(e);if(n>0){var i=t.childNodes[n-1];this.doExchange(e,i,e.raw.orderEntity)}}},moveDown:function(){var e=this.getSelectionModel().getSelection()[0],t=e.parentNode;if(t){var n=t.childNodes.indexOf(e);if(n<t.childNodes.length-1&&-1!==n){var i=t.childNodes[n+1];this.doExchange(e,i,e.raw.orderEntity)}}},doExchange:function(e,t,n){var i,o,r=this;if(n){o=n,i=$App.domainInfo.get(o).hasMixin("softLock");var a=e.raw.orderIndex;e.raw.orderIndex=t.raw.orderIndex,t.raw.orderIndex=a,UB.core.UBService.runList([{entity:o,method:"update",lockType:i?"ltTemp":void 0,execParams:{ID:e.raw.orderKeyField,orderIndex:e.raw.orderIndex,mi_modifyDate:e.raw.mi_modifyDate}},{entity:o,method:"update",lockType:i?"ltTemp":void 0,execParams:{ID:t.raw.orderKeyField,orderIndex:t.raw.orderIndex,mi_modifyDate:t.raw.mi_modifyDate}}],(function(e){if(!e.serverFailure){r.reloadTree();var t=e[0];t&&t.resultLock&&t.resultLock.success&&UB.ux.LockManager.checkUnlock(o,t.resultLock.lockValue),(t=e[1])&&t.resultLock&&t.resultLock.success&&UB.ux.LockManager.checkUnlock(o,t.resultLock.lockValue)}}),r)}},setValue:function(e,t){this.onRefreshDetail(e)},onRefreshDetail:function(e){(this.rendered||this.forceDataLoad)&&this.reloadTree()}})},8980:function(){Ext.define("UB.ux.UBDetailTreeColumn",{extend:"Ext.grid.column.Column",alias:"widget.ubdetailtreecolumn",tdCls:Ext.baseCSSPrefix+"grid-cell-treecolumn",autoLock:!0,lockable:!1,draggable:!1,hideable:!1,treePrefix:Ext.baseCSSPrefix+"tree-",elbowPrefix:Ext.baseCSSPrefix+"tree-elbow-",expanderCls:Ext.baseCSSPrefix+"tree-expander",imgText:'<img src="{1}" class="{0}" />',initComponent:function(){var e=this;e.origRenderer=e.renderer||e.defaultRenderer,e.origScope=e.scope||window,e.renderer=e.treeRenderer,e.scope=e,e.callParent()},treeRenderer:function(e,t,n,i,o,r,a){var s=this,l=[],c=UB.format,u=n.getDepth(),d=s.treePrefix,f=s.elbowPrefix,h=s.expanderCls,p=s.imgText,m=s.origRenderer.apply(s,arguments),g=Ext.BLANK_IMAGE_URL,y=n.get("cls"),x=s.getChildCls?s.getChildCls()+" ":"",b=n.raw.iconCls,v=n.raw.title;for(v=v?`<legend><span>${n.raw.title}</span></legend>`:"",m=b?['<fieldset class="ub-tree-node">',"<legend>",'<span role="img" class="ub-tree-node-icon '+b+'">',"&nbsp","</span>",'<span class="ub-tree-node-title-withicon">',n.raw.title,"</span>","</legend>",m,"</fieldset>"].join(""):`<fieldset class="ub-tree-node">${v}${m}</fieldset>`;n;)(!n.isRoot()||n.isRoot()&&a.rootVisible)&&(n.getDepth()===u?(l.unshift(c(p,x+d+"icon"+(n.get("icon")?"-inline ":"")+(n.get("iconCls")||""),n.get("icon")||g)),n.isLast()?n.isExpandable()?l.unshift(c(p,x+" x-tree-icon "+f+"end-plus "+h,g)):l.unshift(c(p,x+" x-tree-icon "+f+"end",g)):n.isExpandable()?l.unshift(c(p,x+" x-tree-icon "+f+"plus "+h,g)):l.unshift(c(p,x+" x-tree-icon "+d+"elbow",g))):n.isLast()||0===n.getDepth()?l.unshift(c(p,x+" x-tree-icon "+f+"empty",g)):0!==n.getDepth()&&l.unshift(c(p,x+" x-tree-icon "+f+"line",g))),n=n.parentNode;return l.push(m),y&&(t.tdCls+=" "+y),l.join("")},defaultRenderer:Ext.identityFn})},561:function(e,t,n){n(7027),n(3006),n(293),n(4708),n(75),n(9290),n(6814),n(6933),n(9318),n(7080),n(3036),Ext.define("UB.ux.UBDocument",{extend:"Ext.container.Container",mixins:{labelable:"Ext.form.Labelable",field:"Ext.form.field.Field"},alias:"widget.ubdocument",uses:["UB.core.UBApp"],autoEl:"div",statics:{editors:{tinyMCE:"UB.ux.UBTinyMCETextArea",codeMirror:"UB.ux.UBCodeMirror",ubDiagram:"UB.ux.UBMetaDiagram",ubOrgChart:"UB.ux.UBOrgChart",ubReport:"UB.ux.UBReportEditor"},valueProperties:{fName:"fName",origName:"origName"},contentTypeMapping:{"application/pdf":"UB.ux.PDFComponent","application/edi":"UB.ux.PDFComponent","image/png":"UB.ux.UBImg","image/gif":"UB.ux.UBImg","image/jpeg":"UB.ux.UBImg","image/jpg":"UB.ux.UBImg","image/bmp":"UB.ux.UBImg","image/x-icon":"UB.ux.UBImg","text/html":"UB.ux.UBTinyMCETextArea","application/txt":"UB.ux.UBTinyMCETextArea","application/ubreport":"UB.ux.UBReportEditor","text/plain":"UB.ux.UBCodeMirror","application/json":"UB.ux.UBCodeMirror","application/def":"UB.ux.UBCodeMirror","application/javascript":"UB.ux.UBCodeMirror","text/javascript":"UB.ux.UBCodeMirror","text/x-yaml":"UB.ux.UBCodeMirror","application/yaml":"UB.ux.UBCodeMirror","text/xml":"UB.ux.UBCodeMirror","application/xml":"UB.ux.UBCodeMirror","script/x-vue":"UB.ux.UBCodeMirror","application/ubWorkFlow":"UB.ux.GraphViewer","application/ubworkflow":"UB.ux.GraphViewer","application/ubMetaDiagram":"UB.ux.UBMetaDiagram","application/ubmetadiagram":"UB.ux.UBMetaDiagram","application/uborgchart":"UB.ux.UBOrgChart","application/UBOrgChart":"UB.ux.UBOrgChart"}},layout:"fit",cls:"ub-document-container",forceMIME:"",bypassCache:!1,originalMIME:null,lastOriginalValue:null,expanded:!1,documentMIME:null,initComponent:function(){this.originalValue=void 0,this.forceMIME=this.forceMIME||"",this.callParent(arguments),this.addEvents("change","dirtychange","initialize"),this.initEmptyDocumentMIME&&this.setValue("")},createComponent:function(e){let t=this;t.ubCmp&&!1!==t.keepCmpOnRefresh&&e===t.cmpContentType||(t.cmpContentType=e,t.items&&t.items.length>0&&t.removeAll(),t.contentXType=t.getExtXType(e),t.ubCmp=Ext.create(t.contentXType,Ext.apply({name:t.name,useBlobForData:!0,mode:t.getNormalizeContentType(e),readOnly:t.readOnly},t.cmpConfig||{})),t.add(t.ubCmp),t.ubCmp.on("change",t.checkContentChange,t),t.ubCmp.on("setOriginalValue",(function(e){t.lastCmpValue=e}),t)),t.fireEvent("initialize",t)},onContentNotFound:function(){this.errorLabel?this.errorLabel.show():(this.errorLabel=Ext.create("UB.ux.UBLabel",{html:'<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"}),this.add(this.errorLabel)),this.ubCmp&&this.ubCmp.hide()},checkContentChange:function(){const e=this;if(!e.suspendCheckChange&&!e.readOnly)if("UBOnlyOffice"===e.ubCmp.xtype)e.ubCmp.checkDirty()&&(e.fireEvent("change",e,"",""),e.onChange("",""));else{const t=e.ubCmp.getValue(),n=e.lastCmpValue,i=e.getValue();if(e.isDestroyed||(e.ubCmp.isDirty?!e.ubCmp.isDirty():e.isEqual(t,n))){let o;e.lastCmpValue=t,e.value=o=e.originalValue,e.fireEvent("change",e,o,i),e.onChange(t,n)}else{e.lastCmpValue=t;let o=i?JSON.parse(i):{};o.md5="changedAt"+Date.now(),e.value=o=JSON.stringify(o),e.fireEvent("change",e,o,i),e.onChange(t,n)}}},checkDirty:function(){if(this.readOnly)return!1;let e=this.isDirty();e!==this.wasDirty&&(this.fireEvent("dirtychange",this,e),this.onDirtyChange(e),this.wasDirty=e)},getNormalizeContentType:function(e){let t=e.indexOf(";");return-1!==t?e.substring(0,t):e},getExtXType:function(e){let t;if("UB.ux.UBLink"===e||"UB.ux.UBLabel"===e)return e;if(this.expanded){let n=this.getNormalizeContentType(e);t=UB.ux.UBDocument.contentTypeMapping[n]}return t||"UB.ux.UBLink"},getValueProperty:function(e){return JSON.parse(this.value)[e]},setValueProperty:function(e,t){let n=Ext.JSON.decode(this.value,!0);n&&(UB.core.UBUtil.isEqual(n[e],t)||(n[e]=t,this.value=Ext.JSON.encode(n)))},getFName:function(){return this.getValueProperty(UB.ux.UBDocument.valueProperties.fName)},setFName:function(e){this.setValueProperty(UB.ux.UBDocument.valueProperties.fName,e)},getOrigName:function(){return this.getValueProperty(UB.ux.UBDocument.valueProperties.origName)},setOrigName:function(e){this.setValueProperty(UB.ux.UBDocument.valueProperties.origName,e)},getValue:function(){return this.value},loadContent:function(e,t,n){let i=this;return i.bypassCache&&(e+="&_dc="+Date.now()),$App.connection.get(e,{responseType:"arraybuffer"}).then((function(e){return n?{data:e.data,type:i.documentMIME||e.headers("content-type")||t}:new Blob([e.data],{type:i.documentMIME||e.headers("content-type")||t})}),(function(e){throw 401!==e.status?(i.onContentNotFound(),new UB.UBAbortError):e}))},setContent:function(e,t){const n=this;if(!n.documentMIME)throw new Error('This method support only  if "documentMIME" property has value true.');return!1!==t&&(t=!0),n.ubCmp||(n.createComponent(n.documentMIME),t=!0),e&&"object"==typeof e&&(e instanceof Blob||e instanceof File)?n.ubCmp.setSrc({blobData:e,resetOriginalValue:t}).then((function(t){return e instanceof File&&n.setOrigName(e.name),t})):n.ubCmp.setSrc({rawValue:e,resetOriginalValue:t})||Promise.resolve(!0)},setValue:function(e,t,n,i){const o=this;return new Promise(((n,r)=>{let a,s,l,c,u={},d=!1,f="string"==typeof e,h=e&&"object"==typeof e;function p(e,t,i){o.sourceBlob=e,o.loadUrl=t,o.ubCmp.isHidden()&&o.ubCmp.show(),o.errorLabel&&o.errorLabel.hide();let a={url:t,contentType:i,html:!u||u.deleting?l:u.origName||l,blobData:e};!o.forceReload&&o.editorInited&&o.isEditor()?n(null):(o.ubCmp.setSrc(a).then((function(e){n(e)}),(function(e){r(e)})),o.editorInited=o.isEditor())}o.lastNotEmptyValue=e||o.lastNotEmptyValue,o.lastOriginalValue=e,o.instanceID=t,u=f?JSON.parse(e):e,!f&&!h||f&&0===e.length||h&&(!e.ct||!e.origName||e.deleting)?(d=!0,o.documentMIME?a=o.documentMIME:(a="UB.ux.UBLabel",l=UB.i18n("emptyContent"))):(a=o.expanded?u.ct:"UB.ux.UBLink",c={entity:o.entityName,attribute:o.attributeName,ID:o.instanceID},u.store&&(c.store=u.store),u.filename&&(c.filename=u.filename),u.origName&&(c.origName=u.origName),u.isDirty&&(c.isDirty=u.isDirty),o.useRevision&&!Ext.isEmpty(u.revision)&&(c.revision=u.revision),c.filename||(c.filename=o.entityName+o.instanceID+o.attributeName),c._rc=u.revision,l=Ext.String.urlAppend($App.connection.baseURL+"getDocument",Ext.Object.toQueryString(c))),o.originalMIME=o.originalMIME||a,a=o.documentMIME||a,o.value=Ext.Object.getSize(u)>0?JSON.stringify(u):void 0,o.checkChange(),"UB.ux.UBOnlyOffice"===UB.ux.UBDocument.contentTypeMapping[a]?(o.createComponent(a),n(null),p(null,l,a)):"UB.ux.UBLink"===a||d&&0!==Ext.Object.getSize(u)?(o.createComponent(a),p(null,l,a)):0===Ext.Object.getSize(u)?(o.createComponent(a),o.ubCmp.initNewSrc&&(o.value=o.ubCmp.initNewSrc()),n(null)):i&&!u.deleting?(o.createComponent(i.type),p(i,l,a)):(o.getEl()&&o.getEl().mask(UB.i18n("loadingData")),o.loadContent(l,a).then((function(e){s=e.type,o.createComponent(s),p(e,l,s),o.getEl()&&o.getEl().unmask()}),(function(e){o.getEl()&&o.getEl().unmask(),!e||e instanceof UB.UBAbortError?n(null):r(e)})))}))},setComplexValue:function(e){let t=this.attributeName,n=t.lastIndexOf("."),i=t.substring(0,n),o=t.substring(n+1,t.length),r=e.get(i),a=this.entityName;this.entityName=$App.domainInfo.get(a).attr(i).associatedEntity,this.attributeName=o;let s=this.setValue(e.get(t),r,!0);return this.attributeName=t,this.entityName=a,s},resetOriginalValue:function(){this.originalValue=this.getValue(),this.ubCmp&&"function"==typeof this.ubCmp.resetOriginalValue&&this.ubCmp.resetOriginalValue(),this.checkDirty()},isDirty:function(){return!this.readOnly&&(this.isContentDirty()||!this.isEqual(this.getValue(),this.originalValue))},isContentDirty:function(){return!(!this.ubCmp||"function"!=typeof this.ubCmp.isDirty)&&this.ubCmp.isDirty()},isEditor:function(){let e=this.contentXType,t=UB.ux.UBDocument.editors,n=!1;return Ext.Object.each(t,(function(t,i){return e!==i||(n=!0,!1)}),this),n},existData:function(){let e;return this.ubCmp&&this.ubCmp.getValue?e=this.ubCmp.getValue("UBDocument"):this.sourceBlob&&(e=this.sourceBlob.data),!!e},save:function(e){const t=this;if(!(e||t.isEditor()&&t.isDirty()))return Promise.resolve(!0);let n,i,o=t.getValue()||t.lastNotEmptyValue;return o&&(o=JSON.parse(o)),t.ubCmp.getValue?n=t.ubCmp.getValue("UBDocument"):t.sourceBlob&&(n=t.sourceBlob.data),i=!n&&t.loadUrl?t.loadContent(t.loadUrl,null,!0):Promise.resolve(n),i.then((function(e){const n="UBOnlyOffice"===t.ubCmp.xtype?"setOnlyOfficeDocumentToTempStore":"setDocument";return $App.connection.post(n,e,{params:{entity:t.entityName,attribute:t.attributeName,ID:t.instanceID,filename:t.documentFileName||(o&&o.origName?o.origName:t.documentMIME&&t.documentMIME.indexOf("/")<t.documentMIME.length-1?"newfile."+t.documentMIME.substr(t.documentMIME.indexOf("/")+1):"")},headers:{"Content-Type":"application/octet-stream"}})})).then((function(e){const n=e.data;return t.ubCmp.resetOriginalValue&&t.ubCmp.resetOriginalValue(),t.value=Ext.isObject(n.result)?JSON.stringify(n.result):n.result,!0}))},onSave:function(e,t,n){let i=JSON.parse(e);i.success?(this.ubCmp.resetOriginalValue(),this.value=Ext.JSON.encode(i.result)):UB.showErrorWindow(i.errMsg,i.errCode,this.entityName),Ext.callback(t,n,[i.success])},disableActions:function(e){this.action&&this.action.each((function(t){t.menu.items.each((function(t){let n=UB.view.BasePanel.eventId,i=t.eventId;i!==n.scan&&i!==n.attach&&i!==n.deleteattachment||t[e?"disable":"enable"](e)}))}))},setReadOnly:function(e){this.readOnly=e,this.ubCmp&&this.ubCmp.setReadOnly&&this.ubCmp.setReadOnly(e),this.disableActions(e)},disable:function(){this.setDisable(!0)},enable:function(){this.setDisable(!1)},setDisable:function(e){this.disabled=!!e,this.disableActions(e)}})},4708:function(){Ext.define("UB.ux.UBImg",{extend:"Ext.Img",alias:"widget.ubimg",style:"object-fit:contain",constructor:function(){this.useBlobForData=!0,this.dataBlob=null,this.dataUrl=null,this.objUrl=null,this.callParent(arguments)},useBlobForData:!0,updateDataBlob:function(e){var t=this;t.useBlobForData||Ext.Error.raise("object does not use Blob"),t.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),t.data=null,t.dataBlob=e,t.objUrl=window.URL.createObjectURL(e),t.data=t.objUrl},onDestroy:function(){var e=this;e.dataBlob=null,e.data=null,e.useBlobForData&&!Ext.isEmpty(e.objUrl)&&window.URL.revokeObjectURL(e.objUrl),e.objUrl=null,this.callParent()},setSrc:function(e){var t=this,n=e.url,i=e.blobData;if(t.dataUrl=n,t.useBlobForData){if(!i)return $App.connection.get(t.dataUrl,{responseType:"arraybuffer"}).then((function(n){var i=n.data;return e.blobData=new Blob([i],{type:e.contentType}),t.setSrc(e)})).catch((function(t){return 404===t.status&&(e.onContentNotFound?e.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>")),t}));t.updateDataBlob(i),t.callParent([t.data])}else t.data=t.dataUrl,t.callParent([t.data]);return Promise.resolve(!0)}})},9290:function(){Ext.define("UB.ux.UBLabel",{extend:"Ext.form.Label",alias:"widget.ublabel",cls:"emptyDocument",setSrc:function(e){return this.setText(e.html),Promise.resolve(!0)}})},75:function(){Ext.define("UB.ux.UBLink",{extend:"Ext.Component",alias:"widget.ublink",autoEl:"a",href:"javascript:;",html:"",target:"_blank",getElConfig:function(){let e,t=this.callParent();return"a"===this.autoEl?e=t:t.cn=[e={tag:"a",target:"_blank",id:this.id+"-a"}],e.href="javascript:;",e.target=e.target||this.target,e.style=e.style||{},e.style.wordBreak="break-all",t},onRender:function(){var e,t=this;this.callParent(arguments),(e=this.el).on("click",(function(){t.useBlobForData?$App.connection.get(t.dataUrl,{responseType:"arraybuffer"}).then((function(e){var n,i=e.data;n=new Blob([i],{type:t.srcConfig.contentType}),saveAs(n,t.srcConfig.html||(t.srcConfig.params?t.srcConfig.params.origName:""))})).catch((function(e){404===e.status&&(t.html='<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>",t.aEl&&(t.aEl.dom.innerHTML=t.html,t.aEl.dom.href="_blank"))})):$App.connection.authorize().then((function(e){t.dom.href=Ext.String.urlAppend(t.href,"session_signature="+e.signature())}))})),this.aEl="a"===this.autoEl?e:e.getById(this.id+"-a")},setSrc:function(e){var t=this.aEl,n=this;return n.dataUrl=e.url,n.srcConfig=e,n.html=e.html,n.aEl&&e&&(n.aEl.dom.download=e.html||(e.params?e.params.origName:"")),t&&(t.dom.innerHTML=e.html),Promise.resolve(!0)},onDestroy:function(){Ext.destroy(this.aEl),this.aEl=null,this.callParent()}})},7080:function(e,t,n){const i=n(6195),o=n(6486);Ext.define("UB.ux.UBMetaDiagram",{extend:"Ext.Panel",alias:"widget.UBMetaDiagram",width:"100%",height:"100%",layout:"fit",statics:{mixinPictures:{mStorage:'<i class="u-icon-data"></i>',dataHistory:'<i class="u-icon-clock"></i>',unity:'<i class="u-icon-hierarchy"></i>',tree:'<i class="u-icon-hierarchy-alt"></i>',fts:'<i class="u-icon-search"></i>',rls:'<i class="u-icon-list-success"></i>',als:'<i class="u-icon-grid"></i>',aclRls:'<i class="u-icon-list-success">a</i>',audit:'<i class="u-icon-line-chart"></i>',softLock:'<i class="u-icon-key"></i>',clobTruncate:"ct"}},initComponent:function(){var e,t,n,o,r=this;r.addEvents("change"),r.items=r.items||[],r.initObjectTree(),Ext.EventManager.on(document,"mouseup",r.onmouseUpFunc,r),Ext.EventManager.on(document,"mousemove",r.onmousemoveFunc,r),r.idPrefix=Ext.id(null),r.containerId=e=r.idPrefix+"graph",t='<div id="'+e+'" class="graph-editor-holder" style="width: 100%; height: 100%;-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" tabindex="0"></div>',r.editPnl=Ext.create("Ext.panel.Panel",{region:"center",cls:"mx-graph-editor",flex:1,html:t,listeners:{boxready:function(){i.initAndCall().then((function(){r.initMXEditor()}))},resize:function(){this.editor&&this.editor.graph&&this.editor.graph.sizeDidChange()},scope:r}}),r.toolbarId=e=r.idPrefix+"toolbar",n='<div id="'+e+'" tabindex="0"></div>',r.outlineId=e=r.idPrefix+"outline",o='<div id="'+e+'" ></div>',r.menuPnl=Ext.create("Ext.panel.Panel",{height:"100%",region:"west",split:!0,collapsible:!0,width:250,layout:{type:"border"},items:[{xtype:"tabpanel",region:"center",deferredRender:!1,split:!0,height:"auto",bodyStyle:"background:white;",items:[r.objectTree,{xtype:"panel",region:"center",autoRender:!0,title:UB.i18n("toolbar"),html:n,listeners:{boxready:function(e){},scope:r}}]},{xtype:"panel",region:"south",split:!0,height:160,fit:2,html:o}]});var a=Ext.create("Ext.panel.Panel",{layout:{type:"border"},defaults:{split:!0},items:[r.menuPnl,r.editPnl]});r.items.push(a),r.callParent(arguments)},isDirty:function(){return!!this.editor&&this.editor.isModified()},onmousemoveFunc:function(e){var t=this;if(t.dragDropObj&&t.dragDropObj.dragElm){var n=e.getXY();Ext.get(t.dragDropObj.dragElm).position("absolute",t.dragDropObj.dragElm.style.zIndex,n[0],n[1])}},onmouseUpFunc:function(e){var t,n,i,o=this;o.dragDropObj&&o.graphDivEl&&(o.dragDropObj.dragElm&&o.dragDropObj.dragElm.parentNode.removeChild(o.dragDropObj.dragElm),t=e.getX(),n=e.getY(),o.graphDivEl.getX()>t||o.graphDivEl.getX()+o.graphDivEl.getWidth()<t||o.graphDivEl.getY()>n||o.graphDivEl.getY()+o.graphDivEl.getHeight()<n||(t=mxEvent.getClientX(e.browserEvent),n=mxEvent.getClientY(e.browserEvent),i=mxUtils.convertPoint(o.editor.graph.container,t,n),o.addObjectToDiagram(i,o.dragDropObj)),o.dragDropObj=null)},addObjectToDiagram:function(e,t){var n,i,o,r,a,s,l=this,c={},u=t.objectName,d=!1;if(Ext.Object.each(l.editor.graph.model.cells,(function(e,t){var n=t.getAttribute("objectCode");return!n||(u.toUpperCase()===n.toUpperCase()?(d=!0,!1):void 0)}),l),d)return $App.dialogError("Object exist in diagram"),!1;(i=mxUtils.createXmlDocument().createElement("ubObject")).setAttribute("label",u),i.setAttribute("objectCode",u),(n=new mxCell(i,new mxGeometry(0,0,187,147),"verticalAlign=top;align=left;overflow=fill;html=1")).vertex=!0,o=$App.domainInfo.get(u),l.editor.addVertex(null,n,e.x,e.y),o.eachAttribute((function(e,t){if(Ext.String.startsWith(t,"mi_",!0))return!0;"Entity"===e.dataType&&"ID"!==t.toUpperCase()&&((s=c[e.associatedEntity])||(c[e.associatedEntity]=s=[]),s.push({linkType:e.cascadeDelete?"composition":"association",srcObj:u,srcProp:t,destObj:e.associatedEntity,destProp:"ID"}))})),o.mixins&&o.mixins.unity&&((s=c[o.mixins.unity.entity])||(c[o.mixins.unity.entity]=s=[]),s.push({linkType:"inheritance",srcObj:u,srcProp:"ID",destObj:o.mixins.unity.entity,destProp:"ID"})),Ext.Object.each(l.editor.graph.model.cells,(function(e,t){var i=t.getAttribute("objectCode");return!i||!(r=$App.domainInfo.get(i))||(r.mixins&&r.mixins.unity&&r.mixins.unity.entity===u&&(a={linkType:"inheritance",srcObj:i,srcProp:"ID",destObj:u,destProp:"ID"},l.editor.graph.addEdge(l.createEdge(a),null,t,n)),c[i]&&Ext.Array.each(c[i],(function(e){l.editor.graph.addEdge(l.createEdge(e),null,n,t)}),l),void(i!==u&&r.eachAttribute((function(e,o){if(Ext.String.startsWith(o,"mi_",!0))return!0;"Entity"===e.dataType&&"ID"!==o.toUpperCase()&&e.associatedEntity===u&&(a={linkType:"association",srcObj:i,srcProp:o,destObj:u,destProp:"ID"},l.editor.graph.addEdge(l.createEdge(a),null,t,n))}))))}),l)},createEdge:function(e){var t,n;return(n=mxUtils.createXmlDocument().createElement("ubObject")).setAttribute("linkType",e.linkType),n.setAttribute("srcObj",e.srcObj),n.setAttribute("srcProp",e.srcProp),n.setAttribute("destObj",e.destObj),n.setAttribute("destProp",e.destProp),"association"===e.linkType&&((t=new mxCell(n,new mxGeometry(0,0,0,0),"endArrow=open;endSize=10;edgeStyle=orthogonalEdgeStyle;")).geometry.setTerminalPoint(new mxPoint(0,0),!0),t.geometry.setTerminalPoint(new mxPoint(80,0),!0),t.geometry.setTerminalPoint(new mxPoint(160,0),!1),t.edge=!0),"composition"===e.linkType&&((t=new mxCell(n,new mxGeometry(0,0,0,0),"endArrow=diamond;endSize=14;endFill=0;edgeStyle=orthogonalEdgeStyle;")).geometry.setTerminalPoint(new mxPoint(0,0),!0),t.geometry.setTerminalPoint(new mxPoint(80,0),!0),t.geometry.setTerminalPoint(new mxPoint(160,0),!1),t.edge=!0),"inheritance"===e.linkType&&((t=new mxCell(n,new mxGeometry(0,0,0,0),"endArrow=block;endSize=10;endFill=0;edgeStyle=segmentEdgeStyle;fillColor=#0B31D9;strokeColor=#0B31D9;")).geometry.setTerminalPoint(new mxPoint(0,0),!0),t.geometry.setTerminalPoint(new mxPoint(80,0),!0),t.geometry.setTerminalPoint(new mxPoint(160,0),!1),t.edge=!0),t},initObjectTree:function(){var e,t,n=this,i=[],o={};$App.domainInfo.eachEntity((function(e,t){var n=e.modelName,r=o[n];r||(r={text:n,expanded:!1,children:[],icon:null},o[n]=r,i.push(r)),r.children.push({text:t,leaf:!0,icon:null,objCode:t})})),e={root:{expanded:!0,children:i}},t=Ext.create("Ext.data.TreeStore",e),n.objectTree=Ext.create("Ext.tree.Panel",{title:UB.i18n("entities"),flex:1,singleExpand:!0,region:"north",store:t,rootVisible:!1,listeners:{itemmousedown:function(e,t,i,o,r){var a,s,l,c,u;t.isLeaf()&&(a=document.createElement("DIV"),u=n.getContainer().getEl(),document.documentElement.appendChild(a),s=Ext.get(a),l=Ext.get(i),a.style.border="1px solid black",a.style.opacity=1,a.style.backgroundColor="white",s.setWidth(l.getWidth()),s.setHeight(l.getHeight()),c=r.getXY(),s.position("absolute",u.dom.style.zIndex+2,c[0],c[1]),n.dragDropObj={objectName:t.get("text"),dragElm:a})},scope:n}})},useBlobForData:!0,getDataBlob:function(){return this.useBlobForData||Ext.Error.raise("object does not use Blob"),this.dataBlob},updateDataBlob:function(e){var t=this;t.useBlobForData||Ext.Error.raise("object does not use Blob"),t.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),t.data=null,t.dataBlob=e,t.objUrl=window.URL.createObjectURL(e),t.data=t.objUrl},onDestroy:function(){var e=this;e.dataBlob=null,e.data=null,e.useBlobForData&&!Ext.isEmpty(e.objUrl)&&window.URL.revokeObjectURL(e.objUrl),e.objUrl=null,this.callParent()},setSrc:function(e){var t,n=this,i=e.url,o=e.blobData;return t=function(){if(n.changeFired=!0,n.editor){n.isInitEditor=!0;try{n.editor.open(n.objUrl)}finally{n.isInitEditor=!1}n.validateDiagram(),n.editor.setMode("select")}n.changeFired=!1},n.dataUrl=i,n.useBlobForData?o?(n.updateDataBlob(o),t(),Promise.resolve(!0)):$App.connection.get(n.dataUrl,{responseType:"arraybuffer"}).then((function(i){var o,r=i.data;o=new Blob([r],{type:e.contentType}),n.updateDataBlob(o),t()})).fail((function(t){404===t.status&&(e.onContentNotFound?e.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"))})):(n.objUrl=n.dataUrl,t(),Promise.resolve(!0))},validateDiagram:function(){var e,t,n,i,o,r,a,s,l,c,u,d,f,h=this,p=h.editor.graph,m={},g={};Ext.Object.each(h.editor.graph.model.cells,(function(e,t){if(!(n=t.getAttribute("objectCode")))return!0;g[n.toLowerCase()]=t})),Ext.Object.each(h.editor.graph.model.cells,(function(y,x){if(!(n=x.getAttribute("objectCode")))return!0;if(!(e=$App.domainInfo.get(n)))return h.editor.graph.removeCells([x],!0),!0;f=!1;for(var b=x.getEdgeCount()-1;b>-1;b--){switch(i=x.getEdgeAt(b),o=i.getAttribute("srcObj")||"",r=i.getAttribute("srcProp")||"",a=i.getAttribute("destObj")||"",s=i.getAttribute("destProp")||"",l=i.getAttribute("linkType")||"association",d="inheritance"===l,u=!1,n){case o:c=e.attr(r),t=$App.domainInfo.get(a),d?(u=!c||!(e.mixins&&e.mixins.unity&&e.mixins.unity.entity===a),f=!u):u=!c||"Entity"!==c.dataType||"ID"===r.toUpperCase()||c.associatedEntity.toLowerCase()!==a.toLowerCase()||Ext.String.startsWith(r.toLowerCase(),"mi_",!0),u=u||!g[a.toLowerCase()],c&&(m[r]=c);break;case a:c=e.attr(s),u=(u=!c)||!g[o.toLowerCase()],t=$App.domainInfo.get(o);break;default:c=null,u=!0}if(t||(u=!0),u){p.model.beginUpdate();try{p.cellsRemoved([i])}finally{p.model.endUpdate()}}}if(!f&&e.mixins&&e.mixins.unity&&g[e.mixins.unity.entity]){let t={linkType:"inheritance",srcObj:n,srcProp:"ID",destObj:e.mixins.unity.entity,destProp:"ID"};h.editor.graph.addEdge(h.createEdge(t),null,x,g[e.mixins.unity.entity])}Ext.Object.each(e.attributes,(function(e,t){if(Ext.String.startsWith(e,"mi_",!0))return!0;if("Entity"===t.dataType&&"ID"!==e.toUpperCase()&&g[t.associatedEntity.toLowerCase()]&&!m[e]){let i={linkType:"association",srcObj:n,srcProp:e,destObj:t.associatedEntity,destProp:"ID"};h.editor.graph.addEdge(h.createEdge(i),null,x,g[t.associatedEntity.toLowerCase()])}}))}),h)},getContainer:function(){return this.up("basewindow")||this.up("basepanel")},initMXEditor:function(){var e,t,n,i,o=mxUtils.load("models/adminui-pub/resources/config/ubmetaeditor.xml").getDocumentElement(),r=this;i=r.getContainer(),r.editor=e=new mxEditor(o),t=e.graph,r.graphDivEl=Ext.get(r.containerId),n=r.graphDivEl.dom,e.setGraphContainer(n),new Ext.Element(e.toolbar.toolbar.container).up("div.mxWindow").remove(),Ext.get(r.toolbarId).dom.appendChild(e.toolbar.toolbar.container),e.keyHandler.handler.target=r.getEl().dom,mxEvent.addListener(e.keyHandler.handler.target,"keydown",e.keyHandler.handler.keydownHandler),e.keyHandler.handler.isGraphEvent=function(e){return r.isGraphEvent(e,this)},e.setModified=function(t){e.modified=t,t&&r.graphChanged()},t.popupMenuHandler.factoryMethod=mxUtils.bind(this,(function(t,n,o){var r=i.getEl().dom;return t.div.parent=r,t.zIndex=r.style.zIndex+1,t.div.style.zIndex=r.style.zIndex+1,e.createPopupMenu(t,n,o)})),r.initGraph(),e.graph.cellsDisconnectable=!1,e.graph.cellsCloneable=!1,e.graph.allowDanglingEdges=!1,e.graph.disconnectOnMove=!1,e.showOutline();var a=new Ext.Element(e.outline.div).down("div.mxWindowPane");if(Ext.get(r.outlineId).appendChild(a),e.outline.setVisible(!1),e._showTasks=e.showTasks,e.tasks&&(e.tasks.destroy(),e.tasks=null),e.showTasks=Ext.Function.bind(r.showTasks,r),e.refreshTasks=Ext.Function.bind(r.refreshTasks,r),e.properties=null,e.showProperties=Ext.Function.bind(r.showProperties,r),e.hideProperties=Ext.Function.bind(r.hideProperties,r),e.addAction("edit",(function(t,n){if(n){var i=n.getAttribute("objectCode");i?$App.doCommand({cmdType:"showForm",formCode:"ubm_form-entityEdit",tabId:"meta-edit-"+i,parentContext:{entityCode:i}}):e.graph.isEnabled()&&e.graph.isCellEditable(n)&&e.graph.startEditingAtCell(n)}})),t.getTooltipForCell=r.getTooltipForCell,t.tooltipHandler.zIndex=i.getEl().dom.style.zIndex+1,t.setResizeContainer(!0),new mxRubberband(t),t.setPanning(!0),t.setTooltips(!0),r.objUrl){r.isInitEditor=!0;try{r.editor.open(r.objUrl)}finally{r.isInitEditor=!1}}},isGraphEvent:function(e,t){var n=mxEvent.getSource(e);if(n===t.target||n.parentNode===t.target||null!==t.graph.cellEditor&&n===t.graph.cellEditor.textarea)return!0;for(var i=n;null!==i;){if(i===t.target)return!0;i=i.parentNode}for(i=n;null!==i;){if(i===t.graph.container)return!0;i=i.parentNode}return!1},getTooltipForCell:function(e){var t,n;if(t=e.getAttribute("objectCode"))try{return(n=$App.domainInfo.get(t)).caption+": "+n.description}catch(e){return'Unknown entity "'+t+'"'}if(t=e.getAttribute("srcProp"))return"association"===(e.getAttribute("linkType")||"association")?e.getAttribute("srcObj")+"."+t+" -> "+e.getAttribute("destObj")+"."+e.getAttribute("destProp"):e.getAttribute("srcObj")+" inherit "+e.getAttribute("destObj")},graphChanged:function(){this.isInitEditor||this.fireEvent("change",this)},initGraph:function(){var e=this,t=e.editor.graph;mxVertexHandler.prototype.rotationEnabled=!0,mxVertexHandler.prototype.manageSizers=!0,mxVertexHandler.prototype.livePreview=!0,t.graphHandler.guidesEnabled=!0,t.allowLoops=!0,t.isHtmlLabel=function(e){var n=t.view.getState(e),i=n?n.style:t.getCellStyle(e);return i.html+""=="1"||i.whiteSpace+""=="wrap"},t.cellRenderer.getLabelValue=function(e){var n=mxCellRenderer.prototype.getLabelValue.apply(t.cellRenderer,arguments);return e.style.whiteSpace+""=="wrap"&&e.style.html+""!="1"&&(n=mxUtils.htmlEntities(n,!1)),n},t.convertValueToString=function(t){return Ext.isString(t.value)?t.value:Ext.isEmpty(t.getAttribute("objectCode"))?t.getAttribute("label"):e.generateObjHtml(t)};var n=t.removeCells;t.removeCells=function(e,i){e||(e=t.getDeletableCells(t.getSelectionCells()));for(var o=e.length-1;o>-1;)e[o].getAttribute("srcProp")&&e.splice(o,1),o--;n.call(t,e,i)}},generateObjHtml:function(e){var t,n,i,r,a;n=e.getAttribute("objectCode"),this.htmCache||(this.htmCache={}),i=['<table width="100%" height="100%" style=" -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" >','<tr><td style="vertical-align: top;" ><div  >','<table style="width:100%;" >','<tr><td colspan="2" style="text-align:center; background:#C1D3F5;padding:2px;">',n,"</td></tr>"];try{(t=$App.domainInfo.get(n)).eachAttribute((function(e,t){if(Ext.String.startsWith(t,"mi_",!0))return!0;r="Entity"===e.dataType,a="Enum"===e.dataType?"Enum "+e.enumGroup:r?"<B>"+e.associatedEntity+"</B>":e.dataType,i.push("<tr><td>",t,'</td><td style="padding:2px;">',a,"</td></tr>")}));var s=[];o.forEach(t.mixins,(function(e,t){e.enabled&&s.push(UB.ux.UBMetaDiagram.mixinPictures[t]||t)})),s.length&&i.push('<tr><td colspan="2" style="text-align:center; background:#C1D3F5;padding:2px;">'+s.join("&nbsp")+"</td></tr>")}catch(e){i.push('<tr><td colspan="2">Unknown entity "'+n+'"</td></tr>')}return i.push("</table></div></td></tr></table>"),i.join("")},getMixinShortName:function(e){return"mStorage"===e?"S":e.substr(0,1).toUpperCase()},refreshTasks:function(e){null!==this.tasks&&(this.taskEl.innerHTML="",this.taskEl.createTasks(e))},showTasks:function(){var e,t,n=this,i=n.editor.graph;if(null===n.editor.tasks){var o=document.createElement("div");o.style.padding="4px",o.style.paddingLeft="20px",t=Ext.widget("panel",{border:!0,flex:1}),e=Ext.create("Ext.Window",{title:"Tasks",width:200,height:400,closable:!0,closeAction:"hide",autoDestroy:!1,layout:"fit",items:[t]}).show(),n.taskWnd=e,e.ownerCt=n,e.registerWithOwnerCt();var r=t.getEl().dom;document.getElementById(r.id+"-innerCt").appendChild(o),n.taskEl=o;var a=mxUtils.bind(n,(function(){n.taskEl.innerHTML="",n.editor.createTasks(n.taskEl)}));i.getModel().addListener(mxEvent.CHANGE,a),i.getSelectionModel().addListener(mxEvent.CHANGE,a),i.addListener(mxEvent.ROOT,a),n.editor.tasks=e,n.editor.createTasks(o)}n.taskWnd.show()},showProperties:function(e){var t=this.editor;if(null===(e=e||t.graph.getSelectionCell())&&null===(e=t.graph.getCurrentRoot())&&(e=t.graph.getModel().getRoot()),null!==e){t.graph.stopEditing(!0),t.hideProperties();var n=t.createProperties(e);if(null!==n){var i=Ext.widget("panel",{border:!0,flex:1}),o=Ext.create("Ext.Window",{title:"Properties",width:250,height:400,closable:!1,layout:"fit",items:[i]}).show();o.ownerCt=this,o.registerWithOwnerCt();var r=i.getEl().dom;document.getElementById(r.id+"-innerCt").appendChild(n),t.properties=o}}},hideProperties:function(){var e=this.editor;null!==e.properties&&(e.properties.close(),e.properties=null)},beforeDestroy:function(){var e=this;e.editor&&e.editor.destroy(),e.tasksWnd&&e.tasksWnd.destroy(),e.editEntityFrmEditor=null,e.editEntityFrm&&e.editEntityFrm.destroy(),Ext.EventManager.un(document,"onmouseup",e.onmouseUpFunc,e),Ext.EventManager.un(document,"onmousemove",e.onmousemoveFunc,e),e.callParent(arguments)},actionHandler:function(e){this.editor.execute(e.mxAction)},getValue:function(){var e=(new mxCodec).encode(this.editor.graph.getModel());return mxUtils.getXml(e)},resetOriginalValue:function(){return null}})},3006:function(){Ext.define("UB.ux.UBObject",{extend:"Ext.Component",alias:"widget.ubobject",type:"",width:"100%",height:"100%",getElConfig:function(){var e,t=this.callParent();return"object"===this.autoEl?e=t:t.cn=[e={tag:"object",id:this.id+"-object"}],e.type=this.type,e.data=this.data,e.width=this.width,e.height=this.height,t},onRender:function(){this.callParent(arguments),this.objEl="object"===this.autoEl?this.el:this.el.getById(this.id+"-object")},onDestroy:function(){Ext.destroy(this.objEl),this.objEl=null,this.callParent()},setSrc:function(e){return this.type=e.contentType,this.data=e.url+(this.forceMIME?"&forceMIME="+encodeURIComponent(this.forceMIME):""),this.objEl&&(this.objEl.dom.type=this.type,this.objEl.dom.data=this.data),Promise.resolve(!0)},setXSize:function(e){this.width=e.width,this.height=e.height,this.objEl&&(this.objEl.dom.width="100%",this.objEl.dom.height="100%")}})},3036:function(e,t,n){const i=n(6195),o=n(1972);Ext.define("UB.ux.UBOrgChart",{extend:"Ext.Panel",alias:"widget.UBOrgChart",width:"100%",height:"100%",layout:"fit",getRepository(){return o.Repository("org_unit").attrs(["ID","parentID","code","caption","unitType","mi_treePath"]).orderBy("mi_treePath").whereIf(this.rootTreePath,"[mi_treePath]","startWith",this.rootTreePath)},getAttrCode(e){const t={defaultUnitType:"ORG",label:"caption"};return t[e]?t[e]:e},loadData:function(){let e=this;return this.xmInitPromise.then((()=>{let t,n=e.up("basepanel");if(n&&n.record&&(t=n.record.get("ID")),t)return o.Repository("org_diagram").attrs(["ID","orgunitID"]).selectById(t).then((t=>(t&&(e.rootElementID=t.orgunitID),!e.rootElementID||o.Repository(this.getRepository().entityName).attrs(["ID","mi_treePath"]).where(this.getAttrCode("ID"),"=",e.rootElementID).selectSingle().then((t=>(t&&(e.rootTreePath=t.mi_treePath),!0))))))})).then(e.doLoadData.bind(e))},doLoadData:function(){let e=this;return e.getRepository().selectAsObject().then(e.makeTree.bind(e))},treeData:[],makeTree:function(e){let t=this,n={};t.treeData=[],e.forEach((function(e){let i=e[t.getAttrCode("ID")],o=e[t.getAttrCode("parentID")],r=n[i];if(r||(r=n[i]={child:[]}),Object.assign(r,e),t.rootElementID&&t.rootElementID===i&&(o=null,r[t.getAttrCode("parentID")]=null),o){let e=n[o];e||(e=n[o]={child:[]}),e.child.push(r)}else t.treeData.push(r)})),t.allData=n},showElement:function(e,t,n){return this.addChild(this.graph,e,t,!0,n)},showChild:function(e,t,n,i,o){let r,a=this;n||(r=a.graph.getModel(),r.beginUpdate());try{t.child&&t.child.forEach((function(t){let r=a.showElement(e,t);n&&(!i||i>o)&&a.showChild(r,t,i,o+1)}))}finally{n||r.endUpdate()}},defaultLayout:"V",showTree:function(){let e=this;1===e.treeData.length?e.addChild(e.graph,null,e.treeData[0]):e.initRoot(e.treeData);let t=e.graph.getModel();t.beginUpdate();try{1===e.treeData.length?e.showChild(e.rootVarex,true,!0,2,1):e.treeData.forEach((function(t){e.showElement(e.rootVarex,t)}))}finally{t.endUpdate()}e.autoLayout(e.rootVarex,e.defaultLayout),e.changeFired=!1,e.undoManager.clear()},initComponent:function(){let e=this;e.layout="fit",this.expandImage=$App.getImagePath("expandLG.png"),this.collapseImage=$App.getImagePath("collapseLG.png"),this.appendImage=$App.getImagePath("download.png"),e.initMetaInfo(),e.tbar=e.createToolBar(),e.idPrefix=Ext.id();let t=e.idPrefix+"graph";e.containerId=t;let n='<div id="'+t+'" class="graph-editor-holder" style="width: 100%; height: 100%; background-color: white; overflow: scroll; -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" tabindex="0"></div>';e.outlineId=t=e.idPrefix+"outline";let r='<div id="'+t+'" style="width: 100%; height: 100%; overflow: scroll;" ></div>';e.outlineWnd=Ext.create("Ext.Window",{title:o.i18n("Overview"),width:200,height:200,closable:!1,layout:"fit",constrain:!0,items:[{html:r}]}),e.xmInitPromise=new Promise(((t,o)=>{e.mainPnl=Ext.create("Ext.panel.Panel",{flex:1,html:n,items:[e.outlineWnd,{xtype:"text",text:"text",degrees:90}],listeners:{boxready:function(){i.initAndCall().then((()=>{e.initGraph(),t(e)})).catch((e=>o(e)))},resize:function(){e.graph&&e.graph.sizeDidChange()},scope:e}})})),e.items||(e.items=[]),e.items.push(e.mainPnl),e.callParent(arguments),e.isLoadContent=!1},beforeDestroy:function(){this.outlineWnd&&this.outlineWnd.destroy(),this.toolbarWnd&&this.toolbarWnd.destroy(),this.rubberband&&this.rubberband.destroy(),this.keyHandler&&this.keyHandler.destroy(),this.toolbar&&this.toolbar.destroy(),this.outline&&this.outline.destroy(),this.graph&&this.graph.destroy(),this.callParent(arguments)},initGraph:function(){let e=this;e.graphDivEl=Ext.get(e.containerId);let t=e.up("basewindow")||$App.getViewport(),n=t.getEl().dom.style.zIndex||1,i=e.graphDivEl.dom;i.style.position="absolute",i.style.overflow="hidden",i.style.left="0px",i.style.top="0px",i.style.right="0px",i.style.bottom="0px";const o=e.mainPnl.getBox();e.outlineWnd.showAt(o.width-e.outlineWnd.width,0),e.outlineWnd.setXY([o.right-e.outlineWnd.width,o.top]);let r=document.getElementById(e.outlineId);mxEvent.disableContextMenu(i),new mxDivResizer(i),new mxDivResizer(r);let a=new mxGraph(i);e.graph=a,a.setCellsMovable(!0),a.setAutoSizeCells(!0),a.setPanning(!0),a.setTooltips(!0),a.centerZoom=!1,a.panningHandler.useLeftButtonForPanning=!0,a.panningHandler.selectOnPopup=!1,a.panningHandler.panningEnabled=!0,a.cellsDisconnectable=!1,a.cellsCloneable=!1,a.allowDanglingEdges=!1,a.disconnectOnMove=!1,a.gridEnabled=!1,e.isGraphChanged=!1,a.getModel().addListener(mxEvent.CHANGE,(function(){e.graphChanged()})),e.installDblClickHandler(a),e.rubberband=new mxRubberband(a),e.outline=new mxOutline(a,r),a.setTooltips(!mxClient.IS_TOUCH),a.tooltipHandler.zIndex=n+100,e.undoManager=new mxUndoManager,e.installUndoHandler(a),a.setHtmlLabels(!0);let s=a.getStylesheet().getDefaultVertexStyle();function l(e){let t=new mxCompactTreeLayout(a,e);return t.useBoundingBox=!1,t.edgeRouting=!1,t.levelDistance=60,t.nodeDistance=16,t.isVertexMovable=function(e){return!0},t}s[mxConstants.STYLE_SHAPE]="label",s[mxConstants.STYLE_WHITE_SPACE]="wrap",s[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,s[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_LEFT,s[mxConstants.STYLE_SPACING_LEFT]=4,s[mxConstants.STYLE_GRADIENTCOLOR]="#7d85df",s[mxConstants.STYLE_STROKECOLOR]="#5d65df",s[mxConstants.STYLE_FILLCOLOR]="#adc5ff",s[mxConstants.STYLE_FONTCOLOR]="#1d258f",s[mxConstants.STYLE_FONTFAMILY]="Verdana",s[mxConstants.STYLE_FONTSIZE]="10",s[mxConstants.STYLE_FONTSTYLE]="1",s[mxConstants.STYLE_SHADOW]="1",s[mxConstants.STYLE_ROUNDED]="1",s[mxConstants.STYLE_GLASS]="1",s[mxConstants.STYLE_SPACING]=12,s=Ext.clone(s),s[mxConstants.STYLE_GRADIENTCOLOR]="#7DDF94",s[mxConstants.STYLE_STROKECOLOR]="#5DDF71",s[mxConstants.STYLE_FILLCOLOR]="#ADFFBD",a.getStylesheet().putCellStyle("org_staffunit",s),s=Ext.clone(s),s[mxConstants.STYLE_GRADIENTCOLOR]="#D5DF7D",s[mxConstants.STYLE_STROKECOLOR]="#D2DF5D",s[mxConstants.STYLE_FILLCOLOR]="#F7FFAD",a.getStylesheet().putCellStyle("org_department",s),s=Ext.clone(s),s[mxConstants.STYLE_GRADIENTCOLOR]="#7d85df",s[mxConstants.STYLE_STROKECOLOR]="#5d65df",s[mxConstants.STYLE_FILLCOLOR]="#adc5ff",a.getStylesheet().putCellStyle("org_organization",s),s=a.getStylesheet().getDefaultEdgeStyle(),s[mxConstants.STYLE_ROUNDED]=!0,s[mxConstants.STYLE_STROKEWIDTH]=3,s[mxConstants.STYLE_EDGE]=mxEdgeStyle.OrthConnector,e.keyHandler=new mxKeyHandler(a),e.verticalLayout=l(!1),e.horisontalLayout=l(!0),a.popupMenuHandler.factoryMethod=function(n,i,o){let r=t.getEl().dom,s=r.style.zIndex||9999999999999;return n.div.parent=r,n.zIndex=s+1,n.div.style.zIndex=s+1,e.createPopupMenu(a,n,i,o)};var c=a.getPreferredSizeForCell;if(a.getPreferredSizeForCell=function(e){var t=c.apply(this,arguments);return null!==t&&(t.width=Math.max(120,t.width-40)),t},a.cellRenderer.getTextScale=function(e){return Math.min(1,e.view.scale)},a.convertValueToString=function(e){return Ext.isString(e.value)?e.value:e.getAttribute("label")},a.getPreferredSizeForCell=Ext.bind(e.getPreferredSizeForCell,a),e.graph&&e.dataUrl&&!e.isActulData)return e.startLoadData()},installUndoHandler:function(e){var t=mxUtils.bind(this,(function(e,t){var n=t.getProperty("edit");this.undoManager.undoableEditHappened(n)}));e.getModel().addListener(mxEvent.UNDO,t),e.getView().addListener(mxEvent.UNDO,t);const n=function(t,n){var i=n.getProperty("edit").changes;e.setSelectionCells(e.getSelectionCellsForChanges(i))};this.undoManager.addListener(mxEvent.UNDO,n),this.undoManager.addListener(mxEvent.REDO,n)},initRoot:function(){let e=this,t=e.graph,n=t.getDefaultParent();if(t&&t.container){t.getModel().beginUpdate();try{let i=mxUtils.createXmlDocument().createElement("ubOrgChart");i.setAttribute("label",o.i18n("Organization")),i.setAttribute("unitType",e.getAttrCode("defaultUnitType")),i.setAttribute("isRoot",!0);let r=t.container.offsetWidth,a=t.insertVertex(n,"treeRoot",i,r/2-30,20,140,60);t.updateCellSize(a),e.addExpandOverlay(t,a,!0),e.addIconOverlay(a),a.isRoot=!0,e.rootVarex=a}finally{t.getModel().endUpdate()}}},installDblClickHandler:function(e){e.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,(function(t,n){var i=n.getProperty("cell");i&&e.isEnabled()&&null!==this.dblClickAction&&(this.dblClickAction(i,n),e.tooltipHandler.hide(),n.consume())})))},dblClickAction:function(e){let t=this,n=e.getAttribute("unitType"),i=e.getAttribute("ID"),o=t.getEntityByUnitType(n);o&&i&&t.openForm(o,i,null,(function(e){t.refreshDiagram()}))},getEntityByUnitType:function(e){let t=this.orgUnity[e];return t?t.code:""},openForm:function(e,t,n,i){this.openFormC({entityCode:e,instanceID:t,initialFieldValues:n,onClose:i})},openFormC:function(e){let t,n,i=this;e.isModal=!!Ext.isEmpty(e.isModal)||e.isModal;let r=o.core.UBFormLoader.getFormByEntity(e.entityCode);r&&(t=r.get("code"),n=o.i18n(r.get("description")));let a={cmdType:o.core.UBCommand.commandType.showForm,formCode:t,description:n,entity:e.entityCode,instanceID:e.instanceID,initialFieldValues:e.initialFieldValues,customParams:e.customParams,isModal:e.isModal,callback:function(t){if(e.onClose&&t){var n=t.up("window");n&&n.on({beforeclose:e.onClose,scope:i})}}};o.core.UBApp.doCommand(a)},createToolBar:function(){var e=this;return Ext.define("SelectPrinterFmt",{extend:"Ext.data.Model",fields:[{name:"ID",type:"object"},{name:"Caption",type:"string"}]}),{xtype:"toolbar",items:[{xtype:"button",text:o.i18n("Undo"),iconCls:"icon-undo",handler:function(){e.undoManager.undo()},scope:e},{xtype:"button",text:o.i18n("Redo"),iconCls:"icon-redo",handler:function(){e.undoManager.redo()},scope:e},{xtype:"button",text:o.i18n("Zoom"),iconCls:"icon-zoom-in",handler:function(){e.graph.zoomIn()},scope:e},{xtype:"button",text:o.i18n("Zoom Out"),iconCls:"icon-zoom-out",handler:function(){e.graph.zoomOut()},scope:e},{xtype:"button",text:o.i18n("Actual Size"),iconCls:"icon-view11",handler:function(){e.graph.zoomActual()},scope:e},{xtype:"combobox",store:Ext.create("Ext.data.Store",{model:"SelectPrinterFmt",data:[{ID:"A4P",Caption:o.i18n("A4 portrait")},{ID:"A4L",Caption:o.i18n("A4 landscape")},{ID:"A5P",Caption:o.i18n("A5 portrait")},{ID:"A5L",Caption:o.i18n("A5 landscape")}]}),forceSelection:!0,editable:!1,allowBlank:!1,displayField:"Caption",valueField:"Caption",value:o.i18n("A4 portrait"),width:150,labelWidth:0,queryMode:"local",listeners:{select:function(t,n){if(n.length>0)switch(n[0].get("ID")){case"A4P":e.printerFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;break;case"A4L":e.printerFormat=mxConstants.PAGE_FORMAT_A4_LANDSCAPE;break;case"A5P":e.printerFormat=new mxRectangle(0,0,1652,1169);break;case"A5L":e.printerFormat=new mxRectangle(0,0,1169,1652)}},scope:e}},{xtype:"button",text:o.i18n("Print"),iconCls:"icon-printer",handler:function(){new mxPrintPreview(e.graph,1,e.printerFormat||null).open()},scope:e},{xtype:"button",text:o.i18n("Poster Print"),iconCls:"icon-print",handler:function(){Ext.Msg.prompt({msg:o.i18n("Enter maximum page count"),prompt:!0,title:"",minWidth:Ext.Msg.minPromptWidth,buttons:Ext.Msg.OKCANCEL,callback:function(t,n){if("ok"===t){var i=n;if(null!==i){var o=mxUtils.getScaleForPageCount(i,e.graph);new mxPrintPreview(e.graph,o,e.printerFormat||null).open()}}},scope:e,multiline:!1,value:"1"})},scope:e},{xtype:"button",text:o.i18n("Select"),icon:"models/adminui-pub/resources/images/select.gif",handler:function(){e.graph.panningHandler.useLeftButtonForPanning=!1,e.graph.setConnectable(!1)},scope:e},{xtype:"button",text:o.i18n("Pan"),icon:"models/adminui-pub/resources/images/pan.gif",handler:function(){e.graph.panningHandler.useLeftButtonForPanning=!0,e.graph.setConnectable(!1)},scope:e},{xtype:"button",text:o.i18n("Select all"),handler:function(){e.graph.selectAll()},scope:e}]}},createPopupMenu:function(e,t,n){let i=this,r=e.getModel();if(i.isLoadContent||t.addItem(o.i18n("New organizational chart"),"",(function(){i.loadData().then((()=>{i.showTree(),i.isLoadContent=!0}))})),null!==n){if(r.isVertex(n))Ext.Object.each(i.orgUnity,(function(e,r){t.addItem(o.i18n("Create child")+" "+r.caption,"",(function(){i.createChildElement(n,e)}))}),i),t.addSeparator(),t.addItem(o.i18n("Open subordinate chart from this node"),"",(function(){i.openDiagram(n)})),t.addSeparator(),t.addItem(o.i18n("Remove all child"),"",(function(){i.deleteSubtree(e,n),i.graph.removeCellOverlays(n),i.addIconOverlay(n),i.addAddOverlay(i.graph,n)})),t.addItem(o.i18n("Select all child"),"",(function(){i.selectAllChild(n)})),t.addSeparator(),t.addItem(o.i18n("Align child to right"),"",(function(){i.autoLayout(n,"H"),i.selectAllChild(n)})),t.addItem(o.i18n("Align child down me"),"",(function(){i.autoLayout(n,"V"),i.selectAllChild(n)}));else{var a=n.getStyle()||"edgeStyle=orthogonalEdgeStyle;";a.indexOf("topToBottomEdgeStyle")<0&&t.addItem(o.i18n("Format edge top to bottom"),"",(function(){e.setCellStyle("edgeStyle=topToBottomEdgeStyle;",[n])})),a.indexOf("sideToSideEdgeStyle")<0&&t.addItem(o.i18n("Format edge left to right"),"",(function(){e.setCellStyle("edgeStyle=sideToSideEdgeStyle;",[n])})),a.indexOf("orthogonalEdgeStyle")<0&&t.addItem(o.i18n("Format edge orthogonal"),"",(function(){e.setCellStyle("edgeStyle=orthogonalEdgeStyle;",[n])}))}t.addSeparator()}t.addItem(o.i18n("Fit"),$App.getImagePath("zoom_in.png"),(function(){e.fit()})),t.addItem(o.i18n("Actual Size"),$App.getImagePath("view_1_1.png"),(function(){e.zoomActual()})),t.addSeparator(),t.addItem(o.i18n("Print"),$App.getImagePath("print.png"),(function(){new mxPrintPreview(e,1).open()})),t.addItem(o.i18n("Poster Print"),$App.getImagePath("print.png"),(function(){var t=mxUtils.prompt(o.i18n("Enter maximum page count"),"1");if(null!==t){var n=mxUtils.getScaleForPageCount(t,e);new mxPrintPreview(e,n).open()}}))},setDetaileEdgeStyle:function(e,t){let n=this,i=[],o=n.graph.model;n.graph.traverse(e,!0,(function(e){let t=o.getEdgeCount(e);if(t>0)for(var n=0;n<t;n++){var r=o.getEdgeAt(e,n);o.getTerminal(r,!0)===e&&i.push(r)}return!0})),n.graph.setCellStyle("edgeStyle="+t+";",i)},autoLayout:function(e,t){var n=this;switch(t){case"H":n.setDetaileEdgeStyle(e,"sideToSideEdgeStyle"),n.horisontalLayout.execute(n.graph.getDefaultParent(),e);break;case"V":n.setDetaileEdgeStyle(e,"topToBottomEdgeStyle"),n.verticalLayout.execute(n.graph.getDefaultParent(),e)}},addExpandOverlay:function(e,t,n){let i=this,r=new mxCellOverlay(new mxImage(n?i.collapseImage:i.expandImage,24,24),n?o.i18n("Collapse"):o.i18n("Expand"));r.cursor="hand",r.align=mxConstants.ALIGN_CENTER,r.addListener(mxEvent.CLICK,mxUtils.bind(this,(function(e,n){i.expandORCollapse(t,r)}))),r.isExpandOvelay=!0,r.expanded=!n,e.addCellOverlay(t,r)},addAddOverlay:function(e,t){let n=this,i=new mxCellOverlay(new mxImage(n.appendImage,24,24),o.i18n("Append element"));i.cursor="hand",i.offset=new mxPoint(-4,8),i.align=mxConstants.ALIGN_RIGHT,i.verticalAlign=mxConstants.ALIGN_TOP,i.addListener(mxEvent.CLICK,mxUtils.bind(this,(function(e,o){n.addChildElement(t,i)}))),i.isAddOverlay=!0,e.addCellOverlay(t,i)},addIconOverlay:function(e){let t=e.getAttribute("unitType"),n=e.getAttribute("label"),i=this.orgUnity[t],o=i?i.image:$App.getImagePath("office.png"),r=new mxCellOverlay(new mxImage(o,24,24),n);r.offset=new mxPoint(4,8),r.align=mxConstants.ALIGN_LEFT,r.verticalAlign=mxConstants.ALIGN_TOP,r.isIconOverlay=!0,this.graph.addCellOverlay(e,r)},updateCell:function(e){this.graph.refresh(e)},getAddOvelay:function(e){var t=null;return e.overlays&&e.overlays.length?(Ext.Array.each(e.overlays,(function(e){if(e.isAddOverlay)return t=e,!1}),this),t):null},getExpandOvelay:function(e){return e.overlays&&0!==e.overlays.length?e.overlays.find((e=>e.isExpandOvelay)):null},addChildElement:function(e,t){var n,i,o,r,a=this,s=e.getAttribute("ID"),l=a.allData[s],c=a.graph.getModel(),u={},d=0,f=[];if(i=a.findChildCell(e),Ext.Array.each(i,(function(e){o=e.getAttribute("ID"),u[1*o]=e,d++})),l&&l.child.length>0){c.beginUpdate();try{r={x:e.geometry.x,y:e.geometry.y+120},l.child.forEach((function(t){u[t.ID]||(a.showElement(e,t,r),f.push(e),r.x+=100)}))}finally{c.endUpdate()}0===d&&a.autoLayout(e,a.defaultLayout),a.graph.removeCellOverlay(e,t),(n=a.getExpandOvelay(e))?n.expanded&&a.expandORCollapse(e):a.addExpandOverlay(a.graph,e,!0),0===d?a.selectAllChild(e):a.graph.setSelectionCells(f)}},expandORCollapse:function(e,t){var n,i=this,r=e.getAttribute("ID"),a=i.allData[r];a&&(n=a.child),e.isRoot&&!r&&(n=i.treeData),n&&n.length&&(i.hideOrShowCells(i.graph,e,t.expanded),t.expanded=!t.expanded,t.image.src=t.expanded?i.expandImage:i.collapseImage,t.tooltip=t.expanded?o.i18n("Expand"):o.i18n("Collapse")),i.updateCell(e)},hideOrShowCells:function(e,t,n){var i,o=this,r=[],a=!1;return e.traverse(t,!0,(function(e){return t!==e&&(r.push(e),a=a||!e.isVisible()),!0})),null===n&&(n=a),e.toggleCells(n,r,!0),n&&Ext.Array.each(r,(function(e){(i=o.getExpandOvelay(e))&&i.expanded&&(i.image.src=o.collapseImage,o.updateCell(e))})),n},changeElementParent:function(e,t,n){var i,o,r=this,a=r.graph.getModel();if((i=a.getEdgeCount(e))>0)for(let t=0;t<i;t++)if(o=a.getEdgeAt(e,t),a.getTerminal(o,!0)!==e){r.graph.cellsRemoved([o]);break}r.addElementEdge(e,t,n)},addChild:function(e,t,n,i,o){var r,a,s,l,c=this,u=e.getModel(),d=e.getDefaultParent();i||u.beginUpdate();try{(r=mxUtils.createXmlDocument().createElement("ubOrgChart")).setAttribute("label",n[c.getAttrCode("label")]),r.setAttribute("ID",n[c.getAttrCode("ID")]),r.setAttribute("parentID",n[c.getAttrCode("parentID")]),r.setAttribute("code",n.code),r.setAttribute("unitType",n[c.getAttrCode("unitType")]),t||r.setAttribute("isRoot",!0),o&&(a=o.x,s=o.y),(l=e.insertVertex(d,null,r,a,s)).setStyle(c.getEntityByUnitType(n[c.getAttrCode("unitType")]));var f=u.getGeometry(l),h=e.getPreferredSizeForCell(l);f.width=h.width,f.height=h.height,t?c.addElementEdge(l,t,n):(l.isRoot=!0,c.rootVarex=l),n.child.length>0&&c.addAddOverlay(e,l),c.addIconOverlay(l)}finally{i||u.endUpdate()}return l},addElementEdge:function(e,t,n){var i=this.graph,o=i.getDefaultParent(),r=i.insertEdge(o,null,"",t,e);r.setAttribute("fromID",n[this.getAttrCode("ID")]),r.fromID=n[this.getAttrCode("ID")],r.setGeometry(new mxGeometry(0,0,0,0)),r.geometry.relative=!0,r.geometry.setTerminalPoint(new mxPoint(0,0),!0),r.geometry.setTerminalPoint(new mxPoint(80,0),!0),r.geometry.setTerminalPoint(new mxPoint(160,0),!1)},selectAllChild:function(e){var t=[];this.graph.traverse(e,!0,(function(n){return e!==n&&t.push(n),!0})),this.graph.setSelectionCells(t)},deleteSubtree:function(e,t){var n=[];e.traverse(t,!0,(function(e){return t!==e&&n.push(e),!0})),e.removeCells(n)},getPreferredSizeForCell:function(e){var t=null;if(null!==e){var n=this.view.getState(e),i=n?n.style:this.getCellStyle(e);if(null!==i&&!this.model.isEdge(e)){var o=i[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,r=0,a=0;(this.getImage(n)||i[mxConstants.STYLE_IMAGE])&&i[mxConstants.STYLE_SHAPE]===mxConstants.SHAPE_LABEL&&(i[mxConstants.STYLE_VERTICAL_ALIGN]===mxConstants.ALIGN_MIDDLE&&(r+=parseFloat(i[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),i[mxConstants.STYLE_ALIGN]!==mxConstants.ALIGN_CENTER&&(a+=parseFloat(i[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize)),r+=2*(i[mxConstants.STYLE_SPACING]||0),r+=i[mxConstants.STYLE_SPACING_LEFT]||0,r+=i[mxConstants.STYLE_SPACING_RIGHT]||0,a+=2*(i[mxConstants.STYLE_SPACING]||0),a+=i[mxConstants.STYLE_SPACING_TOP]||0,a+=i[mxConstants.STYLE_SPACING_BOTTOM]||0;var s=this.getFoldingImage(n);null!==s&&(r+=s.width+8);var l=this.getLabel(e);if(l&&l.length>0){this.isHtmlLabel(e)||(l=l.replace(/\n/g,"<br>"));var c=mxUtils.getSizeForString(l,o,i[mxConstants.STYLE_FONTFAMILY]);c.width+r>100&&(c=mxUtils.getSizeForString(l,o,i[mxConstants.STYLE_FONTFAMILY],100));var u=c.width+r,d=c.height+a;if(!mxUtils.getValue(i,mxConstants.STYLE_HORIZONTAL,!0)){var f=d;d=u,u=f}this.gridEnabled&&(u=this.snap(u+this.gridSize/2),d=this.snap(d+this.gridSize/2)),t=new mxRectangle(0,0,u,d)}else{var h=4*this.gridSize;t=new mxRectangle(0,0,h,h)}}}return t},getValue:function(){let e=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(e)},resetOriginalValue:function(){return this.changeFired=!1,this.isGraphChanged=!1,null},graphChanged:function(){let e=this;e.isLoadComlete&&(e.isGraphChanged=!0,e.changeFired||this.fireEvent("change",this,!0),e.changeFired=!0)},isDirty:function(){return this.isGraphChanged},updateDataBlob:function(e){var t=this;t.useBlobForData||Ext.Error.raise("object does not use Blob"),t.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),t.data=null,t.dataBlob=e,t.objUrl=window.URL.createObjectURL(e),t.data=t.objUrl},onDestroy:function(){var e=this;e.dataBlob=null,e.data=null,e.useBlobForData&&!Ext.isEmpty(e.objUrl)&&window.URL.revokeObjectURL(e.objUrl),e.objUrl=null,this.callParent()},setSrc:function(e){var t,n=this,i=e.url,o=e.blobData;if(e.rawValue)throw new Error("The UBOrgChart component does not support rawValue");return n.dataUrl=i,n.useBlobForData&&o&&n.updateDataBlob(o),n.isActulData=!1,n.changeFired=!0,t=n.graph?n.startLoadData():Promise.resolve(n.graph),n.changeFired=!1,t},startLoadData:function(){var e,t=this;if(t.dataUrl&&t.graph)return t.isLoadComlete=!1,t.getEl().mask(o.i18n("loadingData")),$App.connection.get(t.dataUrl).then((function(n){let i=n.data;if("string"==typeof i&&(i=(new DOMParser).parseFromString(i,"application/xml"),(e=i.getElementsByTagName("parsererror")).length>0))throw new Error(e[0].innerHTML);return new mxCodec(i.documentElement.ownerDocument).decode(i.documentElement,t.graph.getModel()),this.baseUrl=t.dataUrl,t.isLoadComlete=!0,t.isLoadContent=!0,t.isGraphChanged=!1,t.undoManager.clear(),t.isActulData=!0,!0})).then((()=>t.loadData())).finally((()=>{t.getEl().unmask()}))},initNewSrc:function(){var e=this;return e.loadData().then((()=>{e.showTree(),e.isLoadContent=!0,e.isLoadComlete=!0})),null},findParentCell:function(e){var t,n,i,o=this.graph.getModel();if((t=o.getEdgeCount(e))>0)for(var r=0;r<t;r++)if(n=o.getEdgeAt(e,r),(i=o.getTerminal(n,!0))!==e)return i;return null},findChildCell:function(e){var t,n,i,o=this.graph.getModel(),r=[];if((t=o.getEdgeCount(e))>0)for(var a=0;a<t;a++)n=o.getEdgeAt(e,a),(i=o.getTerminal(n,!1))!==e&&r.push(i);return r},refreshDiagram:function(){var e=this;return e.loadData().then((()=>e.validateDiagram(!0)))},validateDiagram:function(e){var t,n,i,r,a,s=this,l=s.graph.getModel(),c=[],u=[],d={};s.rootVarex=null,Ext.Object.each(l.cells,(function(e,o){if(o.vertex){if((t=o.getAttribute("ID"))&&(t*=1),o.getAttribute("isRoot")&&(s.rootVarex=o,o.isRoot=!0),!t)return!0;n=s.findParentCell(o),(i=n&&n.getAttribute("ID")||null)&&(i*=1),(r=s.allData[t])?(o.getAttribute("label")!==r[s.getAttrCode("label")]&&o.setAttribute("label",r[s.getAttrCode("label")]),o.getAttribute("code")!==r.code&&o.setAttribute("code",r.code),o.getAttribute("unitType")!==r[s.getAttrCode("unitType")]&&o.setAttribute("unitType",r[s.getAttrCode("unitType")]),r[s.getAttrCode("parentID")]!==i&&u.push(o),(a=d[t])?a.cell=o:d[t]=a={cell:o,child:[]},(a=d[r[s.getAttrCode("parentID")]||"root"])?a.child.push(o):d[r[s.getAttrCode("parentID")]||"root"]=a={child:[o]}):c.push(o)}})),u.forEach((function(e){(t=e.getAttribute("ID"))&&(t*=1),r=s.allData[t],(a=d[r[s.getAttrCode("parentID")]])?s.changeElementParent(e,a.cell,r):c.push(e)})),s.graph.removeCells(c,!0),Ext.Object.each(d,(function(t,n){if("root"===t)return s.updateCellOverlay(s.rootVarex,n.child,s.treeData.length,e),!0;(a=s.allData[t])&&s.updateCellOverlay(n.cell,n.child,a.child.length,e)}),s),s.undoManager.clear(),s.rootVarex?(s.changeFired=!1,s.isGraphChanged=!1,s.isLoadComlete=!0):Ext.Msg.alert("",o.i18n("Root is not found"))},updateCellOverlay:function(e,t,n,i){var o,r=this,a=!1;Ext.Array.each(t,(function(e){if(e.isVisible())return a=!0,!1}),r),i?(o=r.getAddOvelay(e),t.length===n||o||r.addAddOverlay(r.graph,e),0===n&&o&&r.graph.removeCellOverlay(e,o),o=r.getExpandOvelay(e),0===t.length&&o&&r.graph.removeCellOverlay(e,o)):(t.length!==n&&r.addAddOverlay(r.graph,e),n>0&&t.length>0&&r.addExpandOverlay(r.graph,e,a),r.addIconOverlay(e))},createNewDiagram:function(e,t){return $App.connection.insert({fieldList:["ID","orgunitID","caption"],entity:"org_diagram",execParams:{orgunitID:e,caption:t}}).then((function(e){return e.serverFailure?null:e.resultData.data[0][0]}))},openDiagram:function(e){var t,n,i=this;t=1*e.getAttribute("ID"),n=e.getAttribute("label"),o.Repository("org_diagram").attrs(["ID","orgunitID","caption"]).where("orgunitID","=",t).selectSingle().then((e=>e?e.ID:$App.dialogYesNo("","Chart for this item does not exist. Create a new one?").then((e=>{if(e)return i.createNewDiagram(t,n)})))).then((e=>{e&&this.openFormC({entityCode:"org_diagram",instanceID:e,isModal:!1})}))},createChildElement:function(e,t){let n=this,i=n.getEntityByUnitType(t),o=e.getAttribute("ID");o=o?1*o:null,i&&n.openForm(i,null,{[n.getAttrCode("parentID")]:o},(function(t){let i=t.down("basepanel");i&&i.record&&n.checkElementId(i.record.get("ID"),e)}))},checkElementId:function(e,t){let n=this;n.getRepository().where(n.getAttrCode("ID"),"=",e).selectSingle().then((i=>{i&&n.refreshDiagram().then((()=>{let i=n.allData[1*t.getAttribute("ID")],o=n.allData[e],r=n.findChildCell(t),a=n.getAddOvelay(t);if(i.child.length===r.length+1){let e={x:t.geometry.x,y:t.geometry.y+120},i=n.graph.getModel();i.beginUpdate();try{n.showElement(t,o,e),a&&n.graph.removeCellOverlay(t,a)}finally{i.endUpdate()}}}))}))},initMetaInfo:function(){let e,t,n=this;n.orgUnity={};let i=this.getRepository().entityName;$App.domainInfo.eachEntity((function(o,r){if(o.mixins&&(e=o.mixins.unity)&&e.enabled&&e.entity&&e.entity.toLowerCase()===i.toLowerCase()&&e.defaults){let i=e.defaults.unitType;switch(n.orgUnity[i]=t={code:r,unitType:i,caption:o.caption},i){case"ORG":t.image=$App.getImagePath("office.png");break;case"DEP":t.image=$App.getImagePath("user-group.png");break;default:t.image=$App.getImagePath("person.png")}}}))}})},9368:function(e,t,n){n(6872),n(8623),n(375),Ext.define("UB.ux.UBPreFilter",{uses:["UB.view.ErrorWindow","UB.view.BasePanel"],statics:{basePrefix:"pre_",storeKeyPrefix:"admin:ub:filterLastConfig:",makeFilters:function(e){return Ext.create("UB.ux.UBPreFilter",e)}},isPreFilter:!0,constructor:function(e){var t=this;t.filters=e.filters,t.entityCode=e.entityCode,t.onFilterReady=e.onFilterReady,t.onCancel=e.onCancel,t.store=e.store,t.scope=e.scope,t.options=e.options||{},t.configName=e.configName||t.options.code||t.entityCode,t.initParams=t.options.params||{},t.customForm=e.customForm,t.customView=e.customView,t.enableFts=!1!==t.options.enableFts,t.filterPrefix=t.store&&t.store.filterFormId?t.store.filterFormId:UB.ux.UBPreFilter.basePrefix+Ext.id(),t.controls={},t.filtersFunc={},t.resultFilters={},!Ext.isEmpty(t.filters)&&Ext.isArray(t.filters)&&Ext.Array.each(t.filters,(function(e){var n=t.resultFilters[e.property];n=n?[n,e]:e,t.resultFilters[e.property]=n})),t.customForm||(t.createFilterForm(),t.filterWin.show(),t.filterWin.down("form").getEl().on("keydown",(function(e){e.getKey()===Ext.EventObject.ENTER&&t.searchHandler()})))},updateStoreFilters:function(){let e=this,t=[];e.store&&(e.store.filterFormId=e.filterPrefix,e.store.filters.each((function(e){e.id.substr(0,4)===UB.ux.UBPreFilter.basePrefix&&t.push(e)})),Ext.Array.each(t,(function(t){e.store.filters.removeAtKey(t.id)})),e.filters.length>0?e.store.filter(e.filters):e.store.clearFilter())},deleteConfig:function(){let e=this,t=e.configBox.getRawValue();Ext.isEmpty(t)?$App.dialogError("doNotSelectedConfigName"):$App.dialogYesNo("attention","deleteConfirm").then((function(n){n&&e.deleteSettings(t,(function(){e.configBox.clearValue(),e.refreshConfig()}))}))},saveConfig:function(){let e=this,t=e.configBox.getRawValue();if(Ext.isEmpty(t))return void $App.dialogError("doNotSelectedConfigName");let n={};Ext.Object.each(e.controls,(function(t,i){var o={};Ext.Object.each(i,(function(e,t){o[e]=t.getValue()}),e),n[t]=o}),e);let i=JSON.stringify(n);e.saveSettings(t,i,!1).then((function(){window.localStorage.setItem(UB.ux.UBPreFilter.storeKeyPrefix+e.configName,t),e.refreshConfig()}))},getInitParam:function(e){return this.initParams?this.initParams[e]:null},setInitParams:function(){var e=this;Ext.Object.each(e.controls,(function(t,n){Ext.Object.each(n,(function(n,i){if("filterType"===n){let n,o=e.initParams[t];o&&o.filterType&&(n=o.filterType),n&&i.setValue(n)}}),e)}),e)},clearAllFilter:function(){let e=this,t=UB.ux.Multifilter.predefinedFilters;Ext.Object.each(e.controls,(function(n,i){Ext.Object.each(i,(function(i,o){if("filterType"!==i)o.clearValue&&o.clearValue(),o.setValue(null),o.filterEmptyValue&&o.setValue(o.filterEmptyValue);else{let i,r=e.initParams[n];r&&r.filterType&&(i=r.filterType),i||(i=t[o.getValue()]),i&&o.setValue(i)}}),e)}),e)},doLoadConfig:function(e,t){let n=this;n.filterWin.down("form").isDirty()?$App.dialogYesNo("attention","filterWasChangedConfirm").then((function(i){i?n.loadConfig():e&&e.call(n,t)})):n.loadConfig()},loadConfig:function(){let e=this,t=e.configBox.getRawValue();if(Ext.isEmpty(t))return void $App.dialogError("doNotSelectedConfigName");let n=function(e,t){if(Ext.isEmpty(t))e.clearValue&&e.clearValue(),e.setValue(null);else if(e.setValueById)e.setValueById(t);else try{"DateTime"===e.fieldType&&Ext.isString(t)&&(t=new Date(t)),e.setValue(t)}catch(t){e.clearValue()}e&&e.resetOriginalValue&&e.resetOriginalValue()};e.loadSettings(t).then((function(i){var o;if(0!==i.getCount()){o=i.getAt(0);var r=JSON.parse(o.get("filter"));Ext.isObject(r)&&(e.clearAllFilter(),Ext.Object.each(r,(function(t,i){var o=e.controls[t];o?(i.filterType&&o.filterType&&n(o.filterType,i.filterType),Ext.Object.each(i,(function(e,t){if("filterType"!==e){var i=o[e];i&&n(i,t)}}),e)):UB.logError("!!!! filter not found for attribute "+e.entityCode+"."+t+" in filter "+e.configName)}),e),window.localStorage.setItem(UB.ux.UBPreFilter.storeKeyPrefix+e.configName,t))}}))},loadSettings:function(e){return UB.Repository("ubs_filter").attrs(["ID","code","name","filter","isGlobal","owner","mi_modifyDate"]).where("code","=",this.configName).whereIf(e,"name","=",e).selectAsStore()},saveSettings:function(e,t,n){let i=this;return Ext.isEmpty(n)&&(n=!1),i.loadSettings(e).then((function(o){if(0!==o.getCount()){let e=o.getAt(0),n={fieldList:["ID","filter","mi_modifyDate"],entity:"ubs_filter",method:UB.core.UBCommand.methodName.UPDATE,execParams:{ID:e.get("ID"),filter:t}};return n.execParams.mi_modifyDate=e.get("mi_modifyDate"),$App.connection.update(n)}return $App.connection.insert({fieldList:["code","name","filter","isGlobal"],entity:"ubs_filter",execParams:{code:i.configName,name:e,filter:t,isGlobal:n?1:0}})}))},deleteSettings:function(e,t){let n=this;n.loadSettings(e).then((function(e){var i;0!==e.getCount()&&(i=e.getAt(0),$App.connection.doDelete({entity:"ubs_filter",execParams:{ID:i.get("ID"),mi_modifyDate:i.get("mi_modifyDate")}}).then((function(){t&&t.call(n)})))}))},refreshConfig:function(){let e=this,t=e.configBox.getValue();return e.loadSettings().then((function(n){n.autoLoad=!1,n.remoteSort=!1,n.remoteFilter=!1,n.remoteGroup=!1,e.configBox.bindStore(n),e.configBox.findRecordByValue(t)&&e.configBox.setValue(t)}))},reCalcFilters:function(){let e,t,n,i=this;if(i.filters=[],i.ftsTextBox&&i.ftsTextBox.getValue()){i.filters.push({id:i.getFilterPrefix("ftsText"),root:"data",property:"ID",filterType:"match",condition:"match",value:i.ftsTextBox.getValue()});let o=i.filtersFunc[i.ftsRecordDateAttr];o&&(e=o(),e.length>0&&(t=e[0].value,n=e.length>1?e[1].value:e[0].value,i.filters.push({id:i.getFilterPrefix("ftsBetween"),root:"data",property:"ID",filterType:"between",condition:"between",valueFrom:t,valueTo:n})))}Ext.Object.each(i.filtersFunc,(function(e,t){var n=t.call();n&&(Ext.isArray(n)?Ext.Array.each(n,(function(e){i.filters.push(e)})):i.filters.push(n))}),i)},initFilterControl:function(e,t,n){var i=this.controls[e]||{};i[t||"main"]=n,this.controls[e]=i,n&&n.resetOriginalValue&&n.resetOriginalValue()},initFilterFunc:function(e,t){this.filtersFunc[e]=t},searchHandler:function(){if(!this.filterWin.down("form").isValid())return;let e=this;e.reCalcFilters(),e.updateStoreFilters(),e.onFilterReady&&e.onFilterReady.call(e.scope||e,e.filters,e.filterPrefix),e.filterWin.isFilterReady=!0,e.filterWin.close(),e.filterWin=null},createFilterForm:function(){let e,t=this;t.filterWin=e=Ext.create("UB.view.BaseWindow",{title:UB.i18n("filterForm"),height:500,width:600,modal:!0,stateful:!0,stateId:"ubFilterForm_"+t.entityCode+"_"+t.configName,layout:{type:"fit"},items:[{xtype:"form",layout:{type:"fit"},items:t.createFilters()}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"0 0 0 5",layout:{type:"hbox",align:"middle"},items:[t.configBox=Ext.widget("ubbasebox",{queryMode:"local",displayField:"name",valueField:"name",fieldLabel:UB.i18n("configurationName")}),{xtype:"button",tooltip:UB.i18n("load"),scale:"medium",iconCls:"u-icon-folder-open",margin:"5 0 0 0",handler:function(){t.doLoadConfig()}},{xtype:"button",tooltip:UB.i18n("save"),scale:"medium",iconCls:"u-icon-save",margin:"5 0 0 0",handler:function(){t.saveConfig()}},{xtype:"button",tooltip:UB.i18n("fDelete"),scale:"medium",iconCls:"u-icon-delete",margin:"5 5 0 0",handler:function(){t.deleteConfig()}}]}],buttons:[{iconCls:"u-icon-search",text:UB.i18n("search"),handler:t.searchHandler,scope:t},{text:UB.i18n("clear"),iconCls:"u-icon-eraser",handler:function(){t.clearAllFilter()}},{text:UB.i18n("cancel"),iconCls:"u-icon-close",handler:function(){e.close()}}]}),t.filterWin.on("close",(function(){t.filterWin.isFilterReady||t.onCancel&&t.onCancel.call(t.scope||t)}),t),t.refreshConfig().then((function(){t.loadLastConfig()}))},loadLastConfig:function(){let e=this,t=window.localStorage.getItem(UB.ux.UBPreFilter.storeKeyPrefix+e.configName);if(t&&Ext.isString(t)&&!e.store){e.configBox.isInternalChange=!0;try{e.configBox.findRecordByValue(t)&&e.configBox.setValue(t)}finally{e.configBox.isInternalChange=!1}e.configBox.getValue()&&e.loadConfig()}},createFtsPanel:function(e){let t=this,n=[],i=e.mixins.fts.ftsRecordDateAttr,o=t.getPrevFilter(t.getFilterPrefix("ftsText"));return t.ftsRecordDateAttr=i,t.ftsTextBox=Ext.create("Ext.form.field.Text",{fieldLabel:UB.i18n("ftsTextFieldLabel"),enableKeyEvents:!0,value:o?o.value:null,listeners:{keyup:function(e,n){n.getKey()===n.ENTER&&t.searchHandler()},scope:t}}),n.push({layout:"hbox",defaults:{margins:"0 5 0 0"},width:"100%",fit:1,margin:"0 0 10 0",collapsible:!1,border:!1,bodyBorder:!1,items:[t.ftsTextBox]}),{title:UB.i18n("ftsSearchGroup"),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:n}},createFilters:function(){let e,t,n,i,o=this,r=$App.domainInfo.get(o.entityCode),a=[],s=o.options.groups,l=o.options.componentsReady,c={};return o.enableFts&&r.mixins&&r.mixins.fts&&(i=o.createFtsPanel(r)),s&&Ext.isArray(s)?(Ext.Array.each(s,(function(i){i.fields&&Ext.isArray(i.fields)&&(t=[],Ext.Array.each(i.fields,(function(i){n=r.attr(i),n&&(e=o.createFilter(n,i),e&&(c[i]=e,t.push(e)))})),a.push({title:UB.i18n(i.caption),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:t}))})),l&&l(c),i&&a.push(i),{flex:1,xtype:"tabpanel",cls:"ub-basepanel",isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:a}):(Ext.Object.each(r.attributes,(function(t,n){n.defaultView&&(e=o.createFilter(n,t),e&&(c[t]=e,a.push(e)))})),l&&l(c),i?(t=[{title:UB.i18n("UbPreFilterMainGroup"),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:a},i],{flex:1,xtype:"tabpanel",cls:"ub-basepanel",isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:t}):{isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:a})},createFilter:function(e,t){let n,i=this,o=[],r=i.entityCode,a={},s=i.initParams[t]||{},l=$App.domainInfo.get(r).getEntityAttribute(t,!0);if(l.customSettings&&l.customSettings.UIGridColumnClass)o=i.getEnumFilterInput(r,t,l.customSettings.UIGridColumnClass),o[1].flex=100,o[2].flex=100;else if(e.associatedEntity)o=i.getAssociationFilterInput(r,t,s),o[1].flex=100,o[2].flex=100;else if("Enum"===e.dataType)o=i.getEnumFilterInput(r,t,void 0,s),o[1].flex=100,o[2].flex=100;else{var c=e.physicalDataType;switch(c){case"float":case"int":o=i.getNumericFilterInput(r,t,"float"===c||"currency"===c);break;case"date":o=i.getDateFilterInput(r,t);break;case"boolean":o=i.getBooleanFilterInput(r,t);break;default:o=i.getPlainTextFilter(r,t),o[1].flex=100}}return s.caption&&(o[0].fieldLabel=s.caption),0===o.length?null:(n=o[0],n.hideLabel=!0,o.unshift({xtype:"label",shrinkWrap:2,margin:"0 0 0 3",width:110,text:o[0].fieldLabel}),i.customView?Ext.Object.each(i.customView,(function(e,t){a[e]=t})):a={layout:{type:"hbox"},defaults:{margins:"0 5 0 0"},width:"100%",fit:1,margin:"0 0 10 0",collapsible:!1,border:!1,bodyBorder:!1},a.items=o,a)},getBaseFilter:function(e){return this.resultFilters[e]},getPrevFilter:function(e,t){let n=this,i=[];return n.store?n.store.filterFormId?(i=n.store.filters.getByKey(e),i&&i.relatedFilter?[i,i.relatedFilter]:i):(this.store.filters.each((function(e){e.property===t&&i.push(e)})),0===i.length?null:1===i.length?i[0]:i):t?this.getBaseFilter(t):null},getFilterPrefix:function(e){return this.filterPrefix+e},getItemMargin:function(){return Ext.form.field.Base.prototype.margin},getAssociationFilterInput:function(e,t,n){return UB.ux.Multifilter.getAssociationFilterInputS(e,t,n,this)},getEnumFilterInput:function(e,t,n,i){return UB.ux.Multifilter.getEnumFilterInputS(e,t,n,i,this)},getNumericFilterInput:function(e,t,n){return UB.ux.Multifilter.getNumericFilterInputS(e,t,n,this)},getPlainTextFilter:function(e,t){return UB.ux.Multifilter.getPlainTextFilterS(e,t,this)},getDateFilterInput:function(e,t){return UB.ux.Multifilter.getDateFilterInputS(e,t,this)},getBooleanFilterInput:function(e,t){return UB.ux.Multifilter.getBooleanFilterInputS(e,t,this)}})},9318:function(e,t,n){n(6814);const i=n(6486);Ext.define("UB.ux.UBReportEditor",{extend:"UB.ux.UBTinyMCETextArea",alias:"widget.ubreporteditor",statics:{portrait:{width:793},landscape:{width:1121},paste_postprocess:function(e,t){UB.ux.UBReportEditor.filter_node(t.node)},possibleElement:{node:["table","thead","tbody","tr","td","img","div","p","hr","strong","em","big","span","font","li","ul","ol","blockquote","h1","h2","h3","h4","h5","h6","#comment","#text"],inlineInnerNode:["#comment","#text"],attributes:["style","data-mce-style","src","rowspan","colspan"],style:["font-family","font-weight","font-style","font-size","text-align","vertical-align","text-indent","list-style-type","list-style-position","background-color","width","height","border-style","border-top-style","border-bottom-style","border-right-style","border-left-style","border","border-width","border-top-width","border-bottom-width","border-right-width","border-left-width","padding","padding-top","padding-bottom","padding-right","padding-left","margin","margin-top","margin-bottom","margin-right","margin-left","disable-split","disableSplit","disablesplit","indissoluble-first-rows","indissoluble-end-rows","draw-border-onsplit","top-through-line"]},filter_node:function(e){let t,n,i,o,r,a,s,l,c=[];if("table"===e.nodeName.toLowerCase()&&this.filter_table(e),e.attributes){for(t=e.attributes.length-1;t>=0;t--)i=e.attributes[t],this.possibleElement.attributes.indexOf(i.name.toLowerCase())<0&&e.removeAttribute(i.name);if(o=e.attributes.getNamedItem("style"),o&&o.value){for(o=o.value.split(";"),t=0;t<o.length;t++){let e=o[t];if(e){let t=e.split(":");2===t.length&&"string"==typeof t[0]&&this.possibleElement.style.indexOf(t[0].toLowerCase())>=0&&c.push(e)}}o.value=c.join(";")}}if(e.childNodes)for(t=0;t<e.childNodes.length;t++){if(r=e.childNodes[t],this.possibleElement.node.indexOf(r.nodeName.toLowerCase())<0){if(s=!0,r.childNodes)for(n=0;n<r.childNodes.length;n++)if(a=r.childNodes[n].nodeName.toLowerCase(),this.possibleElement.inlineInnerNode.indexOf(a)<0){s=!1;break}l=document.createElement(s?"SPAN":"DIV"),this.copyNodeParams(r,l),e.replaceChild(l,r),r=l}this.filter_node(r)}},copyNodeParams:function(e,t){let n,i;e.attributes&&(i=e.attributes.getNamedItem("style"),n=i?i.value:null),n&&t.setAttribute("style",n),t.innerHTML=e.innerHTML},filter_table:function(e){let t,n,o,r=[],a=e.attributes.getNamedItem("width");a&&(t=a.value),a=e.attributes.getNamedItem("style"),a?(r=a.value?a.value.split(";"):[],i.forEach(r,(function(e){if(e){let t=e.split(":");if(2===t.length&&"width"===t[0].toLowerCase())return n=t[1],!1}}))):(a=document.createAttribute("style"),e.attributes.setNamedItem(a)),n||(r.push("width:"+(t||"100%")),a.value=r.join(";")),i.forEach(e.childNodes,(function(e){if("tbody"===e.nodeName.toLowerCase())return o=e,!1})),o||(o=document.createElement("TBODY"),e.appendChild(o)),this.createSpanTableMap(o,[],[])},createSpanTableMap:function(e,t,n){let i,o,r,a,s,l,c,u,d,f,h,p,m,g,y,x,b,v=0,E=!1;function w(e,t){return parseInt(function(e,t,n){if(!e.attributes)return 0;let i=e.attributes.getNamedItem(t);return i&&i.value||0}(e,t),10)}function C(e,t,n){if(!e.attributes)return;let i=e.attributes.getNamedItem(t);i?i.value=n:(i=document.createAttribute(t),i.value=n,e.attributes.setNamedItem(i))}for(let i=0;i<e.childNodes.length;i++)t[i]=[],n[i]=[];m=0,p=e.childNodes.length;for(let I=0;I<p;I++)if(i=e.childNodes[I],"tr"===i.nodeName.toLowerCase()){if(m++,!E){for(o=0;o<i.childNodes.length;o++)f=i.childNodes[o],"td"===f.nodeName.toLowerCase()&&(y=w(f,"colspan"),y>1&&(v+=y-1),v++);E=!0}for(g=0,o=0,r=0;o<v;o++)if(n[I][o]||t[I][o])g++;else if(!(r>=i.childNodes.length)){for(f=i.childNodes[r];"td"!==f.nodeName.toLowerCase();)r++,f=i.childNodes[r];if(h=f,g++,y=w(f,"colspan"),x=w(f,"rowspan"),x>1)for(x-1+I>=p&&(x=p-I||1,C(f,"rowspan",x)),l=I+1,s=I+1;s<I+x&&l<e.childNodes.length;l++)if(b=e.childNodes[l],"tr"===b.nodeName.toLowerCase()){for(d=b.childNodes.length,u=0,c=0;c<d;c++)"td"===b.childNodes[c].nodeName.toLowerCase()&&(u++,u+=(w(b.childNodes[c],"colspan")||1)-1);for(d=t[s].length,c=0;c<d;c++)t[s][c]&&u++;if(u+((y||1)-1)>=v){x=s-I,C(f,"rowspan",x);break}s++}if(y>1){for(u=0,s=o;s<v;s++)t[I][s]||u++;y>u&&(y=u||1,C(f,"colspan",y))}if(x>1)for(let e=I+1;e<I+x;e++)if(t[e][o]=1,y>1)for(a=o+1;a<o+y;a++)n[e]||(n[e]=[]),n[e][a]=1;if(y>1)for(a=o+1;a<o+y;a++)n[I][a]=1;r++}g<v&&C(h,"colspan",v-g+1)}return{colCount:v,rowCount:m}}},pageWidth:793,setOrientation:function(e){return("landscape"===e||"portrait"===e)&&(this.setWidth("landscape"===e?UB.ux.UBReportEditor.landscape.width:UB.ux.UBReportEditor.portrait.width),this.orientation=e,!0)},initComponent:function(){Ext.getBody().getSize(),this.width=UB.ux.UBReportEditor.portrait.width,this.orientation="portrait",this.tinyMCEConfig=Ext.apply({convert_urls:!1,object_resizing:"img,table,p[class=isTopColontitle],p[class=isBottomColontitle]",toolbar1:"undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | formatselect fontsizeselect | pageOrientation | Colontitle | borderL borderR borderT borderB borderE borderA | forecolor | bullist numlist outdent indent |",paste_postprocess:UB.ux.UBReportEditor.paste_postprocess},this.tinyMCEConfig||{}),this.tinyMCEConfig.reportEditor=this,this.lastFrameHeight="100%",this.callParent(arguments),this.tinyMCEConfig.plugins.push("paste"),this.tinyMCEConfig.plugins.push("templateEditor")},onStartSetup:function(e){let t=this;e.on("change",(function(){t.updateSize()}),t),this.callParent(arguments)},syncEditorHeight:function(){this.callParent(arguments),this.updateSize()},updateSize:function(){let e=50,t=Ext.get(this.getInputId()+"_ifr");if(!this.inResizing&&t&&t.dom&&t.dom.contentDocument){let n=this.getEditor();n.editorContainer&&n.contentAreaContainer&&(e=n.editorContainer.offsetHeight-n.contentAreaContainer.offsetHeight+50),this.inResizing=!0,this.setHeight(t.dom.contentDocument.body.offsetHeight+e),this.inResizing=!1}},setValue:function(e){let t=this;if(t.valuesSpecialComments=null,e&&"string"==typeof e){const n=/(<!--@\w+?\s*".+?"-->)/gi,o=/(<!--%\w+?:(.+?)-->)/gi;let r=e.match(n);r&&r.length>0&&(t.valuesSpecialComments=r.join("\r\n"),e=e.replace(n,"")),r=e.match(o),r&&r.length>0&&(i.forEach(r,(function(e){let n=e.match(/<!--%(\w+?:.+?)-->/)[1];n=n.split(":"),"pageOrientation"===n[0]&&t.setOrientation(n[1])})),e=e.replace(o,""))}t.callParent([e])},getValue:function(e){let t=this.callParent();return t="\x3c!--%pageOrientation:"+this.orientation+"--\x3e"+t,"UBDocument"===e&&this.valuesSpecialComments&&(t=this.valuesSpecialComments+t),t},isFocusableField:!0,isFocusable:function(){return!this.readOnly}})},6814:function(e,t,n){n(7680),Ext.define("UB.ux.UBTinyMCETextArea",{extend:"Ext.ux.form.TinyMCETextArea",alias:"widget.ubtinymcetextarea",initComponent:function(){this.tinyMCEConfig&&(this.userSetup=this.tinyMCEConfig.setup),this.ensureTinyMCELoaded(),this.tinyMCEConfig=Ext.apply({language_url:$App.connection.baseURL+"models/adminui-pub/locale/tinymce/"+$App.connection.userLang()+".js",table_default_attributes:{cellpadding:"3px",cellspacing:"0",border:"1px",width:this.pageWidth&&this.pageWidth>20?this.pageWidth-20:20,style:"word-break: break-all"},browser_spellcheck:!0,toolbar1:"undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect forecolor | print",plugins:["advlist autolink lists charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code ","insertdatetime nonbreaking table contextmenu directionality","emoticons template textcolor colorpicker image imagetools"],contextmenu:"link image inserttable | cell row column deletetable",paste_data_images:!0,statusbar:!1,menubar:"edit insert view format table tools",toolbar_items_size:"small",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:function(e,t,n){let i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("accept","image/*"),i.onchange=function(){let t=this.files[0],n=new window.FileReader,i=new window.Blob([t],{type:t.type});n.addEventListener("loadend",(function(){let o="blobid"+Date.now(),r=tinymce.activeEditor.editorUpload.blobCache,a=n.result.split(",",2)[1],s=r.create(o,i,a);r.add(s),e(s.blobUri(),{title:t.name})})),n.addEventListener("error",(function(e){throw new Error(e)})),n.readAsDataURL(i)},i.click()}},this.tinyMCEConfig),this.tinyMCEConfig.setup=this.onStartSetup.bind(this),this.addEvents("setup","setOriginalValue"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.wysiwygIntialized||this.updateLayout()},onStartSetup:function(e){let t=this;tinymce.baseURL=$App.connection.baseURL+"clientRequire/tinymce",this.fireEvent("setup",e),this.userSetup&&this.userSetup(e),e.on("init",(function(){t.ownerLayout&&t.ownerLayout.onContentChange()}))},isFocusableField:!0,isFocusable:function(){return!this.readOnly},setSrc:function(e){let t=this;function n(n){return t.suspendCheckChange=!0,t.setValue(n),e.resetOriginalValue&&(t.resetOriginalValue(),t.fireEvent("setOriginalValue",n,t)),t.suspendCheckChange=!1,n}let i=e.blobData;return i?new Promise(((e,t)=>{let o=new window.FileReader;o.addEventListener("loadend",(function(){e(n(o.result))})),o.addEventListener("error",(function(){t(n(o.error))})),o.readAsText(i)})):e.params?UB.core.UBService.getDocument(e.params).then((function(e){return n(e)})):Promise.resolve(n(e.rawValue))}})},2136:function(e,t,n){n(4421),n(9391),Ext.define("UB.ux.data.UBStore",{extend:"Ext.data.Store",alias:"store.ubstore",totalRequired:!1,uses:["UB.core.UBStoreManager","UB.core.UBEnumManager"],indexByID:null,statics:{copyRecord:function(e,t){e.getFields().forEach((function(n){t.set(n.name,e.get(n.name))}))},resetRecord:function(e){e.modified=[],e.reject(!0)},resultDataRow2Record:function(e,t,n){let i=e.resultData.data[n||0];if(!i)return null;let o=e.resultData.fields,r=o.length,a=-1;for(;++a<r;)t.set(o[a],i[a]);return t},createRecord:function(e,t,n){let i=UB.ux.data.UBStore.getEntityModel(e,t),o=Ext.create(i);return!1!==n&&Ext.create("Ext.data.Store",{model:i}).add(o),o.fields.eachKey((function(e){o.set(e,null)})),UB.ux.data.UBStore.resetRecord(o),o},normalizeFieldList:function(e,t){let n;if(n="string"==typeof e?$App.domainInfo.get(e):e,!n)throw new Error(`Entity "${e}" doesn't exists in domain`);let i=!1,o=!1,r=[];t.forEach((function(e){r.push(e),i=i||"ID"===e||"ID"===e.name,o=o||"mi_modifyDate"===e||"mi_modifyDate"===e.name})),i||r.push("ID");let a=n.mixins.mStorage;return a&&a.simpleAudit&&!o&&r.push("mi_modifyDate"),r},entityModelName:function(e){return"UB.model."+e},getEntityModel:function(e,t,n){let i=this.getEntityModelFields(e,t),o=this.entityModelName(UB.core.UBUtil.getNameMd5(e,t));return Ext.ModelManager.getModel(o)||Ext.define(o,{extend:"Ext.data.Model",entityName:e,idProperty:n||"ID",fields:i}),o},getEntityModelFields:function(e,t){let n=$App.domainInfo.get(e),i=[];return t.forEach((function(e,t){let o=n.attr(e);i.push({name:e,convert:null,type:o?o.physicalDataType:"auto",useNull:!0,mapping:t})})),i}},constructor:function(e){let t=this,n=Ext.clone(e),i=n.ubRequest,o=i.entity;i.fieldList=UB.ux.data.UBStore.normalizeFieldList(o,i.fieldList),Ext.apply(t,{ubRequest:i,model:i.model||UB.ux.data.UBStore.getEntityModel(o,i.fieldList,n.idProperty),proxy:{type:"ubproxy"},entityName:o,autoLoad:!1!==t.autoLoad,remoteSort:!0,remoteFilter:!0,remoteGroup:!0}),e.disablePaging?t.pageSize=0:t.pageSize=t.pageSize?t.pageSize:UB.appConfig.storeDefaultPageSize,t.addEvents("beforereload","entityModified"),t.callParent([n]),t.on({beforeload:t.onBeforeLoad,beforeprefetch:t.onBeforePrefetch})},fireModifyEvent:function(e,t){this.fireEvent("entityModified",e,t)},clearCache:function(){this.clearProxyCache();let e=$App.domainInfo.get(this.entityName).cacheType;return $App.connection.cacheOccurrenceRefresh(this.entityName,e)},setWhereList:function(e,t){this.ubRequest.whereList=e,t||this.reload()},load:function(e){if(this.isDestroyed)return Promise.resolve(this);let t=this;const n="function"==typeof e;return new Promise((function(i,o){t.indexByID=null,t.loading=!0;let r=[];t.linkedItemsLoadList&&Object.keys(t.linkedItemsLoadList).forEach((function(e){let n=t.linkedItemsLoadList[e];n&&n instanceof UB.ux.data.UBStore?r.push(n.load()):"function"==typeof n?r.push(n()):n&&"function"==typeof n.then&&r.push(n)}));let a={};e&&!n&&UB.apply(a,e),t.disablePaging&&!a.limit&&(a.limit=-1,a.start=0),a.callback=function(r,a,s){if(s)a.resultSet&&(a.resultSet.resultLock&&(t.resultLock=a.resultSet.resultLock),a.resultSet.resultAls&&(t.resultAls=a.resultSet.resultAls)),i(t);else{if(t.throwLoadError)throw a.getError();o(a.getError())}if(e&&(e.callback||n)){if(UB.logDebug("UBStore.load(callback) is DEPRECATED. Use Promise style: UBStore.load().then(...)"),!s)throw new Error(a.getError());n?Ext.callback(e,null,[r,a,s]):Ext.callback(e.callback,e.scope,[r,a,s])}},delete a.scope,r.length?Promise.all(r).then((function(){t.superclass.load.call(t,a)})):t.superclass.load.call(t,a)}))},reload:function(e){if(e&&e.callback)throw new Error("UBStore.reload(callback) is OBSOLETE. Use Promise style: UBStore.reload().then(...)");let t=this;return t.fireEvent("beforereload"),t.loading=!0,t.indexByID=null,t.clearCache().then((function(){return t.load(e)}))},clearProxyCache:function(){let e=this.getProxy();e&&(delete e.totalRecCount,delete e.data)},filter:function(e,t){if(!this.isDestroyed){this.clearProxyCache();try{this.throwLoadError=!0,this.callParent([e,t])}finally{this.throwLoadError=!1}}},clearFilter:function(){this.isDestroyed||(this.clearProxyCache(),this.callParent(arguments))},onBeforeLoad:function(e,t){return t.ubRequest=this.ubRequest,!0},onBeforePrefetch:function(e,t){return t.ubRequest=this.ubRequest,!0},remove:function(e){let t=this;t.clearCache().then((function(){t.isDestroyed||t.superclass.remove.call(t,e)}))},add:function(e,t){let n=this;if(t)return this.callParent(arguments);n.clearCache().then((function(){n.isDestroyed||n.superclass.add.call(n,e)}))},getById:function(e){let t=this;return e&&e.getId&&(e=e.getId()),!t.indexByID&&t.createIndexByID&&(t.indexByID={},t.each((function(e){t.indexByID[e.getId()]=e}),t)),t.indexByID?t.indexByID[e]:t.callParent([e])}}),UB.ClientRepository.prototype.selectAsStore=function(e){return(e=e||{}).ubRequest=this.ubql(),Ext.create("UB.ux.data.UBStore",e).load()}},9391:function(e,t,n){n(4421),n(7027),n(7338),n(8623),n(6411),Ext.define("UB.ux.data.proxy.UBProxy",{extend:"Ext.data.proxy.Server",alias:"proxy.ubproxy",uses:["UB.view.ErrorWindow"],constructor:function(e){return Ext.apply(this,{reader:{type:"ubarray",root:"data",totalProperty:"total"}}),this.callParent(arguments),this.addListener("exception",this.onException,this),this},allLoaded:!1,statics:{ubFilterToWhereList:function(e,t){var n,i={},o=this;return n=function(e,n){if(!e.disabled&&e.filterFn){let r=o.ubFiltersItemToUBWhereListItem(e,$App.domainInfo.get(t).attr(e.property).dataType);switch(e.condition){case"match":i.match=r;break;case"between":i.between=r;break;default:i["x"+n]=r}}},e instanceof Ext.util.MixedCollection?e.each(n):Ext.each(e||[],n),i},ubFiltersItemToUBWhereListItem:function(e,t){var n=UB.core.UBCommand.condition,i={};if(i.expression="["+e.property+"]",t===UBDomain.ubDataTypes.String&&(e.exactMatch?i.condition=n.sqlecEqual:e.startWith?i.condition=n.sqlecStartWith:i.condition=n.sqlecLike),e.operator)switch(e.operator){case">=":i.condition=n.sqlecMoreEqual;break;case"<=":i.condition=n.sqlecLessEqual;break;case"<":i.condition=n.sqlecLess;break;case"=":i.condition=n.sqlecEqual;break;case">":i.condition=n.sqlecMore;break;case"!=":i.condition=n.sqlecNotEqual;break;default:i.condition=n.sqlecEqual}if(e.condition&&(i.condition=e.condition),i.condition=i.condition||n.sqlecEqual,UB.connection.UBQLv2)null===e.value?i.condition===n.sqlecNotEqual?i.condition=n.sqlecNotIsNull:i.condition===n.sqlecEqual&&(i.condition=n.sqlecIsNull):i.value=e.value;else switch(i.values||(i.values={}),i.values[e.property]=e.value,e.condition){case"match":i={condition:"match",values:{any:e.value}};break;case"between":i={condition:"between",values:{v1:e.valueFrom,v2:e.valueTo}}}return i}},onException:function(e,t,n){throw new Error({errMsg:n.getError()})},doRequest:function(e,t,n){var i,o,r,a,s,l=this,c=Ext.clone(e.ubRequest),u=[];if("read"!==e.action)throw new Error("unsupported operation for UBProxy: "+e.action);r=l.operationFilter2WhereList(e,c.entity,u)||{},UB.apply(r,c.whereList),Object.keys(r).length?c.whereList=r:delete c.whereList,a=l.operationOrder2OrderList(e)||{},c.orderList||(c.orderList={});for(let e in a){let t=a[e],n=!1;for(let e in c.orderList)if(c.orderList[e].expression===t.expression){c.orderList[e].order=t.order,n=!0;break}n||(c.orderList={},c.orderList[e]=t)}Object.keys(c.orderList).length||delete c.orderList,o=e.limit&&e.limit>0?e.limit:void 0,((i=e.start&&e.start>0?e.start:void 0)||o)&&(c.options=c.options||{},i&&(c.options.start=i),o&&(c.options.limit=o),o&&!i&&(c.options.start=0)),UB.connection.select(c).then((function(i){var o;s=l.getReader().read({data:i.resultData.data}),u.length>0&&l.applyFilterFn(s,u),s.total=i.total,s.totalRecords=s.total,s.resultLock=i.resultLock,s.resultAls=i.resultAls,o=s,e.resultSet=o,e.setCompleted(),e.setSuccessful(),(n=n||{}).isDestroyed||Ext.callback(t,n,[e])}),(function(i){e.setException(i),n.isDestroyed||Ext.callback(t,n,[e])}))},applyFilterFn:function(e,t){var n,i,o=[];for(let r=0,a=e.records.length;r<a;r++){n=e.records[r],i=!0;for(let e=0,o=t.length;e<o;e++)if(!0!==t[e](n)){i=!1;break}i&&o.push(n)}e.records=o,e.count=o.length,console.warn("Attention! Filter using the function works without paging")},operationFilter2WhereList:function(e,t,n){let i=100;if(!e.filters)return;let o=e.filters.length;if(!o)return;let r={};for(let a=0;a<o;++a){let o=e.filters[a];if(o.disabled)continue;if(n&&o.initialConfig.filterFn&&!o.initialConfig.property){n.push(o.initialConfig.filterFn);continue}if(!o.property)throw new Error('invalid filter: "filterItem.property" must have a value');let s=UB.ux.data.proxy.UBProxy.ubFiltersItemToUBWhereListItem(o,$App.domainInfo.get(t).attr(o.property).dataType);r["x"+i++]=s}return r},operationOrder2OrderList:function(e){var t,n,i,o=e.sorters,r=100;if(o&&(t=o.length)>0)for(i={},n=0;n<t;++n)i["x"+r++]={expression:o[n].property,order:"ASC"===o[n].direction?"asc":"desc"};return i}})},7338:function(){Ext.define("UB.ux.data.reader.UBArray",{extend:"Ext.data.reader.Array",alias:"reader.ubarray",readRecords:function(e){var t;return!Ext.isDefined(this.proxy.totalRecCount)&&Ext.isDefined(e.__totalRecCount)&&(this.proxy.totalRecCount=e.__totalRecCount),t={data:e.data,total:this.proxy.totalRecCount},this.callParent([t])}})},5998:function(e,t,n){n(6814),Ext.define("UB.ux.form.HtmlEditor",{extend:"UB.ux.UBTinyMCETextArea",alias:"widget.ubhtmleditor",overflowX:"auto",overflowY:"auto",minHeight:65,pageWidth:793,initComponent:function(){var e=this;Ext.getBody().getSize(),e.elementStyle=e.elementStyle||"width: "+e.pageWidth+"px;",e.tinyMCEConfig=Ext.apply({paste_postprocess:UB.ux.UBReportEditor.paste_postprocess,statusbar:!1,menubar:!1,toolbar:!1,toolbar1:!1,toolbar2:!1,toolbar3:!1,setup:e.onsetup.bind(e)},e.tinyMCEConfig||{}),e.callParent(arguments)},fieldSubTpl:['<div id="{id}_editButton" style="visibility: hidden; z-index: 2; text-align: right; position: absolute; left: -10px; top: 10px;"></div>','<div id="{id}_mframe" role="{role}" tabindex="0" {inputAttrTpl} style="width:100%; owerflow-x:auto; overflow-y: hidden;" >','<textarea id="{id}" tabindex="0"  ','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {inputCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>","</div>",{disableFormats:!0}],afterRender:function(){var e,t,n,i,o=this,r=Ext.getBody().getSize();o.callParent(arguments),o.mainFrame=t=Ext.get(o.getInputId()+"_mframe"),o.mainFrame.dom.select=function(){},(e=Ext.get(o.getInputId())).dom.tabindex=0,(i=e.getHeight()-20)<o.minHeight&&(i=o.minHeight),t.setHeight(i),e.on("resize",(function(){t.setHeight(e.getHeight()-20)})),e.setWidth(o.pageWidth),e.setHeight(r.height),e.setStyle("owerflow-y","hidden"),e.setStyle("owerflow-x","hidden"),o.editBtn=Ext.get(o.getInputId()+"_editButton"),o.editBtn.dom.style.position="relative",o.editBtn.dom.style.height="0px",o.initContextMenu(),(n=t.parent()).on("mouseover",(function(){o.editBtn.isVisible()||o.readOnly||(o.editBtnCtrl.hide(),o.editBtn.hide(),o.editBtn.show(),o.editBtnCtrl.show())})),n.on("mouseleave",(function(){o.hasInputFocus||o.editBtn.hide()})),o.on("focus",(function(){o.readOnly||(o.editBtnCtrl.hide(),o.hasInputFocus=!0,o.editBtn.hide(),o.editBtn.show(),o.editBtnCtrl.show())}),o),o.on("blur",(function(){o.hasInputFocus=!1,Ext.defer((function(){o.editBtn.hide()}),100)}),o)},getFocusEl:function(){return this.iframe},initEditor:function(){var e=this;e.callParent(arguments)},onsetup:function(e){var t,n=this,i=Ext.getBody().getSize();e.on("init",(function(){n.iframe=t=Ext.get(n.getInputId()+"_ifr"),n.iframe.dom.tabindex=0,n.iframe.dom.select=function(){},t.setWidth(n.pageWidth),t.setHeight(i.height)}))},getSubTplMarkup:function(){var e=this;return e.callParent(arguments)},editContent:function(){var e,t,n=this,i=Ext.getBody().getSize();(e=Ext.create("UB.view.BaseWindow",{title:UB.i18n("Edit"),modal:!0,maximizable:!0,maximized:!1,width:i.width,height:i.height,style:{background:"#959596"},overflowX:"auto",overflowY:"auto",stateful:!0,stateId:"HtmlEditorForm",layout:{type:"hbox",pack:"center",align:"stretch"},items:[t=Ext.create("UB.ux.UBTinyMCETextArea",{width:n.pageWidth,tinyMCEConfig:n.tinyMCEEditorConfig,value:n.getRawValue()})],buttons:[{text:UB.i18n("preViewInPDF"),handler:function(){var e;e=t.getValue(),SystemJS.import("@unitybase/pdf").then((e=>e.PrintToPdf.requireFonts({fonts:[{fontName:"TimesNewRoman",fontStyle:"Normal"},{fontName:"TimesNewRoman",fontStyle:"Bold"},{fontName:"TimesNewRoman",fontStyle:"Italic"},{fontName:"TimesNewRoman",fontStyle:"BoldItalic"}]}).then((()=>e)))).then((t=>{let n={font:{name:"TimesNewRoman",size:10,type:"Normal"},margin:{top:11,right:8,bottom:8,left:20},bottomColontitle:{height:8,font:{size:7,wide:0}},listeners:{initColontitle:function(e,n){n.colontitle.isTop?(n.align=t.PrintToPdf.alignType.center,n.text="test report - page "+n.pageNumber+" of "+n.totalPages):(n.align=t.PrintToPdf.alignType.center,n.text=" page "+n.pageNumber+" of "+n.totalPages)}}},i=new t.PrintToPdf(n);var o,r,a,s;i.writeHtml({html:e}),o=i.output("blobUrl"),r=Ext.widget("panel",{border:!0,flex:1}),a=Ext.create("UB.view.BaseWindow",{title:"PDF",width:800,height:600,modal:!0,layout:{type:"vbox",align:"stretch"},items:[r]}),(s=Ext.create("UB.ux.UBObject")).setXSize({width:"100%",height:"100%"}),r.add(s),s.setSrc({url:o,contentType:"application/pdf"}),a.show()}))}},{xtype:"panel",flex:1},{text:UB.i18n("Change"),iconCls:"u-icon-save",handler:function(){var i=t.getValue();n.setValue(i),e.close()}},{text:UB.i18n("cancel"),iconCls:"u-icon-close",handler:function(){e.close()}}],listeners:{afterrender:function(){},beforeclose:function(){}}})).show(),t.updateLayout()},initContextMenu:function(){var e=this;e.editBtnCtrl=Ext.create("Ext.Button",{renderTo:e.editBtn,cls:"ub-btn-flat ub-btn-rounded",tooltip:UB.i18n("Edit"),focusOnToFront:!1,style:"z-index: 3;",iconCls:"u-icon-edit",handler:e.editContent,scope:e})},isFocusableField:!0,isFocusable:function(){return!this.readOnly},setValue:function(){var e=this;e.callParent(arguments)}})},4377:function(){Ext.define("UB.ux.form.UBFieldSet",{extend:"Ext.form.FieldSet",alias:"widget.ubfieldset",margin:"5 0 5 0",padding:"5 0 5 0",border:"0 0 0 0 ",createLegendCt:function(){let e=this.callParent(arguments);return e.items.length>1&&(e.items=[e.items[1],e.items[0]]),e},glyphCollapsed:61701,glyph:61703,createToggleCmp:function(){var e=this;return e.toggleCmp=Ext.widget({xtype:"component",autoEl:{tag:"div"},height:15,width:35,id:e.id+"-legendToggle",style:"float: left; font-size: 1.4em; padding-left: 12px; cursor: pointer;",scope:e}),e.toggleCmp.on("boxready",(function(){e.toggleCmp.getEl().on("click",e.toggle,e)})),e.collapsed?e.toggleCmp.addCls(["u-icon-arrow-right"]):e.toggleCmp.addCls(["u-icon-arrow-down"]),e.toggleCmp},toggle:function(){var e=this;e.callParent(arguments),e.collapsed?(e.toggleCmp.removeCls("u-icon-arrow-down"),e.toggleCmp.addCls("u-icon-arrow-right")):(e.toggleCmp.removeCls("u-icon-arrow-right"),e.toggleCmp.addCls("u-icon-arrow-down"))}})},666:function(){Ext.define("UB.ux.form.UBPlanFactContainer",{extend:"Ext.container.Container",alias:"widget.ubplanfactcontainer",layout:{type:"vbox",align:"left"},initComponent:function(){const e=this;if(e.callParent(arguments),e.items.each((function(t){switch(t.controlType){case"plan":e.planControl=t;break;case"fact":e.factControl=t;break;default:throw new Error('You must set value property "controlType" for UBPlanFactContainer. The value must be "plan" "fact".')}"plan"===t.controlType&&(e.planControl=t),"fact"===t.controlType&&(e.factControl=t)})),!e.factControl)throw new Error('You must specify "fact" control for UBPlanFactContainer. To do this, a value of "fact" for the property controlType.');if(!e.planControl)throw new Error('You must specify "plan" control for for UBPlanFactContainer. To do this, a value of "fact" for the property controlType.');e.factControl.hide(),e.on("afterrender",e.onAfterRender,e,{single:!0})},initContextMenu:function(){const e=this,t=[];t.push({text:UB.i18n("showPlanAndFact"),itemID:"editItem",handler:function(){e.planControl.show(),e.factControl.show()},scope:e}),e.contextMenu=Ext.create("Ext.menu.Menu",{items:t})},adminRoles:"admins",onAfterRender:function(){const e=this,t=($App.connection.userData("roles")||"").split(","),n=(e.adminRoles||"").split(",");let i=!1;e.onDataBind(),e.setEventBind();for(let e=0;e<t.length;e++)if(n.indexOf(t[e])>=0){i=!0;break}i&&(e.initContextMenu(),e.getEl().on("contextmenu",(function(t,n){t.stopEvent(),e.contextMenu.showAt(t.getXY())}),e))},setEventBind:function(){const e=this,t=e.up("basepanel");t||console.error(" The UB.ux.form.field.UBCompositeComboBox must be in the UB.view.BasePanel"),t.binder&&t.binder.updateFormFields(),t.on("formDataReady",e.onDataBind,e)},onDataBind:function(){const e=this;let t;const n=e.planControl.getValue(),i=e.factControl.getValue();if("ubboxselect"===e.planControl.xtype){const e=n?(""+n).split(",").length:0,o=i?(""+i).split(",").length:0;t=o&&o>=e}else t=!!i;t?(e.planControl.hide(),e.factControl.show()):(e.planControl.show(),e.factControl.hide())}})},4557:function(){Ext.define("UB.ux.form.field.ComboExtraButtons",{extend:"Ext.panel.Panel",hidden:!0,width:"100px",shadow:!1,autoRender:!0,autoHide:!1,alwaysFramed:!1,frameHeader:!1,frame:!1,baseCls:Ext.baseCSSPrefix+"ubcombo",floating:!0,constrain:!1,focusOnToFront:!1,init:function(e){var t=this;t.parentCombo=e,t.ownerCt=e,e.on({afterrender:t.onParentAfterRenderer,added:function(e){t.ownerCt=e.up("[floating]"),t.registerWithOwnerCt()},refresh:function(){var n=e.bodyEl.getXY();n[1]-=20,t.showAt(n)},scope:this})},clearSelection:function(){var e=this.parentCombo;this.items.first().disable(),e.clearValue()},addItem:function(){var e=this.parentCombo,t=e.getStore(),n=t.entityName,i=e.displayField,o=e.getValue(),r=t.getById(o),a={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,store:t,isModal:!0,sender:e,onItemAdded:function(t){e.setValueById(t)},initValue:{}};a.initValue[i]=r?r.get(i):o,UB.core.UBApp.doCommand(a)},editItem:function(){var e=this,t=e.parentCombo,n=t.getStore(),i=n.entityName,o=t.getValue(),r={cmdType:UB.core.UBCommand.commandType.showForm,entity:i,instanceID:o,store:n,isModal:!0,sender:t,onClose:function(){t.setValue(n.getById(t.getValue())),e.enable()}};o&&UB.core.UBApp.doCommand(r)},showLookup:function(){var e=this.parentCombo,t=e.getStore(),n=t.entityName,i=e.getValue(),o={entity:n,cmdType:UB.core.UBCommand.commandType.showList,description:$App.domainInfo.get(n,!0).getEntityDescription(),isModal:!0,sender:e,selectedInstanceID:i,onItemSelected:function(t){e.setValueById(t.get("ID"))},cmdData:{params:[{entity:n,method:"select",fieldList:"*",whereList:t.ubRequest.whereList}]}};let r=t.filters.clone();r.removeAtKey(e.userFilterId),o.filters=r,UB.core.UBApp.doCommand(o)},onParentAfterRenderer:function(){this.initEventHandlers(),this.bindHotKeys()},initEventHandlers:function(){let e=this;e.parentCombo.on({expand:e.onParentFocus,change:e.onParentValueChange,focus:e.onParentFocus,blur:e.onParentBlur,scope:e}),e.parentCombo.on({expand:e.onParentExpand,scope:e}),setTimeout((function(){e.ownerCt=e.parentCombo.up("[floating]"),e.registerWithOwnerCt()}),100)},bindHotKeys:function(){let e=this;new Ext.util.KeyMap({target:e.parentCombo.getEl(),binding:[{ctrl:!0,key:Ext.EventObject.E,fn:function(t,n){if(!e.parentCombo.disabled&&!e.parentCombo.readOnly)return n.stopEvent(),e.editItem(),!1}},{key:120,fn:function(t,n){if(!e.parentCombo.disabled&&!e.parentCombo.readOnly)return e.showLookup(),!1}}]})},onParentExpand:function(){this.parentCombo.un({expand:this.onParentExpand,scope:this})},initComponent:function(){var e=this;e.floating=Ext.apply({},{shadow:e.shadow},e.self.prototype.floating),e.items=[{xtype:"button",width:"25px",flex:1,iconCls:"u-icon-edit",handler:{fn:e.editItem,scope:e}},{xtype:"button",width:"25px",flex:1,iconCls:"u-icon-grid",handler:{fn:e.showLookup,scope:e}},{xtype:"button",width:"25px",flex:1,iconCls:"u-icon-add",handler:{fn:e.addItem,scope:e}},{xtype:"button",width:"25px",iconCls:"u-icon-eraser",handler:{fn:e.clearSelection,scope:e}}],e.callParent(arguments),e.on({element:"el",mousedown:e.onClick,scope:e})},showAt:function(e){let t=this;t.parentCombo.disabled||t.parentCombo.readOnly||(t.callParent(arguments),t.isVisible()&&(t.setPagePosition(e[0],e[1]),(t.constrainPosition||t.constrain)&&t.doConstrain(),t.toFront()))},onParentFocus:function(e){var t=this,n=t.parentCombo,i=n.getStore(),o=n.getValue(),r=!(i.getById(o)||0===i.getCount()&&Ext.isNumber(o));t.items.first().setDisabled(r);let a=n.bodyEl.getXY();a[1]-=20,t.showAt(a)},onParentBlur:function(){this.hide()},onParentValueChange:function(){let e=this.parentCombo,t=!e.getStore().getById(e.getValue());this.items.first().setDisabled(t)},onClick:function(e){if(this.disabled)return void e.stopEvent();let t=this.getItemFromEvent(e);t&&!t.isDisabled()&&(_.isFunction(t.handler)?t.handler(e):t.handler&&_.isFunction(t.handler.fn)&&Ext.callback(t.handler.fn,t.handler.scope,[e]))},getItemFromEvent:function(e){return this.getChildByElement(e.getTarget())}})},7142:function(){Ext.define("UB.ux.form.field.UBBaseComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.ubbasebox",queryCaching:!0,getEntity:function(){const e=this.ubRequest||(this.store?this.store.ubRequest:null);return e?e.entity:""},initComponent:function(){var e=this,t=e.getStore();if(e.callParent(arguments),e.on("afterrender",e.onAfterRender,e),e.on("change",e.onValueChange,e),t&&t.on("load",(function(t,n,i){i&&(e.dataLoaded=!0)}),e,{single:!0}),t&&t.ubRequest&&t.ubRequest.entity){var n=$App.domainInfo.get(t.ubRequest.entity,!0).cacheType;"Session"!==n&&"SessionEntity"!==n||(e.queryDelay=200)}},setRawValue:function(e){var t=this;t.callParent(arguments),t.inputEl&&t.readOnly&&e&&e.length>50&&t.inputEl.set({"data-qtip":e})},onDataLoaded:function(e,t){var n=this,i=this.getStore();this.dataLoaded?Ext.callback(e,t||n,[n]):i.on("load",(function(i,o,r){n.dataLoaded=!0,r&&Ext.callback(e,t||n,[n])}),n,{single:!0})},onAfterRender:function(){var e,t=this;t.disableContextMenu||t.initContextMenu(),t.inputCell.on("contextmenu",(function(e,n){e.stopEvent(),t.disabled||t.disableContextMenu||!t.contextMenu||(t.onShowContextMenu(),t.contextMenu.showAt(e.getXY()))}),t),t.inputEl&&t.readOnly&&(e=t.inputEl.getValue())&&e.length>50&&t.inputEl.set({"data-qtip":e}),!t.disableLimitSearchLength&&UB.appConfig.maxSearchLength&&t.inputEl.set({maxlength:UB.appConfig.maxSearchLength})},onShowContextMenu:function(){var e=this;e.editItemButton&&(e.getValue()?e.editItemButton.autoDisable&&(e.disabled||e.disableModifyEntity||e.editItemButton.setDisabled(!1)):(e.editItemButton.autoDisable=!0,e.editItemButton.setDisabled(!0)))},onValueChange:function(){var e=this,t=e.disabled||e.disableModifyEntity||!e.getStore().getById(e.getValue());e.editItemButton&&e.editItemButton.setDisabled(t)},onKeyDown:function(e){var t=this;t.editable||e.getKey()!==e.BACKSPACE?e.ctrlKey||t.callParent(arguments):(e.stopEvent(),t.clearValue())},onKeyUp:function(e){var t=this;t.editedByUser=!0,!t.editable&&e.BACKSPACE?e.stopEvent():e.ctrlKey||t.callParent(arguments)},beforeDestroy:function(e){var t=this;t.contextMenu&&(Ext.destroy(t.contextMenu),t.contextMenu=null),t.keyMap&&(Ext.destroy(t.keyMap),t.keyMap=null),this.callParent()},setReadOnly:function(e){var t,n=this,i=n.getStore(),o=(i.ubRequest?i.ubRequest.entity:null)||i.entityName,r=UB.core.UBCommand.methodName;n.callParent(arguments),n.showLookupButton&&n.showLookupButton.setDisabled(e),n.addItemButton&&n.addItemButton.setDisabled(e||!$App.domainInfo.isEntityMethodsAccessible(o,[r.ADDNEW,r.INSERT])),n.clearValueButton&&n.clearValueButton.setDisabled(e),n.inputEl&&(e&&(t=n.inputEl.getValue())&&t.length>50?n.inputEl.set({"data-qtip":t}):n.inputEl.set({"data-qtip":void 0}))},disableModifyEntity:!1,hideEntityItemInContext:!1,parentIsModal:!1,initContextMenu:function(){var e,t,n,i=this,o=UB.core.UBCommand.methodName;e=[],n=((t=i.getStore()).ubRequest?t.ubRequest.entity:null)||t.entityName;let r=this.up("basepanel");i.parentIsModal=r&&r.isModal||!1,$App.domainInfo.has(n)&&(e.push({text:UB.i18n("editSelItem")+" (Ctrl+E)",iconCls:"u-icon-edit",itemID:"editItem",handler:i.editItem,hidden:!!i.hideEntityItemInContext||i.disableModifyEntity,disabled:i.disabled||i.disableModifyEntity,scope:i}),e.push({text:UB.i18n("selectFromDictionary")+" (F9)",iconCls:"u-icon-grid",itemID:"showLookup",handler:i.showLookup,hidden:!!i.hideEntityItemInContext,disabled:i.disabled||i.readOnly,scope:i}),e.push({text:UB.i18n("addNewItem"),iconCls:"u-icon-add",itemID:"addItem",handler:i.addItem,hidden:!!i.hideEntityItemInContext||i.disableModifyEntity,disabled:i.disableModifyEntity||i.disabled||i.readOnly||!$App.domainInfo.isEntityMethodsAccessible(n,[o.ADDNEW,o.INSERT]),scope:i})),e.push({text:UB.i18n("clearSelection")+" (Ctrl+BackSpace)",iconCls:"u-icon-eraser",itemID:"clearValue",handler:i.clearValue,disabled:i.disabled||i.readOnly,scope:i}),i.contextMenu=Ext.create("Ext.menu.Menu",{items:e}),i.editItemButton=i.contextMenu.items.getAt(0),i.showLookupButton=i.contextMenu.items.getAt(1),i.addItemButton=i.contextMenu.items.getAt(2),i.clearValueButton=i.contextMenu.items.getAt(3),i.keyMap=new Ext.util.KeyMap({target:i.getEl(),binding:[{ctrl:!0,shift:!1,alt:!1,key:Ext.EventObject.E,handler:function(e,t){return i.disabled||i.readOnly||i.hideEntityItemInContext||i.disableModifyEntity||(t.stopEvent(),i.editItem()),!0}},{ctrl:!1,shift:!1,alt:!1,key:120,handler:function(e,t){return i.disabled||i.readOnly||i.hideEntityItemInContext||(t.stopEvent(),i.showLookup()),!0}},{ctrl:!0,shift:!1,alt:!1,key:8,handler:function(e,t){return i.disabled||i.readOnly||(t.stopEvent(),i.clearValue()),!0}},{ctrl:!0,shift:!1,alt:!1,key:65,handler:function(e,t){return i.ctrlCDown=!0,!0}},{ctrl:!0,shift:!1,alt:!1,key:67,handler:function(){return i.ctrlCDown=!0,!0}}]})},doRawQuery:function(){var e=this,t=this.getRawValue();e.ctrlCDown||!t&&e.editedByUser||e.getDisplayValue()===t||e.callParent(arguments),e.deleteWasPressed=!1,e.ctrlCDown=!1},addItem:function(){const e=this,t=e.getStore(),n=t.entityName,i=e.displayField,o=e.getValue(),r=t.getById(o),a={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,store:t,isModal:UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditForms||e.parentIsModal,sender:e,onClose:function(t){t&&e.setValueById&&(e.setIsActualValue=!0,e.setValueById(t))},initValue:{}};a.initValue[i]=r?r.get(i):o,UB.core.UBApp.doCommand(a)},editItem:function(e){var t,n,i,o,r=this;(n=(t=r.getStore()).entityName)&&(i=r.getValue(),o={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,instanceID:i,initValue:e,store:t,isModal:UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditForms||r.parentIsModal,sender:r,onClose:function(e,t,n){!r.readOnly&&n&&(r.setValue(null),r.getStore().clearData(),r.setValueById(e||i),r.enable())}},i&&UB.core.UBApp.doCommand(o))},showExtBasedLookup(){const e=this,t=e.getStore(),n=t.entityName;if(!n)return;const i=e.getValue(),o=e.gridFieldList?e.gridFieldList:"*",r={renderer:"ext",entity:n,cmdType:UB.core.UBCommand.commandType.showList,description:$App.domainInfo.get(n,!0).getEntityDescription(),isModal:!0,sender:e,selectedInstanceID:i,onItemSelected:function(t){e.setValueById&&(e.getStore().clearData(),e.setValueById(t.get(e.valueField||"ID")))},cmdData:{params:[{entity:n,method:"select",fieldList:o,whereList:t.ubRequest.whereList,logicalPredicates:t.ubRequest.logicalPredicates,__mip_ondate:t.ubRequest.__mip_ondate}]},hideActions:e.hideActions};var a=t.filters.clone();a.removeAtKey(e.userFilterId),r.filters=a,UB.core.UBApp.doCommand(r)},showLookup(){if(!UB.connection.appConfig.uiSettings.adminUI.useVueTables)return this.showExtBasedLookup();const e=this.getStore();if(!e.entityName)return;const t=e.filters.clone();t.removeAtKey(this.userFilterId);const n=Ext.clone(e.ubRequest).whereList||{},i=UB.ux.data.proxy.UBProxy.ubFilterToWhereList(t.getRange(),e.entityName);Ext.Object.merge(n,i);const o={renderer:"vue",cmdType:"showList",isModal:!0,cmdData:{repository:()=>UB.Repository({entity:e.entityName,fieldList:this.gridFieldList||UB.connection.domain.get(e.entityName).getAttributeNames({defaultView:!0}),whereList:n,logicalPredicates:e.ubRequest.logicalPredicates,__mip_ondate:e.ubRequest.__mip_ondate}),onSelectRecord:({ID:e,close:t})=>{this.setValueById&&(this.getStore().clearData(),this.setValueById(e)),t()},buildEditConfig:e=>(UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditForms&&(e.isModal=!0),e),buildCopyConfig:e=>(UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditForms&&(e.isModal=!0),e),buildAddNewConfig:e=>(UB.connection.appConfig.uiSettings.adminUI.forceModalsForEditForms&&(e.isModal=!0),e),scopedSlots:e=>({toolbarPrepend:({store:t,close:n})=>e("u-button",{props:{icon:"u-icon-check",appearance:"inverse",disabled:!t.state.selectedRowId},on:{click:()=>{this.setValueById&&(this.getStore().clearData(),this.setValueById(t.state.selectedRowId)),n()}}},[UB.i18n("actionSelect")])})}};UB.core.UBApp.doCommand(o)},onExpand:function(){var e=this,t=e.selectOnTab,n=e.getPicker();e.listKeyNav=new Ext.view.BoundListKeyNav(this.inputEl,{boundList:n,forceKeyDown:!0,tab:function(n){return t&&(this.selectHighlighted(n),e.triggerBlur()),!0},enter:function(t){var i=n.getSelectionModel(),o=i.getCount();this.selectHighlighted(t),e.multiSelect||o!==i.getCount()||e.collapse()},home:null,end:null}),e.callParent(arguments)},getErrors:function(e){var t,n,i=this;return t=i.callParent(arguments),(n=i.getValue())||0===n||i.allowBlank||(0===t.length||t.indexOf(i.blankText)<0)&&t.push(i.blankText),t},onDestroy:function(){this.contextMenu&&this.contextMenu.destroy(),this.callParent(arguments)}})},9516:function(e,t,n){n(7142),Ext.define("UB.ux.form.field.UBBoolBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubboolbox",editable:!1,forceSelection:!0,queryMode:"local",addEmptyValue:!1,addnoFilterValue:!1,initComponent:function(){let e=this;e.displayField="name",e.valueField="value";let t=[{value:1,name:UB.i18n("Yes")},{value:0,name:UB.i18n("No")}];e.addEmptyValue&&t.unshift({value:"isNull",name:UB.i18n("isNull")}),e.addnoFilterValue&&t.unshift({value:"no_filter",name:UB.i18n("no_filter")}),e.store=Ext.create("Ext.data.Store",{fields:["value","name"],data:t}),e.callParent(arguments)},setValueById:null})},5658:function(e,t,n){n(4641),Ext.define("UB.ux.form.field.UBBoxSelect",{extend:"Ext.ux.form.field.BoxSelect",userFilterId:"userFilterId",alias:"widget.ubboxselect",queryCaching:!1,queryDelay:300,minChars:1,dataLoadDelay:!0,componentLayout:"triggerfield",cls:"ub-box-select",requires:["UB.core.UBUtil"],selectOnFocus:!1,highlightSearch:!0,minCharsForQuery:0,matchCls:"combo-search-match",disableGrow:!1,growMax:100,customAction:null,initComponent:function(){var e,t,n=this;n.grow=!n.disableGrow,n.tpl||(n.tpl=new Ext.XTemplate('<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="','boundlist-{[xindex % 2 === 0 ? "even" : "odd"]}  '+Ext.baseCSSPrefix+'boundlist-item " ',">{[values['"+n.displayField+"']]}</li>","</tpl></ul>")),n.disablePaging?delete n.pageSize:n.pageSize||(n.pageSize=UB.appConfig.comboPageSize),!(t=n.getStore())&&n.ubRequest&&(t=n.store=Ext.create("UB.ux.data.UBStore",{ubRequest:n.ubRequest,autoLoad:!1,autoDestroy:!0})),t.pageSize=n.pageSize,e=function(e){return'<span class="'+n.matchCls+'">'+e+"</span>"},n.listConfig={pageSize:n.pageSize,minWidth:n.listMinWidth,selModel:{mode:n.multiSelect?"SIMPLE":"SINGLE",preventFocus:!0},listeners:{refresh:{fn:function(t){if(n.highlightSearch&&n.searchRegExp){var i=t.getEl();if(i){var o=i.down(".x-list-plain");if(o)for(var r=o.down(".x-boundlist-item");r;)r.dom.innerHTML&&(r.dom.innerHTML=r.dom.innerHTML.replace(n.searchRegExp,e)),r=r.next()}}}}},tpl:n.tpl,getInnerTpl:function(e){return"{[values['"+e+"']]}"},createPagingToolbar:function(){var e=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"-paging-toolbar",pageSize:n.pageSize,border:!1,minHeight:0,ownerCt:this,cls:"ub_combo-bound-toolbar",ownerLayout:this.getComponentLayout(),bindStore:Ext.emptyFn,items:[{xtype:"tbspacer",flex:1},{xtype:"tbseparator"},n.customAction||"-",{xtype:"button",text:UB.i18n("more"),handler:n.readMoreData,scope:n}]});return n.pagingToolbar=e,e}},n.on({beforedestroy:n.onBeforedestroy,scope:n}),n.callParent(arguments),n.editable&&n.on({beforequery:n.beforequery,scope:n}),n.getStore()&&n.getStore().on("load",n.onDataLoaded,n)},onBeforedestroy:function(){var e=this;e.getStore()&&e.getStore().un("load",e.onDataLoaded,e)},fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls} {requiredCls}','<tpl if="readOnly"> readonly="readonly"</tpl>','">','<ul id="{cmpId}-itemList" class="x-boxselect-list" ','<tpl if="componentHeight">style=" height:"{componentHeight}px;"</tpl>',">",'<li id="{cmpId}-inputElCt" class="x-boxselect-input" style="width: 100%;" >','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],setAllowBlank:function(e){var t;this.allowBlank=e,(t=Ext.get(this.id+"-listWrapper"))&&(e?t.removeCls(this.requiredCls):t.addCls(this.requiredCls))},setValue:function(e,t,n){Ext.isString(e)&&(e=Ext.JSON.decode("["+e+"]")),this.callParent([e,t,n]),this.updateLayout()},getValue:function(e){let t=this,n=t.callParent(arguments),i=[];return e?n:n?(_.forEach(n,(function(e){i.push(_.isObject(e)?e.get(t.valueField):e)})),UB.core.UBUtil.extractfromBrackets(JSON.stringify(i))):n},getValueArray:function(){var e=this.getValue(!0),t=[];return _.forEach(e,(function(e){t.push(e)})),t},isDirty:function(){var e=this;return!e.disabled&&!e.isEqual(e.getValue(),e.originalValue)},isEqual:function(e,t){return!e&&!t||this.callParent(arguments)},setValueById:function(e,t,n,i){var o,r,a=this;if(!e)return a.setValue(e),t&&a.resetOriginalValue(),void(n&&Ext.callback(n,i||a,[a]));o=a.store.ubRequest,"string"!=typeof e&&(e=String(e)),r="ID"===this.valueField?e.split(",").map((function(e){return parseInt(e,10)})):e.replace(/"/g,"").split(","),UB.Repository(o.entity).attrs(o.fieldList).whereIf(r.length>1,"["+this.valueField+"]","in",r).whereIf(1===r.length,"["+this.valueField+"]","=",r[0]).whereIf(this.enumGroupFilter,"[eGroup]","=",this.enumGroupFilter).misc({__allowSelectSafeDeleted:!0,__mip_recordhistory_all:!0,__mip_disablecache:!0}).selectAsStore().then((function(e){var o=[];e.each((function(e){o.push(e)})),a.store&&(a.setValue(o),t&&a.resetOriginalValue(),n&&Ext.callback(n,i||a,[a]))}))},beforequery:function(e){var t=this;if(t.minCharsForQuery&&t.minCharsForQuery>0&&t.minCharsForQuery>(e.query||"").length)return e.cancel=!0,void t.showToolTipMinQuery();var n=UB.Utils.escapeForRegexp(e.query);if(t.searchRegExp=null,Ext.isEmpty(n)||(t.searchRegExp=new RegExp(n,"gi")),"local"!==e.combo.queryMode){var i=t.store,o=e.query||"",r=t.displayField;o?i.filters.add(new Ext.util.Filter({id:t.userFilterId,root:"data",property:r,caseSensitive:!1,anyMatch:!0,value:o})):(i.filters.removeAtKey(t.userFilterId),e.forceAll=!0)}},showToolTipMinQuery:function(){var e,t=this.getPicker();this.expand(),this.pagingToolbar.setHeight(0),e=t.getTargetEl(),t.clearViewEl(),Ext.core.DomHelper.insertHtml("beforeEnd",e.dom,UB.format(UB.i18n("startSearchMinCharacters"),this.minCharsForQuery))},onItemListClick:function(e,t,n){var i=this,o=e.getTarget(".x-boxselect-item"),r=!!o&&e.getTarget(".x-boxselect-item-close");i.readOnly||i.disabled||(e.stopPropagation(),o?(r?(i.removeByListItemNode(o),i.valueStore.getCount()>0&&i.fireEvent("select",i,i.valueStore.getRange())):i.toggleSelectionByListItemNode(o,e.shiftKey),i.inputEl.focus()):i.selectionModel.getCount()>0&&(i.selectionModel.setLastFocused(null),i.selectionModel.deselectAll()))},alignPicker:function(){var e=this,t=e.picker,n=t.getTargetEl().dom.scrollTop;e.callSuper(arguments),e.isExpanded&&(e.matchFieldWidth&&t.setWidth(e.bodyEl.getWidth()),t.getTargetEl().dom.scrollTop=n)},onDataLoaded:function(){var e,t=this,n=t.store.getCount();t.pagingToolbar&&(t.pageSize>n||t.lastRowIndex&&t.lastRowIndex+1+t.pageSize>n?t.pagingToolbar.setHeight(0):t.pagingToolbar.setHeight(36)),t.onDataRefreshed(),t.inputEl&&t.inputEl.getValue()&&(e=t.inputEl.getValue().length,t.inputEl.dom.setSelectionRange(e,e))},onDataRefreshed:function(){var e=this,t=this.getStore(),n=t.getCount(),i=e.getPicker(),o=e.lastRowIndex;o&&(e.lastRowIndex=null,n>o+8&&(o+=8),(o=t.getAt(o))&&i.focusNode(o))},readMoreData:function(){var e=this,t=this.getStore(),n=t.getCount();e.lastRowIndex=null,n>0&&(e.lastRowIndex=n-1),e.inputEl.focus(),t.loadPage((t.currentPage||0)+1,{params:this.getParams(this.lastQuery),addRecords:!0})},getMultiSelectItemMarkup:function(){var e=this;return e.multiSelectItemTpl||(e.labelTpl?(Ext.isString(e.labelTpl)||Ext.isArray(e.labelTpl))&&(e.labelTpl=Ext.create("Ext.XTemplate",e.labelTpl)):e.labelTpl=Ext.create("Ext.XTemplate",'{[values["'+e.displayField+'"]]}'),e.multiSelectItemTpl=['<tpl for=".">','<li class="x-tab-default x-boxselect-item ','<tpl if="this.isSelected(values.'+e.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : ["'+e.displayField+'"]]}">','<div class="x-boxselect-item-text this.getItemCls(values.'+e.valueField+')">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,getItemCls:function(t){return e.deletedItems&&e.deletedItems.length>0&&e.deletedItems.indexof(t)>=0?"boxselect-item-deleted":""},isSelected:function(t){var n=e.valueStore.findExact(e.valueField,t);return n>=0&&e.selectionModel.isSelected(e.valueStore.getAt(n))},getItemLabel:function(t){return e.getTpl("labelTpl").apply(t)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))}})},9074:function(e,t,n){n(7142),n(4557);const i=n(1972),o=n(6486);Ext.define("UB.ux.form.field.UBComboBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubcombobox",uses:["Ext.grid.plugin.BufferedRenderer"],queryCaching:!0,editable:!0,minChars:0,grow:!1,queryMode:"remote",userFilterId:"_userInput",matchFieldWidth:!0,matchCls:"combo-search-match",highlightSearch:!0,disablePaging:!1,minCharsForQuery:0,allowCustomText:!1,allowFilteredOut:!0,dataLoadDelay:!0,sendQueryAsParam:!1,queryParamName:"query",autoCompleteText:!1,initComponent:function(){let e=this;e.addEvents("beforeQuerySend"),e.disablePaging?delete e.pageSize:e.pageSize||(e.pageSize=i.appConfig.comboPageSize);let t=e.getStore();!t&&e.ubRequest&&(t=e.store=Ext.create("UB.ux.data.UBStore",{ubRequest:e.ubRequest,autoLoad:!1,autoDestroy:!0})),"text"===e.displayField&&(e.displayField=t.ubRequest.fieldList[1]),e.valueField||(e.valueField=t.ubRequest.fieldList[0]),t.pageSize=e.pageSize,e.tpl||(e.tpl=new Ext.XTemplate('<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="','boundlist-{[xindex % 2 === 0 ? "even" : "odd"]}  '+Ext.baseCSSPrefix+'boundlist-item " ',">{[values['"+this.displayField+"']]}</li>","</tpl></ul>"));let n=function(t){return'<span class="'+e.matchCls+'">'+t+"</span>"};e.listConfig=Ext.apply({pageSize:e.pageSize,minWidth:e.listMinWidth,listeners:{refresh:{fn:function(t){if(!e.highlightSearch||!e.searchRegExp)return;let i=t.getEl();if(!i)return;let o=i.down(".x-list-plain");if(!o)return;let r=o.down(".x-boundlist-item");for(;r;)r.dom.innerHTML&&(r.dom.innerHTML=r.dom.innerHTML.replace(e.searchRegExp,n)),r=r.next()}}},getInnerTpl:function(e){return"{[values['"+e+"']]}"},createPagingToolbar:function(){let t=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"-paging-toolbar",pageSize:e.pageSize,border:!1,minHeight:0,ownerCt:this,cls:"ub_combo-bound-toolbar",ownerLayout:this.getComponentLayout(),bindStore:Ext.emptyFn,items:[{xtype:"tbspacer",flex:1},{xtype:"tbseparator"},{xtype:"button",text:i.i18n("more"),handler:e.readMoreData,scope:e}]});return e.pagingToolbar=t,t}},e.listConfig||{}),e.editable&&e.on({beforequery:e.beforequery,scope:e}),e.on({beforedestroy:e.onBeforedestroy,scope:e}),e.callParent(arguments),e.getStore()&&e.getStore().on("load",e.onDataLoaded,e)},onBeforedestroy:function(){let e=this,t=e.getStore();t&&t.un("load",e.onDataLoaded,e)},onDataRefreshed:function(){let e=this.lastRowIndex;if(!e)return;let t=this.getStore(),n=t.getCount(),i=this.getPicker();this.lastRowIndex=null,n>e+8&&(e+=8),e=t.getAt(e),e&&i.focusNode(e)},readMoreData:function(){let e=this.getStore(),t=e.getCount();this.lastRowIndex=null,t>0&&(this.lastRowIndex=t-1),this.inputEl.focus(),e.loadPage((e.currentPage||0)+1,{params:this.getParams(this.lastQuery),addRecords:!0})},createPicker:function(){let e=this.callParent(arguments);return e.mon({blur:this.onPickerBlur,scope:this}),e},onPickerBlur:function(e){let t=this.inputEl;if(e.relatedTarget){if(e.relatedTarget!==t.dom){let t=this.getPicker();if(t&&t.el){let n=0,i=e.relatedTarget;for(;n<11&&i;){if(t.el.dom===i)return;i=i.parentElement,n++}}this.onExitCombo()}}else this.inputEl.focus()},onBlur:function(e){if(this.allowCustomText)return;let t=this,n=t.getPicker();if(n&&n.el&&e.relatedTarget){let i=0,o=e.relatedTarget;for(;i<11&&o;){if(n.el.dom===o)return o=Ext.dom.Element.get(e.relatedTarget),o.un({blur:this.onPickerBlur,scope:t}),void o.on({blur:this.onPickerBlur,scope:t});o=o.parentElement,i++}}t.onExitCombo()},onExitCombo:function(){let e=this;if(!e.valueModels||0===e.valueModels.length)return void e.setRawValue(null);let t=e.getRawValue(),n=null,i=!1;for(let o=0;o<e.valueModels.length;o++)if(n=e.valueModels[o],n=n.get(e.displayField),n===t){i=!0;break}i||e.setRawValue(n)},onDataLoaded:function(){let e=this,t=e.store.getCount();e.pagingToolbar&&(e.pageSize>t||e.lastRowIndex&&e.lastRowIndex+1+e.pageSize>t?e.pagingToolbar.setHeight(0):e.pagingToolbar.setHeight(36)),e.onDataRefreshed()},onKeyDown:function(e){e.ctrlKey&&e.getKey()===Ext.EventObject.Q?this.stopKeyHandlers=!0:e.ctrlKey||this.callParent(arguments)},onKeyUp:function(e){e.ctrlKey&&e.getKey()===Ext.EventObject.Q?this.stopKeyHandlers=!1:e.ctrlKey||this.callParent(arguments)},onKeyPress:function(e){this.stopKeyHandlers?this.up("form").switchTabs(this,e.shiftKey):e.ctrlKey||this.callParent(arguments)},showToolTipMinQuery:function(){let e=this.getPicker();this.expand(),this.pagingToolbar.setHeight(0);let t=e.getTargetEl();e.clearViewEl(),Ext.core.DomHelper.insertHtml("beforeEnd",t.dom,i.format(i.i18n("startSearchMinCharacters"),this.minCharsForQuery))},afterQuery:function(e){let t=this;if(t.autoCompleteText&&t.store.getCount()){let e=t.store.getAt(0),n=t.inputEl.dom.value;t.userInputText=n;let i=e.get(t.displayField);t.inputEl.dom.value=i,t.inputEl.dom.setSelectionRange(n.length,i.length)}t.callParent(arguments)},beforequery:function(e){let t=this;if(t.minCharsForQuery&&t.minCharsForQuery>0&&t.minCharsForQuery>(e.query||"").length)return e.cancel=!0,void t.showToolTipMinQuery();let n=i.Utils.escapeForRegexp(e.query);if(t.searchRegExp=null,n&&(t.searchRegExp=new RegExp(n,"gi")),t.fireEvent("beforeQuerySend",e),"local"!==e.combo.queryMode){let n=e.query||"",i=t.getStore();if(t.sendQueryAsParam)return i.ubRequest||(i.ubRequest={}),void(i.ubRequest[t.queryParamName]=n);if(n){let e=t.displayField;i.filters.add(new Ext.util.Filter({id:t.userFilterId,root:"data",property:e,caseSensitive:!1,anyMatch:!0,value:n}))}else i.filters.removeAtKey(t.userFilterId),t.useForGridEdit&&i.totalCount<=1&&i.reload(),e.forceAll=!0}},setValue:function(e){let t=this,n=Ext.Array.from(e,!1);if(!t.allowCustomText&&t.valueModels&&t.valueModels.length>0&&n.length===t.valueModels.length){let e=!0;for(let i=0;i<t.valueModels.length;i++){let o=t.valueModels[i];o=o.get(t.valueField);let r=n[i];if(Ext.isObject(r)&&r.isModel&&(r=r.get(t.valueField)),o!==r){e=!1;break}}if(e)return}t.clearIsPhantom(),t.callParent(arguments);let i=t.getStore();!t.useForGridEdit||!e||o.isArray(e)||o.isObject(e)||i.filters.get(t.userFilterId)&&i.filters.get(t.userFilterId).value===e||(i.suspendEvent("clear"),i.filter(new Ext.util.Filter({id:t.userFilterId,root:"data",property:this.valueField||"ID",condition:e&&o.isArray(e)?"in":"equal",value:e})))},getValue:function(e){let t=this.callParent(arguments);return t===this.value?t:null},getVal:function(e){let t=this.getValue();if(!t||!e)return null;let n,i=this.getStore();return i&&(n=i.getById(t)),n?n.get(e):null},clearValue:function(){let e=this.store;this.callParent(arguments),this.rawValue=null,e&&e.filters.removeAtKey(this.userFilterId)},getEntity:function(){let e=this.ubRequest||(this.store?this.store.ubRequest:null);return e?e.entity:""},getSubTplData:function(){return this.callParent(arguments)},setRawValue:function(e){this.callParent(arguments),this.clearIsPhantom()},clearIsPhantom:function(){let e=this;e.rendered&&e.phantomSelectedElement&&Ext.get(e.getInputId()).removeCls("ub-combo-deleted"),e.phantomSelectedElement=!1,e.tipPhantomElement&&(e.tipPhantomElement.setDisabled(!0),e.tipPhantomElement=null)},setValueById:function(e,t,n,o){let r=this;if(Ext.isEmpty(e))return r.setValue(e),t&&r.resetOriginalValue(),void(n&&Ext.callback(n,o||r,[r]));let a=r.getStore();function s(i,s){(s||i||r.store.getById(e))&&r.setValue(s?null:i||e),t&&r.resetOriginalValue(),a.resumeEvent("clear"),r.lastQuery=null,n&&Ext.callback(n,o||r,[r])}a.on({load:{fn:function(){if(0===a.getCount()){if(!r.allowFilteredOut)return;i.xhr.allowRequestReiteration(),i.connection.select({entity:r.getEntity(),method:a.ubRequest.method||"select",fieldList:a.ubRequest.fieldList,__allowSelectSafeDeleted:!0,ID:e}).then((function(e){if(a.isDestroyed)return;let t=Ext.create(a.model);i.ux.data.UBStore.resultDataRow2Record(e,t)?(i.ux.data.UBStore.resetRecord(t),a.add(t,!0),s(t),r.fieldCls+=" ub-combo-deleted",r.rendered&&Ext.get(r.getInputId()).addCls("ub-combo-deleted"),r.phantomSelectedElement=!0,r.tipPhantomElement=Ext.create("Ext.tip.ToolTip",{target:r.getInputId(),html:i.i18n("elementIsNotActual")})):s(null,!0)}))}else 1===a.getCount()?(s(a.getAt(0)),r.clearIsPhantom()):(s(),r.clearIsPhantom())},single:!0}}),a.suspendEvent("clear"),a.filter(new Ext.util.Filter({id:r.userFilterId,root:"data",property:this.valueField||"ID",condition:e&&Array.isArray(e)?"in":"equal",value:e}))},getFieldValue:function(e){return this.getValue()&&this.lastSelection.length?this.lastSelection[0].get(e):null}})},7355:function(e,t,n){const i=n(1972);Ext.define("UB.ux.form.field.UBDate",{extend:"Ext.form.field.Date",alias:"widget.ubdatefield",format:"d.m.Y",labelAlign:"left",fieldCls:"ub-date-input",minWidth:120,startDay:1,minValue:new Date(1901,1,1),validator:function(e){return!e||(!!e.match(/^\d{2}([./-])\d{2}\1\d{4}$/)||" ")},constructor:function(e){var t=this;(e=e||{}).width||(e.width=(e.fieldLabel?e.labelWidth||t.labelWidth||100:0)+120),e.fieldLabel&&(t.minWidth=e.width),t.maxWidth=e.maxWidth||e.width,t.callParent([e])},initComponent:function(){var e=this;e.fieldType=e.fieldType||"DateTime",e.callParent(arguments)},rawToValue:function(e){var t=this.callParent(arguments);return this.fieldType===UBDomain.ubDataTypes.Date&&Ext.isDate(t)&&(t=i.truncTimeToUtcNull(t)),t}})},7646:function(e,t,n){n(2823),Ext.define("UB.ux.form.field.UBDateTime",{extend:"Ext.ux.form.DateTimeField",alias:"widget.ubdatetimefield",minWidth:160,fieldCls:"ub-date-input",showToday:!1,minValue:new Date(1901,1,1),constructor:function(e){var t=this;(e=e||{}).width||(e.width=(e.fieldLabel?e.labelWidth||t.labelWidth||100:0)+160),e.fieldLabel&&(t.minWidth=e.width),t.maxWidth=e.maxWidth||e.width,t.callParent([e])}}),Ext.override(Ext.picker.Date,{handleTabClick:function(e){var t=this,n=t.getSelectedDate(t.activeDate),i=t.handler;!t.disabled&&n&&n.dateValue&&!Ext.fly(n.parentNode).hasCls(t.disabledCellCls)&&(t.doCancelFocus=!1===t.focusOnSelect,t.setValue(new Date(n.dateValue)),delete t.doCancelFocus,t.fireEvent("select",t,t.value),i&&i.call(t.scope||t,t,t.value),t.onSelect())}})},8595:function(e,t,n){n(9074),Ext.define("UB.ux.form.field.UBDictComboBox",{extend:"UB.ux.form.field.UBComboBox",alias:"widget.ubdictcombobox",initComponent:function(){var e=this;e.allowCustomText=!0,e.forceSelection=!1,e.on("focus",e.oncbFocus,e),e.callParent(arguments),e.addEvents("beforeAutoSave","afterAutoSave","beforeShowDictionary")},messageFillOtherAttribute:"doYouWantFillOtherAttr",doQueryFillOtherAttribute:!0,oncbFocus:function(){this.onFocusRawValue=this.getRawValue()},getValue:function(e){var t,n,i=this;return t=i.callParent(arguments),n=i.getRawValue(),!t&&n?-1*(new Date).getTime():t},setValue:function(e){let t,n=this,i=Ext.Array.from(e);if(n.valueModels&&n.valueModels.length>0&&i.length===n.valueModels.length){t=!0;for(let e=0;e<n.valueModels.length;e++){let o=n.valueModels[e];o=o.get(n.valueField);let r=i[e];if(Ext.isObject(r)&&r.isModel&&(r=r.get(n.valueField)),o!==r){t=!1;break}}if(t)return}n.clearIsPhantom(),n.callParent(arguments)},onBlur:function(e){var t,n,i=this,o=i.getPicker();if(i.callParent(arguments),o&&o.el&&e.relatedTarget)for(t=0,n=e.relatedTarget;t<11&&n;){if(o.el.dom===n)return(n=Ext.dom.Element.get(e.relatedTarget)).un({blur:this.onPickerBlur,scope:i}),void n.on({blur:this.onPickerBlur,scope:i});n=n.parentElement,t++}Ext.defer(i.checkOnBlur,20,i)},checkOnBlur:function(){var e,t,n,i=this,o=i.getRawValue(),r=null;if(!i.isDestroyed&&(e=i.getStore(),t=e.entityName,i.getValue()<0&&i.onFocusRawValue!==o)){if(i.store.each((function(e){if(o===e.get(i.displayField))return r=e.get(i.valueField),!1}),i),r)return void i.setValue(r);(n={})[i.displayField]=o,$App.connection.select({entity:t,fieldList:[i.valueField,i.displayField],whereList:{valExpr:{expression:"["+i.displayField+"]",condition:"equal",values:n}}}).then((function(n){if(n&&n.resultData.data.length){let t=e.add(UB.core.UBCommand.resultDataRow2Object(n),!0);return i.setValue(t[0]),!0}i.doQueryFillOtherAttribute&&$App.dialogYesNo("",UB.i18n(i.messageFillOtherAttribute,i.getFieldLabel(),$App.domainInfo.get(t,!0).getEntityCaption())).then((function(e){e&&Ext.defer((function(){this.addDictItem({caption:this.getRawValue()})}),10,i)}))}))}},addDictItem:function(){let e=this,t=e.getStore(),n=t.entityName,i=e.displayField,o={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,store:t,isModal:!0,sender:e,onClose:function(t){t&&(e.setValueById(t),e.editItemButton.setDisabled(!1))},initValue:{}};e.staticValues&&Ext.applyIf(o.initValue,e.staticValues),o.initValue[i]=e.getRawValue(),e.fieldsCloneText&&Ext.Array.from(e.fieldsCloneText,!1).forEach((function(t){o.initValue[t]=e.getRawValue()})),e.fireEvent("beforeShowDictionary",e,o),UB.core.UBApp.doCommand(o)},onBeforeSaveForm:function(e){e.push([this.orderNumber||Number.MAX_VALUE,this.onBeforeSaveFormRun.bind(this)])},onBeforeSaveFormRun:function(){let e=this,t=e.getValue();if(!t||t>0||t&&t instanceof Array&&0===t.length)return;let n=[e.displayField,e.valueField],i=e.store.ubRequest.entity,o={};return e.staticValues&&(Ext.applyIf(o,e.staticValues),n=n.concat(Object.keys(e.staticValues))),o[e.displayField]=e.getRawValue(),$App.connection.addNew({entity:i,execParams:o,fieldList:n}).then((function(t){var n,o=t.resultData.data[0],r=t.resultData.fields,a={};return r.forEach((function(e,t){a[e]=o[t]})),e.fieldsCloneText&&Ext.Array.from(e.fieldsCloneText,!1).forEach((function(t){a[t]=e.getRawValue()})),n={entity:i,execParams:a,fieldList:r},e.fireEvent("beforeAutoSave",e,n),$App.connection.insert(n).then((function(t){if(t&&t.resultData.data.length){e.editItemButton.setDisabled(!1);var n=e.getStore().add(UB.core.UBCommand.resultDataRow2Object(t),!0);e.setValue(n[0]),e.fireEvent("afterAutoSave",e,n[0])}}))}))},onValueChange:function(){let e=this.getValue(),t=!e||e<=0;this.editItemButton&&this.editItemButton.setDisabled(t)},saveItem:function(){this.onBeforeSaveFormRun()}})},2077:function(e,t,n){n(7142);const i=n(1972);Ext.define("UB.ux.form.field.UBMultiSelectBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubmultiselecbox",multiSelect:!0,initComponent:function(){var e=this;e.displayTpl='<tpl for=".">{[Ext.String.ellipsis(typeof values === "string" ? values : values["'+e.displayField+'"], 16)]}<tpl if="xindex < xcount">'+e.delimiter+"</tpl></tpl>",e.callParent(arguments),e.addEvents("itemSelected")},initContextMenu:function(){var e=this;e.callParent(arguments),e.editItemButton&&(e.editItemButton.disable(),e.editItemButton.hide()),e.showLookupButton&&(e.showLookupButton.disable(),e.showLookupButton.hide()),e.addItemButton&&(e.addItemButton.disable(),e.addItemButton.hide())},editItem:function(){},showLookup:function(){},queryDelay:500,afterRender:function(){this.callParent(arguments);let e=Ext.get(this.getInputId());e.dom.readOnly=!0},onTriggerClick:function(){var e,t,n,o,r,a,s,l,c=this,u=!1;function d(){var e=s.getSelectionModel();u=!0,a.each((function(n){var i,o=-1;(i=t.findRecord(c.valueField,n.get(c.valueField)))&&(o=t.indexOf(i)),o>=0&&e.select(o,!0,!0)}),c),u=!1}c.store.ubRequest?((l=Ext.clone(c.store.ubRequest)).orderList={byDisplayField:{expression:c.displayField,order:"ASC"}},(t=Ext.create("UB.ux.data.UBStore",{ubRequest:l,autoLoad:!1,autoDestroy:!0})).load(),t.on("load",(function(){s&&d()}))):((t=Ext.create("Ext.data.Store",{model:c.store.model,sorters:[{property:c.displayField}],proxy:{type:"memory",enablePaging:!0},autoLoad:!1,autoDestroy:!0})).load(),t.add(c.store.getRange(0,c.store.getCount()-1))),n=Ext.widget("toolbar",{dock:"bottom",border:"1 0 0 0",cls:"ub-grid-info-panel",style:"border-top-width: 1px !important;",items:[Ext.widget("tbfill"),Ext.widget("tbseparator"),c.pagingBar=Ext.create("UB.view.PagingToolbar",{isPagingBar:!0,cls:"ub-grid-info-panel",border:0,margin:0,padding:"0 0 0 5",width:180,store:t})]}),c.store.ubRequest||n.hide(),r=new Ext.util.DelayedTask((function(){""===o.getValue()?(t.filters.removeAtKey("searchTask"),t.clearFilter()):t.filter({id:"searchTask",property:c.displayField,condition:i.core.UBCommand.condition.sqlecLike,value:o.getValue()})}),c),(o=Ext.widget("textfield",{labelWidth:60,fieldLabel:i.i18n("filter")})).on("change",(function(e,t){r.delay(c.queryDelay)})),a=Ext.create("Ext.data.Store",{model:c.store.model,sorters:[{property:c.displayField}],proxy:{type:"memory"}});var f=c.getValue();if(f&&f.length>0)if(c.store.ubRequest){delete(l=Ext.clone(c.store.ubRequest)).orderList,l.whereList=l.whereList||{};var h={};h[c.valueField]=f,l.whereList["selectedItems"+Date.now()]={condition:"in",expression:"["+c.valueField+"]",values:h},Ext.create("UB.ux.data.UBStore",{ubRequest:l}).load().then((function(e){a.add(e.getRange(0,e.getCount()-1)),d()}))}else _.forEach(f,(function(e){var t=c.store.findRecord(c.valueField,e);t&&a.add(t)}));(e=Ext.create("Ext.window.Window",{padding:"5 5 0 5",height:450,width:550,modal:!0,stateful:!!c.store.ubRequest,stateId:"nultiselect_"+(c.store.ubRequest?c.store.ubRequest.entity:""),layout:"fit",title:i.i18n("selectElements")+(c.fieldLabel?" - "+c.fieldLabel:""),items:[{layout:{type:"hbox",align:"stretch"},items:[Ext.widget("grid",{xtype:"grid",hideHeaders:!0,flex:1,title:i.i18n("selectedElements"),store:a,tbar:{items:[]},columns:[{name:"id",width:25,dataIndex:c.valueField,renderer:function(e){return'<a style="color: #141b9b; cursor:pointer;" class="u-icon-close"></a>'}},{name:"name",dataIndex:c.displayField,flex:1}],listeners:{cellclick:function(e,n,i,o,r,l,u,d){if(0===i){a.remove(o);var f=-1,h=s.getSelectionModel(),p=t.findRecord(c.valueField,o.get(c.valueField));p&&(f=t.indexOf(p)),f>=0&&h.deselect(f,!0)}},scope:c}}),{xtype:"splitter"},s=Ext.widget("grid",{selModel:{selType:"checkboxmodel",checkOnly:!0,pruneRemoved:!1,showHeaderCheckbox:!0,listeners:{select:function(e,t,n){u||a.add(t)},deselect:function(e,t,n){if(!u){var i=a.findRecord(c.valueField,t.get(c.valueField));i&&a.remove(i)}},scope:c}},hideHeaders:!0,flex:1,title:i.i18n("allElements"),store:t,hideActionToolbar:!0,tbar:{items:[o]},bbar:n,columns:[{name:"name",dataIndex:c.displayField,flex:1}]})]}],buttons:[{text:i.i18n("clear"),iconCls:"u-icon-eraser",handler:function(){a.removeAll(),u=!0,s.getSelectionModel().deselectAll(!0),u=!1}},{text:i.i18n("selectAll"),tooltip:i.i18n("selectAllOnPage"),handler:function(){var e=s.getSelectionModel(),t=[];e.selectAll(!0),e.selected.each((function(e){a.findRecord(c.valueField,e.get(c.valueField))||t.push(e)})),a.add(t)}},{xtype:"panel",flex:1},{text:i.i18n("ok"),iconCls:"u-icon-check",handler:function(){c.setValue(a.getRange(0,a.getCount()-1)),e.close(),c.fireEvent("itemSelected",c)}},{text:i.i18n("cancel"),iconCls:"u-icon-close",handler:function(){e.close()}}]})).center(),e.show(),d(),e.on("close",(function(){r.cancel()}))},setValueById:function(e,t,n,o){var r=this;if(Ext.isEmpty(e))return t&&r.resetOriginalValue(),void(n&&Ext.callback(n,o||r,[r]));var a=r.getStore();function s(i,s){r.setValue(s?null:i||e),t&&r.resetOriginalValue(),a.resumeEvent("clear"),r.lastQuery=null,n&&Ext.callback(n,o||r,[r])}a.on({load:{fn:function(){if(0===a.getCount()){var t=$App.domainInfo.get(r.getEntity());t.hasMixin("mStorage")&&t.mixin("mStorage").safeDelete||t.hasMixin("dataHistory")?$App.connection.select({entity:r.getEntity(),fieldList:a.ubRequest.fieldList,__allowSelectSafeDeleted:!0,ID:e}).then((function(e){if(!a.isDestroyed){var t=Ext.create(a.model);i.ux.data.UBStore.resultDataRow2Record(e,t)?(i.ux.data.UBStore.resetRecord(t),a.add(t,!0),s(t),r.fieldCls+=" ub-combo-deleted",r.rendered&&Ext.get(r.getInputId()).addCls("ub-combo-deleted"),r.phantomSelectedElement=!0,r.tipPhantomElement=Ext.create("Ext.tip.ToolTip",{target:r.getInputId(),html:i.i18n("elementIsNotActual")})):s(null,!0)}})):s(null,!0)}else 1===a.getCount()?s(a.getAt(0)):s()},single:!0}}),a.suspendEvent("clear"),a.filter(new Ext.util.Filter({id:r.userFilterId,root:"data",property:"ID",condition:e&&Array.isArray(e)?"in":"equal",value:e}))},onDestroy:function(){this.tipPhantomElement&&this.tipPhantomElement.destroy(),this.callParent(arguments)}})},2842:function(){Ext.define("UB.ux.form.field.UBText",{extend:"Ext.form.field.Trigger",alias:"widget.ubtextfield",triggerCls:"ub-multilang-trigger",initComponent:function(){var e=this,t=[];e.hideTrigger=!e.isMultiLang,e.hideTrigger&&(e.componentLayout="field"),t.push({text:UB.i18n("editMultiLang"),handler:e.showMultiLangForm,scope:e}),e.contextMenu=Ext.create("Ext.menu.Menu",{items:t}),e.callParent(arguments)},getSubTplMarkup:function(e){var t=this;return t.hideTrigger?t.getTpl("fieldSubTpl").apply(this.getSubTplData()):t.callParent(arguments)},initTrigger:function(){var e=this;e.hideTrigger||e.callParent(arguments)},onTriggerClick:function(){this.showMultiLangForm()},setAllowBlank:function(e){this.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments),e.isMultiLang&&(e.triggerEl&&e.triggerEl.set({"data-qtip":UB.i18n("isMultilangTip")}),e.getEl().on("contextmenu",e.showContextMenu,e))},showContextMenu:function(e){e.stopEvent(),this.contextMenu.showAt(e.getXY())},showMultiLangForm:function(){var e,t,n,i=this,o=["ID"],r={},a=[];function s(){_.forEach(UB.appConfig.supportedLanguages,(function(e){$App.connection.userLang()!==e&&n.hasOwnProperty(i.attributeName+"_"+e+"^")&&(r[e].setValue(n[i.attributeName+"_"+e+"^"]),r[e].resetOriginalValue())}))}function l(){var n={};t.down("form").isValid()&&(_.forEach(UB.appConfig.supportedLanguages,(function(e){$App.connection.userLang()!==e&&r[e].isDirty()&&(n[i.attributeName+"_"+e+"^"]=r[e].getValue())})),e.addExtendedDataForSave(n),e.lockOnSave||e.entityLocked||e.isNewInstance||!e.formDataReady||e.isSaveProcess||e.hasPersistLock||e.setEntityLocked(),i.nationalFieldEdited=!0,t.close())}(e=i.up("basepanel"))&&i.attributeName&&(_.forEach(UB.appConfig.supportedLanguages,(function(e){$App.connection.userLang()!==e&&(o.push(i.attributeName+"_"+e+"^"),r[e]=Ext.create(Ext.getClassName(i),{fieldLabel:UB.i18n(e),allowBlank:i.allowBlank,readOnly:i.readOnly||i.disabled,labelStyle:"word-break: 'break-all'; word-wrap: 'break-word';",labelWidth:120,rows:i.rows}),a.push(r[e]))})),n=e.getExtendedDataForSave(),e.instanceID?$App.connection.select({entity:e.entityName,method:"select",fieldList:o,ID:e.instanceID}).then(UB.LocalDataStore.selectResultToArrayOfObjects).then((function(e){var t=e&&e.length>0?e[0]:{};_.forEach(UB.appConfig.supportedLanguages,(function(e){$App.connection.userLang()!==e&&(r[e].setValue(t[i.attributeName+"_"+e+"^"]),r[e].resetOriginalValue())})),s()})):s(),(t=Ext.create("UB.view.BaseWindow",{title:i.fieldLabel,height:250,width:500,modal:!0,stateful:!0,stateId:"ubLangForm_"+e.entityCode+"_"+i.attributeName,layout:{type:"fit"},items:[{overflowX:"auto",overflowY:"auto",xtype:"form",padding:5,layout:{type:"vbox",align:"stretch"},items:a}],buttons:[{text:UB.i18n("Change"),iconCls:"u-icon-save",hidden:i.readOnly||i.disabled,handler:l,scope:i},{text:UB.i18n("cancel"),iconCls:"u-icon-close",handler:function(){t.close()}}]})).on("boxready",(function(){t.actionsKeyMap={},t.actionsKeyMap.saveAndClode=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:Ext.EventObject.ENTER,ctrl:!0,shift:!1,fn:function(){l()}}]})})),t.show())}})},3906:function(e,t,n){n(2842),Ext.define("UB.ux.form.field.UBTextArea",{extend:"UB.ux.form.field.UBText",alias:["widget.ubtextareafield","widget.ubtextarea"],requires:["Ext.XTemplate","Ext.layout.component.field.TextArea","Ext.util.DelayedTask"],fieldSubTpl:['<textarea id="{id}" role="{role}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {inputCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}],getSubTplMarkup:function(e){var t=this,n=e.childElCls,i=t.getTpl("fieldSubTpl").apply(this.getSubTplData());return t.hideTrigger?this.getTpl("fieldSubTpl").apply(this.getSubTplData()):['<table id="',t.id,'-triggerWrap" class="',Ext.baseCSSPrefix,"form-trigger-wrap ub-textarea-wrap",n,'" cellpadding="0" cellspacing="0" role="presentation">','<tbody role="presentation">','<tr role="presentation">','<td id="',t.id,'-inputCell" class="',Ext.baseCSSPrefix,"form-trigger-input-cell",n,'" role="presentation">',i,"</td>",t.getTriggerMarkup(),"</tr>","</tbody>","</table>"].join("")},getTriggerMarkup:function(){var e=this;return e.hideTrigger?"":e.callParent(arguments)},initTrigger:function(){var e=this;e.hideTrigger||e.callParent(arguments)},growMin:60,growMax:1e3,growAppend:"\n-",cols:20,rows:4,enterIsSpecial:!1,preventScrollbars:!1,componentLayout:"textareafield",setGrowSizePolicy:Ext.emptyFn,returnRe:/\r/g,inputCls:Ext.baseCSSPrefix+"form-textarea",getSubTplData:function(){var e=this,t=e.getFieldStyle(),n=e.callParent();return e.grow&&e.preventScrollbars&&(n.fieldStyle=(t||"")+";overflow:hidden;height:"+e.growMin+"px"),Ext.applyIf(n,{cols:e.cols,rows:e.rows}),n},afterRender:function(){var e=this;e.callParent(arguments),e.needsMaxCheck=e.enforceMaxLength&&e.maxLength!==Number.MAX_VALUE&&!Ext.supports.TextAreaMaxLength,e.needsMaxCheck&&e.inputEl.on("paste",e.onPaste,e)},transformRawValue:function(e){return this.stripReturns(e)},transformOriginalValue:function(e){return this.stripReturns(e)},getValue:function(){return this.stripReturns(this.callParent())},valueToRaw:function(e){return e=this.stripReturns(e),this.callParent([e])},stripReturns:function(e){return e&&"string"==typeof e&&(e=e.replace(this.returnRe,"")),e},onPaste:function(e){var t=this;t.pasteTask||(t.pasteTask=new Ext.util.DelayedTask(t.pasteCheck,t)),t.pasteTask.delay(1)},pasteCheck:function(){var e=this,t=e.getValue(),n=e.maxLength;t.length>n&&(t=t.substr(0,n),e.setValue(t))},fireKey:function(e){var t=this,n=e.getKey();e.isSpecialKey()&&(t.enterIsSpecial||n!==e.ENTER||e.hasModifier())&&t.fireEvent("specialkey",t,e),!t.needsMaxCheck||n===e.BACKSPACE||n===e.DELETE||e.isNavKeyPress()||t.isCutCopyPasteSelectAll(e,n)||t.getValue().length>=t.maxLength&&e.stopEvent()},isCutCopyPasteSelectAll:function(e,t){return!!e.ctrlKey&&(t===e.A||t===e.C||t===e.V||t===e.X)},autoSize:function(){var e,t=this;t.grow&&t.rendered&&(t.updateLayout(),(e=t.inputEl.getHeight())!==t.lastInputHeight&&(t.fireEvent("autosize",t,e),t.lastInputHeight=e))},beforeDestroy:function(){var e=this.pasteTask;e&&(e.cancel(),this.pasteTask=null),this.callParent()}})},9479:function(){Ext.define("UB.ux.tree.Column",{extend:"Ext.grid.column.Column",alias:"widget.ubtreecolumn",tdCls:Ext.baseCSSPrefix+"grid-cell-treecolumn",autoLock:!0,lockable:!1,draggable:!1,hideable:!1,textCls:"",innerCls:"ub_tree_inner-col",isTreeColumn:!0,cellTpl:['<tpl for="lines">','<span class="{parent.lineCLS}{#}" ></span>',"</tpl>",'<tpl if="iconCls">','<span class="ub_tree_icon ub_tree_depth ub_tree_depth_{depth} {iconCls}"></span>',"</tpl>",'<span class="ub_tree_text ub_tree_depth ub_tree_depth_{depth} ','<tpl if="isNode">ub_tree_text_group</tpl>',' {textCls}">{value}</span>','<tpl if="isNode"><span class=','"ub_tree_group ub_tree_depth ub_tree_depth_{depth} fa <tpl if="expanded">fa-caret-down<tpl else>fa-caret-right</tpl>"',"></span>",'<tpl else><span class="ub_tree_group ub_tree_depth ub_tree_depth_{depth}"></tpl>'],initComponent:function(){const e=this;let t=e.renderer;"string"==typeof t&&(t=Ext.util.Format[t]),e.origRenderer=t,e.origScope=e.scope||window,e.renderer=e.treeRenderer,e.scope=e,e.callParent()},treeRenderer:function(e,t,n,i,o,r,a){const s=n.get("cls");s&&(t.tdCls+=" "+s);const l=this.initTemplateRendererData(e,t,n,i,o,r,a);return this.getTpl("cellTpl").apply(l)},initTemplateRendererData:function(e,t,n,i,o,r,a){const s=this,l=s.origRenderer,c=n.data;let u=n.parentNode;const d=a.rootVisible,f=a.showTreeLines,h=[];let p;for(;u&&u.data.depth>0;)p=u.data,h[d?p.depth:p.depth-1]=p.isLast?0:1,u=u.parentNode;return{record:n,baseIconCls:s.iconCls,iconCls:c.iconCls,icon:c.icon,checkboxCls:s.checkboxCls,checked:c.checked,elbowCls:s.elbowCls,expanderCls:s.expanderCls,textCls:s.textCls,leaf:c.leaf,expanded:c.expanded,isNode:n.hasChildNodes(),depth:n.getDepth(),expandable:n.isExpandable(),isLast:c.isLast,blankUrl:Ext.BLANK_IMAGE_URL,href:c.href,hrefTarget:c.hrefTarget,lines:h,metaData:t,childCls:s.getChildCls?s.getChildCls()+" ":"",lineCLS:f?"ub_tree_line_visible ub_tree_line_visible":"ub_tree_line ub_tree_line",value:l?l.apply(s.origScope,arguments):e}}})},5122:function(e,t,n){n(2842),n(3906),n(5658),n(4318),n(561),n(8230),n(7937),n(4979),n(8595),n(9074),n(7355),n(7646),n(9516),n(4377),n(4353),n(5642),n(9599),n(7959),n(4933),n(5998),n(8541),n(6814),n(7093),n(666),n(1962),n(9479);const i=n(6486),o=n(1972);Ext.define("UB.view.BasePanel",{extend:"Ext.form.Panel",alias:"widget.basepanel",border:!1,uses:["UB.core.UBAppConfig","UB.core.UBStoreManager","UB.core.UBUtil","UB.core.UBService","UB.core.UBCommand","UB.core.UBApp","UB.view.StatusWindow"],bodyPadding:0,isBasePanel:!0,statics:{defaultUBName:"ubName",actionId:{save:"save",saveAndClose:"saveAndClose",fDelete:"fDelete",refresh:"refresh",scan:"scan",attach:"attach",deleteAttachment:"deleteAttachment",showVersions:"showVersions",accessRight:"accessRight",audit:"audit",history:"history",formConstructor:"formConstructor",downloadAttach:"downloadAttach",lock:"lock",unLock:"unLock"},eventId:{save:"save",fDelete:"fDelete",refresh:"refresh",scan:"scan",attach:"attach",deleteattachment:"deleteattachment",showVersions:"showVersions",accessRight:"accessRight",audit:"audit",history:"history",formConstructor:"formConstructor",downloadAttach:"downloadAttach",lock:"lock",unLock:"unLock"},hotKeys:{saveAndClose:{key:Ext.EventObject.ENTER,shift:!1,ctrl:!0,text:" (Ctrl+Enter)"},save:{key:Ext.EventObject.S,ctrl:!0,shift:!1,text:" (Ctrl+S)"},fDelete:{key:Ext.EventObject.DELETE,ctrl:!0,shift:!1,text:" (Ctrl+DELETE)"},refresh:{ctrl:!0,shift:!1,key:Ext.EventObject.R,text:" (Ctrl+R)"}},markFieldLabelAsMandatory:function(e){return e+'<span class="ub-view-marked-field-label">*</span>'}},mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},overflowX:!0,overflowY:!0,bodyStyle:"padding: 5px 0 0 0",cls:"ub-basepanel",switchSaveButtonsAction:!1,isNewInstance:!0,record:null,postOnlySimpleAttributes:!1,formWasSaved:!1,lockOnSave:!1,initComponent:function(){let e=this;function t(t){t||Ext.suspendLayouts();try{e.enableBinder(),e.initUBComponentFired||Ext.callback(e.initUBComponent,e),e.initUBComponentFired=!0,e.isDestroyed||e.fireEvent("formDataReady")}finally{t||Ext.resumeLayouts(!0)}e.unmaskForm()}function n(){e.startHideDone||(e.items.each((function(e){e.oldHidden||e.setVisible(!0),e.hideMode=e.oldHideMode,delete e.oldHidden,delete e.oldHideMode})),e.startHideDone=!0)}e.dfm&&e.dfm.parentConfig&&Ext.apply(e,e.dfm.parentConfig),e.formDataReady=!1,e.domainEntity=$App.domainInfo.get(e.entityName),e.entityMethods=e.domainEntity.entityMethods,e.isNewInstance=!(e.instanceID&&!e.addByCurrent),e.isEditMode=!e.isNewInstance,e.addByCurrent&&(e.addByCurrentInstanceID=e.instanceID),e.documents={},e.domainEntity.filterAttribute({dataType:"Document"}).forEach((t=>{e.documents[t.code]=t})),e.documentsCount=Object.keys(e.documents).length,e.hasDataHistoryMixin=e.domainEntity.hasMixin("dataHistory"),e.hasAuditMixin=e.domainEntity.hasMixin("audit"),e.hasHardSecurityMixin=e.domainEntity.hasMixin("aclRls"),e.isEntityLockable=e.domainEntity.hasMixin("softLock"),e.hasEntityALS=e.domainEntity.hasMixin("als"),e.addItems(),e.fieldList=e.getFieldList(),e.startLoadFormData(),e.preprocessPanel(),e.tabID&&(e.dockedItems||(e.dockedItems=[]),e.headerPanel=Ext.create("Ext.panel.Header",{border:0,padding:"3 3 3 8",isHeader:!0,layout:"hbox",height:25,dock:"top",cls:"ub-toolbar-header",bodyCls:"ub-toolbar-header",title:e.title||""}),e.headerPanel.titleCmp.setHeight(25),e.dockedItems.splice(0,0,e.headerPanel)),e.initComponentStart&&"function"==typeof e.initComponentStart&&Ext.callback(e.initComponentStart,e),e.callParent(arguments),e.initUBControlMap(),e.fields.forEach((function(e){e.getFieldLabel&&(e.originalFieldLabel=e.getFieldLabel())})),e.details=e.getDetails(),e.addEvents("recordloaded","beforesave","manualsaving","aftersave","afterdelete","formDataReady","beforeSaveForm","beforeDelete","beforeClose","updateFields","controlChanged","initComponentDone","dataBind","beforeRefresh"),e.on("destroy",e.onFormDestroy,e),e.on("close",e.onPanelClose,e),e.on("boxready",(function(){var t=e.getFormWin();t&&e.mon(t,"close",e.onPanelClose,e),e.formDataReady||e.getEl().mask(o.i18n("loadingData"))})),e.record=o.ux.data.UBStore.createRecord(e.entityName,e.fieldList),e.record.store.on("update",e.onRecordUpdate,e),e.binder=Ext.create("UB.view.FormDataBinder",{panel:e}),e.binder.on("controlChanged",e.controlChanged,e),e.binder.on("formDataReady",(function(){e.formDataReady=!0,Ext.suspendLayouts();try{e.rendered?t(!0):e.on("afterrender",t,e,{single:!0}),n()}finally{Ext.resumeLayouts(!0)}if(!e.isDestroyed){var i=e.getEl();i&&i.unmask()}})),e.binder.on("dataBind",(function(){e.fireEvent("dataBind",e.record)}),e),this.updateActions("init"),e.initComponentDone&&i.isFunction(e.initComponentDone)&&Ext.callback(e.initComponentDone,e),e.fireEvent("initComponentDone",e)},createForm:function(){for(var e,t={},n=this.basicFormConfigs,i=n.length,r=0;r<i;++r)t[e=n[r]]=this[e];return new o.view.UBForm(this,t)},setInstanceID:function(e){this.instanceID=e,this.isEditMode=!!this.instanceID,this.addByCurrent=!1},getInstanceID:function(){return this.instanceID||this.record.get("ID")},isFormDirty:function(e){return this.record.dirty||this.extendedDataForSave&&Object.keys(this.extendedDataForSave).length>0},onRecordUpdate:function(e,t){let n=this;if(n.record!==t)return;if(n.isInnerChangingRecord)return;let i=n.isFormDirty();(!n.fireDirty&&i||n.fireDirty&&!i)&&(n.fireDirty=!n.fireDirty,this.updateActions())},disableBinder:function(){this.isInnerChangingRecord=!0,this.binder.isInnerChangingRecord=!0},enableBinder:function(){this.isInnerChangingRecord=!1,this.binder.isInnerChangingRecord=!1},onPanelClose:function(){let e=this;e.onClose&&"function"==typeof e.onClose&&(e.isDeleted?e.onClose(null,e.store,e.formWasSaved,e.record):e.onClose(e.isNewInstance?null:e.instanceID,e.store,e.formWasSaved,e.record)),e.fireEvent("beforeClose",e)},getFormWin:function(){return this.formWin||(this.formWin=this.up("window")),this.formWin},onFormDestroy:function(){this.entityLocked&&this.deleteLock(),this.deleteInstanceID(),o.view.UBDropZone&&o.view.UBDropZone.un("configureDropZone",this.onFileDragDropConfigure,this),this.binder&&this.binder.destroy()},controlChanged:function(e,t,n){var i=this;i.lockOnSave||i.entityLocked||i.isNewInstance||!i.formDataReady||i.isSaveProcess||i.hasPersistLock||i.setEntityLocked(),i.fireEvent("controlChanged",e,t,n)},addPersistLock:function(){var e,t=this,n=t.getInstanceID(),i=t.entityName;return t.isEntityLockable?("ID"!==t.domainEntity.mixins.softLock.lockIdentifier&&((e=t.domainEntity.mixins.softLock.lockIdentifier.split(".")).length>0&&(e=e[0]),i=t.domainEntity.attr(e).associatedEntity,n=t.record.get(e)),$App.connection.run({method:"isLocked",entity:i,ID:n}).then((function(e){if(t.onGetLockInfo(e),e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType&&(!t.lockCtx||!t.entityLocked))throw new o.UBError(o.i18n("tempLockExistForThisUser"));return $App.connection.run({method:"lock",lockType:"ltPersist",entity:i,ID:n})})).then((function(e){e.resultLock&&e.resultLock.success&&(t.clearLockCtx(),t.onGetLockInfo({lockInfo:e.resultLock.lockInfo}))}))):Promise.resolve(!1)},removePersistLock:function(){var e,t=this,n=t.getInstanceID(),i=t.entityName;return t.isEntityLockable?("ID"!==t.domainEntity.mixins.softLock.lockIdentifier&&((e=t.domainEntity.mixins.softLock.lockIdentifier.split(".")).length>0&&(e=e[0]),i=t.domainEntity.attr(e).associatedEntity,n=t.record.get(e)),$App.connection.run({method:"isLocked",entity:i,ID:n}).then((function(e){if(e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType&&(!t.lockCtx||!t.entityLocked))throw new o.UBError(o.i18n("tempLockExistForThisUser"));if(e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType)throw new Error("Can not delete temporary lock");return $App.connection.run({method:"unlock",lockType:"ltPersist",entity:i,ID:n})})).then((function(e){e.resultLock&&e.resultLock.success&&t.onGetLockInfo()}))):Promise.resolve(!1)},onGetLockInfo:function(e){this.record.lockInfo=e&&e.lockInfo||{};let t=this.record.lockInfo;this.hasPersistLock=(t.isLocked||t.lockExists)&&"Persist"===t.lockType&&t.lockUser===$App.connection.userLogin(),this.updateLockButton()},setEntityLocked:function(){var e,t,n,i,r=this,a=r.getInstanceID(),s=r.entityName;return!r.isEntityLockable||r.lockingProcessStarted?Promise.resolve(!0):(r.lockingProcessStarted=!0,r.hasPersistLock?Promise.resolve(!1):("ID"!==r.domainEntity.mixins.softLock.lockIdentifier&&((i=r.domainEntity.mixins.softLock.lockIdentifier.split(".")).length>0&&(i=i[0]),s=r.domainEntity.attr(i).associatedEntity,a=r.record.get(i)),$App.connection.run({method:"isLocked",entity:s,ID:a}).then((function(i){return r.onGetLockInfo(i),!r.hasPersistLock&&(r.isNewInstance?(t={},r.initValue&&Ext.applyIf(t,r.initValue),r.parentContext&&Ext.applyIf(t,r.parentContext),e={method:"addnew",entity:r.entityName,execParams:t,fieldList:r.fieldList,lockType:"ltTemp"},n=$App.connection.addNew(e)):(e={entity:r.entityName,fieldList:["ID","mi_modifyDate"],lockType:"ltTemp",ID:r.instanceID},r.formRequestConfig("select",e),n=$App.connection.select(e)),n.catch((function(e){throw r.entityLocked=!1,e})).then((function(e){if(!e.resultLock.success)throw r.entityLocked=!1,new o.UBError(o.i18n("doNotGetLock",e.resultLock.lockUser,Math.floor((new Date-e.resultLock.lockTime)/1e3)));return r.isNewInstance||r.record.get("mi_modifyDate").getTime()===e.resultData.data[0][e.resultData.fields.indexOf("mi_modifyDate")].getTime()?(r.lockCtx=o.ux.LockManager.addLock({lockIdentifier:e.resultLock.lockID,entity:r.entityName,instance:e.resultLock.lockValue?e.resultLock.lockValue:r.record,onLockLoss:function(){r.lockCtx&&o.ux.LockManager.deleteLock(r.lockCtx),r.removeEntityLock(),r.lockCtx=null,r.updateLockButton()},scope:r}),r.entityLocked||(r.record.resultLock=e.resultLock,r.entityLocked=!0),r.updateLockButton(),r.updateActions("entityRequiredLock",!1),!0):(r.entityLocked=!0,r.deleteLock(!0).then((function(){throw new o.UBError("changedByAnotherUserForLock")})))})).finally((function(){r.lockingProcessStarted=!1})))}))))},updateLockButton:function(){var e,t,n=this;n.isDestroyed||(n.entityLocked||n.hasPersistLock||n.record.lockInfo?(n.lockButton||((t=n.getHeader())||(e=n.getFormWin())&&(t=e.getHeader()),n.headerPanel&&(t=n.headerPanel),t&&(n.lockButton=t.insert(1,{xtype:"label",style:{fontWeight:"bold"},text:o.i18n("entityLockedOwn")}))),n.lockButton?.removeCls("ub-persistlockinfo"),n.hasPersistLock?(n.lockButton.addCls("ub-persistlockinfo"),n.lockButton.setText(o.i18n("persistLockInfo",n.record.lockInfo.lockUser,Ext.Date.format(new Date(n.record.lockInfo.lockTime),"d.m.Y H:i:s"))),n.lockButton.show()):n.entityLocked?(n.lockButton.setText(o.i18n("entityLockedOwn")),n.lockButton.show()):n.record.lockInfo&&n.record.lockInfo.lockExists&&"Temp"===n.record.lockInfo.lockType?o.ux.LockManager.existLock(n.entityName,n.record.lockInfo.lockValue)||(n.lockButton.setText(o.i18n("tempSoftLockInfo",n.record.lockInfo.lockUser,Ext.Date.format(new Date(n.record.lockInfo.lockTime),"d.m.Y H:i:s"))),n.lockButton.show()):n.record.lockInfo&&n.record.lockInfo.lockExists&&"Persist"===n.record.lockInfo.lockType?(n.lockButton.setText(o.i18n("softLockInfo",n.record.lockInfo.lockUser,Ext.Date.format(new Date(n.record.lockInfo.lockTime),"d.m.Y H:i:s"))),n.lockButton.show()):n.lockButton?.isVisible&&n.lockButton.isVisible()&&n.lockButton.hide(),n.hasPersistLock?(n.actions.unLock.show(),n.actions.lock.hide()):(n.actions.unLock.hide(),n.entityLocked||n.actions.lock.show())):n.lockButton&&n.lockButton.isVisible()&&n.lockButton.setVisible(!1))},removeEntityLock:function(){this.isEntityLockable&&(this.entityLocked=!1,this.updateLockButton(),this.updateActions("entityRequiredLock",!0))},clearLockCtx:function(){var e=this;e.isEntityLockable&&e.entityLocked&&e.lockCtx&&(e.entityLocked=!1,o.ux.LockManager.deleteLock(e.lockCtx),e.lockCtx=null)},deleteLock:function(e){var t=!1,n=this;if(n.hasPersistLock||n.startDeleteLock||!n.isEntityLockable||!n.entityLocked)return Promise.resolve(!1);let i=n.getInstanceID(),r=n.entityName;if("ID"!==n.domainEntity.mixins.softLock.lockIdentifier){let e=n.domainEntity.mixins.softLock.lockIdentifier.split(".");e.length>0&&(e=e[0]),r=n.domainEntity.attr(e).associatedEntity,i=n.record.get(e)}n.startDeleteLock=!0;let a=Promise.resolve(n.isEntityLockable&&n.entityLocked);return $App.connection.run({method:"isLocked",entity:r,ID:i}).then((function(s){return n.onGetLockInfo(s),!n.hasPersistLock&&(n.isEntityLockable&&n.entityLocked&&(n.lockCtx&&(n.entityLocked=!0,t=o.ux.LockManager.deleteLock(n.lockCtx),n.lockCtx=null),n.entityLocked&&(t||e)&&(a=a.then((function(){return $App.connection.run({entity:r,method:"unlock",ID:i}).then((function(e){return n.record.lockInfo=e&&e.resultLock&&e.resultLock.lockInfo?e.resultLock.lockInfo:{},!(!e||!e.resultLock)&&e.resultLock.success}))})))),delete n.startDeleteLock,a.then((function(e){return n.removeEntityLock(),e})))}))},setTitle:function(e,t){let n=this;n._formFullTitle=t,n._formTitle=e;let i=n.getFormWin();i?i.setTitle(t||e):(n.headerPanel&&(n.headerPanel.setTitle(t||e),n.placeholder&&n.placeholder.setTooltip&&n.placeholder.setTooltip(e)),n.callParent(arguments))},getFormTitle:function(){let e=this,t=e.getFormWin();return e._formFullTitle||e._formTitle||e.title||(t?t.title:null)||(e.placeholder?e.placeholder.title:null)},addNewVersionToTitle:function(){var e=this;e.on("afterrender",(function(){e.setTitle(e._formTitle,o.format("{0} ({1} {2})",e._formFullTitle||e._formTitle,o.i18n("novajaVersija"),Ext.Date.format(e.__mip_ondate,"d.m.Y")))}),e,{single:!0})},enableEdit:function(){let e=this.fields;for(let t=0,n=e.length;t<n;++t)e[t].setReadOnly&&Ext.isDefined(e[t].initialReadOnly)&&!e[t].initialReadOnly&&e[t].setReadOnly(!1)},disableEdit:function(){let e=this.fields;for(let t=0,n=e.length;t<n;++t)e[t].setReadOnly&&e[t].setReadOnly(!0)},getCanEdit:function(){let e=this;return Ext.isDefined(e.isEditable)?e.isEditable():!Ext.isDefined(e.canEdit)||e.canEdit},setupParentContainer:function(){let e=this;e.isDetail&&(e.target.ownerCt.mainEntityGridPanel.on("parentchange",e.onParentChange,e),e.mainEntityGridPanel=e.target.ownerCt.mainEntityGridPanel,e.on("close",(function(){var t=e.up("tabpanel");t&&t.isMainTabPanel||(t&&1===t.items.getCount()&&(t.relatedSplitter.hide(),t.hide(),t.ownerCt.doLayout()),t.mainPanel.mainEntityGridPanel.onDetailClose(e.entityName))}),e))},onParentChange:function(e){var t,n=this;t=function(){n.oldParentID!==n.newParentID&&(n.refreshInProgress=!0,n.setInstanceID(n.newParentID),n.loadInstance())},n.reloadTimeoutID&&(clearTimeout(n.reloadTimeoutID),n.reloadTimeoutID=null),n.newParentID=e,n.oldParentID=n.instanceID,n.isNewInstance=!1,n.reloadTimeoutID=setTimeout(t,700)},initFields:function(){var e,t,n,r=this,a=Ext.ComponentQuery.query(":focusable",r),s=r.fields,l=s.length,c=r.getCanEdit(),u=null;for((t=s[0])&&t.isMasterLink&&(r.masterForm=r.getMasterForm(t),r.masterForm&&(c=Ext.isDefined(r.isEditable)?r.isEditable():r.masterForm.getCanEdit())),r.canEdit=c,e=0;e<l;++e)(t=s[e]).initialReadOnly=t.readOnly,c||t.setReadOnly&&t.setReadOnly(!0),r.canFocus(t=s[e])&&-1!==a.indexOf(t)&&!Ext.isDefined(t.checked)&&(t.addListener("keydown",r.preventDefaultKeys,r),t.enableKeyEvents=!0),u||(u=t),t.minVal&&(t.minValue=i.isFunction(t.minVal)?t.minVal(r,t):t.minVal),t.maxVal&&(t.maxValue=i.isFunction(t.maxVal)?t.maxVal(r,t):t.maxVal),!r.isEditMode&&c&&Ext.isDefined(t.defaultValue)&&(n=t.defaultValue,r.setFieldValue(t,i.isFunction(n)?n(r,t):n));r.firstControl=u,(t=r.down("tabpanel"))&&t.addListener("tabchange",r.onTabChange,r),u&&document.activeElement!==u.getEl()&&r.focusControl(u),r.instanceID&&(o.view.activeForm||(o.view.activeForm=[]),o.view.activeForm[r.instanceID]=r),r.setupParentContainer()},getMasterForm:function(e){return o.view.activeForm?o.view.activeForm[this.record.get(e.attributeName)]:null},getEntityGridPanel:function(e){return e instanceof o.view.EntityGridPanel?e:e.down("entitygridpanel")},setFieldValue:function(e,t){Ext.isArray(e.fieldList)?e.setValueById(t):(e.setValue(t),this.isEditMode&&e.resetOriginalValue())},makeGridReadonly:function(e,t){var n;return!!(n=this.getEntityGridPanel(e))&&(n.actions[o.view.EntityGridPanel.actionId.addNew].setDisabled(t),n.actions[o.view.EntityGridPanel.actionId.addNewByCurrent].setDisabled(t),n.actions[o.view.EntityGridPanel.actionId.del].setDisabled(t),!0)},makeGridEditable:function(e,t){var n;return!!(n=this.getEntityGridPanel(e))&&(n.actions[o.view.EntityGridPanel.actionId.edit].setDisabled(!t),t||n.suspendEvent("itemdblclick"),!0)},getGrids:function(){let e=this.query("ubdetailgrid")||[],t=this.query("tabpanel");if(t)for(let n=0,i=t.length;n<i;++n)e=e.concat(t[n].query("ubdetailgrid"));return e},onControlFocused:function(e){e.enableKeyEvents||(e.addListener("keydown",this.preventDefaultKeys,this),e.enableKeyEvents=!0)},canFocus:function(e){var t="gridview"===e.xtype;return!(t=t||e&&(!e.readOnly||!this.canEdit)&&("x-field"===e.componentCls||e.isFocusableField)&&e.container&&!e.ownerCt.gridOwner)||e.myFocusHandlerActive||Ext.isDefined(e.checked)||e.ownerCt.gridOwner||(e.addListener("focus",this.onControlFocused,this),e.myFocusHandlerActive=!0),t},focusFirst:function(e){var t,n,i,o,r=this,a=-1;if(!e)return!1;for(n=(t=Ext.isArray(e)?e:Ext.ComponentQuery.query(":focusable",e)).length;++a<n;)if(r.canFocus(t[a]))return r.focusControl(t[a]),t[a];return n>0&&(i=t[0].up("tabpanel"))&&(o=i.getActiveTab().down("gridview"))?(r.focusControl(o,500),o):null},activateNextTab:function(e,t){var n=e.getActiveTab(),i=e.items.items,o=i.indexOf(n)+(t?-1:1);return o===i.length?o=0:-1===o&&(o=i.length-1),e.setActiveTab(o),i[o]},onTabChange:function(e,t){this.focusFirst(t)},collapseControl:function(e){e&&i.isFunction(e.collapse)&&e.collapse()},frameControl:function(e){e&&e.el&&e.el.frame("#668AB8",1,{duration:500})},preventDefaultKeys:function(e,t){var n,o,r,a,s=this,l=t.shiftKey,c=null,u=null,d=0;switch(t.getKey()){case Ext.EventObject.TAB:t.stopEvent(),r=(o=Ext.ComponentQuery.query(":focusable",this)).length;do{this.canFocus(n=o[d])&&(c||(c=n),u=n)}while(++d<r);if(e===(l?c:u)){if(e&&e.ownerCt.gridOwner&&(n=e.ownerCt.gridOwner.down("gridview"))){s.focusControl(n,500);break}s.focusControl(l?u:c)}else for(d=o.indexOf(e)+(a=l?-1:1);d>=0&&d<r;){if(this.canFocus(n=o[d])){this.focusControl(n);break}d+=a}break;case Ext.EventObject.DELETE:e.readOnly&&t.stopEvent();break;case Ext.EventObject.BACKSPACE:if(e.readOnly){t.stopEvent();break}t.ctrlKey&&(t.stopEvent(),i.isFunction(e.clearValue)?e.clearValue():e.setValue(""));break;case Ext.EventObject.F5:t.stopEvent();break;case Ext.EventObject.X:t.altKey&&(t.stopEvent(),s.closeWindow(!0));break;case Ext.EventObject.Q:t.ctrlKey&&(t.stopEvent(),s.switchTabs(e,t.shiftKey))}},switchTabs:function(e,t){let n=this,i=e.up("tabpanel");if(!t||!i)if(i)n.activateNextTab(i,!1);else{if(!(i=n.down("tabpanel")))return;i.getActiveTab()}},focusControl:function(e,t){var n,o,r=!1;if(e&&this.canFocus(e)&&i.isFunction(e.focus)&&(n=e.getFocusEl(),r=n&&n.dom&&n.dom.select,t?setTimeout((function(){e.focus(r,!1)}),t):e.focus(!0,!0),"gridview"===e.xtype)){e.focus(r,!1);var a=e.up("entitygridpanel");if(a){var s=a.getSelectionModel();o=a.getStore(),s&&s.getSelection().length<1&&o&&o.getCount()&&!o.isDestroyed&&s.select(0,!0)}}},setActionDisabled:function(e,t){var n,i=this.actions[e];this.actionsKeyMap&&(n=this.actionsKeyMap[e]),i&&i.setDisabled(t),n&&n.setDisabled(t)},updateActions:function(e,t){var n,i,r,a,s=this,l=this.actions[o.view.BasePanel.actionId.save],c=this.actions[o.view.BasePanel.actionId.saveAndClose],u=this.actions[o.view.BasePanel.actionId.fDelete],d=this.actions[o.view.BasePanel.actionId.refresh];function f(e,t){switch(e){case"aSave":n&&n.setDisabled(t);break;case"aSaveAndClose":i&&i.setDisabled(t);break;case"aDelete":r&&r.setDisabled(t);break;case"aRefresh":a&&a.setDisabled(t)}}switch(s.actionsKeyMap&&(n=s.actionsKeyMap[o.view.BasePanel.actionId.save],i=s.actionsKeyMap[o.view.BasePanel.actionId.saveAndClose],r=s.actionsKeyMap[o.view.BasePanel.actionId.fDelete],a=s.actionsKeyMap[o.view.BasePanel.actionId.refresh]),e||(e="onDirtychange",t=!s.isFormDirty()),e){case"onDirtychange":l&&!l.initialConfig.blocked&&(l.setDisabled(t),f("aSave",t)),c&&!c.initialConfig.blocked&&(c.setDisabled(t),f("aSaveAndClose",t));break;case"init":s.isEditMode?(d.initialConfig.blocked||(d.setDisabled(!1),f("aRefresh",!1)),u.initialConfig.blocked||(u.setDisabled(!1),f("aDelete",!1))):(d.setDisabled(!0),u.setDisabled(!0),l.setDisabled(!0),c.setDisabled(!0),f("aRefresh",!0),f("aDelete",!0),f("aSave",!0),f("aSaveAndClose",!0));break;case"entityRequiredLock":l.setDisabled(t),c.setDisabled(t),f("aSave",t),f("aSaveAndClose",t);break;case"onSave":d.show(),d.setDisabled(!1),f("aRefresh",!1),u.initialConfig.blocked||(u.setDisabled(!1),f("aDelete",!1)),l.initialConfig.blocked||(l.setDisabled(!1),f("aSave",!1)),c.initialConfig.blocked||(c.setDisabled(!1),f("aSaveAndClose",!1))}},getDetails:function(e){for(var t,n=[],i=0,r=(e=e||this.items).length;i<r;++i)(t=e.items[i])instanceof o.ux.UBDetailGrid||t instanceof o.ux.UBDetailTree||t.isDetail?n.push(t):(t.isContainer||t.isPanel)&&(n=n.concat(this.getDetails(t.items)));return n},setDetails:function(e,t){let n=this.details;if(e)for(let i=0,o=n.length;i<o;++i)t?n[i].onRefreshDetail(e,this.entityName):n[i].setValue(e,this.entityName)},getLoadMask:function(){return this.lm=this.lm||new Ext.LoadMask(this.getEl()),this.lm},onAfterRender:function(){let e=this;e.formDataReady||e.maskForm();let t=e.getFormWin();t&&e.mon(t,"beforeclose",e.beforeClose,e),e.on({beforeclose:e.beforeClose,scope:e})},startLoadFormData:function(){let e=this;if(e.entityName)e.__mip_ondate&&e.addNewVersionToTitle(),e.isEditMode||e.addByCurrent?e.initEditOrByCurrentFormData():e.initEmptyFormData();else{Ext.suspendLayouts();try{Ext.callback(e.initUBComponent,e)}finally{Ext.resumeLayouts(!0)}}},initEmptyFormData:function(){let e=this;e.addCreatingToTitle();let t,n={entity:e.entityName,fieldList:e.fieldList};e.hasEntityALS&&(n.alsNeed=!0),e.parentContext&&(t=e.parentContext),e.initValue&&(t=t||{},Ext.applyIf(t,e.initValue)),Ext.Object.getSize(t)&&(n.execParams=t),$App.connection.addNew(n).then((function(t){e.initFormData(t)})).catch((function(t){e.unmaskForm(),o.showErrorWindow(t),e.closeWindow(!0)}))},formRequestConfig:function(e,t){let n=this;return n.selectMethod&&"select"===e&&(t.method=n.selectMethod),n.insertMethod&&"insert"===t.method&&"save"===e&&(t.method=n.insertMethod),n.updateMethod&&"update"===t.method&&"save"===e&&(t.method=n.updateMethod),n.deleteMethod&&"delete"===e&&(t.method=n.deleteMethod),n.hasEntityALS||delete t.alsNeed,t},initEditOrByCurrentFormData:function(){let e=this,t=e.formRequestConfig("select",{entity:e.entityName,fieldList:e.fieldList,ID:e.instanceID,lockType:e.isEntityLockable?"None":void 0,alsNeed:!!e.hasEntityALS||void 0});$App.connection.select(t).then((function(t){if(!e.isDestroyed)if(t&&t.resultData.data.length){if(e.addByCurrent)e.addCreatingToTitle(),$App.connection.addNew({entity:e.entityName,fieldList:e.fieldList,alsNeed:e.hasEntityALS,execParams:o.core.UBCommand.resultDataRow2Object(t,0,e.getFieldListWithoutAdtDocument(e.fieldList))}).then(e.initFormData.bind(e));else{if(e.disableBinder(),o.ux.data.UBStore.resultDataRow2Record(t,e.record),e.record.resultData=t.resultData,e.record.resultAls=t.resultAls,o.ux.data.UBStore.resetRecord(e.record),e.isEntityLockable){let n=t.resultLock;n&&n.lockInfo&&e.onGetLockInfo(n)}e.enableBinder(),e.isNewInstance=!1,e.initFormData()}e.fireEvent("recordloaded",e.record,t)}else e.closeWindow(!0),$App.dialogError("recordNotExistsOrDontHaveRights")}))},initFormData:function(e){let t,n=this;function r(){t&&n.record&&(n.record.resultAls=t),Ext.suspendLayouts();try{n.addInitialFieldValues(),n.setFields(n.record),n.setDetails(n.record),n.initFields(),n.updateActions()}finally{Ext.resumeLayouts(!0)}}n.isDestroyed||(e&&(t=e.resultAls,n.isNewInstance=e.method===o.core.UBCommand.methodName.ADDNEW,n.disableBinder(),o.ux.data.UBStore.resultDataRow2Record(e,n.record),n.instanceID=n.record.get("ID")||n.instanceID,e.method===o.core.UBCommand.methodName.ADDNEW&&i.filter($App.domainInfo.entities[e.entity].attributes,{dataType:"Date"}).forEach((function(e){if(n.record.get(e.name)&&i.isDate(n.record.get(e.name))){let t=n.record.get(e.name);t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),n.record.set(e.name,t)}})),n.isNewInstance||o.ux.data.UBStore.resetRecord(n.record),n.enableBinder(),n.fireEvent("recordloaded",n.record,e)),n.record&&n.isEntityLockable&&n.isNewInstance&&!n.lockOnSave&&"ID"!==n.domainEntity.mixins.softLock.lockIdentifier?n.setEntityLocked().then((function(){r()}),(function(e){throw n.closeForce=!0,n.closeWindow(!0),e})):r())},bindHotKeys:function(){var e=this,t=e.getFormWin(),n=o.view.BasePanel.actionId,i=o.view.BasePanel.hotKeys,r=t?t.getEl():e.getEl();e.actionsKeyMap={},r&&(e.actionsKeyMap[n.saveAndClose]=new Ext.util.KeyMap({target:r,binding:[{key:i[n.saveAndClose].key,ctrl:i[n.saveAndClose].ctrl,shift:i[n.saveAndClose].shift,fn:function(){e.onAction(e.actions[o.view.BasePanel.actionId.saveAndClose].initialConfig)}}]}),e.actionsKeyMap[n.save]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:i[n.save].key,ctrl:i[n.save].ctrl,shift:i[n.save].shift,fn:function(t,n){n.stopEvent(),e.onAction(e.actions[o.view.BasePanel.actionId.save].initialConfig)}}]}),e.actionsKeyMap[n.refresh]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:i[n.refresh].key,ctrl:i[n.refresh].ctrl,shift:i[n.refresh].shift,fn:function(t,n){n.stopEvent(),e.onRefresh()}}]}),e.actionsKeyMap[n.fDelete]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:i[n.fDelete].key,ctrl:i[n.fDelete].ctrl,shift:i[n.fDelete].shift,fn:function(t,n){n.stopEvent(),e.onAction(e.actions[o.view.BasePanel.actionId.fDelete].initialConfig)}}]}),e.hideActions&&e.hideActions.length&&e.hideActions.forEach((t=>{let n=e.actionsKeyMap[t];n&&n.disable()})),e.updateActions("init"))},addCreatingToTitle:function(){let e=this;e.on("afterrender",(function(){e.setTitle(e.getFormTitle()+o.format(" ({0})",o.i18n("dobavlenie")))}),e,{single:!0})},addInitialFieldValues:function(){let e=this;e.initialFieldValues&&e.isNewInstance&&Ext.Object.each(e.initialFieldValues,(function(t,n){e.record.fields.containsKey(t)&&e.record.set(t,n)}),e)},getUBCmp:function(e){return this.ubNameMap[e]},getField:function(e){return this.ubAttributeMap[e]||this.binder.getFields()[e]},initUBControlMap:function(){let e=this,t=e.getForm().getFields().items;e.ubNameMap={},e.ubAttributeMap={},e.fields=[],i.forEach(t,(function(t){let n=t[o.view.BasePanel.defaultUBName];t.attributeName&&(e.ubAttributeMap[t.attributeName]=t),n&&!t.oneWayBinding&&(e.ubNameMap[n]=t,e.fields.push(t))})),i.each(e.documents,(function(t,n){let i=e.ubNameMap[e.attrName(n)];i&&(i.isUBDocumentCtrl=!0)}))},getUBCmps:function(){return this.fields},addDocumentAttrForComplexUBDocumentAttr:function(e,t,n,i){if(e[i].attributeName.split(".").length>1){for(var o=e[i].attributeName.substring(0,e[i].attributeName.lastIndexOf(".")),r=!1,a=0;a<n;++a)if(e[a].attributeName===o){r=!0;break}r||t.push(o)}},setFields:function(e){let t=this;if(e){t.binder.record&&t.binder.record===e||t.binder.setRecord(e),t.isEntityLockable&&t.updateActions("entityRequiredLock",!0),t.formDataReady=!1,Ext.suspendLayouts();try{t.disableBinder(),t.binder.bind(!0),t.enableBinder();let n=t.fields;for(let e=0,i=n.length;e<i;e++){let i=n[e];if("ubdocument"===i.xtype)for(let e=0,t=this.docActions.length;e<t;e++)if(this.docActions[e].initialConfig.key===i.attributeName){i.action=this.docActions[e];break}t.record.resultAls&&t.updateAls(i,i.attributeName)}t.fireEvent("updateFields",e)}finally{Ext.resumeLayouts(!0)}}},updateAls:function(e,t){let n=this,i=n.record.resultAls?n.record.resultAls[t]||"":"SUM",o=-1===i.indexOf("U"),r=n.domainEntity.attr(t);o&&!e.readOnly&&e.setReadOnly?(e.setReadOnly(!0),e.wasLockedByMixin=!0):!o&&e.readOnly&&e.setReadOnly&&e.wasLockedByMixin&&(e.setReadOnly(!1),e.wasLockedByMixin=!1),(n.isNewInstance&&!n.entityMethods.insert||!n.isNewInstance&&!n.entityMethods.update)&&e.setReadOnly(!0);let a=e.allowBlank;n.record.resultAls&&i&&(a=-1===i.indexOf("M")),a=a&&r.allowNull&&!e.isRequired,a!==e.allowBlank&&e.setAllowBlank(a)},getFieldValues:function(e,t,n){let i={};for(let o=0,r=t.length;o<r;++o)n&&this.domainEntity.attr(t[o]).dataType===UBDomain.ubDataTypes.Document||(i[t[o]]=e.get(t[o]));return i},getFieldListWithoutAdtDocument:function(e){let t=[];const n=UBDomain.ubDataTypes.Document;for(let i=0,o=e.length;i<o;++i)this.domainEntity.attr(e[i]).dataType!==n&&t.push(e[i]);return t},addBaseActions:function(){var e,t=this,n=o.view.BasePanel.actionId,i=o.view.BasePanel.hotKeys,r=o.view.BasePanel.eventId,a=o.core.UBCommand.methodName,s=new Ext.Action({actionId:n.saveAndClose,scale:"medium",iconCls:"u-icon-save-and-close",text:o.i18n("saveAndClose")+i[n.saveAndClose].text,eventId:r.save,cls:"save-and-close-action",handler:t.onAction,blocked:!t.domainEntity.haveAccessToAnyMethods([a.INSERT,a.UPDATE]),disabled:!0,scope:t}),l=new Ext.Action({actionId:n.save,scale:"medium",iconCls:"u-icon-save",text:o.i18n("save")+i[n.save].text,cls:"save-action",eventId:r.save,handler:t.onAction,blocked:!t.domainEntity.haveAccessToAnyMethods([a.INSERT,a.UPDATE]),disabled:!0,scope:t});if(t.switchSaveButtonsAction?(t.actions[n.save]=s,t.actions[n.saveAndClose]=l):(t.actions[n.save]=l,t.actions[n.saveAndClose]=s),t.hasDataHistoryMixin&&(t.actions[n.history]=new Ext.Action({actionId:n.history,iconCls:"iconHistory",text:o.i18n("ChangesHistory"),eventId:r.history,handler:t.onAction,scope:t})),t.hasAuditMixin&&(t.actions[n.audit]=new Ext.Action({actionId:n.audit,iconCls:"u-icon-line-chart",text:o.i18n("showAudit"),eventId:r.audit,handler:t.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible("uba_auditTrail","select"),scope:t})),t.hasHardSecurityMixin){var c=t.entityName+"_acl",u=t.domainEntity;u.mixins&&u.mixins.aclRls&&u.mixins.aclRls.useUnityName&&(c=u.mixins.unity.entity+"_acl"),t.actions[n.accessRight]=new Ext.Action({actionId:n.accessRight,text:o.i18n("accessRight"),eventId:r.accessRight,handler:t.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible(c,"select"),scope:t})}t.actions[n.refresh]=new Ext.Action({actionId:n.refresh,scale:"medium",iconCls:"u-icon-refresh",text:o.i18n("refresh")+i[n.refresh].text,cls:"refresh-action",eventId:r.refresh,handler:t.onAction,scope:t}),t.actions[n.lock]=new Ext.Action({actionId:n.lock,scale:"medium",iconCls:"u-icon-lock",text:o.i18n("lockBtn"),hidden:!t.isEntityLockable||t.isNewInstance,eventId:r.lock,handler:t.onAction,scope:t}),t.actions[n.unLock]=new Ext.Action({actionId:n.unLock,scale:"medium",iconCls:"u-icon-unlock",hidden:!t.isEntityLockable||t.isNewInstance,text:o.i18n("unLockBtn"),eventId:r.unLock,handler:t.onAction,scope:t}),t.actions[n.fDelete]=new Ext.Action({actionId:n.fDelete,scale:"medium",iconCls:"u-icon-delete",text:o.i18n("Delete")+i[n.fDelete].text,cls:"delete-action",eventId:r.fDelete,handler:t.onAction,blocked:e=!t.domainEntity.haveAccessToMethod(a.DELETE),disabled:e||t.isNewInstance,scope:t}),$App.domainInfo.isEntityMethodsAccessible("ubm_form",a.UPDATE)&&(t.actions[n.formConstructor]=new Ext.Action({actionId:n.formConstructor,scale:"medium",iconCls:"u-icon-wrench",text:o.i18n("formConstructor"),eventId:r.formConstructor,handler:t.onAction,scope:t})),t.createDocActions()},onFileDragDrop:function(e,t){var n,i,r,a=this,s=a.getField(e),l=a.getInstanceID(),c=!1,u=!1,d=0;t.preventDefault(),1===t.dataTransfer.files.length?(n=t.dataTransfer.files[0],s.fireEvent("change"),i=Ext.MessageBox.progress(o.i18n("loadingData"),""),$App.connection.setDocument(n,{entity:a.entityName,attribute:e,id:l,origName:n.name,filename:n.name},(function(e){e.loaded<e.total?c?i.updateProgress(e.loaded/e.total,o.i18n("loadingData")):c=e.loaded/e.total<.3:u||(u=!0,i.updateProgress(0,o.i18n("Transformation")),r=setInterval((function(){d=d>=1?0:d+.1,i.updateProgress(d,o.i18n("Transformation"))}),1e3))})).finally((function(){clearInterval(r),i.close()})).then((function(e){s.setValue(e,l),$App.dialogInfo("dropZoneOperationComplete")}))):$App.dialogError("dropZoneOneFileRequired")},onFileDragDropConfigure:function(e){var t=this;t.isVisible()&&i.forEach(t.documents,(function(n,i){var r,a=t.getField(i);!a||a.isDisabled()||a.readOnly||(r=a.getValue(),e.push({message:o.i18n(r?"dropZoneReplace":"dropZoneAdd")+" "+n.caption,dropHandler:t.onFileDragDrop.bind(t,i)}))}))},createDocActions:function(){var e=this,t=o.view.BasePanel.actionId,n=o.view.BasePanel.eventId,i=[];e.docActions=i,0!==e.documentsCount&&(o.view.UBDropZone&&o.view.UBDropZone.on("configureDropZone",e.onFileDragDropConfigure,e),Ext.Object.each(e.documents,(function(r,a){const s=[];o.connection.appConfig.uiSettings.adminUI.disableScanner||s.push({actionId:t.scan+"_"+r,iconCls:"u-icon-print",text:o.i18n("skanirovat"),eventId:n.scan,handler:e.onAction,attribute:r,scope:e}),s.push({actionId:t.attach+"_"+r,iconCls:"u-icon-attachments",text:o.i18n("izFayla"),eventId:n.attach,handler:e.onAction,attribute:r,scope:e},{actionId:t.deleteAttachment+"_"+r,iconCls:"u-icon-circle-close",text:o.i18n("clear"),eventId:n.deleteattachment,handler:e.onAction,attribute:r,scope:e},{actionId:t.showVersions+"_"+r,iconCls:"u-icon-branch",text:o.i18n("showDocVersions"),eventId:n.showVersions,handler:e.onAction,attribute:r,scope:e},{actionId:t.downloadAttach+"_"+r,iconCls:"u-icon-download",text:o.i18n("downloadAttach"),eventId:n.downloadAttach,handler:e.onAction,attribute:r,scope:e}),i.push(new Ext.Action({text:a.caption,iconCls:"u-icon-attachments",height:32,key:r,menu:s}))})))},addBaseDockedItems:function(){var e=this,t=o.view.BasePanel.actionId,n=[e.actions[t.refresh],e.actions[t.save],e.actions[t.saveAndClose],e.actions[t.fDelete],"-",e.createMenuItemLink()],i=[e.createButtonWOText(e.actions[t.refresh]),e.createButtonWOText(e.actions[t.saveAndClose]),e.createButtonWOText(e.actions[t.save]),e.createButtonWOText(e.actions[t.fDelete]),"->",{menuId:"AllActions",scale:"medium",iconCls:"u-icon-setting",arrowCls:"",tooltip:o.i18n("allActions"),menu:n}];e.actions[t.formConstructor]&&n.splice(3,0,e.actions[t.formConstructor]),e.hasDataHistoryMixin&&(n.push("-"),n.push(e.actions[t.history])),e.hasAuditMixin&&(n.push("-"),n.push(e.actions[t.audit])),e.hasHardSecurityMixin&&(n.push("-"),n.push(e.actions[t.accessRight])),e.isEntityLockable&&(n.push("-"),n.push(e.actions[t.lock]),n.push(e.actions[t.unLock])),e.documentsCount>0&&(n.push("-"),Ext.Array.insert(n,n.length,e.docActions),Ext.Array.insert(i,2,["-"].concat(e.docActions))),e.dockedItems=[{xtype:"toolbar",dock:"top",items:i,ubID:"mainToolbar",enableOverflow:!0}]},getFieldList:function(){var e,t,n=this,r=[];if(t=n.baseFieldList?n.baseFieldList.map((function(e){return"string"==typeof e?e:e.attributeName})):[],t=i.uniq(t),r=o.ux.data.UBStore.normalizeFieldList(this.entityName,t||[]),n.parentContext&&i.forEach(n.parentContext,(function(e,t){r.indexOf(t)<0&&r.push(t)})),(e=n.dfm&&n.dfm.requiredFields?n.dfm.requiredFields:n.requiredFields)&&i.forEach(e,(function(e){r.indexOf(e)<0&&r.push(e)})),n.isEntityLockable&&"ID"!==n.domainEntity.mixins.softLock.lockIdentifier){var a=n.domainEntity.mixins.softLock.lockIdentifier.split(".");(a=a.length>0?a[0]:null)&&r.indexOf(a)<0&&(r.push(a),o.logError("Attribute",a,"implicitly added to form fieldlist (it present in softLock.lockIdentifier)"))}return r},prepareDfmItems:function(e,t){let n=this,r=n.domainEntity,a=o.core.UBCommand,s=!1;function l(e){var t,n=!1,o=Ext.ClassManager.getNameByAlias("widget."+e);return o&&(t=Ext.ClassManager.get(o)),t&&t.prototype&&(t=t.prototype,i.forEachRight(t.xtypesChain,(function(e){if("form"===e)return n=!0,!1}))),n}if(Array.isArray(e))for(let i=0,u=e.length;i<u;++i){let u=e[i];if(t&&(s=!l(u.xtype)),"string"==typeof u.attributeName)if(r.attr(u.attributeName))n.baseFieldList.push(u.isMultilang?{isMultilang:!0,attributeName:u.attributeName}:u.attributeName),Ext.applyIf(u,Ext.applyIf(o.core.UBUtil.attribute2cmpConfig(r,u),{ubName:a.getUBCmpUBName(u.attributeName)}));else if(r.attr(u.attributeName)){n.baseFieldList.push(u.isMultilang?{isMultilang:!0,attributeName:u.attributeName}:u.attributeName);var c=o.core.UBUtil.attribute2cmpConfig(r,u);Ext.applyIf(u,Ext.applyIf(c,{ubName:a.getUBCmpUBName(u.attributeName)}))}else Ext.apply(u,{xtype:"label",text:"!"+u.attributeName,style:{color:"white",backgroundColor:"red"}});Array.isArray(u.items)?this.prepareDfmItems(u.items,s):Ext.isObject(u.items)&&this.prepareDfmItems([u.items],s)}},addItems:function(){var e=this;e.items=e.items||[],e.dfm&&(Ext.isString(e.dfm)?e.dfm=Ext.decode(e.dfm):e.dfm=i.cloneDeep(e.dfm),e.baseFieldList=[],e.prepareDfmItems(e.dfm.items,!0),e.dfm&&e.dfm.items&&(e.items=e.items.concat(e.dfm.items)),i.forEach(e.items,(function(e){e.oldHideMode=e.hideMode,e.oldHidden=e.hidden,e.hideMode="visibility",e.hidden=!0})))},callBase:function(e){return this.callBase.caller.$previous.apply(this,arguments)},addBaseListeners:function(){var e=this,t=o.view.BasePanel.eventId;e.on("afterrender",e.onAfterRender,e),e.on("boxready",(function(){this.bindHotKeys()}),e),e.on(t.save,(function(){e.fireEvent("manualsaving",e,arguments),e.onSave.apply(e,arguments)}),e),e.on(t.refresh,e.onRefresh,e),e.on(t.fDelete,e.onDelete,e),e.on(t.history,e.onHistory,e),e.on(t.lock,e.onLock,e),e.on(t.unLock,e.onUnLock,e),e.actions.formConstructor&&e.on(t.formConstructor,e.onConstructor,e),e.instanceID&&e.entityDetails.length&&e.on(t.showdetail,e.onShowDetail,e),e.documentsCount>0&&(e.on(t.scan,e.onScan,e),e.on(t.attach,e.onAttach,e),e.on(t.deleteattachment,e.onDeleteAttachment,e),e.on(t.showVersions,e.onshowVersions,e),e.on(t.downloadAttach,e.onDownloadAttach,e)),e.hideActions&&e.hideActions.length&&e.hideActions.forEach((function(t){let n=e.actions[t];!n&&t&&"docAction"===t.substr(0,9)&&e.docActions.length&&e.docActions.forEach((function(e){if(e.initialConfig&&e.initialConfig.key&&t==="docAction"+e.initialConfig.key)return n=e,!1})),n&&(n.initialConfig.blocked=!0,n.disable(),n.hide())})),e.hasAuditMixin&&e.on(t.audit,e.onAudit,e),e.hasHardSecurityMixin&&e.on(t.accessRight,e.onAccessRight,e)},onConstructor:function(){var e=this;if($App.domainInfo.get("ubm_form").haveAccessToMethod("update")){if(!e.formCode)throw new o.UBError("isAutoGeneratedForm");o.Repository("ubm_form").attrs(["ID","code"]).where("code","=",e.formCode).select().then((function(t){if(!t||t.length<1)throw new o.UBError("formNotFound");let n=e.up("window"),i=!!n&&n.modal,r={cmdType:"showForm",description:"",entity:"ubm_form",instanceID:t[0].ID,isModal:i,isModalDialog:i,sender:e};r.isModal||(r.target=o.core.UBApp.getViewport().centralPanel,r.tabId="ubm_form"+t[0].ID),$App.doCommand(r)}))}},onshowVersions:function(e){if(!this.record.get(e.attribute))throw new o.UBError("emptyContent");Ext.create("UB.view.DocumentVersions",{docRecord:this.record,docAttribute:e.attribute,instanceID:this.getInstanceID(),docContainerBase:this.getField(e.attribute)}).show()},onDownloadAttach:function(e){let t=this.record.get(e.attribute);t&&$App.downloadDocument({entity:this.entityName,attribute:e.attribute,ID:this.getInstanceID()},JSON.parse(t))},onDelete:function(){var e,t=this,n=[];t.lockInterface();try{t.fireEvent("beforeDelete",n)}catch(e){throw t.unmaskForm(),e}Promise.all(n).then((function(){return $App.dialogYesNo("deletionDialogConfirmCaption",o.format(o.i18n("deleteFormConfirmCaption"),t.getFormTitle()))})).then((function(n){if(n)return t.maskForm(2e3),e=t.formRequestConfig("delete",{entity:t.entityName,method:"delete",execParams:{ID:t.instanceID}}),$App.connection.doDelete(e).then((function(n){if(t.store&&!t.store.isDestroyed){var i=t.store.findRecord("ID",t.instanceID);i&&t.store.remove(i)}t.store&&t.store.fireModifyEvent&&t.store.fireModifyEvent(e,n),t.isDeleted=!0,t.fireEvent("afterdelete"),Ext.callback(t.eventHandler,t,[t,"afterdelete"]),o.connection.emitEntityChanged(t.entityName,{entity:t.entityName,method:"delete",resultData:{ID:t.instanceID}})})).finally((function(){t.unmaskForm()})).then((function(){t.closeWindow(!0)}))})).finally((function(){t.unmaskForm()}))},onRefresh:function(){let e=this;(e.isFormDirty()?$App.dialogYesNo("areYouSure","formWasChanged"):Promise.resolve(!0)).then((function(t){if(t){e.fireEvent("beforeRefresh",e);let t=e.details;t&&t.length&&t.forEach((e=>{e.rowEditing&&e.editingPlugin.editing&&e.editingPlugin.cancelEdit()})),e.deleteLock().then((function(){e.loadInstance()}))}}))},onLock:function(){this.hasPersistLock||this.addPersistLock()},onUnLock:function(){this.hasPersistLock&&this.removePersistLock()},onShowDetail:function(e){$App.runLink({cmdData:o.core.UBCommand.getCommandByEntityAndType(e.entityName,o.core.UBCommand.commandType.showList),parent:e.attribute,parentid:this.getInstanceID()})},loadInstance:function(){let e=this,t=e.formRequestConfig("select",{entity:e.entityName,fieldList:e.fieldList,ID:e.instanceID,alsNeed:!!e.hasEntityALS||void 0,lockType:e.isEntityLockable?"None":void 0});e.formDataReady=!1,$App.connection.select(t).then((function(t){if(e.disableBinder(),o.ux.data.UBStore.resultDataRow2Record(t,e.record),e.record.resultData=t.resultData,e.record.resultAls=t.resultAls,o.ux.data.UBStore.resetRecord(e.record),e.isEntityLockable){let n=t.resultLock;n&&n.lockInfo&&e.onGetLockInfo(n)}e.enableBinder(),e.setFields(e.record),e.setDetails(e.record,!0),e.fireDirty=!1,e.updateActions(),e.fireEvent("recordloaded",e.record,t)}))},onSave:function(e){let t=this;e&&e.length&&(e=e[0]);let n=e&&e.actionId===o.view.BasePanel.actionId.saveAndClose||!1;t.lockInterface(),t.saveForm().finally((function(){t.unmaskForm()})).then((function(e){n&&e>=0&&t.closeWindow(!0)}))},saveForm:function(){let e=this,t=e.getForm(),n=[];e.fireEvent("beforeSaveForm",n),n.sort((function(e,t){return e[0]-t[0]}));let i=Promise.resolve(!0);return n.forEach((e=>{i=i.then((function(){return e[1]()}))})),i.then((function(n){return-1===n||0===n?n:t.isValid()?t.isValid()?"function"==typeof e.onBeforeSave?Promise.resolve(e.onBeforeSave()).then((function(t){return!1!==t?e.saveInstance():Promise.resolve(-1)})):e.saveInstance():Promise.resolve(-1):(e.showValidationErrors(),Promise.resolve(-1))}))},showValidationErrors:function(){const e=this;e.getForm().getFields().each((function(t){t.isValid()||(o.toast({entityTitle:e.domainEntity.caption,fieldLabel:t.fieldLabel,callback:function(){if(e){let n=e.getFormWin();n&&n.toFront(),Ext.callback(t.focus,t,[],100)}}}),t.focus())}),e)},attrName:function(e){return"attr"+Ext.String.capitalize(e)},saveInstance:function(e){var t,n,r=this,a=[],s=[];if(i.forEach(r.documents,(function(e,t){var n=r.getField(t);n&&n.isEditor()&&n.isContentDirty()&&!r.__mip_ondate&&a.push(n),r.__mip_ondate&&(r.record.get(t)&&s.push(t),r.record.set(t,null))})),0===a.length&&!r.isFormDirty()&&!r.__mip_ondate&&!e)return Promise.resolve(0);r.maskForm(o.appConfig.formSaveMaskDelay);let l=Promise.resolve(!0);return r.isEntityLockable&&r.lockOnSave&&!r.entityLocked&&(l=r.setEntityLocked()),l.then((()=>Promise.all(a.map((e=>e.save(!!r.__mip_ondate)))))).then((()=>{r.binder.suspendAutoBind(),r.disableBinder(),i.forEach(r.documents,(function(e,t){let n=r.getField(t);if(n&&n.isDirty()){let e=n.getValue();r.record.set(t,e)}})),r.enableBinder(),r.binder.releaseAutoBind(),t=r.record.getChanges(),r.postOnlySimpleAttributes&&Object.keys(t).forEach((e=>{-1!==e.indexOf(".")&&delete t[e]})),void 0===t.ID&&(t.ID=r.instanceID?r.instanceID:r.record.get("ID")),r.record.get("mi_modifyDate")&&(t.mi_modifyDate=r.record.get("mi_modifyDate"));let e=[];return r.extendedDataForSave&&(i.forEach(r.extendedDataForSave,(function(t,n){let i=n.match(/(\w+)_\w\w\^/);i&&i.length>1&&e.indexOf(i[1])<0&&e.push(i[1])})),e.forEach((e=>{t&&t.hasOwnProperty(e)&&(t[e+"_"+$App.connection.userLang()+"^"]=t[e],delete t[e])})),i.defaults(t,r.extendedDataForSave)),n={fieldList:r.fieldList,entity:r.entityName,method:r.__mip_ondate&&!r.addByCurrent?"newversion":r.isEditMode?"update":"insert",execParams:t},r.hasEntityALS&&(n.alsNeed=!0),n.__mip_ondate=r.__mip_ondate,n=r.formRequestConfig("save",n),r.fireEvent("beforesave",r,n),$App.connection.update(n).then((function(e){return r.deleteLock().then((function(){return r.isEntityLockable?$App.connection.query({method:"isLocked",entity:r.entityName,ID:r.getInstanceID()}).then((function(t){return[e,t]})):[e]}))})).then((function(e){var t=e[0],l=e[1],c=!!r.__mip_ondate;r.store&&r.store.fireModifyEvent&&r.store.fireModifyEvent(n,e),delete r.extendedDataForSave,r.isNewInstance="addnew"===t.method,r.isEditMode=!0,delete r.__mip_ondate,r.updateActions("onSave"),r.disableBinder(),o.ux.data.UBStore.resultDataRow2Record(t,r.record),o.ux.data.UBStore.resetRecord(r.record),r.setInstanceID(r.record.get("ID")),r.enableBinder(),r.record.resultLock=t.resultLock,r.record.resultAls=t.resultAls,r.setFields(r.record),r.store&&!r.store.isDestroyed&&r.store.clearCache(),r.updateStoreRecord(t),r.isEntityLockable&&l&&l.lockInfo&&r.onGetLockInfo(l);var u=r.getFormWin();return u&&delete u.newInstance,r.formWasSaved=!0,r.fireEvent("aftersave",r,t),Ext.callback(r.eventHandler,r,[r,"aftersave"]),Ext.callback(r.onAfterSave,r),o.connection.emitEntityChanged(r.entityName,{entity:r.entityName,method:r.__mip_ondate&&!r.addByCurrent?"newversion":r.isEditMode?"update":"insert",resultData:{ID:r.instanceID}}),r.fireDirty=!1,r.updateActions(),c&&s.length>0?(a=[],i.forEach(r.documents,(function(e,t){r.getField(t).instanceID=r.record.get("ID")})),i.forEach(s,(function(e){var t=r.getField(e);a.push(t)})),Promise.all(a.map((function(e){return e.existData()?e.save(!0):Promise.resolve(null)}))).then((function(){return i.forEach(r.documents,(function(e,t){var n=r.getField(t);r.record.set(t,n.getValue())})),r.saveInstance()}))):1}))})).finally((function(){r.unmaskForm(),r.isSaveProcess=!1}))},addExtendedDataForSave:function(e){var t=this;e&&(t.extendedDataForSave?i.forEach(e,(function(e,n){""!==e&&null!=e||""===t.extendedDataForSave[n]&&null===t.extendedDataForSave[n]&&void 0===t.extendedDataForSave[n]?t.extendedDataForSave[n]=e:delete t.extendedDataForSave[n]})):t.extendedDataForSave=e,this.updateActions("onDirtychange",0===Object.keys(t.extendedDataForSave).length))},getExtendedDataForSave:function(){return this.extendedDataForSave||{}},updateStoreRecord:function(){var e,t=this;this.store&&!this.store.isDestroyed&&(t.updateOrInsertStoreRecord(t.store,t.record),o.core.UBAppConfig.systemEntities.hasOwnProperty(t.entityName)&&(e=o.core.UBStoreManager.getSystemEntityStore(o.core.UBAppConfig.systemEntities[t.entityName].name),t.store!==e&&t.updateOrInsertStoreRecord(e,t.record)))},updateOrInsertStoreRecord:function(e,t){if(e&&!e.isDestroyed){var n,i,o,r,a,s,l=e.getById(t.get("ID")),c=t.fields.items;if(null==l)e.reload();else{for(n=l.fields,r=0,a=c.length;r<a;++r)i=c[r].name||c[r],n.get(i)&&!l.isEqual(l.get(i),o=t.get(i))&&(s=!0,l.set(i,o));e.clearCache(),s&&(l.commit(),e.fireEvent("childwasmodified"))}}},onScan:function(e){var t=this,n=t.entityName,i=t.getInstanceID(),r=e.attribute,a=o.format('{0}: "{1}"',o.i18n("skanirovanieAtributa"),this.documents[e.attribute].caption),s=t.getField(r),l=i;s.fireEvent("change"),$App.scan(a,{},this.documents[e.attribute].documentMIME).then((function(e){const t=`Scan-${Date.now()}-.${$App.__scanService.lastScanedFormat}`,i="string"==typeof e?o.base64toArrayBuffer(e):e;return $App.connection.setDocument(i,{entity:n,attribute:r,id:l,origName:t,filename:t})})).then((function(e){s.setValue(e,l)}))},onAttach:function(e){var t=this.getField(e.attribute),n=!(t.isEditor&&t.isEditor()&&t.documentMIME),i=this.getInstanceID();t.fireEvent("change"),Ext.create("UB.view.UploadFileAjax",{entityName:this.entityName,instanceID:i,attribute:e.attribute,scope:this,uploadData:n,callback:function(e){n?e.success?t.setValue(e.result,i):o.showResponseError(e):t.setContent(e,!1)}})},onDeleteAttachment:function(e){var t=this,n=t.getField(e.attribute);n.fireEvent("change"),$App.dialogYesNo("clear","vyHotiteUdalitSoderzhimoeDocumenta").then((function(e){if(!e)return;let i=n.getValue();if(Ext.isString(i)&&i.length&&(i=Ext.JSON.decode(i,!0)),!Ext.Object.getSize(i))return;let o=Ext.apply(i,{deleting:!0,size:0});n.setValue(o,t.getInstanceID())}))},lockInterface:function(){let e=this.getEl();e&&e.mask().addCls("ub-invisible-mask")},maskForm:function(e){let t=this;clearTimeout(t.maskTimeout||0),t.maskTimeout=setTimeout((function(){let e=t.getEl();e&&e.mask(o.i18n("loadingData"))}),e||1)},unmaskForm:function(){clearTimeout(this.maskTimeout||0);let e=this.getEl();e&&e.unmask()},beforeDestroy:function(){let e=this;if(this.mainEntityGridPanel&&(this.mainEntityGridPanel.un("parentchange",this.onParentChange,this),this.mainEntityGridPanel.actions[o.view.EntityGridPanel.actionId.showPreview].setDisabled(!1)),clearTimeout(this.maskTimeout||0),e.callParent(),e.sender&&e.sender.up){var t=e.sender.up("form");t&&(t.focusControl?t.focusControl(e.sender,300):e.sender.focus())}},deleteInstanceID:function(){return this.instanceID&&o.view.activeForm&&delete o.view.activeForm[this.instanceID],!0},beforeClose:function(){var e=this,t=e.getFormWin()||{};return!(!t.closeForce&&!e.closeForce&&e.isFormDirty(!0)&&e.getCanEdit()&&(Ext.Msg.confirm({buttons:Ext.MessageBox.YESNOCANCEL,icon:Ext.MessageBox.WARNING,buttonText:{yes:o.i18n("save"),no:o.i18n("doNotSave"),cancel:o.i18n("cancel")},minWidth:320,title:o.i18n("unsavedData"),msg:o.i18n("confirmSave"),fn:function(n){"yes"===n&&e.saveForm().then((function(t){t>=0&&e.closeWindow(!0)})),"no"===n&&(e.closeForce=!0,t.closeForce=!0,e.closeWindow(!0)),e.deleteInstanceID()}}),1))},closeWindow:function(e){var t=this,n=this.getFormWin();if(t.deleteLock(),t.closeForce=e,n&&!t.target)return n.closeForce=e,void n.close();t&&t.close()},onHistory:function(){var e=this,t=e.fieldList.concat(),n=o.core.UBUtil.convertFieldListToExtended(e.fieldList);function r(e){i.findIndex(n,{name:e})<0&&(t=[e].concat(t),n=[{name:e,visibility:!0,description:o.i18n(e)}].concat(n))}e.instanceID&&(r("mi_dateTo"),r("mi_dateFrom"),$App.doCommand({cmdType:"showList",isModal:!0,cmdData:{params:[{entity:e.entityName,method:o.core.UBCommand.methodName.SELECT,fieldList:t}]},cmpInitConfig:{extendedFieldList:n},instanceID:e.instanceID,__mip_recordhistory:!0}))},onAccessRight:function(){var e,t,n,o=this,r=[],a=!1;o.instanceID&&(o.isEntityLockable&&!o.entityLocked?(n=o.setEntityLocked(),a=!0):n=Promise.resolve(!0),t=o.entityName+"_acl",(e=o.domainEntity)&&e.mixins&&e.mixins.aclRls&&(e.mixins.aclRls.useUnityName&&(t=e.mixins.unity.entity+"_acl"),i.forEach(e.mixins.aclRls.onEntities,(function(e){var t=$App.domainInfo.get(e);t.descriptionAttribute?r.push(t.sqlAlias+"ID."+t.descriptionAttribute):r.push(t.sqlAlias+"ID")})),n.then((function(){$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:t,method:"select",fieldList:r,whereList:{parentExpr:{expression:"[instanceID]",condition:"equal",values:{instanceID:o.instanceID}}}}]},isModalDialog:!0,parentContext:{instanceID:o.instanceID},hideActions:["addNewByCurrent"],onClose:function(){a&&o.deleteLock()}})}))))},onAudit(){if(!this.instanceID)return;const e=this.up("window");$App.showAuditTrail({entityCode:this.entityName,instanceID:this.instanceID,isModal:!!e&&e.modal})}}),Ext.onReady((function(){Ext.define("Ext.layout.container.AutoUB",{override:"Ext.layout.container.Auto",chromeCellMeasureBug:!1})}))},375:function(e,t,n){n(8623),n(9455),n(6411),Ext.define("UB.view.BaseWindow",{extend:"Ext.window.Window",alias:"widget.basewindow",uses:["UB.core.UBApp"],constrain:!0,maximizable:!0,initComponent:function(){var e=this,t=this.commandCode?UB.core.UBLocalStorageManager.getItem(this.windowLocalStoreKey=UB.core.UBLocalStorageManager.getKeyUI(this.commandCode),!0):void 0;t&&t.window&&t.window.position?(t.window.position.x&&(this.x=t.window.position.x),t.window.position.y&&(this.y=t.window.position.y)):this.dfm&&this.dfm.position&&(this.dfm.position.x&&(this.x=this.dfm.position.x),this.dfm.position.y&&(this.y=this.dfm.position.y)),t&&t.window?(t.window.height&&(this.height=t.window.height),t.window.width&&(this.width=t.window.width)):this.dfm&&this.dfm.size?(this.dfm.size.height&&(this.height=this.dfm.size.height),this.dfm.size.width&&(this.width=this.dfm.size.width)):this.isGrid&&(this.height=UB.appConfig.gridHeightDefault,this.width=UB.appConfig.gridWidthDefault),Ext.apply(this,{minHeight:UB.appConfig.formMinHeight,minWidth:UB.appConfig.formMinWidth}),e.modal=!0,this.callParent(arguments),this.addListener("activate",this.onActivated,this)},onActivated:function(){$App.fireEvent("windowActivated",this)},beforeDestroy:function(){var e;this.commandCode&&((e=UB.core.UBLocalStorageManager.getItem(this.windowLocalStoreKey,!0)||{}).window={position:{x:this.x,y:this.y}},this.height&&(e.window.height=this.height),this.width&&(e.window.width=this.width),UB.core.UBLocalStorageManager.setItem(this.windowLocalStoreKey,e)),this.callParent(arguments),$App.fireEvent("windowDestroyed",this)}})},6907:function(){Ext.define("UB.view.ColumnCategories",{extend:"Ext.grid.column.Action",alias:"widget.columncategories",width:40,align:"center",minWidthChar:6,maxWidthChar:7,sortable:!0,header:"",cls:"ub-favorites-header",tdCls:"ub-favorites-td",disableExport:!0,updateDelay:500,defaultRenderer:function(e,t,n,i,o,r,a){var s,l,c,u,d=this,f=Ext.baseCSSPrefix,h=d.origScope||d,p=d.items,m=p.length,g=0;for(n.baseValue=e,d.items[0].iconCls="ub-favorites-img "+d.getCls(e),l=_.isFunction(d.origRenderer)&&d.origRenderer.apply(h,arguments)||"";g<m;g++)u=(c=(s=p[g]).disabled||!!s.isDisabled&&s.isDisabled.call(s.scope||h,a,i,o,s,n))?null:s.tooltip||(s.getTip?s.getTip.apply(s.scope||h,arguments):null),s.hasActionConfiguration||(s.stopSelection=d.stopSelection,s.disable=Ext.Function.bind(d.disableAction,d,[g],0),s.enable=Ext.Function.bind(d.enableAction,d,[g],0),s.hasActionConfiguration=!0),l+='<div role="button" alt="'+(s.altText||d.altText)+'" class="'+f+"action-col-icon "+f+"action-col-"+String(g)+" "+(c?f+"item-disabled":" ")+" "+(_.isFunction(s.getClass)?s.getClass.apply(s.scope||h,arguments):s.iconCls||d.iconCls||"")+'"'+(u?' data-qtip="'+u+'"':"")+" ></div>";return l},constructor:function(e){var t=this;e||(e={}),e.items=[{tagName:"div",tooltip:UB.i18n("FavoritesToolTip"),iconCls:"ub-favorites-img ub-favorites-img-empty",handler:function(){t.onFavoritesClick.apply(t,arguments)}}],t.filterCaption=UB.i18n("gridCategoryCaption"),t.callParent([e])},initComponent:function(){var e=this;e.timers={},e.callParent(arguments)},onFavoritesClick:function(e,t,n,i,o){var r,a,s,l,c,u,d=this,f=e.getStore(),h=f.getAt(t);if(a=h.baseValue,l=f.ubRequest.entity,c=$App.domainInfo.get(l,!0).getEntityAttributeInfo(this.dataIndex,-1),u=this.dataIndex.split("."),u=c.attributeCode===u[0]?"ID":u.slice(0,u.length-2).join("."),!(r=h.get(u)))throw new Error('You must add column "'+u+'" to fieldList');switch(a){case"1":s="2";break;case"2":s="3";break;case"3":s="0";break;default:s="1"}d.timers[r]&&clearTimeout(d.timers[r]),d.updateCls(o.target,a,s),h.baseValue=s,d.timers[r]=setTimeout((function(){delete d.timers[r],d.startUpdateFavorites(r,a,s,o.target,c,h)}),d.updateDelay||300)},updateCls:function(e,t,n){var i=Ext.fly(e);i.removeCls(this.getCls(t)),i.addCls(this.getCls(n))},getCls:function(e){switch(e){case"1":return"ub-favorites-img-yellow";case"2":return"ub-favorites-img-green";case"3":return"ub-favorites-img-red";default:return"ub-favorites-img-empty"}},startUpdateFavorites:function(e,t,n,i,o,r){var a=this,s=o.attribute.associatedEntity,l=o.attribute.associationAttr;(t?UB.Repository(s).attrs(["ID",l,"ubUser","code"]).where("instanceID","=",e).select():$App.connection.addNew({entity:s,fieldList:["ID",l,"ubUser","code"]}).then((function(e){return UB.LocalDataStore.selectResultToArrayOfObjects(e)}))).then((function(o){var l,c=o[0]||{};return c.code=n,c.instanceID=e,c.ubUser=$App.connection.userData("userID"),l={entity:s,method:"0"===c.code?"delete":t&&c.ID?"update":"insert",execParams:c},$App.connection.run(l).catch((function(){a.updateCls(i,t,r.baseValue),r.baseValue=t}))}))},statics:{prepareConditions:function(e,t,n){var i,o,r,a,s,l=t.split("."),c="favFtrUsr"+l[0],u={};for(o=t.split("."),o=n.attributeCode===o[0]?"ID":o.slice(0,o.length-2).join("."),e.fieldList.indexOf(o)<0&&e.fieldList.push(o),s=!1,r=0;r<e.fieldList.length;r++)if((a=e.fieldList[r]).name===o||"object"==typeof a&&a.name===o){s=!0;break}s||e.fieldList.push({name:o,visibility:!1}),i=l.slice(0,l.length-1).join(".")+".ubUser",e.whereList||(e.whereList={}),e.joinAs||(e.joinAs=[]),u[i]=$App.connection.userData("userID"),e.whereList[c]={expression:"["+i+"]",condition:"equal",values:u},e.joinAs.push(c)}}})},4272:function(){Ext.define("UB.view.ColumnFavorites",{extend:"Ext.grid.column.Action",alias:"widget.columnfavorites",width:40,align:"center",minWidthChar:6,maxWidthChar:7,sortable:!0,header:"",cls:"ub-favorites-header",tdCls:"ub-favorites-td",disableExport:!0,allowedCategoryCount:2,updateDelay:1,defaultRenderer:function(e,t,n,i,o,r,a){let s=this,l=Ext.baseCSSPrefix,c=s.origScope||s,u=s.items;u[0].iconCls="ub-favorites-img "+s.getCls(e),n.baseValue=e;let d=_.isFunction(s.origRenderer)&&s.origRenderer.apply(c,arguments)||"";for(let e=0,t=u.length;e<t;e++){let t=u[e],r=t.disabled||!!t.isDisabled&&t.isDisabled.call(t.scope||c,a,i,o,t,n),f=r?null:t.tooltip||(t.getTip?t.getTip.apply(t.scope||c,arguments):null);t.hasActionConfiguration||(t.stopSelection=s.stopSelection,t.disable=Ext.Function.bind(s.disableAction,s,[e],0),t.enable=Ext.Function.bind(s.enableAction,s,[e],0),t.hasActionConfiguration=!0),d+='<div role="button" alt="'+(t.altText||s.altText)+'" class="'+l+"action-col-icon "+l+"action-col-"+String(e)+" "+(r?l+"item-disabled":" ")+" "+(_.isFunction(t.getClass)?t.getClass.apply(t.scope||c,arguments):t.iconCls||s.iconCls||"")+'"'+(f?' data-qtip="'+f+'"':"")+" ></div>"}return d},constructor:function(e){let t=this;e||(e={}),e.items=[{tagName:"div",autoEl:"div",iconCls:"ub-favorites-img",handler:function(){t.onFavoritesClick.apply(t,arguments)}}],t.filterCaption=UB.i18n("gridFavoritesCaption"),t.callParent([e])},initComponent:function(){this.timers={};let e=$App.connection.appConfig.uiSettings.adminUI.favoriteCategoryCount;e&&(this.allowedCategoryCount=e),this.callParent(arguments)},onFavoritesClick:function(e,t,n,i,o){let r=this,a=e.getStore(),s=a.getAt(t),l=s.baseValue,c=a.ubRequest.entity,u=$App.domainInfo.get(c).getEntityAttributeInfo(this.dataIndex,-1),d=this.dataIndex.split(".");d=u.attributeCode===d[0]?"ID":d.slice(0,d.length-2).join(".");let f=s.get(d);if(!f)throw new Error('You must add column "'+d+'" to fieldList');let h=parseInt(l&&l[0],10)||0,p=l&&l[1]||"0",m=(h+1)%r.allowedCategoryCount+p;r.timers[f]&&clearTimeout(r.timers[f]),r.updateCls(o.target,l,m),s.baseValue=m,r.timers[f]=setTimeout((function(){delete r.timers[f],r.startUpdateFavorites(f,l,m,o.target,u,s)}),r.updateDelay||300)},updateCls:function(e,t,n){let i=Ext.fly(e);i.removeCls(this.getCls(t)),i.addCls(this.getCls(n))},getCls:function(e){switch(e&&e[0]){case"1":return"ub-favorites-img-yellow";case"2":return"ub-favorites-img-green";case"3":return"ub-favorites-img-red";default:return"ub-favorites-img-empty"}},startUpdateFavorites:function(e,t,n,i,o,r){let a,s=this,l=o.attribute.associatedEntity,c=o.attribute.associationAttr;a=t?UB.Repository(l).attrs(["ID",c,"ubUser","code"]).where(c,"=",e).where("ubUser","=",$App.connection.userData("userID")).select():$App.connection.addNew({entity:l,fieldList:["ID",c,"ubUser","code"]}).then((function(e){return UB.LocalDataStore.selectResultToArrayOfObjects(e)})),a.then((function(o){let a=o[0]||{};a.code=n,a.instanceID=e,a.ubUser=$App.connection.userData("userID");let c={entity:l,method:"00"===a.code?"delete":t&&a.ID?"update":"insert",execParams:a};return $App.connection.query(c).catch((function(){s.updateCls(i,t,r.baseValue),r.baseValue=t}))}))},statics:{prepareConditions:function(e,t,n){let i=t.split("."),o="favFtrUsr"+i[0],r=t.split(".");r=n.attributeCode===r[0]?"ID":r.slice(0,r.length-2).join(".");let a=!1;for(let t=0;t<e.fieldList.length;t++){let n=e.fieldList[t];if(n.name===r||"object"==typeof n&&n.name===r){a=!0;break}}a||e.fieldList.push({name:r,visibility:!1});let s=i.slice(0,i.length-1).join(".")+".ubUser";e.whereList||(e.whereList={}),e.joinAs||(e.joinAs=[]);let l={};l[s]=$App.connection.userData("userID"),e.whereList[o]={expression:"["+s+"]",condition:"equal",values:l},e.joinAs.push(o)}}})},9599:function(e,t,n){n(375);const i=n(1972);Ext.define("UB.view.DocumentVersions",{extend:"UB.view.BaseWindow",height:600,width:800,modal:!0,commandCode:"DocumentVersions",layout:{type:"fit"},constructor:function(){this.callParent(arguments)},initComponent:function(){let e=this;e.maxDeepRevisions=10,e.title=i.i18n("formShowDocRevisions")+" "+e.docContainerBase.initialConfig.fieldLabel;let t,n=e.docRecord.get(e.docAttribute);e.documentInfo={},n&&(e.documentInfo=Ext.JSON.decode(n),t=e.documentInfo.revision);let o=[];e.revisionItems=[],o.push({xtype:"label",text:i.i18n(t>1?"selectDocRevision":"onlyCurrentVersionExists"),margin:"0 0 0 10"});let r=t-e.maxDeepRevisions>0?t-e.maxDeepRevisions:1;if(t>1)for(let n=r;n<=t;n++){let r=Ext.widget("button",{style:"text-weight: bolder",margin:"0 0 0 5",text:n.toString()+(n===t?" "+i.i18n("isLastDocRevision"):""),revisionNum:n,handler:e.loadRevision,scope:e});o.push(r),e.revisionItems.push(r)}e.tBar=Ext.widget("toolbar",{dock:"top",cls:"ub-grid-info-panel",items:o}),e.items=e.items||[];let a=Ext.merge({useRevision:!0,expanded:!0},e.docContainerBase.initialConfig);a.hidden=!1,e.documentConainer=Ext.create("UB.ux.UBDocument",a),e.items.push(e.documentConainer),e.callParent(arguments),e.addDocked([e.tBar])},loadRevision:function(e){let t=this;t.documentInfo.revision=e.revisionNum,t.documentInfo.origName=i.i18n("revisionNum")+e.revisionNum,t.documentConainer.setValue(Ext.JSON.encode(t.documentInfo),t.instanceID,!0),e.addCls("ub-buttondown"),Ext.Array.each(t.revisionItems,(function(t){t.revisionNum!==e.revisionNum&&t.removeCls("ub-buttondown")}))}})},6830:function(e,t,n){n(6872),n(9628),n(2455),n(9943),n(7045),n(4916),n(7185),n(4272),n(6907),n(2526),n(6751),n(7093);const i=n(6486),o=n(1972);Ext.define("UB.view.EntityGridPanel",{extend:"Ext.grid.Panel",alias:"widget.entitygridpanel",cls:"ub-entity-grid",selModel:{mode:"MULTI",pruneRemoved:!1},selType:"cellmodel",disableSearchBar:!1,disableAutoSelectRow:!0,rowHeight:28,uses:["UB.core.UBCommand","UB.view.BaseWindow","UB.view.InputDateWindow","UB.core.UBFormLoader","UB.ux.UBPreFilter"],statics:{actionId:{addNew:"addNew",addNewByCurrent:"addNewByCurrent",prefilter:"prefilter",edit:"edit",del:"del",newVersion:"newVersion",refresh:"refresh",history:"history",accessRight:"accessRight",audit:"audit",itemSelect:"itemSelect",exportXls:"exportXls",exportCsv:"exportCsv",exportHtml:"exportHtml",showPreview:"showPreview",lock:"lock",unLock:"unLock",itemLink:"itemLink",optimizeWidth:"optimizeWidth"},eventId:{addnew:"addnew",addnewbycurrent:"addnewbycurrent",prefilter:"prefilter",edit:"edit",del:"del",filtered:"filtered",newversion:"newversion",accessRight:"accessRight",audit:"audit",refresh:"refresh",history:"history",itemselect:"itemselect",exportXls:"exportXls",exportCsv:"exportCsv",exportHtml:"exportHtml",showPreview:"showPreview",lock:"lock",unLock:"unLock",itemLink:"itemLink",optimizeWidth:"optimizeWidth"},comboBoxAttributesStoreField:{idProperty:"id",dataIndex:"dataIndex",header:"header"},hotKeys:{edit:{key:Ext.EventObject.E,ctrl:!0,shift:!1,text:" (Ctrl+E)"},del:{key:Ext.EventObject.DELETE,ctrl:!0,shift:!1,text:" (Ctrl+Delete)"},addNew:{key:Ext.EventObject.INSERT,ctrl:!0,shift:!1,text:" (Ctrl+Ins)"},refresh:{ctrl:!0,key:Ext.EventObject.R,shift:!1,text:" (Ctrl+R)"},itemSelect:{key:Ext.EventObject.ENTER,shift:!1,ctrl:!1,text:" (ENTER)"},prefilter:{ctrl:!0,key:Ext.EventObject.F,shift:!0,text:" (Ctrl+Shift+F)"}},columnParams:{String:{minSize:20,maxSize:80},Text:{minSize:20,maxSize:80},Date:{minSize:13,maxSize:20},DateTime:{minSize:17,maxSize:20},Int:{minSize:13,maxSize:20},Enum:{minSize:20,maxSize:30},Float:{minSize:16,maxSize:20},Currency:{minSize:16,maxSize:20},Boolean:{minSize:8,maxSize:20}},getGridCharWidth:function(){if(!this.gridCharWidth){let e=document.createElement("div");e.style.width="auto",e.style.height="auto",e.style.border=0,e.style.padding=0,e.style.margin=0,e.className="x-grid-cell",e.innerHTML="pppppppppp",e.style.position="absolute",e.style.float="left",e.style.whiteSpace="nowrap",e.style.visibility="hidden",document.body.appendChild(e),this.gridCharWidth=e.clientWidth/10,document.body.removeChild(e)}return this.gridCharWidth},getGridHeaderCharWidth:function(){if(!this.gridHeaderCharWidth){let e=document.createElement("div");e.style.width="auto",e.style.height="auto",e.style.border=0,e.style.padding=0,e.style.margin=0,e.className="x-column-header",e.innerHTML="pppppppppp",e.style.position="absolute",e.style.float="left",e.style.whiteSpace="nowrap",e.style.visibility="hidden",document.body.appendChild(e),this.gridHeaderCharWidth=e.clientWidth/10,document.body.removeChild(e)}return this.gridHeaderCharWidth},getEntityColumns:function(e,t,n,r,a){let s=[],l=$App.domainInfo.get(e);for(let c=0,u=(t=t||o.Utils.convertFieldListToExtended(l.filterAttribute({defaultView:!0}))).length;c<u;++c){let u=l.getEntityAttributeInfo(t[c].name,-1);if(u.attribute&&u.attribute.customSettings&&u.attribute.customSettings.UIGridColumnClass){s.push({xtype:"column"+u.attribute.customSettings.UIGridColumnClass.toLowerCase(),header:"",menuText:o.i18n(u.attribute.customSettings.UIGridColumnClass.toLowerCase()),dataIndex:t[c].name,stateId:u.attribute.customSettings.UIGridColumnClass.toLowerCase()+t[c].name,fieldName:t[c].name});continue}let d=o.view.EntityGridPanel.getEntityColumn(e,t[c],n,a);if(d){if(r){let e=t[c].name.indexOf(".")+1?t[c].name.substring(0,t[c].name.indexOf(".")):t[c].name,n=l.attributes[e],r={};n.dataType===UBDomain.ubDataTypes.Entity?(t[c].editor&&t[c].editor.fieldList?r.fieldList=t[c].editor.fieldList:t[c].name.indexOf(".")+1?r.fieldList=["ID",t[c].name.substring(t[c].name.indexOf(".")+1)]:r.fieldList=["ID",$App.domainInfo.get(n.associatedEntity).getDescriptionAttribute()],t[c].editor&&(t[c].editor.whereList&&(r.whereList=t[c].editor.whereList),t[c].editor.orderList&&(r.orderList=t[c].editor.orderList)),d.editor=o.core.UBUtil.ubDt2Ext(n,r),d.editor.valueField=d.editor.displayField,d.editor.storeAttributeValueField=e,!1===n.allowNull&&(d.editor.allowBlank=!1)):(d.editor=o.core.UBUtil.ubDt2Ext(n,r),!1===n.allowNull&&(d.editor.allowBlank=!1)),d.editor.margin="0 1 0 1",t[c].editor&&i.extend(d.editor,t[c].editor)}s.push(d)}}return s.length<3&&s.forEach((function(e){e.flex||e.width||(e.flex=1,delete e.stateId)})),s},getEntityColumn:function(e,t,n,r){let a=$App.domainInfo,s=t.name,l=t.format&&"function"!=typeof t.format?t.format:null,c=a.get(e),u=c.getEntityAttributeInfo(s);if(!c||!u)return null;let d=u.attribute;if(!d){if(!u.parentAttribute||u.parentAttribute.dataType!==UBDomain.ubDataTypes.Json)return null;d={dataType:"String"}}if(!u.parentAttribute&&!1===t.visibility)return null;let f="";if(!t.description)if(u.parentAttribute){f=`${u.parentAttribute.caption}.${u.attribute.caption}`;let e=c.getEntityAttributeInfo(s,-1);e.parentAttribute&&(f=`${e.parentAttribute.caption}.${f}`)}else f=u.attribute.caption;let h={stateId:s,fieldName:s};h.dataIndex=s,h.header=t.description||f||o.i18n(d.code),h.tooltip=t.tooltip||t.description||f,h.sortable=!1===r?r:t.hasOwnProperty("sortable")?t.sortable&&"Text"!==d.dataType:"Text"!==d.dataType&&d.allowSort,h.simpleFilter=t.simpleFilter,h.filterCaption=t.filterCaption;let p=a.ubDataTypes;switch(d.dataType){case p.Enum:let e=o.core.UBEnumManager.getDictionary(d.enumGroup,"name");h.renderer=function(t){return e[t]};break;case p.Entity:let t=a.get(d.associatedEntity).descriptionAttribute||"caption",i=n[o.core.UBUtil.getNameMd5(d.associatedEntity,["ID",t])];h.renderer=function(e){let n=i.getById(e);return n?n.get(t):""};break;case p.Date:h.renderer=Ext.util.Format.dateRenderer(l||Ext.util.Format.dateFormat||"d.m.Y"),h.filter={type:"date",dataIndex:h.dataIndex,dateFormat:Ext.util.Format.dateFormat};break;case p.DateTime:h.renderer=Ext.util.Format.dateRenderer(l||Ext.util.Format.datetimeFormat||"d.m.Y G:i"),h.filter={type:"date",dataIndex:h.dataIndex,dateFormat:Ext.util.Format.dateFormat};break;case p.Float:h.align="right",h.renderer=Ext.util.Format.numberRenderer(l||"0,000."+"".padStart(UBDomain.FLOATING_SCALE_PRECISION,"0"));break;case p.Currency:h.align="right",h.renderer=Ext.util.Format.numberRenderer(l||"0.00");break;case p.Int:h.renderer=Ext.util.Format.numberRenderer(l||"0,000"),h.align="right";break;case p.Boolean:h.xtype="booleancolumn",h.trueText=o.i18n("Yes"),h.falseText=o.i18n("No");break;case p.String:case p.Text:h.renderer=function(e,t){let n=Ext.String.htmlEncode(e);return t&&Ext.isString(e)&&e.length>15&&(t.tdAttr='data-qtip="'+Ext.String.htmlEncode(n)+'"'),n}}return h.filterable=!1!==t.filterable,t.format&&"function"==typeof t.format&&(h.renderer=t.format),t.summaryType&&(h.summaryType=t.summaryType),t.config?i.defaults(i.clone(t.config),h):h},loadRunListParamsRequirementsStores:function(e){let t={},n=$App.domainInfo.get(e.entity).getEntityRequirements(o.core.UBUtil.convertFieldListToNameList(e.fieldList,!0));for(let i=0,r=n.length;i<r;++i){let r=$App.domainInfo.get(n[i]).descriptionAttribute,a=["ID"];"ID"!==r&&a.push(r);let s=o.core.UBUtil.getNameMd5(n[i],a);if(!t[s]){let r=Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:n[i],method:"select",fieldList:a,options:{limit:o.LIMITS.lookupMaxRows}},autoLoad:!1,disablePaging:!0,autoDestroy:!0,createIndexByID:!0});r.lookUpEntity=e.entity,r.lookUpField=n[i],r.on("load",(function(t,n,i){if(i&&n){const t=n.length;t>=o.LIMITS.lookupMaxRows?o.logError(`Lookups: Entity "${e.entity}" result truncated to ${o.LIMITS.lookupMaxRows} records to prevent performance problems. Consider to avoid lookp'ing to a huge entities`):t>=o.LIMITS.lookupWarningRows&&o.logWarn(`Lookups: Too many rows (${t}) returned for "${e.entity}" lookup. Consider to avoid lookups for huge entities to prevents performance degradation`)}}),r,{single:!0}),t[s]=r}}return t}},mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},selectedRecordID:null,viewType:"ubtableview",customActions:[],hidePagingBar:!1,hideMenuAllActions:!1,minRowsPagingBarVisibled:11,hideActionToolbar:!1,toolbarActionList:null,readOnly:!1,notWriteChanges:!1,rowEditing:!1,summaryDataOnClient:!1,menuAllActionsActionList:null,hideActions:[],onEntityChangedListener:null,applyState:function(){this.callParent(arguments),this.stateLoadedFromStore=!0},onOptimizeWidth:function(){this.optimizeColumnWidth(!0)},getData:function(){let e=[];return this.getStore().data.items.forEach((function(t){e.push(t.getData())})),e},getAttributeData:function(){let e={insert:[],update:[],del:[]};return this.getStore().data.items.forEach((function(t){let n=t.getData();if(Object.keys(n).forEach((function(e){e.indexOf(".")+1&&delete n[e]})),n.ID){if(t.dirty){let i=t.getChanges(),o={ID:n.ID};n.mi_modifyDate&&(o.mi_modifyDate=n.mi_modifyDate),Object.keys(i).forEach((function(e){e.indexOf(".")+1||(o[e]=n[e])})),e.update.push(o)}}else e.insert.push(n)})),this.getStore().getRemovedRecords().forEach((function(t){t.getData().ID&&e.del.push(t.getData())})),e},optimizeColumnWidth:function(e){let t,n,r,a,s,l=this,c={},u=0,d=0,f=0,h={},p=0,m=o.view.EntityGridPanel.columnParams;if((l.stateLoadedFromStore||l.columns.length<3)&&!e)return;let g=l.getEl().getWidth();i.forEach(l.store.model.getFields(),(function(e){c[e.name]=e}));let y=$App.domainInfo.get(l.entityName);l.columns.forEach((function(e){if(n={},!e.dataIndex)return;let t=y.attr(e.dataIndex);if(t||c[e.dataIndex]){if(t)n.type=t.dataType,n.size=t.size;else{switch(n.type=c[e.dataIndex].type.type,n.type){case"string":n.type="String";break;case"int":n.type="Int";break;case"float":n.type="Float";break;case"boolean":n.type="Boolean";break;case"date":n.type="Date"}n.size=m[n.type]&&m[n.type].minSize||20}n.minSize=e.minWidthChar||m[n.type]&&m[n.type].minSize||20,n.maxSize=e.maxWidthChar||m[n.type]&&m[n.type].maxSize||80,n.size&&n.size<n.maxSize&&(n.maxSize=n.size<20?20:n.size),n.size||(n.size=n.minSize),n.size>n.maxSize&&(n.size=n.maxSize),u+=n.size,p+=n.size<n.minWidth?n.size:n.minSize,n.column=e,h[e.dataIndex]=n}})),t=o.view.EntityGridPanel.getGridCharWidth(),g-=l.columns.length+1,g-=8*l.columns.length,g-=12,a=g/t,u>a&&(f=0,a>p&&(f=a-p),s=l.columns.length,i.forEachRight(l.columns,(function(e){n=h[e.dataIndex],n&&(d=f>0?Math.round(f/s)||1:0,n.size>n.minSize&&(n.minSize+d>n.maxSize?(n.size=n.maxSize,f-=n.maxSize-n.minSize):(n.size=n.minSize+d,f-=d)),s-=1)}))),u=function(){let e=0;return i.forEach(h,(function(t){e+=t.size||t.minSize})),e}(),u<a&&(r=o.view.EntityGridPanel.getGridHeaderCharWidth(),f=a-u,s=l.columns.length,i.forEach(l.columns,(function(e){n=h[e.dataIndex],n&&(d=Math.round(f/s)||1,n.headerWidth=(e.text.length>20?20:e.text.length)*r/t,n.headerWidth>n.size+d?(f-=n.headerWidth-n.size,n.size=n.headerWidth):n.size+d>n.maxSize?(f-=n.maxSize-n.size,n.size=n.maxSize):(f-=d,n.size+=d),s-=1)}))),u=0,l.suspendLayouts(),i.forEach(h,(function(e){u+=e.size*t,e.column.setWidth(e.size*t+8)})),l.resumeLayouts()},createStoreByConfig:function(){let e,t=this,n=Ext.clone(t.entityConfig);t.stores=e=o.view.EntityGridPanel.loadRunListParamsRequirementsStores(n),n.fieldList=o.core.UBUtil.convertFieldListToNameList(n.fieldList),t.rowEditing&&n.fieldList.forEach((function(e){let t=$App.domainInfo.get(n.entity),i=e.indexOf("."),o=-1!==i?e.substring(0,i):e,r=t.attributes[o];r&&r.dataType===UBDomain.ubDataTypes.Entity&&-1!==i&&!n.fieldList.includes(o)&&n.fieldList.push(o)})),t.store=Ext.create("UB.ux.data.UBStore",{ubRequest:n,autoLoad:!1,linkedItemsLoadList:e,pageSize:t.pageSize||o.appConfig.storeDefaultPageSize,autoDestroy:!0}),t.store.on("load",t.onLoadStore,t),t.filters&&(t.filters instanceof Ext.util.MixedCollection&&(t.filters=t.filters.items),t.store.filters.addAll(t.filters)),t.entityName=n.entity,t.loadStoreImmediately&&(!t.autoFilter||t.autoFilter&&t.autoFilter.notShowBefore)&&!t.disableAutoLoadStore&&t.store.load()},createAutoFilter:function(){let e=this;e.autoFilterActive=!0,e.disableAutoShow=!0,e.preFilterForm=o.ux.UBPreFilter.makeFilters({options:e.autoFilter,entityCode:e.entityName,filters:e.baseFilters,onFilterReady:function(t,n){e.preFilterForm=null,t&&t.length>0&&e.store.addFilter(t,!1),n&&(e.store.filterFormId=n),e.autoFilterActive=!1,(e.rendered||e.store.isLoading())&&e.store.load();let i=e.up("window");i&&i.show()},onCancel:function(){e.preFilterForm=null,e.close()},scope:e})},createSystemConditions:function(){let e=this;e.entityConfig&&e.entityConfig.fieldList&&e.entityConfig.fieldList.forEach((function(t){let n="object"==typeof t?t.name:t,i=$App.domainInfo.get(e.entityConfig.entity).getEntityAttributeInfo(n,-1),r=i.attribute&&i.attribute.customSettings&&i.attribute.customSettings.UIGridColumnClass?i.attribute.customSettings.UIGridColumnClass:null;r&&o.view["Column"+r]&&o.view["Column"+r].prepareConditions&&o.view["Column"+r].prepareConditions(e.entityConfig,n,i)}))},onLoadStore:function(e,t,n){n&&0!==t.length?(this.enableAction("edit"),this.enableAction("del"),this.enableAction("showPreview"),this.enableAction("lock"),this.enableAction("unLock"),this.enableAction("itemLink")):(this.disableAction("edit"),this.disableAction("del"),this.disableAction("showPreview"),this.disableAction("lock"),this.disableAction("unLock"),this.disableAction("itemLink"))},createPopupMenu:function(){let e=this,t=o.view.EntityGridPanel.actionId,n=[e.actions[t.edit],e.actions[t.addNewByCurrent],e.actions[t.del]];e.hasDataHistoryMixin&&!e.isHistory&&(n.push("-"),n.push(e.actions[t.newVersion]),n.push(e.actions[t.history])),e.hasAuditMixin&&(n.push("-"),n.push(e.actions[t.audit])),e.hasHardSecurityMixin&&(n.push("-"),n.push(e.actions[t.accessRight])),e.entityDetails.length&&!e.disableMenuItemDetails&&(n.push("-"),n.push(e.createMenuItemDetails())),n.push("-"),n.push(e.actions[t.itemLink]),e.menu=Ext.create("Ext.menu.Menu",{items:n}),e.popupMenuItems=n},initComponent:function(){let e=this;if(!e.extendedFieldList&&e.entityConfig&&(e.extendedFieldList=o.core.UBUtil.convertFieldListToExtended(e.entityConfig.fieldList)),e.createSystemConditions(),!e.store&&e.entityConfig?e.createStoreByConfig():(e.entityConfig&&(e.entityName=e.entityConfig.entity),e.store&&(e.store.on("load",e.onLoadStore,e),e.store.ubRequest&&e.store.ubRequest.entity&&(e.entityName=e.store.ubRequest.entity)),e.store&&e.loadStoreImmediately&&(!e.autoFilter||e.autoFilter&&e.autoFilter.notShowBefore)&&!e.disableAutoLoadStore&&e.store.load()),e.entity=$App.domainInfo.get(e.entityName),e.onEntityChangedListener=function(){this.onRefresh()}.bind(e),o.connection.on(`${e.entityName}:changed`,e.onEntityChangedListener),!e.entity)throw new Error("You must specify entity");if(e.isHistory=e.store&&e.store.ubRequest&&e.store.ubRequest.__mip_recordhistory,e.isHistory&&(e.miDataID=e.store.ubRequest.id||e.store.ubRequest.ID),e.autoFilter&&!e.autoFilter.notShowBefore&&e.createAutoFilter(),e.columns=e.columns||o.view.EntityGridPanel.getEntityColumns(e.entityName,e.getVisibleColumns(),e.stores,e.rowEditing,e.hasOwnProperty("sortableColumns")?e.sortableColumns:void 0),e.extendedColumns){let t={};e.columns.forEach((function(e){e.dataIndex&&(t[e.dataIndex]=e)})),e.extendedColumns.forEach((function(n){n.dataIndex&&t[n.dataIndex]?i.merge(t[n.dataIndex],n):e.columns.push(n)}))}if(e.getRowClass=e.getRowClass||Ext.emptyFn,Ext.apply(e,{viewConfig:{enableTextSelection:!0,blockRefresh:!1,listeners:{itemcontextmenu:{fn:e.onItemContextMenu,scope:e},refresh:{fn:e.onViewRefreshed,scope:e}},getRowClass:e.getRowClass}}),e.rowEditing){let t=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,clicksToMoveEditor:2,saveBtnText:o.i18n("save"),cancelBtnText:o.i18n("actionCancel"),autoCancel:!1,errorSummary:!1});t.on("canceledit",(function(t,n){(!n.record.get("ID")&&!e.notWriteChanges||e.notWriteChanges&&n.record.phantom&&null!==n.record.dirtySave)&&n.store.remove(n.record),e.fireEvent("changeData",e,"cancelEdit")})),t.on("beforeedit",(function(t,n){if(e.editingPlugin.editing||e.readOnly||!e.entity.haveAccessToMethod(o.core.UBCommand.methodName.UPDATE))return!1;if(n.grid.columns.forEach((t=>{t.field&&t.field.setWidth(t.width-2),e.GridSummary&&i.find(e.GridSummary.items.items,{baseColumn:t}).setWidth(t.width-2),t.field&&(i.has(t.field,"events.change")&&"function"==typeof t.field.events.change.clearListeners&&t.field.events.change.clearListeners(),t.field.xtype.indexOf("combobox")+1&&t.field.setValue())})),e.lineNumberColumn&&!n.record.get(e.lineNumberColumn)){let t=i.find(n.grid.columns,{dataIndex:e.lineNumberColumn});t&&(t.field.setValue(),n.record.set(e.lineNumberColumn,n.grid.getStore().max(e.lineNumberColumn)+1))}if("function"==typeof e.onBeforeEdit&&!1===e.onBeforeEdit(t,n))return!1;i.filter(n.grid.columns,(function(e){return e.getEditor()&&e.getEditor().xtype.indexOf("combobox")>=0})).forEach((function(e){if(!e.field.gridFieldList){let t=$App.domainInfo.get(e.field.getStore().entityName).getAttributeNames({defaultView:!0});t.includes(e.field.displayField)||t.push(e.field.displayField),t.includes(e.field.valueField)||t.push(e.field.valueField),e.field.gridFieldList=t}e.field.disableModifyEntity=!0,e.field.useForGridEdit=!0,n.record.get(e.field.name)||e.field.getStore().load()}))})),t.on("validateedit",(function(t,n){const i=n.grid.columns.filter((function(e){return e.field.getValue()&&e.field.lastSelection&&!e.field.lastSelection.length})).map((function(e){return e.text}));return i.length?($App.dialogInfo(o.format(o.i18n("notValidForColumns"),`<br> ${i.join("<br>")}`)),!1):("function"!=typeof e.onValidateEdit||!1!==e.onValidateEdit(t,n))&&void 0})),e.plugins?e.plugins.push(t):e.plugins=[t]}e.plugins||(e.plugins=[]),e.dockedItems||(e.dockedItems=[]),e.summary&&(Ext.isObject(e.summary)&&i.forEach(e.summary,(function(t,n){i.forEach(e.columns,(function(e){if(e.fieldName===n)return e.summaryType=t,!1}))})),e.GridSummary=new o.view.GridSummary({grid:e}),e.dockedItems.push(e.GridSummary),e.store&&e.store.on("clear",(function(){e.GridSummary&&e.GridSummary.dataBind()}))),e.disableSearchBar||e.plugins.push({ptype:"multifilter"}),e.isDetail&&(e.target.ownerCt.mainEntityGridPanel.on("parentchange",e.onParentChange,e),e.mainEntityGridPanel=e.target.ownerCt.mainEntityGridPanel,e.on("close",(function(){let t=e.up("tabpanel");t&&1===t.items.getCount()&&(t.relatedSplitter.hide(),t.hide(),t.ownerCt.doLayout()),t.mainPanel.mainEntityGridPanel.onDetailClose(e.entityName)}),e)),e.hasDataHistoryMixin=e.entity.hasMixin("dataHistory"),e.hasAuditMixin=e.entity.hasMixin("audit"),e.hasHardSecurityMixin=e.entity.hasMixin("aclRls"),e.isEntityLockable=e.entity.hasMixin("softLock"),e.createComboBoxAttributesStore(),e.preprocessPanel(),e.hideActions.includes("showDetail")&&(e.disableMenuItemDetails=!0),e.createPopupMenu(),e.on({selectionchange:e.onSelectionChange,viewready:e.onViewReady,boxready:function(){e.optimizeColumnWidth(),e.disableAutoSelectRow&&!e.selectedRecordID||e.selectDefaultRow(),e.setupActions(),e.initPagingToolbar(),e.store.isLoading()||e.autoFilterActive||e.forceDataLoad||e.store.load(),e.notWriteChanges&&e.GridSummary&&e.GridSummary.dataBind();let t=e.getFormWin();t&&e.mon(t,"close",e.onPanelClose,e)},deselect:function(t,n,i){e.getView().removeRowCls(i,"ub-grid-row-selected")},select:function(t,n,i){e.getView().addRowCls(i,"ub-grid-row-selected")},scope:e}),e.addEvents("parentchange"),e.on("sortchange",(function(){e.store.currentPage=1})),e.bBar=Ext.widget("toolbar",{dock:"top",border:"1 0 0 0",cls:"ub-grid-info-panel",style:"border-top-width: 1px !important;",hidden:!0,items:[e.filterBar=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1})]}),e.store.on({load:function(){e.updateVisibleBBar()}}),e.details&&e.store.on("load",(function(){e.details.forEach((function(t){t&&t.autoShow&&e.doShowDetail(t)}))}),e,{single:!0}),e.on("close",e.onPanelClose,e),e.dockedItems.push(e.bBar),e.callParent(arguments),"function"==typeof this.afterInit&&this.afterInit()},lazyPagingToolbarInit:function(){if(this.floatToolbarEl)return;let e=this,t=e.getEl();e.floatToolbarEl=Ext.DomHelper.append(t,{tag:"div",cls:"ub-float-toolbar"},!0),e.pagingBar=Ext.create("UB.view.PagingToolbar",{renderTo:e.floatToolbarEl,isPagingBar:!0,cls:"ub-grid-info-panel-tb",padding:"0 0 0 5",autoCalcTotal:e.autoCalcTotal,store:e.store})},initPagingToolbar:function(){let e=this;e.hidePagingBar||e.store.on("refresh",(function(){1===e.store.currentPage&&e.store.getCount()<e.minRowsPagingBarVisibled?e.floatToolbarEl&&e.floatToolbarEl.hide():(e.lazyPagingToolbarInit(),e.floatToolbarEl.isVisible()||e.floatToolbarEl.show())}))},getFormWin:function(){return this.formWin||(this.formWin=this.up("window")),this.formWin},onPanelClose:function(){let e=this;e.onClose&&"function"==typeof e.onClose&&(e.isDeleted?e.onClose(null,e.store):e.onClose(e.isNewInstance?null:e.instanceID,e.store)),e.fireEvent("beforeClose",e)},updateVisibleBBar:function(){let e=this.bBar.isVisible(),t=0===this.filterBar.items.length||!this.filterBar.items.getAt(0).mustBeVisibled;t&&e?this.bBar.setVisible(!1):e||t||this.bBar.setVisible(!0)},onViewRefreshed:function(e){let t=this.getStore();if((null===this.focusOnUpdate||void 0===this.focusOnUpdate||this.focusOnUpdate)&&t.getCount()>0&&!this.disableAutoSelectRow&&e.focusRow(t.getAt(0)),this.mainEntityGridPanel){let e=this.mainEntityGridPanel.getView();e&&e.focus()}},clearBBar:function(){for(let e=this.bBar.items.getCount()-1;e>=0;e--){let t=this.bBar.items.getAt(e);this.bBar.remove(t,!t.isPagingBar)}},getVisibleColumns:function(){let e=this;return this.extendedFieldList.filter((function(t){return t.name!==e.detailAttribute&&!1!==t.visibility}))},initState:function(){let e,t=this.stateful&&this.getStateId();t&&(e=Ext.state.Manager.get(t))&&(delete e.sort,delete e.storeState,Ext.state.Manager.set(t,e)),this.callParent(arguments)},createComboBoxAttributesStore:function(){let e=o.view.EntityGridPanel.comboBoxAttributesStoreField,t=e.idProperty,n=e.header,i=e.dataIndex,r=[];for(let e=0,o=this.columns.length;e<o;++e){let o=this.columns[e],a={};a[t]=o[i],a[n]=o[n],r.push(a)}this.comboBoxAttributesStore=Ext.create("Ext.data.Store",{fields:[t,n],data:r})},addBaseActions:function(){let e=this,t=o.view.EntityGridPanel.actionId,n=o.view.EntityGridPanel.eventId,i=o.view.EntityGridPanel.hotKeys,r=o.core.UBCommand.methodName;e.actions[t.addNew]=new Ext.Action({actionId:t.addNew,scale:"medium",iconCls:"u-icon-add",cls:"add-new-action",text:o.i18n("actionAdd")+i[t.addNew].text,eventId:n.addnew,handler:e.onAction,disabled:!e.entity.haveAccessToMethods([r.ADDNEW,r.INSERT]),scope:e}),e.actions[t.addNewByCurrent]=new Ext.Action({actionId:t.addNewByCurrent,scale:"medium",iconCls:"u-icon-copy",cls:"add-currect-action",text:o.i18n("Copy"),eventId:n.addnewbycurrent,handler:e.onAction,disabled:!e.entity.haveAccessToMethod(r.ADDNEW),scope:e}),e.rowEditing||(e.actions[t.edit]=new Ext.Action({actionId:t.edit,scale:"medium",iconCls:"u-icon-edit",cls:"edit-action",text:o.i18n("Edit")+i[t.edit].text,eventId:n.edit,handler:e.onAction,disabled:!e.entity.haveAccessToMethod(r.UPDATE),scope:e})),e.actions[t.del]=new Ext.Action({actionId:t.del,scale:"medium",iconCls:"u-icon-delete",cls:"delete-action",text:o.i18n("Delete")+i[t.del].text,eventId:n.del,handler:e.onAction,disabled:!e.entity.haveAccessToMethod(r.DELETE),scope:e}),e.actions[t.showPreview]=new Ext.Action({actionId:t.showPreview,scale:"medium",iconCls:"u-icon-eye",text:o.i18n("showPreview"),eventId:n.showPreview,handler:e.onAction,disabled:!1,scope:e}),e.hasDataHistoryMixin&&(e.actions[t.newVersion]=new Ext.Action({actionId:t.newVersion,iconCls:"iconNewVersion",text:o.i18n("novajaVersija"),eventId:n.newversion,handler:e.onAction,disabled:!e.entity.haveAccessToMethod(r.NEWVERSION),scope:e}),e.actions[t.history]=new Ext.Action({actionId:t.history,iconCls:"iconHistory",text:o.i18n("ChangesHistory"),eventId:n.history,handler:e.onAction,scope:e})),e.hasAuditMixin&&(e.actions[t.audit]=new Ext.Action({actionId:t.audit,text:o.i18n("showAudit"),eventId:n.audit,handler:e.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible("uba_auditTrail","select"),scope:e})),e.hasHardSecurityMixin&&(e.actions[t.accessRight]=new Ext.Action({actionId:t.accessRight,text:o.i18n("accessRight"),eventId:n.accessRight,handler:e.onAction,disabled:!e.entity.haveAccessToMethod("select"),scope:e})),e.actions[t.refresh]=new Ext.Action({actionId:t.refresh,scale:"medium",iconCls:"u-icon-refresh",cls:"refresh-action",text:o.i18n("refresh")+i[t.refresh].text,eventId:n.refresh,handler:e.onAction,scope:e}),e.isModal&&(e.actions[t.itemSelect]=new Ext.Action({actionId:t.itemSelect,scale:"medium",iconCls:"u-icon-check",text:o.i18n("vybrat"),eventId:n.itemselect,handler:e.onAction,scope:e})),e.autoFilter&&(e.actions[t.prefilter]=new Ext.Action({actionId:t.prefilter,scale:"medium",iconCls:"u-icon-filter",text:o.i18n("showPreFilter")+i[t.prefilter].text,eventId:n.prefilter,handler:e.onAction,scope:e})),e.actions[t.lock]=new Ext.Action({actionId:t.lock,scale:"medium",iconCls:"u-icon-lock",text:o.i18n("lockBtn"),eventId:n.lock,handler:e.onAction,scope:e}),e.actions[t.unLock]=new Ext.Action({actionId:t.unLock,scale:"medium",iconCls:"u-icon-unlock",text:o.i18n("unLockBtn"),eventId:n.unLock,handler:e.onAction,scope:e}),e.actions[t.exportXls]=new Ext.Action({actionId:t.exportXls,iconCls:"u-icon-file-excel",text:o.i18n("exportXls"),eventId:n.exportXls,handler:e.onAction,scope:e}),e.actions[t.exportCsv]=new Ext.Action({actionId:t.exportCsv,text:o.i18n("exportCsv"),eventId:n.exportCsv,handler:e.onAction,scope:e}),e.actions[t.exportHtml]=new Ext.Action({actionId:t.exportHtml,iconCls:"u-icon-file-html",text:o.i18n("exportHtml"),eventId:n.exportHtml,handler:e.onAction,scope:e}),e.actions[t.itemLink]=new Ext.Action({actionId:t.itemLink,text:o.i18n("gridItemLink"),eventId:n.itemLink,handler:e.onAction,scope:e}),e.actions[t.optimizeWidth]=new Ext.Action({actionId:t.optimizeWidth,text:o.i18n("gridOptimizeWidth"),eventId:n.optimizeWidth,handler:e.onAction,scope:e})},addBaseDockedItems:function(){let e=this,t=o.view.EntityGridPanel.actionId,n=Ext.isArray(e.customActions)&&e.customActions.length,i=Ext.isArray(e.toolbarActionList)&&0===e.toolbarActionList.length&&!n,r=e.hideMenuAllActions,a=e.menuAllActionsActionList||[t.itemSelect,t.refresh,t.edit,t.addNew,t.addNewByCurrent,t.del,t.showPreview,t.prefilter,"-",e.createMenuItemLink()],s=[];if(Ext.Array.each(a,(function(t){let n=e.actions[t];n&&s.push(n)})),s.push("-"),s.push(e.createMenuItemLink()),s.push(e.actions[t.itemLink]),this.hasDataHistoryMixin&&!this.isHistory&&(s.push("-"),s.push(e.actions[t.newVersion]),s.push(e.actions[t.history])),e.hasAuditMixin&&(s.push("-"),s.push(e.actions[t.audit])),e.hasHardSecurityMixin&&(s.push("-"),s.push(e.actions[t.accessRight])),e.isEntityLockable&&(s.push("-"),s.push(e.actions[t.lock]),s.push(e.actions[t.unLock])),s.push(e.actions[t.optimizeWidth]),n){s.push("-");let t=e.customActions;for(let e=0,n=t.length;e<n;++e)s.push(new Ext.Action(t[e]))}e.hideActions.includes(t.exportXls)&&e.hideActions.includes(t.exportCsv)&&e.hideActions.includes(t.exportCsv)||(s.push("-"),s.push(e.createMenuExport())),e.entityDetails.length&&!e.disableMenuItemDetails&&(s.push("-"),e.menuItemDetails=e.createMenuItemDetails(),s.push(e.menuItemDetails));let l=e.toolbarActionList||[t.refresh,t.addNew],c=[];Ext.Array.each(l,(function(t){c.push(e.createButtonWOText(e.actions[t]))})),Ext.Array.each(e.customActions,(function(t){c.push(e.createButtonWOText(new Ext.Action(t)))})),e.isModal&&c.push(e.createButtonWOText(e.actions[t.itemSelect])),c.push("->",{menuId:"AllActions",scale:"medium",iconCls:"u-icon-setting",arrowCls:"",tooltip:o.i18n("allActions"),menu:s,hidden:r}),e.dockedItems||(e.dockedItems=[]),e.dockedItems.unshift({xtype:"toolbar",dock:"top",items:c,hidden:i||e.hideActionToolbar}),e.menuAllActions=s},createMenuExport:function(){let e=[],t=o.view.EntityGridPanel.actionId;return e.push(this.actions[t.exportXls]),e.push(this.actions[t.exportCsv]),e.push(this.actions[t.exportHtml]),Ext.create("Ext.menu.Item",{text:o.i18n("export"),hideOnClick:!1,iconCls:"u-icon-file-export",menu:{items:e}})},addBaseListeners:function(){let e=this,t=o.view.EntityGridPanel.eventId;e.on(t.exportXls,e.onExportXls,e),e.on(t.exportCsv,e.onExportCsv,e),e.on(t.exportHtml,e.onExportHtml,e),e.rowEditing||e.on("itemdblclick",e.onItemDblClick,e),e.on(t.addnew,e.onAddNew,e),e.on(t.addnewbycurrent,e.onAddNewByCurrent,e),e.on(t.edit,e.onEdit,e),e.on(t.del,e.onDel,e),e.on(t.showPreview,e.onShowPreview,e),e.on(t.filtered,e.onFiltered,e),e.on(t.lock,e.onLock,e),e.on(t.unLock,e.onUnLock,e),e.on(t.itemLink,e.onItemLink,e),e.on(t.optimizeWidth,e.onOptimizeWidth,e),e.autoFilter&&e.on(t.prefilter,e.onPrefilter,e),e.hasDataHistoryMixin&&(e.on(t.newversion,e.onNewVersionDataRequest,e),e.on(t.history,e.onHistory,e)),e.hasAuditMixin&&e.on(t.audit,e.onAudit,e),e.hasHardSecurityMixin&&e.on(t.accessRight,e.onAccessRight,e),e.isModal&&e.on(t.itemselect,e.onItemSelect,e),e.on(t.refresh,e.onRefresh,e),e.entityDetails.length&&e.on(o.core.UBPanelMixin.eventId.showdetail,e.onShowDetail,e)},hideAction:function(e,t){let n=this.actions[e];n&&(n.blocked=!0,n.disable(),n.hide(),n.forceHidden=n.forceHidden||!!t),this.actionsKeyMap&&(n=this.actionsKeyMap[e],n&&n.disable())},showAction:function(e,t){let n=this.actions[e];if(n){if(n.forceHidden&&!t)return;n.blocked=!1,n.setDisabled(!1),n.show(),n.forceHidden=!1}this.actionsKeyMap&&(n=this.actionsKeyMap[e],n&&n.setDisabled(!1))},disableAction:function(e){let t=this.actions[e];if(t){if(t.forceHidden)return;t.isDisabled()||t.disable()}this.actionsKeyMap&&(t=this.actionsKeyMap[e],t&&t.disable())},enableAction:function(e){let t=this,n=t.actions[e];if(n){if(n.forceHidden)return;n.isDisabled()&&n.setDisabled(!1),n.forceHidden=!1}t.actionsKeyMap&&(n=t.actionsKeyMap[e],n&&n.setDisabled(!1))},setReadOnly:function(e){this.readOnly=e,this.rendered&&this.setReadOnlyInner(e)},setReadOnlyInner:function(e){e?(this.hideAction("addNew"),this.hideAction("addNewByCurrent"),this.hideAction("del"),this.hideAction("edit"),this.hideAction("newVersion")):(this.showAction("addNew"),this.showAction("addNewByCurrent"),this.showAction("del"),this.showAction("edit"),this.showAction("newVersion"))},afterRender:function(){this.callParent(),this.bindHotkeys(),this.readOnly&&this.setReadOnlyInner(!0)},openForm:function(e){let t,n=this,i=n.up("basepanel");if(i){if(t=i.saveForm(),!t)return}else t=Promise.resolve(0);t.then((function(t){if(-1===t)return;let o=n.parentContext?Ext.clone(n.parentContext):{};n.detailAttribute&&n.parentID&&(o[n.detailAttribute]=n.parentID);let r=n.getStore(),a=n.up("window"),s=!!a&&a.modal,l=n.getFormParam(),c={cmdType:"showForm",formCode:l?l.formCode:l,description:l?l.description:l,entity:l&&l.entityName?l.entityName:n.entityName,instanceID:l&&l.instanceID?l.instanceID:e&&e.instanceID,isModal:!(!i&&!n.isModal),store:r,isModalDialog:s,addByCurrent:e&&e.addByCurrent,__mip_ondate:e&&e.__mip_ondate,parentContext:o,detailAttribute:n.detailAttribute,parentID:n.parentID,sender:n.getView()||n};c.isModal||s||(c.target=$App.viewport.centralPanel,c.tabId=$App.generateTabId({entity:(l?l.entityName:null)||n.entityName,instanceID:c.instanceID,formCode:c.formCode})),l&&l.cmpInitConfig&&(c.cmpInitConfig=l.cmpInitConfig),$App.doCommand(c)}))},onItemDblClick:function(e,t,n,i,o,r){this.isModal?this.onItemSelect():this.doOnEdit(r)},insertRecord:function(e){let t=this,n=[];e.grid.columns.forEach((function(t){t.field&&t.field.storeAttributeValueField&&e.record.set(t.field.storeAttributeValueField,t.field.getValue()&&t.field.lastSelection?t.field.lastSelection[0].get("ID"):null),t.field&&["textareafield","ubtextfield","ubtextareafield"].includes(t.field.xtype)&&void 0!==e.record.modified[t.dataIndex]&&""===e.record.get(t.dataIndex)&&e.record.set(t.dataIndex,null)}));let i=e.record.getData();Object.keys(i).forEach((function(e){e.indexOf(".")+1||"ID"===e||"mi_modifyDate"===e?delete i[e]:n.push(e)})),e.grid.detailFields&&e.grid.detailFields.length&&e.grid.detailFields.forEach((function(t){n.push(t),i[t]=e.grid.parentContext[t]})),t.notWriteChanges?(!t.hideActions.includes("del")&&t.entity.haveAccessToMethod(o.core.UBCommand.methodName.DELETE)&&t.enableAction("del"),t.GridSummary&&t.GridSummary.dataBind(),t.fireEvent("changeData",t,"insert")):$App.connection.run({entity:this.entityName,method:"insert",fieldList:n,execParams:i}).then((function(n){e.record.set("ID",n.execParams.ID),n.execParams.mi_modifyDate&&e.record.set("mi_modifyDate",new Date(n.execParams.mi_modifyDate)),e.record.commit(),t.GridSummary&&t.GridSummary.dataBind(),!t.hideActions.includes("del")&&t.entity.haveAccessToMethod(o.core.UBCommand.methodName.DELETE)&&t.enableAction("del"),t.fireEvent("changeData",t,"insert")}))},updateRecord:function(e){let t=this,n=[];e.grid.columns.forEach((function(t){t.field&&t.field.storeAttributeValueField&&(!t.field.getValue()||i.get(t.field,"lastSelection[0]"))&&e.record.set(t.field.storeAttributeValueField,t.field.getValue()&&t.field.lastSelection?t.field.lastSelection[0].get("ID"):null),t.field&&["textareafield","ubtextfield","ubtextareafield"].includes(t.field.xtype)&&void 0!==e.record.modified[t.dataIndex]&&""===e.record.get(t.dataIndex)&&e.record.set(t.dataIndex,null)}));let o=e.record.getData();Object.keys(o).forEach((function(t){(t.indexOf(".")+1||void 0===e.record.modified[t])&&"ID"!==t&&"mi_modifyDate"!==t?delete o[t]:n.push(t)})),t.notWriteChanges?(t.GridSummary&&t.GridSummary.dataBind(),t.fireEvent("changeData",t,"update")):$App.connection.run({entity:t.entityName,method:"update",fieldList:n,execParams:o}).then((function(n){n.execParams.mi_modifyDate&&e.record.set("mi_modifyDate",new Date(n.execParams.mi_modifyDate)),e.record.commit(),t.GridSummary&&t.GridSummary.dataBind(),t.fireEvent("changeData",t,"update")}))},addNewRecord:function(e,t){let n={},i=this.store.data.length;if(this.store.ubRequest.fieldList.forEach((function(e){n[e]=null})),this.store.insert(i,n),e){delete e.ID,delete e.mi_modifyDate,this.lineNumberColumn&&t&&delete e[this.lineNumberColumn];let n=this.store.getAt(i);Object.keys(e).forEach((function(t){n.set(t,e[t])}))}t?this.editingPlugin.startEdit(i,0):(this.store.getAt(i).dirtySave=null,this.enableAction("del"))},getFormParam:function(){let e=this;if("function"==typeof e.onDeterminateForm)return e.formParam=e.onDeterminateForm(e),e.formParam;if(e.formParam)return e.formParam;if(Ext.isDefined(e.commandData)&&(e.formParam=e.getFormParamFromCommandData(e.commandData),Ext.isDefined(e.formParam)))return e.formParam;let t=o.core.UBFormLoader.getFormByEntity(e.entityName);return t?(e.formParam={formCode:t.get("code"),description:o.i18n(t.get("description"))},e.formParam):void 0},getFormParamFromCommandData:function(e){let t;return Ext.isObject(e)&&(Ext.isDefined(e.formCode)&&(t={formCode:e.formCode}),Ext.isDefined(e.formTitle)&&(Ext.isObject(t)||(t={}),t.description=e.formTitle)),t},onAddNew:function(){let e=this;if(e.rowEditing)if(e.editingPlugin.editing)$App.dialogInfo("rowEditing");else{let t=e.up("basepanel");t&&(t.isDirty()||t.isNewInstance)&&!e.notWriteChanges?t.saveForm().then((function(t){-1!==t&&e.addNewRecord(null,!0)})):e.addNewRecord(null,!0)}else if(this.isHistory){let t;e.store.data.length>0&&(t=e.store.data.first().data.mi_dateFrom,e.store.data.each((function(e){t=e.data.mi_dateFrom>t?e.data.mi_dateFrom:t}))),Ext.create("UB.view.InputDateWindow",{callback:function(n){if(!(i.isUndefined(t)||n>t))throw new o.UBError(o.format(o.i18n("dateIsTooEarly"),t));e.openForm({__mip_ondate:n,instanceID:e.miDataID})},scope:e})}else e.openForm()},onAddNewByCurrent:function(){let e=this,t=e.getSelectionModel().getSelection();if(t.length<1)$App.dialogInfo("selectRowFirst");else if(e.rowEditing)if(e.editingPlugin.editing)$App.dialogInfo("rowEditing");else{let n=e.up("basepanel");n&&(n.isDirty()||n.isNewInstance)&&!e.notWriteChanges?n.saveForm().then((function(n){-1!==n&&(e.addNewRecord(t[0].getData(),!0),e.getSelectionModel().deselect(t[0]))})):(e.addNewRecord(t[0].getData(),!0),e.getSelectionModel().deselect(t[0]))}else{let n={addByCurrent:!0,instanceID:t[0].get("ID")};e.openForm(n)}},onEdit:function(e,t){this.rowEditing?t.record.get("ID")?this.updateRecord(t):this.insertRecord(t):this.doOnEdit()},doOnEdit:function(e){let t=this.getSelectionModel().getSelection();t.length<1||((e=e||{}).instanceID=t[0].get("ID"),this.openForm(e))},getFormTitle:function(){let e=this.placeholder;return this.title||(e?e.title:null)||((e=this.up(""))?e.title:null)||this.entity.caption},onDel:function(){let e=this.getSelectionModel().getSelection();if(e.length<1)return;let t=this,n="";if(t.rowEditing&&t.editingPlugin.editing)$App.dialogInfo("rowEditing");else{if(1===e.length&&t.entity.descriptionAttribute){try{n="String"!==t.entity.attr(t.entity.descriptionAttribute).dataType?e[0].get(t.columns[0].fieldName):e[0].get(t.entity.descriptionAttribute)}catch(e){}n=n?"["+n+"]":""}$App.dialogYesNo("deletionDialogConfirmCaption",o.format(o.i18n("deleteConfirmationWithCaption"),t.getFormTitle(),n)).then((function(n){if(!n)return;let i,r=[],a=e.length&&e[0].get("mi_unityEntity");if(t.notWriteChanges){let n=t.store,i=null;for(let t=0,o=e.length;t<o;++t)i=n.indexOf(e[t]),n.remove(e[t]);null!==i&&t.getView().on("itemremove",(function(){t.GridSummary&&t.GridSummary.dataBind(),t.fireEvent("afterdel"),t.fireEvent("changeData",t,"delete"),t.pagingBar&&t.pagingBar.decreaseTotal(),n.getCount()<=i&&(i=n.getCount()-1),t.getSelectionModel().select(n.getAt(i))}),t,{single:!0})}else{for(let n=0,o=e.length;n<o;++n)i=a?e[n].get("mi_unityEntity"):t.entityName,r.push({entity:i,method:"delete",execParams:{ID:e[n].get("ID")}});$App.connection.runTrans(r).then((function(e){let t=e.map((e=>$App.connection.invalidateCache(e)));return Promise.all(t).then((function(){return e}))})).then((function(e){let n=t.store,a=null;e.forEach((function(e){let t=n.getById(e.ID);if(a=n.indexOf(t),n.remove(t),o.core.UBAppConfig.systemEntities.hasOwnProperty(i)){let t=o.core.UBStoreManager.getSystemEntityStore(o.core.UBAppConfig.systemEntities[i].name);t.remove(t.getById(e.ID))}})),t.store&&t.store.fireModifyEvent&&t.store.fireModifyEvent(r,e),null!==a&&t.getView().on("itemremove",(function(){n.getCount()<=a&&(a=n.getCount()-1),t.getSelectionModel().select(n.getAt(a))}),t,{single:!0}),t.GridSummary&&t.GridSummary.dataBind(),t.fireEvent("afterdel"),t.fireEvent("changeData",t,"delete"),t.pagingBar&&t.pagingBar.decreaseTotal()}))}}))}},onPrefilter:function(){let e=this;e.autoFilter&&o.ux.UBPreFilter.makeFilters({options:e.autoFilter,entityCode:e.entityName,store:e.getStore(),onFilterReady:function(){e.filtersDescription&&e.filtersDescription()}})},showFilter:function(e){let t=this;o.ux.UBPreFilter.makeFilters({options:t.autoFilter||e||{},entityCode:t.entityName,store:t.getStore(),onFilterReady:function(){t.filtersDescription&&t.filtersDescription()}})},onItemContextMenu:function(e,t,n,i,o){if(o.stopEvent(),!e||!t)return;let r=e.getSelectionModel();r&&(this.rowEditing&&this.editingPlugin.editing||(this.forbidSelectOnContextMenu||r.select(t),this.menu.showAt(o.xy)))},onNewVersionDataRequest:function(){let e=this,t=e.getSelectionModel().getSelection();t.length<1||o.Repository(e.entityName).attrs(["ID","mi_data_id"]).selectById(t[0].get("ID")).then((function(t){return o.Repository(e.entityName).attrs(["mi_dateFrom","mi_data_id"]).where("mi_data_id","=",t.mi_data_id).misc({__mip_recordhistory_all:!0}).orderByDesc("mi_dateFrom").limit(1).select()})).then((function(n){var i=n[0];Ext.create("UB.view.InputDateWindow",{callback:function(n){if(!(n>i.mi_dateFrom))throw new o.UBError(o.format(o.i18n("dateIsTooEarly"),i.mi_dateFrom));e.onItemDblClick(e,t[0],null,null,null,{__mip_ondate:n})},scope:e})}))},onToolsClick:function(){$App.dialogError("Not Implemented")},onRefresh:function(){let e=this;if(!e._inRefresh)return e._inRefresh=!0,e.store.reload().finally((function(){e._inRefresh=!1,e.down(e.viewType)?.focus()}))},onHistory:function(){let e=this,t=e.entityConfig.fieldList.concat(),n=e.extendedFieldList.concat();function r(e){i.findIndex(n,{name:e})<0&&(t=[e].concat(t),n=[{name:e,visibility:!0,description:o.i18n(e)}].concat(n))}r("mi_dateTo"),r("mi_dateFrom");let a=this.getSelectionModel().getSelection();!e.isInHistory&&a.length<1||$App.connection.select({entity:e.entityName,fieldList:["ID","mi_data_id"],ID:e.isInHistory?e.miDataID:a[0].get("ID")}).then((function(i){let r=o.core.UBCommand.resultDataRow2Object(i);$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:e.entityName,method:o.core.UBCommand.methodName.SELECT,fieldList:t}]},cmpInitConfig:{extendedFieldList:n},isModalDialog:!0,instanceID:r.mi_data_id,__mip_recordhistory:!0})}))},onAccessRight:function(){let e=this.getSelectionModel().getSelection();if(e.length<1)return;let t=this.entityName+"_acl",n=this.entity;if(!n||!n.mixins||!n.mixins.aclRls)return;n.mixins.aclRls.useUnityName&&(t=n.mixins.unity.entity+"_acl");let o=[];i.forEach(n.mixins.aclRls.onEntities,(function(e){let t=$App.domainInfo.get(e);o.push(t.sqlAlias+"ID"+(t.descriptionAttribute?"."+t.descriptionAttribute:""))})),$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:t,method:"select",fieldList:o,whereList:{parentExpr:{expression:"[instanceID]",condition:"equal",values:{instanceID:e[0].get("ID")}}}}]},isModalDialog:!0,parentContext:{instanceID:e[0].get("ID")},hideActions:["addNewByCurrent"]})},onAudit:function(){const e=this.getSelectionModel().getSelection();if(e.length<1)return;const t=e[0].get("ID");o.core.UBApp.showAuditTrail({entityCode:this.entityName,instanceID:t,isModal:!1})},getPreviewForm:function(){let e=null,t=o.core.UBFormLoader.getFormByEntity(this.entityName,!0);return i.forEach(t,(function(t){if(-1!==t.get("code").toLowerCase().indexOf("preview"))return e=t,!1})),e||t[0]},onShowPreview:function(e){let t=this.getPreviewForm();if(!t)return void o.logError("No preview form");let n=this.getSelectionModel().getSelection();if(n.length<1)return void $App.dialogInfo("selectRowFirst");let i={instanceID:n[0].get("ID")},r={formCode:t.get("code"),description:o.i18n(t.get(o.core.UBAppConfig.systemEntities.form.fields.description))},a=new RegExp("(.*?)(_grid_UI)"),s=this.stateId?this.stateId.replace(a,o.format("$1_{0}_{0}$2",this.entityName)):void 0;this.setMainPanel(s);let l={cmdType:"showForm",formCode:r.formCode,description:r.description,entity:this.entityName,instanceID:i.instanceID,store:this.getStore(),addByCurrent:!1,__mip_ondate:!1,detailAttribute:this.detailAttribute,parentID:this.parentID,sender:this.getView()||this,target:this.detailTabPanel,tabId:Ext.id(),isDetail:!0};o.core.UBApp.doCommand(l),e.disable()},getMainContainer:function(){return this.mainPanel||this},activateByCommand:function(e){this.autoFilter&&!this.autoFilter.notShowBefore&&this.onPrefilter()},setMainPanel:function(e){let t=this;if(!t.mainPanel){let n=Ext.create("Ext.resizer.Splitter"),i=Ext.create("Ext.tab.Panel",{stateful:!0,border:!1,layout:"fit",stateId:e}),o=t.ownerCt,r=!!t.closable;o.remove(t,!1),t.mainPanel=Ext.create("Ext.panel.Panel",{xtype:"panel",flex:1,border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",layout:"fit",border:!1,flex:1,items:t},n,i]}),t.mainPanel.closable=r,o.add(t.mainPanel),o.setActiveTab&&o.setActiveTab(t.mainPanel),t.mainPanel.mainEntityGridPanel=t,i.mainPanel=t.mainPanel,i.relatedSplitter=n,t.detailTabPanel=i,t.up("window")||t.mainPanel.setTitle(t.title)}t.detailTabPanel.relatedSplitter.show(),t.detailTabPanel.show(),t.mainPanel.show(),t.show(),t.ownerCt&&t.ownerCt.doLayout()},onShowDetail:function(e){let t=o.core.UBCommand.commandType.showList,n=o.core.UBCommand.getCommandByEntityAndType(e.entityName,t,!0);if(this.getSelectionModel().getSelection().length<1)$App.dialogInfo("selectRowFirst");else{if(!n)throw new Error(o.format('Can\'t get command with type "{0}" for entity "{1}"',t,e.entityName));this.doShowDetail(e),e.disable()}},doShowDetail:function(e){let t=this,n=t.up("window"),r=o.core.UBCommand.commandType.showList,a=o.core.UBCommand.getCommandByEntityAndType(e.entityName,r,!0),s=new RegExp("(.*?)(_grid_UI)"),l=t.stateId?t.stateId.replace(s,`$1_${e.entityName}_${e.attribute}$2`):void 0;t.setMainPanel(l);let c=this.getSelectionModel().getSelection(),u=c.length>0?c[0].get("ID"):null,d=new Ext.util.MixedCollection;d.add(o.core.UBCommand.whereListParentID,new Ext.util.Filter({id:o.core.UBCommand.whereListParentID,property:e.attribute,exactMatch:!0,root:"data",value:u})),o.core.UBApp.doCommand(i.assign({renderer:"ext",cmdType:o.core.UBCommand.commandType.showList,cmdData:a,entity:e.entityName,detailAttribute:e.attribute,parentID:u,target:t.detailTabPanel,isDetail:!0,filters:d,tabId:Ext.id(),title:((n||t).title?(n||t).title+"->":"")+$App.domainInfo.get(e.entityName).caption},e.command||{})),n&&n.doLayout()},onSelectionChange:function(e,t,n){var i,r=this;0!==t.length&&(i=t[0].get("ID"),r.selectedRecordID!==i&&(r.selectedRecordID=i,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null),this.timeoutID=setTimeout((function(){r.fireEvent("parentchange",i)}),o.appConfig.gridParentChangeEventTimeout)))},onParentChange:function(e){this.parentID=e,this.store.filters.removeAtKey(o.core.UBCommand.whereListParentID),this.store.filter(new Ext.util.Filter({id:o.core.UBCommand.whereListParentID,root:"data",property:this.detailAttribute,exactMatch:!0,value:e}))},onViewReady:function(){let e=this.getView(),t=e?e.getStore():null;t&&e&&e.storeListeners&&e.storeListeners.update&&t.on("update",e.storeListeners.update,e)},setupActions:function(){let e=this,t=e.up("form");("function"==typeof e.isEditable?!e.isEditable():!(!t||"function"!=typeof t.isEditable||t.isEditable()))&&(e.actions[o.view.EntityGridPanel.actionId.addNew].setDisabled(!0),e.actions[o.view.EntityGridPanel.actionId.addNewByCurrent].setDisabled(!0),e.actions[o.view.EntityGridPanel.actionId.del].setDisabled(!0)),e.hideActions.forEach((function(t){e.hideAction(t,!0),"showDetail"===t&&(e.disableMenuItemDetails=!0,e.menuItemDetails&&(e.menuItemDetails.disable(),e.menuItemDetails.hide()))})),e.readOnly&&e.setReadOnly(e.readOnly)},bindHotkeys:function(){let e=this,t=o.view.EntityGridPanel.actionId,n=o.view.EntityGridPanel.hotKeys;e.actionsKeyMap={},e.actionsKeyMap[t.edit]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.edit].key,ctrl:n[t.edit].ctrl,shift:n[t.edit].shift,fn:function(t,n){n.stopEvent(),e.onEdit()}}]}),e.actionsKeyMap[t.del]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.del].key,ctrl:n[t.del].ctrl,shift:n[t.del].shift,fn:function(t,n){n.stopEvent(),e.onDel()}}]}),e.actionsKeyMap[t.addNew]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.addNew].key,ctrl:n[t.addNew].ctrl,shift:n[t.addNew].shift,fn:function(t,n){n.stopEvent(),e.onAddNew()}}]}),e.actionsKeyMap[t.refresh]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.refresh].key,ctrl:n[t.refresh].ctrl,shift:n[t.refresh].shift,fn:function(t,n){n.stopEvent(),e.onRefresh()}}]}),e.actionsKeyMap[t.itemSelect]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.itemSelect].key,ctrl:n[t.itemSelect].ctrl,shift:n[t.itemSelect].shift,fn:function(t,n){n.stopEvent(),e.isModal?e.onItemSelect():e.onEdit()}}]}),e.actionsKeyMap[t.prefilter]=new Ext.util.KeyMap({target:e.getEl(),binding:[{key:n[t.prefilter].key,ctrl:n[t.prefilter].ctrl,shift:n[t.prefilter].shift,fn:function(t,n){n.stopEvent(),e.onPrefilter()}}]}),e.actionsKeyMap["ctrl+0"]=new Ext.util.KeyMap({target:e.getEl(),binding:[{ctrl:!0,key:Ext.EventObject.Q,fn:function(t,n){n.stopEvent();let i=e.up("tabpanel");if(n.shiftKey){if(i){let e=i.up("form");e.frameControl(e.focusFirst(e))}}else if(i){let e=i.getActiveTab(),t=i.items.indexOf(e)+1;if(t>=i.items.length&&(t=0),i.setActiveTab(t),e=i.getActiveTab(),e){let t=e.up("form");t.frameControl(t.focusFirst(e)||e)}}}}]})},selectDefaultRow:function(){if(!this.getStore().getCount())return;let e,t=this;e=t.selectedRecordID?t.store.getById(t.selectedRecordID):t.store.getAt(0);try{let n=t.getSelectionModel(),i=t.getView();i.focus(),n.setCurrentPosition?n.setCurrentPosition({view:i,row:e.index,column:0}):n.select(e),i.focusRow(e.index)}catch(e){}},getExportTitle:function(e){let t,n=this.entity;if(Ext.isDefined(n)&&(t=n.description||n.caption),!Ext.isDefined(t)){let e=this.up("window");Ext.isDefined(e)&&(t=e.title)}return t=t||this.title||e,t+" "+Ext.Date.format(new Date,"Y m d  H:i:s")},onExportXls:function(){let e=this.getExportTitle("export to excel");Ext.ux.exporter.Exporter.exportAny(this,"xlsx",{stripeRows:!0,title:e,entityName:this.entityName,metaobject:this.entity,scope:this,callback:function(t){let n=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});saveAs(n,e+".xlsx")}})},onExportCsv:function(){let e=this.getExportTitle("export to CSV");Ext.ux.exporter.Exporter.exportAny(this,"csv",{stripeRows:!0,title:e,entityName:this.entityName,metaobject:this.entity,scope:this,callback:function(t){let n=new Blob([t],{type:"text/csv"});saveAs(n,e+".csv")}})},onExportHtml:function(){let e=this.getExportTitle("export to html");Ext.ux.exporter.Exporter.exportAny(this,"html",{stripeRows:!0,title:e,entityName:this.entityName,metaobject:this.entity,scope:this,callback:function(t){let n=new Blob([t],{type:"text/html"});saveAs(n,e+".html")}})},beforeDestroy:function(e,t){let n=this;n.mainEntityGridPanel&&n.mainEntityGridPanel.un("parentchange",n.onParentChange,n);let i=n.getStore();i&&(i.un("load",n.onLoadStore,n),i.groupers&&i.groupers.length>0&&i.clearGrouping(),i.clearListeners()),n.pagingBar&&n.pagingBar.destroy(),n.menu&&n.menu.destroy(),o.connection.removeListener(`${n.entityName}:changed`,n.onEntityChangedListener),n.callParent(arguments)},onItemSelect:function(){let e=this.getSelectionModel().getSelection();e.length<1||(this.onItemSelected(e[0]),this.up("window").close())},onDetailClose:function(e){let t=o.core.UBPanelMixin.actionId.showDetail;function n(n){n&&n.actionId===t&&n.menu.items.each((function(n){n.actionId===t&&n.entityName===e&&n.enable()}))}Ext.Array.each(this.popupMenuItems,n),Ext.Array.each(this.menuAllActions,n)},onLock:function(){if(!this.isEntityLockable)return;let e,t=this.getSelectionModel().getSelection();if(t.length&&t[0]&&(e=t[0].get("ID")),!e)return;let n=this.entityName;$App.connection.query({method:"isLocked",entity:n,ID:e}).then((function(t){if("Temp"===t.lockInfo.lockType)throw t.lockInfo.lockUser!==$App.connection.userLogin()?new o.UBError("recordLockedByTempLock"):new o.UBError("recordLockedThisUserByTempLock");if("Persist"===t.lockInfo.lockType)throw t.lockInfo.lockUser!==$App.connection.userLogin()?new o.UBError("recordLockedOtherUser"):new o.UBError("recordLockedThisUser");return $App.connection.query({method:"lock",lockType:"ltPersist",entity:n,ID:e})})).then((function(e){e.resultLock&&e.resultLock.success&&$App.dialogInfo("lockSuccessCreated")}))},onItemLink:function(){let e=this.getSelectionModel().getSelection();if(e.length<1)return void $App.dialogInfo("gridEmptySelection");let t=this,n=t.getFormParam(),r=n&&n.instanceID||e[0].get("ID"),a=["cmdType=showForm"];a.push("entity="+(n&&n.entityName?n.entityName:t.entityName));let s=n&&n.formCode?n.formCode:n;s&&a.push("formCode="+s),a.push("instanceID="+r);let l=[];i.forEach(t.parentContext,(function(e,t){e&&l.push(t+"="+e)})),l.length>0&&a.push("parentContext="+window.encodeURIComponent(l.join("&"))),t.detailAttribute&&t.parentID&&(a.push("detailAttribute="+t.detailAttribute),a.push("parentID="+t.parentID));let c=a.join("&");Ext.Msg.show({prompt:!0,minWidth:400,msg:o.i18n("gridItemLink"),buttons:Ext.Msg.OK,multiline:!1,value:window.location.origin+window.location.pathname+"#"+c}).textField.selectOnFocus=!0},onUnLock:function(){if(!this.isEntityLockable)return;let e,t=this.getSelectionModel().getSelection();if(t.length&&t[0]&&(e=t[0].get("ID")),!e)return;let n=this.entityName;$App.connection.query({method:"isLocked",entity:n,ID:e}).then((function(t){if("None"===t.lockInfo.lockType)throw new o.UBError("recordNotLocked");if(t.lockInfo.lockUser!==$App.connection.userLogin())throw new o.UBError("recordLockedOtherUser");if("Temp"===t.lockInfo.lockType)throw new o.UBError("recordLockedByTempLock");return $App.connection.query({method:"unlock",lockType:"ltPersist",entity:n,ID:e})})).then((function(e){e.resultLock&&e.resultLock.success&&$App.dialogInfo("lockSuccessDeleted")}))}})},5642:function(e,t,n){const i=n(1972);UB.view||(UB.view={}),UB.view.ErrorWindow={errList:[],showError:function(e){var t=this;t.isInited||t.init(),t.inProcessInit?t.errList.push(e):t.renderErr(e)},renderErr:function(e){var t,n,i,o,r,a,s=this,l=!1;s.lastError&&s.lastError.errMsg===e.errMsg&&s.lastError.detail===e.detail||(s.lastError=e,s.mask.style.display="inline",s.main.style.display="inline",(t=document.createElement("div")).className="ub-error-win-c-item",(n=document.createElement("div")).style.width="100%",n.style.padding="5px",n.style.display="table-cell",n.innerHTML=e.errMsg,t.appendChild(n),n.oncontextmenu=function(e){var t=function(){s.removeEvent(document.body,"click",r),document.body.removeChild(n),l=!1};l&&t(),(n=document.createElement("button")).className="ub-error-win-detail-btn",n.innerHTML=UB.i18n("showDeveloperDetail"),n.style.position="absolute",n.style.left=e.clientX+"px",n.style.top=e.clientY+"px",n.onclick=function(e){o(arguments),t()},document.body.appendChild(n),r=function(e){e.target!==n&&t()},s.addEvent(document.body,"click",r),l=!0},(i=document.createElement("div")).className="ub-error-win-c-detail",i.style.width="100%",i.style.display="none",t.appendChild(i),(n=document.createElement("div")).style.padding="5px",n.innerHTML=e.detail||e.errMsg,n.style.display="table-cell",n.style.width="100%",i.appendChild(n),(n=document.createElement("div")).style.padding="5px",n.style.width="auto",n.style.display="table-cell",n.style.cursor="pointer",(a=document.createElement("a")).className="ub-error-win-btn-detail-close u-icon-close",a.onclick=function(e){o(arguments)},n.appendChild(a),i.appendChild(n),s.content.appendChild(t),s.mask.focus(),s.main.focus(),s.main.click(),s.mask.click(),o=function(){"none"===i.style.display?i.style.display="inline-block":i.style.display="none"})},closeWindow:function(){var e=this;e.mask.style.display="none",e.main.style.display="none",e.clearContent()},clearContent:function(){var e=this;delete e.lastError;for(var t=e.content.childNodes.length-1;t>=0;t--)e.content.removeChild(e.content.childNodes[t])},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},init:function(){var e,t,n,i,o,r=this;if(!r.inProcessInit){r.inProcessInit=!0,r.main=e=document.createElement("div"),e.className="ub-error-win",e.style.display="none",e.style.left=(window.innerWidth-600)/2+"px",e.style.top=(window.innerHeight-400)/2+"px",e.tabindex="5",document.body.appendChild(e),e.setAttribute("tabindex","5"),e.innerHTML=['<div class="ub-error-win-inner"><table collspan="0" rowspam="0" style="border-spacing: 0px;" width="100%" height="100%" >','<tr><td ><div class="ub-error-win-header">','<i class="fa fa-2x fa-exclamation-triangle"></i> ',,"</div></td></tr>",'<tr><td class="ub-error-win-content">','<div class="ub-error-win-contentT" style="width:600px; min-height: 80px; max-height: 350px;"></div>',"</td></tr>",'<tr><td><div class="ub-error-win-footer"><button class="ub-error-win-btn ub-error-win-btn-ok" tabindex="1" >',UB.i18n("ok"),"</button></div></td></tr>","</table></div>"].join(""),r.mask=t=document.createElement("div"),t.className="ub-mask",t.style.display="none",document.body.appendChild(t),r.content=e.querySelector('[class="ub-error-win-contentT"]'),o=e.querySelector('[class="ub-error-win-header"]');var a=function(t){e.moveWin=!1,r.removeEvent(document.body,"mouseup",a),r.removeEvent(document.body,"mousemove",s)},s=function(t){e.moveWin&&(e.style.left=t.x-e.moveWin.x+e.offsetLeft+document.body.scrollLeft+"px",e.style.top=t.y-e.moveWin.y+e.offsetTop+document.body.scrollTop+"px",e.moveWin.x=t.x,e.moveWin.y=t.y)};o.onmousedown=function(t){e.moveWin={x:t.x,y:t.y},r.addEvent(document.body,"mouseup",a),r.addEvent(document.body,"mousemove",s)},(n=e.querySelector('[class*="ub-error-win-btn-ok"]')).focus(),n.tabindex=1,n.onkeypress=l,n.onkeyup=l,n.onkeydown=function(e){if(13!==e.keyCode&&27!==e.keyCode||i(),17!==e.keyCode&&45!==e.keyCode&&67!==e.keyCode)return!1},e.onkeypress=l,e.onkeyup=l,e.onkeydown=n.onkeydown,i=function(){r.closeWindow()},n.attachEvent?n.attachEvent("onclick",i):n.onclick=i,r.isInited=!0,r.inProcessInit=!1,r.errList.forEach((function(e){r.renderErr(e)})),r.errList=[],r.mask.setAttribute("tabindex","5"),r.mask.onkeypress=l,r.mask.onkeyup=l,r.mask.onkeydown=n.onkeydown}function l(e){return n.focus(),!1}}},i.setErrorReporter(UB.view.ErrorWindow.showError.bind(UB.view.ErrorWindow)),UB.showResponseError=function(e){if(e.errCode===UB.core.UBCommand.errCode.MODIFIED_BY_ANOTHER_USER){var t=e.resultData,n=_.find(t.fields,"mi_modifyDate"),i=_.find(t.fields,"mi_modifyUser"),o=t.data[0][i],r=Ext.Date.format(Ext.Date.parse(t.data[n],"c"),Ext.util.Format.datetimeFormat);UB.core.UBDataLoader.loadInstance({entityName:"uba_user",fieldList:["name"],id:o,callback:function(t){var n=UB.format("UB.core.UBApp.runLink(&quot;command=ShowFormUser&amp;id={2}&quot;); Ext.fly(this).up(&quot;div.x-window&quot;).hide();",o);Ext.Msg.show({title:UB.i18n("error"),msg:UB.format('{0} <a href="#" onclick="{1}">{2}</a> {3}',e.errMsg,n,t.get("name"),r),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},scope:this})}else UB.showErrorWindow(e.errMsg,e.errCode,e.entity);throw new Error(e.errMsg)},UB.toast=function(e){var t=Ext.create("widget.uxNotification",{title:UB.i18n("error"),position:"t",slideInDuration:800,slideBackDuration:1500,slideInAnimation:"elasticIn",slideBackAnimation:"elasticIn",useXAxis:!0,autoShow:!0,cls:"ux-notification-light",iconCls:"ux-notification-icon-error",bodyPadding:5,items:[{html:UB.i18n("fieldValidationError",e.entityTitle),border:!1},{xtype:"box",autoEl:{tag:"a",href:"#",onclick:"return false;",html:e.fieldLabel},listeners:{boxready:function(n){n.getEl().on({click:function(){return t.close(),Ext.callback(e.callback),!1}})}}}]})}},4318:function(e,t,n){const i=n(6486);Ext.define("UB.view.FormDataBinder",{mixins:{observable:"Ext.util.Observable"},constructor:function(e){let t=this;if(!e||!Ext.isObject(e))throw new Error("Config object is required.");if(!e.panel)throw new Error("Properties panel is required.");if(Ext.apply(t,e),!(t.form||t.controls&&Ext.isArray(t.controls))){if(!t.panel.getForm)throw new Error("Property form or controls in config object is required.");t.form=t.panel.getForm()}t.mixins.observable.constructor.call(this,e),t.addEvents("formDataReady","controlDataReady","controlChanged","dataBind"),t.connectFieldsEvents()},updateFormFields:function(){this.disconnectFieldsEvents(),this.connectFieldsEvents()},getFields:function(e){let t,n=this,o={};return t=n.controls?n.controls:n.form.getFields().items,i.forEach(t,(function(t){t.attributeName&&(e||!0!==t.oneWayBinding)&&(o[t.attributeName]=t)})),o},getFieldsByName:function(e,t){let n=[],o=function(t){return t.attributeName===e&&n.push(t),!0};return t||i.forEach(this.getFields(),o),i.forEach(this.getOneWayBindCtrl(),o),n},suspendAutoBind:function(){this.isSuspendAutoBind=!0},releaseAutoBind:function(){this.isSuspendAutoBind=!1},setRecord:function(e){let t=this;t.record&&t.record.store.un("update",t.onRecordUpdate,t),t.record=e,t.record.store.on("update",t.onRecordUpdate,t)},getOneWayBindCtrl:function(){let e=this,t=[];if(!e.oneWayBindCtrl){let n=e.panel.getForm(),i=e.panel.query("form");Ext.each(i,(function(i){i!==n&&Ext.each(i.query("[attributeName][oneWayBinding=true]"),(function(e){t.push(e)}),e)}),e);let o=e.panel.query("[attributeName][oneWayBinding=true]");Ext.each(t,(function(e){let t=o.indexOf(e);t>=0&&o.splice(t,1)}),e),e.oneWayBindCtrl=o}return e.oneWayBindCtrl},bind:function(e){let t=this,n=t.getFields(!0),o=t.getOneWayBindCtrl();t.calcReady=!0,t.notReadyControls=1,t.notReadyControlList=[];try{i.forEach(n,(function(n){t.bindField(n,e)})),i.forEach(o,(function(n){t.bindField(n,e)})),t.controlDataReady(),t.fireEvent("dataBind",t.record)}finally{t.calcReady=!1}},controlDataReady:function(e){let t,n=this;n.notReadyControls--,e&&(t=n.notReadyControlList.indexOf(e))>=0&&n.notReadyControlList.splice(t,1),n.fireEvent("controlDataReady",e),0===n.notReadyControls&&n.fireEvent("formDataReady")},bindField:function(e,t){let n,i=this;i.isInnerChangingControl=!0;try{let o=i.record.get(e.attributeName),r=i.panel.getInstanceID();e.setValueById?e.dataLoadDelay&&i.calcReady?(i.notReadyControls+=1,i.notReadyControlList.push(e),n=e.setValueById(o,t,i.controlDataReady,i)):n=e.setValueById(o,t,i.controlDataReady,i):(n="ubdocument"===e.xtype&&-1!==e.attributeName.indexOf(".")?e.setComplexValue(i.record):e.setValue?e.setValue(o,r,!0):e.setText(o,r,!0),e.resetOriginalValue&&e.resetOriginalValue(),n&&"function"==typeof n.then&&(i.notReadyControls+=1,i.notReadyControlList.push(e),n.then((function(){i.controlDataReady(e)})))),e.onBeforeSaveForm&&i.panel&&i.panel.on("beforeSaveForm",e.onBeforeSaveForm,e)}finally{i.isInnerChangingControl=!1}},onRecordUpdate:function(e,t,n,o){let r=this;r.record===t&&(r.isInnerChangingRecord||r.isSuspendAutoBind||i.forEach(o,(function(e){i.forEach(r.getFieldsByName(e),(function(e){r.bindField(e)}))})))},onControlChanged:function(e,t,n){var i=this;if(e&&e.attributeName&&!i.isInnerChangingControl&&!i.isSuspendAutoBind&&(!i.panel||i.panel.formDataReady)&&!1!==i.fireEvent("controlChanged",e,t,n)){i.isInnerChangingRecord=!0;try{void 0===t&&(t=null),null!==t&&"string"==typeof t&&""===t&&(t=null),i.record.set(e.attributeName,t)}finally{i.isInnerChangingRecord=!1}}},connectFieldsEvents:function(){let e=this,t=e.getFields();e.connectedFields={},i.forEach(t,(function(t){e.connectedFields[t.attributeName]=t,t.on("change",e.onControlChanged,e)}))},getBindedFields:function(){return this.connectedFields},disconnectFieldsEvents:function(){let e=this,t=e.connectedFields;t&&(i.forEach(t,(function(t){t.un("change",e.onControlChanged,e)})),e.connectedFields=null)},destroy:function(){let e=this;e.isDestroyed||(e.record&&e.record.store.un("update",e.onRecordUpdate,e),e.disconnectFieldsEvents(),e.record=null,e.parent=null,e.form=null,e.isDestroyed=!0)}})},7185:function(){Ext.define("UB.view.GridSummary",{extend:"Ext.container.Container",alias:"widget.gridsummury",cls:"x-grid-row-summary",baseCls:Ext.baseCSSPrefix+"grid-footer-ct",defaultType:"panel",dock:"bottom",layout:{type:"hbox",align:"stretch"},height:30,style:{backgroundColor:"#ffffff !important"},border:"1 0 0 0",summaryDataOnClient:!1,initComponent:function(){let e=this;e.createItems(),e.callParent(arguments)},createItems:function(){let e=this,t=e.grid;e.items=[],t.on("boxready",(function(){let n=[],i=[t.columns.length];_.forEach(t.columns,(function(e){i[e.getIndex()]=e})),_.forEach(i,(function(e){n.push(Ext.create("Ext.Component",{baseColumn:e,border:"1 1 0 0",cls:"x-grid-cell-summary x-grid-cell x-grid-cell-inner",style:{textAlign:"count"===e.summaryType?"right":e.align||"left"},width:e.getWidth()}))})),e.items.addAll(n),e.updateLayout()}),e),t.on("columnresize",(function(t,n,i){e.items.each((function(e){if(e.baseColumn===n)return e.setWidth(n.getWidth()),!1}))})),t.on("columnhide",(function(t,n,i){e.items.each((function(e){if(e.baseColumn===n)return e.hide(),!1}))})),t.on("columnshow",(function(t,n,i){e.items.each((function(e){if(e.baseColumn===n)return e.setWidth(n.getWidth()),e.show(),!1}))})),t.on("columnmove",(function(t,n,i,o,r){0!==e.items.getCount()&&e.items.each((function(t,r){if(t.baseColumn===n){Ext.suspendLayouts();try{e.items.remove(t),e.items.insert(o>i?o-1:o,t)}finally{Ext.resumeLayouts()}return e.updateLayout(),!1}}))})),t.getStore().on("load",e.dataBind,e)},dataBind:function(){let e,t,n=this,i=n.grid,o=[],r=!1;if(n.items&&0!==n.items.length)if(i.summaryDataOnClient){let e=i.getStore();n.items.each((function(t){let n,i;t.baseColumn.summaryType&&(n=e[t.baseColumn.summaryType](t.baseColumn.fieldName)||0,i=t.getEl(),i.setHTML("count"===t.baseColumn.summaryType?Ext.util.Format.numberRenderer("0,000")(n):t.baseColumn.renderer?t.baseColumn.renderer(n):n),t.toolTipe||(t.toolTipe=Ext.create("Ext.tip.ToolTip",{target:i,trackMouse:!0,html:UB.i18n(t.baseColumn.summaryType+"ST")})))}))}else e=Ext.clone(i.getStore().ubRequest),e.fieldList=[],n.items.each((function(t){t.baseColumn.summaryType&&("count"===t.baseColumn.summaryType?r||(e.fieldList.push("count([ID])"),o.push("ID"),r=!0):(o.push(t.baseColumn.fieldName),e.fieldList.push(t.baseColumn.summaryType+"(["+t.baseColumn.fieldName+"])")))})),delete e.options,delete e.orderList,t=UB.ux.data.proxy.UBProxy.ubFilterToWhereList(i.getStore().filters,e.entity)||{},UB.apply(t,e.whereList),Object.keys(t).length?e.whereList=t:delete e.whereList,$App.connection.select(e).then((function(e){let t={};!e.resultData||e.resultData.rowCount<1||(_.forEach(o,(function(n,i){t[n]=e.resultData.data[0][i]})),n.items.each((function(e){let n,i;e.baseColumn.summaryType&&(n=t["count"===e.baseColumn.summaryType?"ID":e.baseColumn.fieldName]||0,i=e.getEl(),i.setHTML("count"===e.baseColumn.summaryType?Ext.util.Format.numberRenderer("0,000")(n):e.baseColumn.renderer?e.baseColumn.renderer(n):n),e.toolTipe||(e.toolTipe=Ext.create("Ext.tip.ToolTip",{target:i,trackMouse:!0,html:UB.i18n(e.baseColumn.summaryType+"ST")})))})))}))}})},6751:function(){Ext.define("UB.view.InputDateWindow",{extend:"Ext.window.Window",alias:"widget.inputdatewindow",padding:1,autoShow:!0,autoDestroy:!0,closable:!1,border:0,layout:"fit",modal:!0,initComponent:function(){var e=this,t=Ext.create("Ext.form.field.Date",{allowBlank:!1,blankText:UB.i18n("requiredField"),fieldLabel:UB.i18n("aktualnoS"),anchor:"100%",value:new Date,listeners:{scope:e,specialkey:function(t,n,i){switch(n.getKey()){case n.ENTER:e.onButtonClick();break;case n.ESC:e.close()}}}}),n=Ext.create("Ext.form.Panel",{frame:!0,items:[t]});Ext.apply(e,{title:UB.i18n("aktualnoS"),defaultFocus:t,items:[n],fieldDate:t,buttons:[{text:Ext.MessageBox.buttonText.ok,scope:e,handler:e.onButtonClick},{text:Ext.MessageBox.buttonText.cancel,scope:e,handler:e.close}]}),e.callParent(arguments)},onButtonClick:function(e,t){var n=this,i=n.fieldDate.getValue();Ext.callback(n.callback,n.callback,[i]),n.close()}})},1463:function(){Ext.define("UB.view.OverflowSelect",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],mixins:{observable:"Ext.util.Observable"},noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items" role="menuitem">(None)</div>',constructor:function(e){var t=this;t.layout=e,t.callParent(arguments),t.triggerButtonCls=t.triggerButtonCls||Ext.baseCSSPrefix+"box-menu-after",t.menuItems=[],t.mixins.observable.constructor.call(t),t.scrollPosition=0,t.scrollSize=0},beginLayout:function(e){this.callParent(arguments),this.clearOverflow(e)},completeLayout:function(e){var t,n=this,i=e.state.boxPlan,o=n.layout.names;i&&i.tooNarrow&&(t=e.childItems[e.childItems.length-1],n.scrollSize=t.props[o.x]+t.props[o.width],n.updateScrollButtons(),n.updateActivePosition(e)),this.callParent(arguments)},beginLayoutCycle:function(e,t){this.callParent(arguments),t||(this.clearOverflow(e),this.layout.cacheChildItems(e))},updateActivePosition:function(e){for(var t,n=1;n<e.childItems.length;n++)if(e.childItems[n]&&e.childItems[n].target&&(t=e.childItems[n].target).active){this.scrollToItem(t,!0);break}},onRemove:function(e){Ext.Array.remove(this.menuItems,e)},getSuffixConfig:function(){var e=this,t=e.layout,n=t.owner,i=n.id;return e.menu=new Ext.menu.Menu({listeners:{scope:e,beforeshow:e.beforeMenuShow}}),e.menuTrigger=new Ext.button.Button({id:i+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+e.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item ub-overflow-button",plain:n.usePlainButtons,ownerCt:n,ownerLayout:t,width:34,height:32,iconCls:Ext.baseCSSPrefix+e.getOwnerType(n)+"-more-icon",ui:n instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",menu:e.menu,showEmptyMenu:!0,getSplitCls:function(){return""}}),e.menuTrigger.getRenderTree()},getOverflowCls:function(){return Ext.baseCSSPrefix+this.layout.direction+"-box-overflow-body"},handleOverflow:function(e){var t=this,n=t.layout.names,i=e.state.boxPlan,o=[null,null];return t.showTrigger(e),"vertical"!==t.layout.direction&&(o[n.heightIndex]=(i.maxSize-32)/2,t.menuTrigger.setPosition.apply(t.menuTrigger,o)),{reservedSpace:t.triggerTotalWidth}},captureChildElements:function(){var e=this,t=e.menuTrigger;e.layout.names,e.triggerTotalWidth=42,t.rendering&&t.finishRender()},_asLayoutRoot:{isRoot:!0},clearOverflow:function(e){var t=this,n=t.menuItems,i=t.layout.owner;i.suspendLayouts(),t.captureChildElements(),t.hideTrigger(),i.resumeLayouts(),n.length=0},showTrigger:function(e){var t,n,i,o,r,a=this,s=a.layout,l=s.owner,c=s.names,u=c.x,d=c.width,f=(e.state.boxPlan.targetSize[d],e.childItems),h=f.length,p=a.menuTrigger;for(a.ownerContext=e,p.suspendLayouts(),p.show(),p.resumeLayouts(a._asLayoutRoot),a.triggerTotalWidth,l.suspendLayouts(),a.menuItems.length=0,o=0;o<h;o++)i=(t=f[o]).target,(r=t.props)[u],r[d],n=Ext.create("Ext.Button",{text:i.text,targetTab:i,childContext:t,handler:a.onMenuItemClick,scope:a}),a.menuItems.push(n);l.resumeLayouts()},updateItemsState:function(e){var t=this,n=e.childContext.props,i=e.targetTab,o=t.layout.names,r=o.x,a=o.width;t.ownerContext.state.boxPlan.targetSize[a];n=e.childContext.props,t.triggerTotalWidth,n[r],n[a],e.initialConfig.cls="",i.active&&(e.initialConfig.cls+="ub-overflow-menu-item-active")},onMenuItemClick:function(e){this.scrollToItem(e.targetTab),e.targetTab.tabBar.tabPanel.setActiveTab(e.targetTab.card)},scrollToItem:function(e,t){var n,i,o,r,a,s,l=this,c=l.layout,u=c.owner,d=c.names;if(!l.isScrollingProcess&&void 0!==(e=l.getItem(e))){if(e===u.items.first())i=0;else if(e===u.items.last())i=l.getMaxScrollPosition();else{for(o=0;o<u.items.length;o++)if(u.items.getAt(o)===e){r=u.items.getAt(o+1),r=l.getItemVisibility(r),a=u.items.getAt(o-1),a=l.getItemVisibility(a);break}(n=l.getItemVisibility(e)).fullyVisible&&r.fullyVisible&&a.fullyVisible||(s=l.layout.innerCt[d.getWidth](),i=a.hiddenStart?n.width+r.width+a.width<s?r.itemEnd-s:n.itemStart+n.width/2-s/2:n.width+r.width+a.width<s?a.itemStart:n.itemStart+n.width/2-s/2)}void 0!==i&&l.scrollTo(i,t)}},scrollTo:function(e,t){var n=this,i=n.layout,o=i.names,r=n.getScrollPosition(),a=Ext.Number.constrain(e,0,n.getMaxScrollPosition());n.isScrollingProcess||a===r||n.scrolling||(n.scrollPosition=NaN,void 0===t&&(t=n.animateScroll),n.isScrollingProcess=!0,i.innerCt[o.scrollTo](o.beforeScrollX,a,!!t&&n.getScrollAnim()),t?n.scrolling=!0:n.updateScrollButtons(),n.fireEvent("scroll",n,a,!!t&&n.getScrollAnim()),n.isScrollingProcess=!1)},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},updateScrollButtons:function(){this.scrolling=!1},getItemVisibility:function(e){var t=this,n=t.getItem(e).getBox(!0,!0),i=t.layout,o=i.names,r=n[o.x],a=r+n[o.width],s=t.getScrollPosition(),l=s+i.innerCt[o.getWidth]();return{hiddenStart:r<s,hiddenEnd:a>l,fullyVisible:r>s&&a<l,scrollStart:s,scrollEnd:l,itemStart:r,itemEnd:a,width:n[o.width]}},getScrollPosition:function(){var e=this,t=e.layout;return isNaN(e.scrollPosition)?t.innerCt[t.names.getScrollLeft]():e.scrollPosition},getMaxScrollPosition:function(){var e=this.layout,t=this.scrollSize-e.innerCt[e.names.getWidth]();return t<0?0:t},hideTrigger:function(){var e=this.menuTrigger;e&&e.hide()},beforeMenuShow:function(e){var t,n=this,i=n.menuItems,o=0,r=i.length;for(e.suspendLayouts(),n.clearMenu(),e.removeAll();o<r;o++)t=i[o],n.updateItemsState(t),n.addComponentToMenu(e,t);e.items.length<1&&e.add(n.noItemsMenuText),e.resumeLayouts()},createMenuConfig:function(e,t){var n=this,i=Ext.apply({},e.initialConfig),o=e.toggleGroup;return Ext.copyTo(i,e,["iconCls","icon","itemId","disabled","handler","scope","menu","tabIndex"]),Ext.apply(i,{text:e.overflowText||e.text,hideOnClick:t,destroyMenu:!1,listeners:{}}),e.isFormField?(i.value=e.getValue(),i.listeners.change=function(t,n,i){e.setValue(n)}):(o||e.enableToggle)&&Ext.apply(i,{hideOnClick:!1,group:o,checked:e.pressed,handler:function(t,n){e.onClick(n)}}),e.isButton&&!e.changeListenersAdded&&(e.on({textchange:n.onButtonAttrChange,iconchange:n.onButtonAttrChange,toggle:n.onButtonToggle}),e.changeListenersAdded=!0),delete i.margin,delete i.ownerCt,delete i.xtype,delete i.id,delete i.itemId,i},onButtonAttrChange:function(e){var t=e.overflowClone;t.suspendLayouts(),t.setText(e.text),t.setIcon(e.icon),t.setIconCls(e.iconCls),t.resumeLayouts(!0)},onButtonToggle:function(e,t){e.overflowClone.checked!==t&&e.overflowClone.setChecked(t)},addComponentToMenu:function(e,t){var n,i,o,r=this;if(t instanceof Ext.toolbar.Separator)e.add("-");else if(t.isComponent)if(t.isXType("splitbutton"))t.overflowClone=e.add(r.createMenuConfig(t,!0));else if(t.isXType("button"))t.overflowClone=e.add(r.createMenuConfig(t,!t.menu));else if(t.isXType("buttongroup"))for(o=(i=t.items.items).length,n=0;n<o;n++)r.addComponentToMenu(e,i[n]);else t.overflowClone=e.add(Ext.create(Ext.getClassName(t),r.createMenuConfig(t)))},clearMenu:function(){var e,t,n,i,o=this.menu;if(o&&o.items)for(n=(e=o.items.items).length,t=0;t<n;t++)(i=e[t]).setMenu&&i.setMenu(null)},destroy:function(){var e=this.menuTrigger;e&&!this.layout.owner.items.contains(e)&&delete e.ownerCt,Ext.destroy(this.menu,e)}})},7045:function(e,t,n){const i=n(1972);Ext.define("UB.view.PagingToolbar",{extend:"Ext.container.Container",alias:"widget.pagingtb",requires:["Ext.data.Store"],baseWidth:130,width:160,layout:{type:"hbox"},itemCls:"x-btn-default-toolbar-small",baseCls:Ext.baseCSSPrefix+"toolbar",initComponent:function(){var e=this;function t(){e.lastTotalCount=null,e.store.ubRequest.options||(e.store.ubRequest.options={})}e.beforePageText="",e.lastTotalCount=null,e.buttonCount=Ext.create("Ext.Button",{focusOnToFront:!1,iconCls:"ub-sum-row-icon",tooltip:i.i18n("calcRowCount"),handler:e.calcTotalRow,scope:e,height:32,margin:"0 0 0 0"}),e.store.on("beforereload",t,e),e.store.filters.on("add",t,e),e.store.filters.on("clear",t,e),e.store.filters.on("remove",t,e),e.store.filters.on("replace",t,e),e.buttonPage=Ext.create("Ext.Button",{focusOnToFront:!1,tooltip:i.i18n("currentPageNumber"),text:"1",handler:function(){e.selectPage()},scope:e,cls:"UB-paging-toolbar-page",height:32,margin:"0 0 0 0"}),e.items=[{itemId:"prev",xtype:"button",tooltip:Ext.PagingToolbar.prototype.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",width:34,height:32,border:0,disabled:!1,handler:e.movePrevious,scope:e},e.buttonPage,{itemId:"next",xtype:"button",tooltip:Ext.PagingToolbar.prototype.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",width:34,height:32,disabled:!1,handler:e.moveNext,scope:e},e.buttonCount],e.callParent(),e.store&&e.store.on("load",e.onStoreLoad,e),e.addEvents("totalChanged")},destroy:function(){this.contextMenu&&this.contextMenu.destroy(),this.callParent(arguments)},movePrevious:function(){let e=this,t=e.store.currentPage-1;return t>0&&!1!==e.fireEvent("beforechange",e,t)&&(e.store.previousPage(),!0)},onStoreLoad:function(){let e=this;e.suspendLayouts();let t=e.store.getCount();e.buttonPage.setText(parseInt(e.store.currentPage,10).toLocaleString()),e.store.currentPage<=1&&t<e.store.pageSize?e.setTotal(t):(void 0!==e.store.totalCount&&e.store.totalCount>=0&&(e.setTotal(e.store.totalCount),e.lastTotalCount=e.store.totalCount),e.autoCalcTotal||e.fireEvent("totalChanged",null),e.resumeLayouts())},selectPage:function(e){let t,n,i,o,r=this,a=[],s=!1;function l(e){r.store.loadPage(e.itemNum)}t=e||(r.store.currentPage-3>0?r.store.currentPage-3:1),n=t+7,o=null!==r.lastTotalCount?r.lastTotalCount:r.store.totalCount,void 0!==o&&o>0&&(i=o/r.store.pageSize,Math.floor(i)!==i&&(i+=1),i=Math.floor(i),n=i,t>n&&(t=n-7>0?n-7:1),n>t+7-1?n=t+7-1:s=!0),t>1&&(a.push({text:1,itemNum:1,handler:l}),t>2&&a.push({text:"...",handler:function(){r.selectPage(t-7<=0?1:t-7)}}));for(let e=t;e<=n;e++)a.push({text:e,itemNum:e,disabled:r.store.currentPage===e,handler:l});s||(a.push({text:"...",handler:function(){r.selectPage(n)}}),i&&a.push({xtype:"label",text:i,disabled:!0})),r.contextMenu?(r.contextMenu.removeAll(),r.contextMenu.add(a)):r.contextMenu=Ext.create("Ext.menu.Menu",{width:60,minWidth:60,cls:"ub-paging-tb-menu",plain:!0,margin:"0 0 5 0",items:a}),a.length>0&&r.contextMenu.showBy(r.buttonPage)},calcTotalRow:function(){if(this.autoCalcTotal)return;let e=this.store;e.ubRequest.options||(e.ubRequest.options={}),e.ubRequest.options.totalRequired=!0,this.autoCalcTotal=!0,e.load()},decreaseTotal:function(){"number"==typeof this.lastTotal&&this.setTotal(this.lastTotal-1)},updateTotal:function(){this.setTotal(this.lastTotal||0)},setTotal:function(e){let t=this,n=t.buttonCount.text||"   ",o=e||0===e?Ext.util.Format.number(parseInt(e,10),"0,000"):"-";t.buttonCount.setText(o),t.buttonCount.setIconCls(""),t.buttonCount.setTooltip(i.i18n("totalRowCount")),o.length>n.length&&t.setWidth(t.baseWidth+(t.buttonCount.rendered?t.buttonCount.getWidth():0)),t.fireEvent("totalChanged",e),t.lastTotal=e},getPageData:function(){let e=this.store,t=e.getTotalCount();return{total:t,currentPage:e.currentPage,pageCount:t<0?e.currentPage+1:Math.ceil(t/e.pageSize),fromRecord:(e.currentPage-1)*e.pageSize+1,toRecord:Math.min(e.currentPage*e.pageSize,t)}},moveNext:function(){let e=this,t=e.getPageData(),n=t.pageCount,i=e.store.currentPage+1;(t.total<0||i<=n)&&!1!==e.fireEvent("beforechange",e,i)&&e.store.nextPage()}})},1962:function(){Ext.define("UB.view.StatusWindow",{extend:"Ext.window.Window",alias:"widget.statuswindow",autoShow:!0,height:70,width:400,modal:!0,closable:!1,initComponent:function(){this.items=[Ext.create("Ext.Img",{src:$App.getImagePath("scan-to-pdf.png"),margin:3,style:{verticalAlign:"middle"}}),this.statusLabel=Ext.create("Ext.form.Label")],this.callParent()},setStatus:function(e){this.statusLabelEl||(this.statusLabelEl=this.statusLabel.getEl()),this.statusLabelEl&&this.statusLabelEl.dom.innerHTML===e||this.statusLabel.setText(e)}})},2526:function(){Ext.define("UB.view.Table",{extend:"Ext.view.Table",alias:"widget.ubtableview",renderRows:function(e,t,n){var i=this;i.callParent(arguments),i.hideEndRow||n.push('<tr class="ub-grid-row-end" ><td class="ub-grid-row-cell-end" colspan="'+i.ownerCt.getVisibleColumnManager().getColumns().length+'">'+i.getEndRowHtml()+"</td></tr>")},getEndRowHtml:function(){return""}})},4314:function(e,t,n){n(1463),Ext.define("UB.view.UBBar",{override:"Ext.tab.Bar",initComponent:function(){this.callParent(arguments);var e=UB.view.OverflowSelect||this.classOverflowSelect;this.layout.overflowHandler=new e(this.layout)},afterComponentLayout:function(e){this.needsScroll=!1,this.callParent(arguments)}})},7631:function(){Ext.define("UB.view.UBDropZone",{singleton:!0,requires:["Ext.util.Observable"],mixins:{observable:"Ext.util.Observable"},currentDropTargetConfig:[],enterLaveBalance:0,visible:!1,_enabled:!0,constructor:function(){this.mixins.observable.constructor.call(this)},setEnabled:function(e){this._enabled=e,e||this.hide()},isEnabled:function(){return this._enabled},addZoneHandlers:function(e,t,n){n.dragoverHandler=n.dragoverHandler||function(e){let t=e.dataTransfer;e.stopPropagation(),e.preventDefault(),t.dropEffect="copy"},t.addEventListener("dragenter",(function(n){e.dzEnter(),t.className="ub-dz-placeholder ub-dz-placeholder-accept",n.stopPropagation(),n.preventDefault()})),t.addEventListener("dragover",(function(e){return n.dragoverHandler(e)})),t.addEventListener("dragleave",(function(n){let i=t.getBoundingClientRect();e.dzLeave(),(n.clientX>i.left+i.width||n.clientX<i.left||n.clientY>i.top+i.height||n.clientY<i.top)&&(t.className="ub-dz-placeholder"),n.stopPropagation(),n.preventDefault()})),t.addEventListener("drop",(function(t){let i=!1;return t.stopPropagation(),n.dropHandler?(i=n.dropHandler(t),e.hide(),i):(UB.logError("no handler passed to UBDropZone config: "+JSON.stringify(n)),!1)}))},init:function(){let e,t,n=document.body,i=this;i.mask=e=document.createElement("div"),e.className="ub-mask",e.style.display="none",n.appendChild(e),e.addEventListener("dragenter",(function(e){i.dzEnter(),e.preventDefault()})),e.addEventListener("dragleave",(function(e){i.dzLeave(),e.preventDefault()})),i.content=t=document.createElement("div"),t.className="ub-dz-body",n.appendChild(t),t.addEventListener("dragenter",(function(e){i.dzEnter(),e.stopPropagation(),e.preventDefault()})),t.addEventListener("dragleave",(function(e){i.dzLeave(),e.stopPropagation(),e.preventDefault()})),n.addEventListener("dragenter",(function(e){if(!i._enabled)return;let n=e.dataTransfer;e.preventDefault(),!i.isVisible()&&n.types.length>0&&-1!==n.types.indexOf("Files")&&(i.fireEvent("configureDropZone",i.currentDropTargetConfig),i.currentDropTargetConfig&&i.currentDropTargetConfig.length&&(i.currentDropTargetConfig.forEach((function(e,n){let o=document.createElement("div");o.className="ub-dz-placeholder",o.id="ub-dz-item-"+n,o.innerHTML=`<i class="${e.iconCls||"fas fa-box-open fa-5x"}"></i><br>${UB.i18n(e.message)}</div>`,t.appendChild(o),i.addZoneHandlers(i,o,e)})),i.show()))})),n.addEventListener("dragover",(function(e){if(i._enabled)return e.preventDefault(),e.dataTransfer.dropEffect="none",!1}))},clearContent:function(){let e=this.content;for(let t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes[t]);this.currentDropTargetConfig=[]},dzEnter:function(){return++this.enterLaveBalance},dzLeave:function(){return--this.enterLaveBalance,0===this.enterLaveBalance&&this.hide(),this.enterLaveBalance},hide:function(){this.mask.style.display="none",this.content.style.display="none",this.clearContent(),this.visible=!1,this.enterLaveBalance=0},show:function(){this.enterLaveBalance=0,this.mask.style.display="inline",this.content.style.display="inline",this.visible=!0},isVisible:function(){return this.visible}})},4933:function(){Ext.define("UB.view.UBForm",{extend:"Ext.form.Basic",constructor:function(e,t){this.callParent([e,t]),this.getFields()},getFields:function(){let e=this;if(!e.formFields){let t=[];e.formFields=new Ext.util.MixedCollection;let n=e.owner.query("form");Ext.each(n,(function(n){n!==e.owner&&Ext.each(n.query("[isFormField]"),(function(e){t.push(e)}),e)}),e);let i=e.owner.query(e.monitor.selector);Ext.each(t,(function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1)}),e),e.formFields.addAll(i)}return e.formFields},onFieldAdd:function(e){let t=this;t.owner===e.up("form")&&(t.callParent(arguments),t.formFields&&t.formFields.addAll([e]))},onFieldRemove:function(e){let t=this;t.owner===e.up("form")&&(t.callParent(arguments),t.formFields&&t.formFields.push(e))}})},8541:function(e,t,n){const i=n(1972);Ext.define("UB.view.UploadFileAjax",{extend:"Ext.window.Window",alias:"widget.uploadfileajax",uses:["UB.core.UBLocalStorageManager","UB.core.UBService","UB.core.UBApp","UB.view.ErrorWindow"],padding:1,uploadData:!0,accept:"",initComponent:function(){this.fieldFile=Ext.create("Ext.form.field.File",{name:"document",allowBlank:!1,blankText:i.i18n("requiredField"),fieldLabel:i.i18n("vyberiteFayl"),anchor:"100%",buttonText:"",buttonConfig:{iconCls:"iconAttach"},listeners:{afterrender:function(e){e.getEl().dom.addEventListener("change",this.onFileSelect,!1),this.accept&&e.button.fileInputEl.dom.setAttribute("accept",this.accept),e.inputEl.on("click",(function(){this.button.fileInputEl.dom.click()}),e)},scope:this}}),this.progressBar=Ext.create("Ext.ProgressBar"),this.form=Ext.create("Ext.form.Panel",{frame:!0,method:"POST",waitTitle:i.i18n("pleaseWait"),waitMsgTarget:!0,items:[this.fieldFile,this.progressBar]}),Ext.apply(this,{autoShow:!0,title:i.i18n("fayl"),border:0,layout:"fit",modal:!0,stateful:!0,stateId:i.core.UBLocalStorageManager.getKeyUI("UploadFileWindowP_window"),defaultFocus:this.fieldFile,items:[this.form],buttons:[{text:i.i18n("load"),scope:this,handler:this.upLoad}]}),this.callParent()},onFileSelect:function(e){},upLoad:function(e){let t=e.up("window"),n=!1,o=!1,r=this.fieldFile.fileInputEl.dom,a=this.progressBar;if(0===r.files.length)return;e.disable();let s=r.files[0];if(!this.uploadData)return Ext.callback(t.callback,t.scope,[s]),void t.close();let l={entity:this.entityName,attribute:this.attribute,origName:s.name,filename:s.name,id:this.instanceID};i.connection.setDocument(s,l,(function(e){e.loaded<e.total?o?a.updateProgress(e.loaded/e.total,i.i18n("loadingData"),!0):o=e.loaded/e.total<.3:n||(a.reset(),n=!0,a.wait({duration:3e4,text:i.i18n("Transformation"),animate:!0}))})).then((function(e){Ext.callback(t.callback,t.scope,[{errMsg:"",result:e,success:!0}])})).finally((function(){t.close()}))}})},475:function(e,t,n){const i=n(1972);n(1463),n(4314),n(6872),n(287),Ext.define("UB.view.Viewport",{extend:"Ext.container.Viewport",uses:["UB.core.UBApp"],initComponent:function(){var e=this;i.view.Viewport.main=this,e.leftPanel=Ext.create("Ext.Component",{width:240,html:'<div id="sidebar-placeholder">Either @unitybase/adminui-vue should be added into domain or some model should replace #sidebar-placeholder by actual menu</div>',region:"west",defaultSizes:{full:240,collapsed:72}}),e.centralPanel=Ext.create("Ext.tab.Panel",{id:"ubCenterViewport",isMainTabPanel:!0,deferredRender:!1,region:"center",maxTabWidth:200,border:!1,margin:"1, 0, 0, 0",loader:{autoLoad:!1},listeners:{beforetabchange:function(e,t,n){const i=t&&t.uiTag||"";return $App&&$App.connection&&$App.connection.setUiTag(i),!0}}}),Ext.apply(e,{layout:"border",items:[e.leftPanel,e.centralPanel]}),this.callParent(arguments),this.on("destroy",(function(){this.leftPanel=null,i.view.Viewport.main=null,i.view.Viewport.centerPanel=null}),this)},getCenterPanel:function(){return this.getLayout().centerRegion},getLeftPanel:function(){return this.leftPanel}})},3072:function(e,t,n){n(7479),Ext.define("Ext.ux.DateTimePicker",{extend:"Ext.picker.Date",alias:"widget.datetimepicker",todayText:"Today",timeLabel:"Time",requires:["Ext.ux.form.TimePickerField"],initComponent:function(){var e=this.value||new Date;this.callParent(),this.value=e},onRender:function(e,t){this.timefield||(this.timefield=Ext.create("Ext.ux.form.TimePickerField",{fieldLabel:this.timeLabel,useSeconds:this.useSeconds,labelWidth:36,value:Ext.Date.format(this.value,"H:i:s")})),this.timefield.ownerCt=this,this.timefield.on("change",this.timeChange,this),this.callParent(arguments);let n=Ext.get(Ext.DomQuery.selectNode("table",this.el.dom));Ext.core.DomHelper.insertBefore(n,{tag:"div",style:"border:0px;",children:[{tag:"div",cls:"x-datepicker-footer ux-timefield"}]},!0),this.timefield.render(this.el.child("div div.ux-timefield"));let i=this.getEl().parent("div.x-layer");i&&i.setStyle("height",i.getHeight()+31)},timeChange:function(e,t,n){this.value=this.fillDateTime(this.value)},fillDateTime:function(e){if(this.timefield){let t=this.timefield.getRawValue();e.setHours(t.h),e.setMinutes(t.m),e.setSeconds(t.s)}return e},changeTimeFiledValue:function(e){this.timefield.un("change",this.timeChange,this),this.timefield.setValue(this.value),this.timefield.on("change",this.timeChange,this)},setValue:function(e){return this.value=e,this.changeTimeFiledValue(e),this.update(this.value)},getValue:function(){return this.fillDateTime(this.value)},handleDateClick:function(e,t){var n=this,i=n.handler;e.stopEvent(),n.disabled||!t.dateValue||Ext.fly(t.parentNode).hasCls(n.disabledCellCls)||(n.doCancelFocus=!1===n.focusOnSelect,n.setValue(this.fillDateTime(new Date(t.dateValue))),delete n.doCancelFocus,n.fireEvent("select",n,n.value),i&&i.call(n.scope||n,n,n.value),n.onSelect())},selectToday:function(){var e=this,t=e.todayBtn,n=e.handler;return t&&!t.disabled&&(e.setValue(new Date),e.fireEvent("select",e,e.value),n&&n.call(e.scope||e,e,e.value),e.onSelect()),e},selectedUpdate:function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());this.callParent([t])}})},8786:function(){!function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Ext.define("Ext.ux.exporter.Base64",{statics:{encode:function(t){let n,i,o,r,a,s,l,c="",u=0;for(t=function(e){e=e.replace(/\r\n/g,"\n");let t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}(t);u<t.length;)n=t.charCodeAt(u++),i=t.charCodeAt(u++),o=t.charCodeAt(u++),r=n>>2,a=(3&n)<<4|i>>4,s=(15&i)<<2|o>>6,l=63&o,isNaN(i)?s=l=64:isNaN(o)&&(l=64),c=c+e.charAt(r)+e.charAt(a)+e.charAt(s)+e.charAt(l);return c}}})}()},4916:function(e,t,n){n(676),n(1078),n(6438),n(9582),n(5310),n(8786),Ext.define("Ext.ux.exporter.Exporter",{uses:["Ext.ux.exporter.Base64","Ext.ux.exporter.csvFormatter.CsvFormatter","Ext.ux.exporter.excelFormatter.ExcelFormatter","Ext.ux.exporter.htmlFormatter.HtmlFormatter","Ext.ux.exporter.xlsxFormatter.XlsxFormatter"],statics:{exportAny:function(e,t,n){var i="export";e.is?e.is("gridpanel")?i+="Grid":e.is("treepanel")?i+="Tree":(i+="Store",e=e.getStore()):i+="Store",this[i](e,this.getFormatterByName(t),n)},exportGrid:function(e,t,n){n=n||{},t=this.getFormatterByName(t);var i=Ext.Array.filter(e.columns,(function(e){return!e.hidden&&!e.disableExport}));i.sort((function(e,t){return e.getIndex()<t.getIndex()?-1:1})),Ext.applyIf(n,{title:e.title,columns:i}),this.doFormat(t,e.store,n)},exportStore:function(e,t,n){n=n||{},t=this.getFormatterByName(t),Ext.applyIf(n,{columns:e.fields?e.fields.items:e.model.prototype.fields.items}),this.doFormat(t,e,n)},doFormat:function(e,t,n){var i=n.callback;if(Ext.getBody().mask(UB.i18n("pleaseWait")),n.callback=function(e){Ext.getBody().unmask(),i.call(n.scope,e)},t.buffered||t.pageSize&&t.pageSize>0){var o,r,a,s,l,c={};s=n.entityName,o=Ext.apply(Ext.clone(t.ubRequest),{options:{start:0,totalRequired:!0}}),r=UB.ux.data.proxy.UBProxy.ubFilterToWhereList(t.filters.getRange(),s),o.whereList=o.whereList||{},Ext.Object.merge(o.whereList,r);var u,d=100;if(t.sorters&&(u=t.sorters.length)>0){o.orderList={};for(let e=0;e<u;++e)l=t.sorters.get(e),o.orderList["x"+d++]={expression:l.property,order:"ASC"===l.direction?"asc":"desc"}}delete o.limit,$App.connection.select(o).then((function(i){Ext.Array.each(o.fieldList,(function(e,t){c[e]=t}),this),(a={data:i.resultData.data}).dataFieldsMap=c,a.isRawData=!0,a.ubRequest=t.ubRequest,a.model=t.model,e.format(a,n)}))}else e.format(t,n)},exportTree:function(e,t,n){n=n||{},t=this.getFormatterByName(t);var i=e.store||n.store;Ext.applyIf(n,{title:e.title}),this.doFormat(t,i,n)},getFormatterByName:function(e){return e=e||"csv",Ext.isString(e)?Ext.create("Ext.ux.exporter."+e+"Formatter."+Ext.String.capitalize(e)+"Formatter"):e}}})},676:function(){Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function(e){e=e||{},Ext.applyIf(e,{})}})},1078:function(){Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:",",extension:"csv",lineSeparator:"\n",capitalizeHeaders:!1,format:function(e,t){var n;this.columns=t.columns||(e.fields?e.fields.items:e.model.prototype.fields.items),this.entityName=t.entityName,this.eAttributes={},Ext.each(t.columns,(function(e,t){this.eAttributes[e.dataIndex]=$App.domainInfo.get(this.entityName).getEntityAttribute(e.dataIndex)}),this),n=this.getHeaders()+this.lineSeparator+this.getRows(e),t.callback.call(t.scope,n)},getHeaders:function(e){var t=[];return Ext.each(this.columns,(function(e){var n;n=null!=e.text?e.text:e.name?e.name.replace(/_/g," "):"",this.capitalizeHeaders&&(n=Ext.String.capitalize(n)),t.push(n)}),this),t.join(this.separator)},getRows:function(e){var t=[];return e.isRawData?Ext.Array.each(e.data,(function(n,i){t.push(this.getCells(n,i,e))}),this):e.each((function(n,i){t.push(this.getCells(n,i,e))}),this),t.join(this.lineSeparator)},getCells:function(e,t,n){let i=[],o=this;return Ext.each(this.columns,(function(r,a){let s,l=r.name||r.dataIndex;if(!l)return!0;if(n.isRawData)switch(s=e[n.dataFieldsMap[r.dataIndex]],o.eAttributes[r.dataIndex].dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:s=new Date(s);break;case UBDomain.ubDataTypes.Float:case UBDomain.ubDataTypes.Currency:s=parseFloat(s);break;case UBDomain.ubDataTypes.Int:s=parseInt(s,10)}else s=e.get(l);"function"==typeof r.renderer&&(s=r.renderer(s,null,e,t,a,n),s=Ext.String.htmlDecode(s)),s='"'+s+'"',i.push(s)})),i.join(this.separator)}})},697:function(){Ext.define("Ext.ux.exporter.excelFormatter.Cell",{constructor:function(e){Ext.applyIf(e,{type:"String"}),Ext.apply(this,e),Ext.ux.exporter.excelFormatter.Cell.superclass.constructor.apply(this,arguments)},render:function(){return this.tpl.apply(this)},tpl:Ext.create("Ext.XTemplate",'<Cell ss:StyleID="{style}">','<Data ss:Type="{type}">{value}</Data>',"</Cell>")})},5310:function(e,t,n){n(4234),Ext.define("Ext.ux.exporter.excelFormatter.ExcelFormatter",{extend:"Ext.ux.exporter.Formatter",uses:["Ext.ux.exporter.excelFormatter.Cell","Ext.ux.exporter.excelFormatter.Style","Ext.ux.exporter.excelFormatter.Worksheet","Ext.ux.exporter.excelFormatter.Workbook"],contentType:"data:application/vnd.ms-excel;base64,",extension:"xls",format:function(e,t){const n=Ext.create("Ext.ux.exporter.excelFormatter.Workbook",t);return n.addWorksheet(e,t||{}),n.render()}})},4059:function(){Ext.define("Ext.ux.exporter.excelFormatter.Style",{constructor:function(e){if(e=e||{},Ext.apply(this,e,{parentStyle:"",attributes:[]}),Ext.ux.exporter.excelFormatter.Style.superclass.constructor.apply(this,arguments),null==this.id)throw new Error("An ID must be provided to Style");this.preparePropertyStrings()},preparePropertyStrings:function(){Ext.each(this.attributes,(function(e,t){this.attributes[t].propertiesString=this.buildPropertyString(e),this.attributes[t].children=e.children||[],Ext.each(e.children,(function(e,n){this.attributes[t].children[n].propertiesString=this.buildPropertyString(e)}),this)}),this)},buildPropertyString:function(e){let t="";return Ext.each(e.properties||[],(function(e){t+=Ext.String.format('ss:{0}="{1}" ',e.name,e.value)}),this),t},render:function(){return this.tpl.apply(this)},tpl:Ext.create("Ext.XTemplate",'<tpl if="parentStyle.length == 0">','<Style ss:ID="{id}">',"</tpl>",'<tpl if="parentStyle.length != 0">','<Style ss:ID="{id}" ss:Parent="{parentStyle}">',"</tpl>",'<tpl for="attributes">','<tpl if="children.length == 0">',"<{name} {propertiesString} />","</tpl>",'<tpl if="children.length &gt; 0">',"<{name} {propertiesString}>",'<tpl for="children">',"<{name} {propertiesString} />","</tpl>","</{name}>","</tpl>","</tpl>","</Style>")})},4234:function(e,t,n){n(4059),n(1576),Ext.define("Ext.ux.exporter.excelFormatter.Workbook",{constructor:function(e){e=e||{},Ext.apply(this,e,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:!0,hasStripeStyles:!0,windowHeight:9e3,windowWidth:5e4,protectStructure:!1,protectWindows:!1}),this.hasDefaultStyle&&this.addDefaultStyle(),this.hasStripeStyles&&this.addStripedStyles(),this.addTitleStyle(),this.addHeaderStyle()},render:function(){return this.compileStyles(),this.joinedCompiledStyles=this.compiledStyles.join(""),this.compileWorksheets(),this.joinedWorksheets=this.compiledWorksheets.join(""),this.tpl.apply(this)},addWorksheet:function(e,t){const n=Ext.create("Ext.ux.exporter.excelFormatter.Worksheet",e,t);return this.worksheets.push(n),n},addStyle:function(e){const t=Ext.create("Ext.ux.exporter.excelFormatter.Style",e||{});return this.styles.push(t),t},compileStyles:function(){return this.compiledStyles=[],Ext.each(this.styles,(function(e){this.compiledStyles.push(e.render())}),this),this.compiledStyles},compileWorksheets:function(){return this.compiledWorksheets=[],Ext.each(this.worksheets,(function(e){this.compiledWorksheets.push(e.render())}),this),this.compiledWorksheets},tpl:Ext.create("Ext.XTemplate",'<?xml version="1.0" encoding="utf-8"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" ','xmlns:x="urn:schemas-microsoft-com:office:excel" ','xmlns:o="urn:schemas-microsoft-com:office:office" ','xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" ','xmlns:html="http://www.w3.org/TR/REC-html40">','<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">',"<Title>{title}</Title>","</DocumentProperties>",'<OfficeDocumentSettings xmlns="urn:schemas-microsoft-com:office:office">',"<AllowPNG/>","</OfficeDocumentSettings>",'<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">',"<WindowHeight>{windowHeight}</WindowHeight>","<WindowWidth>{windowWidth}</WindowWidth>","<ProtectStructure>{protectStructure}</ProtectStructure>","<ProtectWindows>{protectWindows}</ProtectWindows>","</ExcelWorkbook>","<Styles>","{joinedCompiledStyles}","</Styles>","{joinedWorksheets}","</Workbook>"),addDefaultStyle:function(){const e=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:"Default",attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"10"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(e)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(e)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(e)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(e)}]}]})},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"},{name:"Vertical",value:"Center"}]}]})},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"10"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#A3C9F1"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]})},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#F5FAFF"}]}]}),this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#FFFFFF"}]}]}),Ext.each(["even","odd"],(function(e){this.addChildNumberFormatStyle(e,e+"date","[ENG][$-409]dd-mmm-yyyy;@"),this.addChildNumberFormatStyle(e,e+"int","0"),this.addChildNumberFormatStyle(e,e+"float","0.00")}),this)},addChildNumberFormatStyle:function(e,t,n){this.addStyle({id:t,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:n}]}]})}})},1576:function(e,t,n){n(697),Ext.define("Ext.ux.exporter.excelFormatter.Worksheet",{constructor:function(e,t){t=t||{},this.store=e,Ext.applyIf(t,{hasTitle:!0,hasHeadings:!0,stripeRows:!0,title:"Workbook",columns:null==e.fields?{}:e.fields.items}),Ext.apply(this,t),Ext.ux.exporter.excelFormatter.Worksheet.superclass.constructor.apply(this,arguments)},dateFormatString:"Y-m-d",worksheetTpl:Ext.create("Ext.XTemplate",'<Worksheet ss:Name="{title}">',"<Names>",'<NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />',"</Names>",'<Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">',"{columns}",'<Row ss:Height="38">','<Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></Data><NamedCell ss:Name="Print_Titles" />',"</Cell>","</Row>",'<Row ss:AutoFitHeight="1">',"{header}","</Row>","{rows}","</Table>",'<WorksheetOptions xmlns="urn:schemas-microsoft-com:office:excel">',"<PageSetup>",'<Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />',"</PageSetup>","<FitToPage />","<Print>","<PrintErrors>Blank</PrintErrors>","<FitWidth>1</FitWidth>","<FitHeight>32767</FitHeight>","<ValidPrinterInfo />","<VerticalResolution>600</VerticalResolution>","</Print>","<Selected />","<DoNotDisplayGridlines />","<ProtectObjects>False</ProtectObjects>","<ProtectScenarios>False</ProtectScenarios>","</WorksheetOptions>","</Worksheet>"),render:function(e){return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+2,title:this.title.replace(/[/\\?*[\]]/g,"-")})},buildColumns:function(){const e=[];return Ext.each(this.columns,(function(t){e.push(this.buildColumn())}),this),e},buildColumn:function(e){return Ext.String.format('<Column ss:AutoFitWidth="1" ss:Width="{0}" />',e||164)},buildRows:function(){const e=[];return this.store.each((function(t,n){e.push(this.buildRow(t,n))}),this),e},buildHeader:function(){const e=[];return Ext.each(this.columns,(function(t){let n;null!=t.text?n=t.text:t.name&&(n=t.name.replace(/_/g," "),n=Ext.String.capitalize(n)),e.push(Ext.String.format('<Cell ss:StyleID="headercell"><Data ss:Type="String">{0}</Data><NamedCell ss:Name="Print_Titles" /></Cell>',n))}),this),e.join("")},buildRow:function(e,t){let n;const i=[];!0===this.stripeRows&&(n=t%2==0?"even":"odd");let o=0;return Ext.each(this.columns,(function(r){const a=r.name||r.dataIndex;if(void 0!==a){let s,l;"function"==typeof r.renderer?(s=r.renderer(e.get(a),{},e,t,o++,this.store),l="String"):(s=e.get(a),l=this.typeMappings[r.type||e.fields.get(a).type.type]),i.push(this.buildCell(s,l,n).render())}}),this),Ext.String.format("<Row>{0}</Row>",i.join(""))},buildCell:function(e,t,n){return"DateTime"===t&&_.isFunction(e.format)&&(e=e.format(this.dateFormatString)),Ext.create("Ext.ux.exporter.excelFormatter.Cell",{value:e,type:t,style:n})},typeMappings:{int:"Number",string:"String",float:"Number",date:"DateTime"}})},6438:function(){Ext.define("Ext.ux.exporter.htmlFormatter.HtmlFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/Html;base64,",separator:"",extension:"html",lineSeparator:"<br>",lineSeparator1:"</tr><tr>",startHtml:"<!DOCTYPE html><html><head><meta charset='utf-8'><title></title></head><style>.TD:hover{background: lightblue;color: #000000;}caption{text-align: center;font-size: 22px;font-weight: bolder;font-style: italic}td{border: 1px solid black; font-size: 14px}table{border: 2px double black;border-collapse: collapse;}</style><body><table style='width:",startCaption:"px'><caption>",endCaption:"</caption>",end:"</table></body></html>",capitalizeHeaders:!1,format:function(e,t){var n,i;this.columns=t.columns||(e.fields?e.fields.items:e.model.prototype.fields.items),this.entityName=t.entityName,i=$App.domainInfo.get(this.entityName),this.eAttributes={},Ext.each(t.columns,(function(e,t){this.eAttributes[e.dataIndex]=i.getEntityAttribute(e.dataIndex)}),this),n=this.startHtml+this.styleGridTable()+this.startCaption+this.gridTitleHtml(t)+this.endCaption+this.extHtml()+this.getRows(e)+this.end,t.callback.call(t.scope,n)},extHtml:function(){return new Ext.XTemplate("<tr>",'<tpl for=".">','<td style=" width:{width}px; text-align: center; font-weight: bold;font-size: 18px; background: lightblue ">{text}</td>',"</tpl>","</tr>","<tr>").apply(this.columns)},gridTitleHtml:function(e){var t=[];return t.push(e.title),t.join(this.separator)},getHeaders:function(){var e=[];return Ext.each(this.columns,(function(t){var n;n=null!=t.text?t.text:t.name?t.name.replace(/_/g," "):"",this.capitalizeHeaders&&(n=Ext.String.capitalize(n)),e.push(n)}),this),e.join(this.separator)},styleGridTable:function(){var e=[],t=0;return Ext.each(this.columns,(function(n){var i;i=null!=n.width?n.width:n.width?n.width.replace(/_/g," "):"",this.capitalizeHeaders&&(i=Ext.String.capitalize(i)),e.push(i),t+=i}),this),t},getRows:function(e){var t=[];return e.isRawData?Ext.Array.each(e.data,(function(n,i){t.push(this.getCells(n,i,e))}),this):e.each((function(n,i){t.push(this.getCells(n,i,e))}),this),t.join(this.lineSeparator1)},getCells:function(e,t,n){let i=this,o=[];return Ext.each(this.columns,(function(r,a){let s,l=r.name||r.dataIndex;if(!l)return!0;if(n.isRawData)switch(s=e[n.dataFieldsMap[r.dataIndex]],i.eAttributes[r.dataIndex].dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:s=s?new Date(s):s;break;case UBDomain.ubDataTypes.Float:case UBDomain.ubDataTypes.Currency:s=s?parseFloat(s):s;break;case UBDomain.ubDataTypes.Int:s=s?parseInt(s,10):s}else s=e.get(l);"function"==typeof r.renderer&&(s=r.renderer(s,null,e,t,a,n)),s='<td class="TD">'+(s||"")+"</td>",o.push(s)})),o.join(this.separator)}})},9582:function(e,t,n){const i=n(9274).UBDomain;Ext.define("Ext.ux.exporter.xlsxFormatter.XlsxFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:application/vnd.ms-excel;base64,",extension:"xls",sharedStrings:{item:[],count:0},format:function(e,t){if(window&&!window.isserver&&!Ext.ux.exporter.xlsxFormatter.XlsxFormatter.libsLoaded)return void SystemJS.import("@unitybase/xlsx/dist/xlsx-all.min.js").then((n=>{window.XLSX=n,Ext.ux.exporter.xlsxFormatter.XlsxFormatter.libsLoaded=!0,this.format(e,t)}));var n,o,r,a,s,l,c,u,d,f,h,p,m,g,y,x,b,v,E,w,C,I,S=[],B=window.XLSX;function D(e){const t=C[e.name];if(t)switch(t.dataType){case i.ubDataTypes.Date:case i.ubDataTypes.DateTime:return f;case i.ubDataTypes.Float:return b;case i.ubDataTypes.Currency:return v;case i.ubDataTypes.Int:return E;case i.ubDataTypes.String:case i.ubDataTypes.Text:return y;default:return x}switch(e.type.type){case"date":return f;case"float":return b;case"int":return E;default:return x}}function A(e){const t=C[e.name],n=i.ubDataTypes;if(t)switch(t.dataType){case n.Date:case n.DateTime:return 12;case n.Float:case n.Currency:return 13;case n.Int:case n.Boolean:return 10;case n.String:return t.size<11?10:t.size<17?16:t.size<26?25:30;case n.Text:return 50}switch(e.type.type){case"date":return 12;case"string":return 25;case"float":return 13;default:return 18}}function T(t,n,o,r,a){let s;if(h)switch(C[t.dataIndex].dataType){case i.ubDataTypes.Date:case i.ubDataTypes.DateTime:case i.ubDataTypes.Float:case i.ubDataTypes.Currency:case i.ubDataTypes.Int:s=n}s||("function"==typeof t.renderer?(s=t.renderer(n,null,a,r,t.dataIndex,e),s=Ext.String.htmlDecode(s)):s=n),o.push({value:s})}(n=new B.XLSXWorkbook).useSharedString=!0,h=t.metaobject,w=t.entityName,h||(h=$App.domainInfo.get(w)),o=(g=n.style).fonts.add({code:"def",name:"Calibri",fontSize:11,scheme:"minor"}),g.fonts.add({code:"defBold",name:"Calibri",fontSize:11,scheme:"minor",bold:!0}),u=g.borders.add({left:{style:"thin"},right:{style:"thin"},top:{style:"thin"},bottom:{style:"thin"}}),g.alignments.add({code:"Hright",horizontal:"right"}),g.alignments.add({code:"Hcenter",horizontal:"center",wrapText:"1"}),g.alignments.add({code:"HVcenter",horizontal:"center",vertical:"center",wrapText:"1"}),g.alignments.add({code:"wrapText",wrapText:"1"}),g.formats.add({code:"floatFormat",formatCode:"#,##0.0000_ ;[Red]\\-#,##0.0000\\ "}),g.formats.add({code:"sumFormat",formatCode:"#,##0.00_ ;[Red]\\-#,##0.00\\ "}),g.formats.add({code:"intFormat",formatCode:"#,##0_ ;[Red]\\-#,##0\\ "}),f=g.getStyle({font:o,border:u,format:B.XLSXStyle.indexDefFormateDate,code:"DefDateStyle"}),b=g.getStyle({font:o,border:u,alignment:g.alignments.named.Hright,format:g.formats.named.floatFormat}),v=g.getStyle({font:o,border:u,alignment:g.alignments.named.Hright,format:g.formats.named.sumFormat}),E=g.getStyle({font:o,border:u,alignment:g.alignments.named.Hright,format:g.formats.named.intFormat}),x=g.getStyle({font:o,border:u}),y=g.getStyle({font:o,border:u,alignment:g.alignments.named.wrapText}),p=g.getStyle({font:g.fonts.named.defBold,alignment:g.alignments.named.HVcenter}),m=g.getStyle({font:g.fonts.named.defBold,fill:"EBEDED",border:u,alignment:g.alignments.named.HVcenter}),C={},Ext.each(t.columns,(function(e,t){C[e.dataIndex]=h.getEntityAttribute(e.dataIndex)}),this),r=n.addWorkSheet({caption:t.title,name:t.title}),a=Ext.ModelManager.getModel(e.model),l=a.getFields(),s=[],c=[],I={},Ext.each(t.columns,(function(e,t){I[e.dataIndex]=function(e){let t;return Ext.each(l,(function(n){if(n.name===e)return t=n,0}),this),t}(e.dataIndex)}),this),r.addMerge({colFrom:1,colTo:t.columns.length}),r.addRow({value:t.title,column:1,style:p},{},{height:40}),S.push({column:0,width:1}),Ext.each(t.columns,(function(e,t){const n=I[e.dataIndex];S.push({column:t+1,width:A(n)}),s.push({column:t+1,style:D(n)}),d=Ext.String.capitalize(e.text||n.name||"").replace(/_/g," "),c.push({column:t+1,value:d,style:m})}),this),r.setColsProperties(S),r.addRow(c,null,{height:30}),e.isRawData?Ext.Array.each(e.data,(function(n,i){c=[],Ext.each(t.columns,(function(t){T(t,n[e.dataFieldsMap[t.dataIndex]],c,i,n)}),this),r.addRow(c,s)}),this):e.each((function(e,n){c=[],Ext.each(t.columns,(function(t){T(t,e.get(t.dataIndex),c,n,e)}),this),r.addRow(c,s)}),this);const k=n.render();t.callback.call(t.scope,k)}})},2823:function(e,t,n){n(3072),Ext.define("Ext.ux.form.DateTimeField",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",requires:["Ext.ux.DateTimePicker"],initComponent:function(){this.format=this.format+" "+(this.useSeconds?"H:i:s":"H:i"),this.callParent()},createPicker:function(){var e=this,t=Ext.String.format;return Ext.create("Ext.ux.DateTimePicker",{ownerCt:e.ownerCt,useSeconds:e.useSeconds,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:e.minValue,maxDate:e.maxValue,disabledDatesRE:e.disabledDatesRE,disabledDatesText:e.disabledDatesText,disabledDays:e.disabledDays,disabledDaysText:e.disabledDaysText,format:e.format,showToday:e.showToday,minText:t(e.minText,e.formatDate(e.minValue)),maxText:t(e.maxText,e.formatDate(e.maxValue)),listeners:{scope:e,select:e.onSelect},keyNavConfig:{esc:function(){e.collapse()}}})},onExpand:function(){var e=this,t=this.getValue();if(!t&&e.defaultTime)if(t=new Date,"string"==typeof e.defaultTime){var n=e.defaultTime.split(":");t.setHours(parseInt(n[0],10)),t.setMinutes(parseInt(n[1],10)),n.length>2&&t.setMilliseconds(parseInt(n[2],10))}else"function"==typeof e.defaultTime?e.defaultTime(e,t):(t.setHours(e.defaultTime.getHours()),t.setMinutes(e.defaultTime.getMinutes()),t.setMilliseconds(e.defaultTime.getMilliseconds()));this.picker.setValue(Ext.isDate(t)?t:new Date)}})},7479:function(e,t,n){n(8620),Ext.define("Ext.ux.form.TimePickerField",{extend:"Ext.form.field.Base",alias:"widget.uxtimepicker",alternateClassName:"Ext.form.field.TimePickerField",requires:["Ext.form.field.Number","Ext.ux.form.field.PadNumber"],inputType:"hidden",style:"padding:4px 0 0 0;margin-bottom:0px",msgTarget:"none",value:null,initComponent:function(){var e=this;e.useSeconds&&(e.margin="0 0 0 0"),e.spinnerCfg=e.spinnerCfg||{columnWidth:e.useSeconds?.333:.5,margin:e.useSeconds?"0 0 0 0":"0 15px 0 0"},e.value=e.value||"00:00:00",e.callParent(),e.spinners=[];var t=Ext.apply({},e.spinnerCfg,{readOnly:e.readOnly,disabled:e.disabled,style:"float: left",listeners:{change:{fn:e.onSpinnerChange,scope:e}}});e.hoursSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},t,{minValue:0,maxValue:23})),e.minutesSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},t,{minValue:0,maxValue:59})),e.useSeconds?(e.secondsSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},t,{minValue:0,maxValue:59})),e.spinners.push(e.hoursSpinner,e.minutesSpinner,e.secondsSpinner)):e.spinners.push(e.hoursSpinner,e.minutesSpinner),e.on("render",e.addSpinners,e)},addSpinners:function(){var e,t;e=Ext.dom.Query.select("td",this.getEl().dom)[1],t=Ext.get(e),Ext.create("Ext.container.Container",{layout:"column",border:!1,frame:!1,items:this.spinners,renderTo:t}),Ext.core.DomHelper.append(t,{tag:"div",cls:"x-form-clear-left"}),this.setRawValue(this.value)},_valueSplit:function(e){Ext.isDate(e)&&(e=Ext.Date.format(e,"H:i:s"));var t=e.split(":");return{h:t.length>0?t[0]:0,m:t.length>1?t[1]:0,s:t.length>2?t[2]:0}},onSpinnerChange:function(){this.rendered&&this.fireEvent("change",this,this.getValue(),this.getRawValue())},callSpinnersFunction:function(e,t){for(var n=0;n<this.spinners.length;n++)this.spinners[n][e](t)},getRawValue:function(){if(this.rendered)return{h:this.hoursSpinner.getValue(),m:this.minutesSpinner.getValue(),s:this.useSeconds?this.secondsSpinner.getValue():0};var e=this.value||new Date;return this._valueSplit(e)},setRawValue:function(e){e=this._valueSplit(e),this.hoursSpinner&&(this.hoursSpinner.setValue(e.h),this.minutesSpinner.setValue(e.m),this.useSeconds&&this.secondsSpinner.setValue(e.s))},getValue:function(){var e=this.getRawValue();return Ext.String.leftPad(e.h,2,"0")+":"+Ext.String.leftPad(e.m,2,"0")+":"+Ext.String.leftPad(e.s,2,"0")},setValue:function(e){this.value=Ext.isDate(e)?Ext.Date.format(e,"H:i:s"):e,this.rendered&&(this.setRawValue(this.value),this.validate())},disable:function(){this.callParent(arguments),this.callSpinnersFunction("disable",arguments)},enable:function(){this.callParent(arguments),this.callSpinnersFunction("enable",arguments)},setReadOnly:function(){this.callParent(arguments),this.callSpinnersFunction("setReadOnly",arguments)},clearInvalid:function(){this.callParent(arguments),this.callSpinnersFunction("clearInvalid",arguments)},isValid:function(e){return this.hoursSpinner.isValid(e)&&this.minutesSpinner.isValid(e)&&(!this.useSeconds||this.secondsSpinner.isValid(e))},validate:function(){return this.hoursSpinner.validate()&&this.minutesSpinner.validate()&&(!this.useSeconds||this.secondsSpinner.validate())}})},7680:function(e,t,n){Ext.define("Ext.ux.form.TinyMCETextArea",{extend:"Ext.form.field.TextArea",alias:["widget.tinymce_textarea","widget.tinymce_field"],wysiwygIntialized:!1,intializationInProgress:!1,lastHeight:null,lastFrameHeight:null,noWysiwyg:!1,tinyMCEConfig:{},ensureTinyMCELoaded:function(){return window.BOUNDLED_BY_WEBPACK=!1,Promise.all([n.e(659),n.e(411)]).then(n.t.bind(n,1411,23))},afterRender:function(){var e=this;e.callParent(arguments),e.on("blur",(function(){var t=document.getElementById(e.getInputId());if(e.wysiwygIntialized){var n=tinymce.get(e.getInputId());n&&n.isHidden()&&(t&&(e.positionBeforeBlur={start:t.selectionStart,end:t.selectionEnd}),n.load())}else t&&(e.positionBeforeBlur={start:t.selectionStart,end:t.selectionEnd})}),e),e.on("resize",(function(t,n,i){e.noWysiwyg||e.wysiwygIntialized?e.syncEditorHeight(i):e.initEditor(i)}),e)},syncEditorHeight:function(e){var t=this;if(t.lastHeight=e,t.wysiwygIntialized&&t.rendered){var n=tinymce.get(t.getInputId());if(n&&!n.isHidden()){var i=Ext.get(t.getInputId()+"_ifr");if(i){var o=i.up(".mce-edit-area"),r=e,a=(o=o.up(".mce-container-body")).down(".mce-toolbar-grp");a&&(r-=a.getHeight());var s=o.down(".mce-menubar");s&&(r-=s.getHeight());var l=o.down(".mce-statusbar");return l&&(r-=l.getHeight()),t.lastFrameHeight=r-3,i.setHeight(r-3),r-3}}}},initEditor:function(e){var t=this;if(!(t.noWysiwyg||t.intializationInProgress||t.wysiwygIntialized)){if(t.intializationInProgress=!0,t.tinyMCEConfig){var n=t.tinyMCEConfig;t.tinyMCEConfig={},Ext.Object.merge(t.tinyMCEConfig,n)}else t.tinyMCEConfig={};t.tinyMCEConfig.mode="exact",t.tinyMCEConfig.resize=!1,t.tinyMCEConfig.elements=t.getInputId(),t.lastFrameHeight?t.tinyMCEConfig.height=t.lastFrameHeight:t.tinyMCEConfig.height=30,t.readOnly&&(t.tinyMCEConfig.readonly=!0),t.isDisabled()&&(t.tinyMCEConfig.readonly=!0),t.labelEl&&t.labelEl.on("click",(function(){t.focus(!1)}),t.labelEl);var i=null;t.tinyMCEConfig.setup&&(i=t.tinyMCEConfig.setup),t.tinyMCEConfig.setup=function(n){n.on("init",(function(i){t.wysiwygIntialized=!0,t.intializationInProgress=!1;var o=n.setContent;n.setContent=function(){o.apply(n,arguments),n.fire("change",{})},e&&setTimeout((function(){t.syncEditorHeight(e)}),200)})),n.on("change",(function(){var e=t.getValue(),i=n.getContent();n.save(),t.fireEvent("change",t,i,e,{}),t.validateOnChange&&t.validate()})),n.on("focus",(function(){var e=t.findParentByType("window");e&&e.toFront(!0)})),i&&i(n)},this.ensureTinyMCELoaded().then((()=>{window.tinymce.init(t.tinyMCEConfig),t.intializationInProgress=!1}))}},getEditor:function(){if(this.wysiwygIntialized)return tinymce.get(this.getInputId())},isEditorHidden:function(){if(!this.wysiwygIntialized)return!0;var e=tinymce.get(this.getInputId());return!e||e.isHidden()},showEditor:function(){var e=this;if(e.storedCursorPosition=null,!e.wysiwygIntialized)return e.noWysiwyg=!1,void e.initEditor(e.getHeight());var t=tinymce.get(e.getInputId());t&&(t.show(),t.nodeChanged(),e.lastHeight&&e.syncEditorHeight(e.lastHeight),e.focus())},hideEditor:function(){var e=this;if(e.wysiwygIntialized){var t=tinymce.get(e.getInputId());if(t){var n=t.selection.getNode();if(n&&"#document"!==n.nodeName&&"BODY"!==n.nodeName&&"body"!==n.nodeName){var i='<a id="_____sys__11223___"></a>';t.selection.collapse(!0),t.execCommand("mceInsertContent",0,i),t.hide();var o=document.getElementById(e.getInputId()),r=-1,a="";if(o&&(r=(a=o.value).indexOf(i)),-1!==r){var s=new RegExp(i,"g");a=a.replace(s,""),o.value=a,o.setSelectionRange&&(o.focus(),o.setSelectionRange(r,r))}}else t.hide()}}},toggleEditor:function(){var e=this;e.wysiwygIntialized?tinymce.get(e.getInputId()).isHidden()?e.showEditor():e.hideEditor():e.showEditor()},removeEditor:function(){var e=this;if(e.intializationInProgress)return e;if(!e.wysiwygIntialized)return e;var t=tinymce.get(e.getInputId());return t&&(t.save(),t.destroy(!1)),e.wysiwygIntialized=!1,e},reinitEditor:function(e){var t=this;if(t.noWysiwyg||t.intializationInProgress)return t;if(t.tinyMCEConfig||(t.tinyMCEConfig={}),e||(e={}),Ext.apply(t.tinyMCEConfig,e),!t.wysiwygIntialized)return t;var n=!0,i=tinymce.get(t.getInputId());return i&&(n=i.isHidden(),i.save(),i.destroy(!1)),t.wysiwygIntialized=!1,n||t.initEditor(t.getHeight()),t},setValue:function(e){var t=this,n=t.callParent(arguments);if(t.wysiwygIntialized){var i=tinymce.get(t.getInputId());i&&(i.load(),i.save())}return n},focus:function(e,t){var n=this;if(n.isDisabled())return n;if(t)return isNaN(t)&&(t=10),setTimeout((function(){n.focus(e,!1)}),t),n;if(!n.wysiwygIntialized)return n.callParent(arguments);var i=tinymce.get(n.getInputId());return!i||i.isHidden()?n.callParent(arguments):(n.callParent(arguments),i.focus(!0),n)},enable:function(e){var t=this,n=t.callParent(arguments);return n?(t.tinyMCEConfig.readonly&&t.reinitEditor({readonly:!1}),n):n},disable:function(e){var t=this,n=t.callParent(arguments);return n?(t.tinyMCEConfig.readonly||t.reinitEditor({readonly:!0}),n):n},setReadOnly:function(e){var t=this,n=t.callParent(arguments);return e!==t.tinyMCEConfig.readonly&&t.reinitEditor({readonly:e}),n},storeCurrentSelection:function(){var e=this,t=!1,n=tinymce.get(e.getInputId());e.wysiwygIntialized&&n&&!n.isHidden()&&(t=!0);var i=document.getElementById(e.getInputId());t?e.storedCursorPosition=n.selection.getBookmark("simple"):i&&(e.storedCursorPosition=e.positionBeforeBlur)},restoreCurrentSelection:function(){var e=this;if(e.storedCursorPosition){var t=!1,n=tinymce.get(e.getInputId());e.wysiwygIntialized&&n&&!n.isHidden()&&(t=!0);var i=document.getElementById(e.getInputId());t?n.selection.moveToBookmark(e.storedCursorPosition):i&&i.setSelectionRange(e.storedCursorPosition.start,e.storedCursorPosition.end)}},insertText:function(e){var t=this,n=!1,i=tinymce.get(t.getInputId());t.wysiwygIntialized&&i&&!i.isHidden()&&(n=!0);var o=document.getElementById(t.getInputId());if(n)i.focus(),i.execCommand("mceInsertContent",0,e);else if(o){o.focus();var r=o.selectionStart+e.length;o.value=o.value.slice(0,o.selectionStart)+e+o.value.slice(o.selectionEnd),o.setSelectionRange(r,r)}},beforeDestroy:function(){var e=window.tinymce&&tinymce.get(this.getInputId());e&&e.destroy(!1)},renderActiveError:function(){var e=this,t=e.getActiveError(),n=!!t,i=Ext.get(e.getInputId()+"_ifr");if(!i)return e.callParent(arguments);var o=tinymce.get(e.getInputId());if(!o)return e.callParent(arguments);var r=i.up(".mce-edit-area");if(!(r=r.up(".mce-container-body")))return e.callParent(arguments);if(!(r=r.up(".mce-tinymce")))return e.callParent(arguments);if(e.rendered&&!e.isDestroyed&&!e.preventMark){var a=function(){e.clearInvalid()};n?(r.addCls("tinymce-error-field"),o.on("keydown",a),o.on("change",a)):(r.removeCls("tinymce-error-field"),o.off("keydown",a),o.off("change",a))}return e.callParent(arguments)}})},4641:function(){Ext.define("Ext.ux.form.field.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],delimiter:",",multiSelect:!0,forceSelection:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,triggerOnClick:!0,stacked:!1,pinList:!0,filterPickList:!1,selectOnFocus:!0,grow:!0,growMin:!1,growMax:!1,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list">','<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],childEls:["listWrapper","itemList","inputEl","inputElCt","emptyEl"],componentLayout:"boxselectfield",emptyInputCls:"x-boxselect-emptyinput",initComponent:function(){var e=this,t=e.typeAhead;t&&!e.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings."),Ext.apply(e,{typeAhead:!1}),e.callParent(),e.typeAhead=t,e.selectionModel=new Ext.selection.Model({store:e.valueStore,mode:"MULTI",lastFocused:null,onSelectChange:function(e,t,n,i){i()}}),!Ext.isEmpty(e.delimiter)&&e.multiSelect&&(e.delimiterRegexp=new RegExp(String(e.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")))},initEvents:function(){var e=this;e.callParent(arguments),e.enableKeyEvents||e.mon(e.inputEl,"keydown",e.onKeyDown,e),e.mon(e.inputEl,"paste",e.onPaste,e),e.mon(e.listWrapper,"click",e.onItemListClick,e),e.mon(e.selectionModel,{selectionchange:function(t,n){e.applyMultiselectItemMarkup(),e.fireEvent("valueselectionchange",e,n)},focuschange:function(t,n,i){e.fireEvent("valuefocuschange",e,n,i)},scope:e})},onBindStore:function(e,t){var n=this;e&&(n.valueStore=new Ext.data.Store({model:e.model,proxy:{type:"memory"}}),n.mon(n.valueStore,"datachanged",n.applyMultiselectItemMarkup,n),n.selectionModel&&n.selectionModel.bindStore(n.valueStore))},onUnbindStore:function(e){var t=this,n=t.valueStore;n&&(t.selectionModel&&(t.selectionModel.setLastFocused(null),t.selectionModel.deselectAll(),t.selectionModel.bindStore(null)),t.mun(n,"datachanged",t.applyMultiselectItemMarkup,t),n.destroy(),t.valueStore=null),t.callParent(arguments)},createPicker:function(){var e=this,t=e.callParent(arguments);return e.mon(t,{beforerefresh:e.onBeforeListRefresh,scope:e}),e.filterPickList&&t.addCls("x-boxselect-hideselections"),t},onDestroy:function(){var e=this;Ext.destroyMembers(e,"valueStore","selectionModel"),e.callParent(arguments)},getSubTplData:function(){var e=this,t=e.callParent(),n=e.emptyText&&t.value.length<1;return t.value="",n?(t.emptyText=e.emptyText,t.emptyCls=e.emptyCls,t.inputElCls=e.emptyInputCls):(t.emptyText="",t.emptyCls=e.emptyInputCls,t.inputElCls=""),t},afterRender:function(){var e=this;Ext.supports.Placeholder&&e.inputEl&&e.emptyText&&delete e.inputEl.dom.placeholder,e.bodyEl.applyStyles("vertical-align:top"),e.grow&&(Ext.isNumber(e.growMin)&&e.growMin>0&&e.listWrapper.applyStyles("min-height:"+e.growMin+"px"),Ext.isNumber(e.growMax)&&e.growMax>0&&e.listWrapper.applyStyles("max-height:"+e.growMax+"px")),!0===e.stacked&&e.itemList.addCls("x-boxselect-stacked"),e.multiSelect||e.itemList.addCls("x-boxselect-singleselect"),e.applyMultiselectItemMarkup(),e.callParent(arguments)},findRecord:function(e,t){var n,i=this.store;return!!i&&(n=i.queryBy((function(n,i){return n.isEqual(n.get(e),t)}))).getCount()>0&&n.first()},onLoad:function(){var e=this,t=e.valueField,n=e.valueStore,i=!1;n&&(Ext.isEmpty(e.value)||0!=n.getCount()||e.setValue(e.value,!1,!0),n.suspendEvents(),n.each((function(o){var r=e.findRecord(t,o.get(t)),a=r?n.indexOf(o):-1;a>=0&&(n.removeAt(a),n.insert(a,r),i=!0)})),n.resumeEvents(),i&&n.fireEvent("datachanged",n)),e.callParent(arguments)},isFilteredRecord:function(e){var t=this,n=t.valueField,i=e.get(n);return-1===t.store.findExact(n,i)&&-1!==t.valueStore.findExact(n,i)},doRawQuery:function(){var e=this,t=e.inputEl.dom.value;e.multiSelect&&(t=t.split(e.delimiter).pop()),this.doQuery(t,!1,!0)},onBeforeListRefresh:function(){this.ignoreSelection++},onListRefresh:function(){this.callParent(arguments),this.ignoreSelection>0&&--this.ignoreSelection},onListSelectionChange:function(e,t){var n,i=this,o=i.valueStore,r=[];if(i.ignoreSelection<=0&&i.isExpanded){if(!t.length)return!1;o.each((function(e){(Ext.Array.contains(t,e)||i.isFilteredRecord(e))&&r.push(e)})),r=Ext.Array.merge(r,t),(n=Ext.Array.intersect(r,o.getRange()).length)===r.length&&n===i.valueStore.getCount()||(i.setValue(r,!1),i.multiSelect&&i.pinList||Ext.defer(i.collapse,1,i),o.getCount()>0&&i.fireEvent("select",i,o.getRange())),i.inputEl.focus(),i.pinList||(i.inputEl.dom.value=""),i.selectOnFocus&&i.inputEl.dom.select()}},syncSelection:function(){var e,t,n,i=this,o=i.picker,r=i.valueField;o&&(e=o.store,t=[],i.valueStore&&i.valueStore.each((function(n){var i=e.findExact(r,n.get(r));i>=0&&t.push(e.getAt(i))})),i.ignoreSelection++,(n=o.getSelectionModel()).deselectAll(),t.length>0&&n.select(t),i.ignoreSelection>0&&--i.ignoreSelection)},doAlign:function(){var e,t=this,n=t.picker,i="-above";t.picker.alignTo(t.listWrapper,t.pickerAlign,t.pickerOffset),e=n.el.getY()<t.inputEl.getY(),t.bodyEl[e?"addCls":"removeCls"](t.openCls+i),n[e?"addCls":"removeCls"](n.baseCls+i)},alignPicker:function(){var e=this,t=e.picker,n=t.getTargetEl().dom.scrollTop;e.callParent(arguments),e.isExpanded&&(e.matchFieldWidth&&t.setWidth(e.listWrapper.getWidth()),t.getTargetEl().dom.scrollTop=n)},getCursorPosition:function(){var e;return Ext.isIE?((e=document.selection.createRange()).collapse(!0),e.moveStart("character",-this.inputEl.dom.value.length),e=e.text.length):e=this.inputEl.dom.selectionStart,e},hasSelectedText:function(){return Ext.isIE?document.selection.createRange().parentElement()==this.inputEl.dom:this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd},onKeyDown:function(e,t){var n=this,i=e.getKey(),o=n.inputEl.dom.value,r=n.valueStore,a=n.selectionModel,s=!1;if(!n.readOnly&&!n.disabled&&n.editable){if(n.isExpanded&&i==e.A&&e.ctrlKey)n.select(n.getStore().getRange()),a.setLastFocused(null),a.deselectAll(),n.collapse(),n.inputEl.focus(),s=!0;else if(r.getCount()>0&&(""==o||0===n.getCursorPosition()&&!n.hasSelectedText())){var l=a.getCount()>0?r.indexOf(a.getLastSelected()||a.getLastFocused()):-1;i==e.BACKSPACE||i==e.DELETE?(l>-1?(a.getCount()>1&&(l=-1),n.valueStore.remove(a.getSelection())):n.valueStore.remove(n.valueStore.last()),a.clearSelections(),n.setValue(n.valueStore.getRange()),l>0&&a.select(l-1),s=!0):i==e.RIGHT||i==e.LEFT?-1==l&&i==e.LEFT?(a.select(r.last()),s=!0):l>-1&&(i==e.RIGHT?l<r.getCount()-1?(a.select(l+1,e.shiftKey),s=!0):e.shiftKey||(a.setLastFocused(null),a.deselectAll(),s=!0):i==e.LEFT&&l>0&&(a.select(l-1,e.shiftKey),s=!0)):i==e.A&&e.ctrlKey&&(a.selectAll(),s=e.A),n.inputEl.focus()}if(s)return n.preventKeyUpEvent=s,void e.stopEvent();n.isExpanded&&i==e.ENTER&&n.picker.highlightedItem&&(n.preventKeyUpEvent=!0),n.enableKeyEvents&&n.callParent(arguments),e.isSpecialKey()||e.hasModifier()||(n.selectionModel.setLastFocused(null),n.selectionModel.deselectAll(),n.inputEl.focus())}},onKeyUp:function(e,t){var n=this,i=n.inputEl.dom.value;if(n.preventKeyUpEvent)return e.stopEvent(),void(!0!==n.preventKeyUpEvent&&e.getKey()!==n.preventKeyUpEvent||delete n.preventKeyUpEvent);(n.multiSelect&&n.delimiterRegexp&&n.delimiterRegexp.test(i)||!0===n.createNewOnEnter&&e.getKey()==e.ENTER)&&(i=Ext.Array.clean(i.split(n.delimiterRegexp)),n.inputEl.dom.value="",n.setValue(n.valueStore.getRange().concat(i)),n.inputEl.focus()),n.callParent([e,t])},onPaste:function(e,t){var n=this,i=n.inputEl.dom.value,o=!!(e&&e.browserEvent&&e.browserEvent.clipboardData)&&e.browserEvent.clipboardData;n.multiSelect&&n.delimiterRegexp&&n.delimiterRegexp.test(i)&&(o&&o.getData&&(/text\/plain/.test(o.types)?i=o.getData("text/plain"):/text\/html/.test(o.types)&&(i=o.getData("text/html"))),i=Ext.Array.clean(i.split(n.delimiterRegexp)),n.inputEl.dom.value="",n.setValue(n.valueStore.getRange().concat(i)),n.inputEl.focus())},onExpand:function(){var e=this,t=e.listKeyNav;e.callParent(arguments),!t&&e.filterPickList&&((t=e.listKeyNav).highlightAt=function(e){var t,n=this.boundList,i=n.all.item(e),o=n.all.getCount();if(i&&i.hasCls("x-boundlist-selected")){t=0==e||!n.highlightedItem||n.indexOf(n.highlightedItem)<e?1:-1;do{e+=t,i=n.all.item(e)}while(e>0&&e<o&&i.hasCls("x-boundlist-selected"));if(i.hasCls("x-boundlist-selected"))return}i&&(i=i.dom,n.highlightItem(i),n.getTargetEl().scrollChildIntoView(i,!1))})},onTypeAhead:function(){var e,t,n,i,o=this,r=o.displayField,a=o.inputEl.dom,s=o.valueStore,l=o.getPicker();if(o.filterPickList){var c=this.createFilterFn(r,a.value);e=-1!==(e=o.store.findBy((function(e){return-1===s.indexOfId(e.getId())&&c(e)})))&&o.store.getAt(e)}else e=o.store.findRecord(r,a.value);e&&(n=(t=e.get(r)).length,i=a.value.length,l.highlightItem(l.getNode(e)),0!==i&&i!==n&&(a.value=t,o.selectText(i,t.length)))},onItemListClick:function(e,t,n){var i=this,o=e.getTarget(".x-boxselect-item"),r=!!o&&e.getTarget(".x-boxselect-item-close");i.readOnly||i.disabled||(e.stopPropagation(),o?(r?(i.removeByListItemNode(o),i.valueStore.getCount()>0&&i.fireEvent("select",i,i.valueStore.getRange())):i.toggleSelectionByListItemNode(o,e.shiftKey),i.inputEl.focus()):(i.selectionModel.getCount()>0&&(i.selectionModel.setLastFocused(null),i.selectionModel.deselectAll()),i.triggerOnClick&&i.onTriggerClick()))},getMultiSelectItemMarkup:function(){var e=this;return e.multiSelectItemTpl||(e.labelTpl?(Ext.isString(e.labelTpl)||Ext.isArray(e.labelTpl))&&(e.labelTpl=Ext.create("Ext.XTemplate",e.labelTpl)):e.labelTpl=Ext.create("Ext.XTemplate",'{[values["'+e.displayField+'"]]}'),e.multiSelectItemTpl=['<tpl for=".">','<li class="x-tab-default x-boxselect-item ','<tpl if="this.isSelected(values.'+e.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : ["'+e.displayField+'"]]}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function(t){var n=e.valueStore.findExact(e.valueField,t);return n>=0&&e.selectionModel.isSelected(e.valueStore.getAt(n))},getItemLabel:function(t){return e.getTpl("labelTpl").apply(t)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function(){var e,t=this;if(t.itemList){for(;null!=(e=t.inputElCt.prev());)e.remove();t.inputElCt.insertHtml("beforeBegin",t.getMultiSelectItemMarkup())}Ext.Function.defer((function(){t.picker&&t.isExpanded&&t.alignPicker(),t.hasFocus&&t.inputElCt&&t.listWrapper&&t.inputElCt.scrollIntoView(t.listWrapper)}),15)},getRecordByListItemNode:function(e){for(var t=0,n=this.itemList.dom.firstChild;n&&n.nextSibling&&n!=e;)t++,n=n.nextSibling;return!1!==(t=n==e&&t)&&this.valueStore.getAt(t)},toggleSelectionByListItemNode:function(e,t){var n=this.getRecordByListItemNode(e),i=this.selectionModel;n&&(i.isSelected(n)?(i.isFocused(n)&&i.setLastFocused(null),i.deselect(n)):i.select(n,t))},removeByListItemNode:function(e){var t=this,n=t.getRecordByListItemNode(e);n&&(t.valueStore.remove(n),t.setValue(t.valueStore.getRange()))},getRawValue:function(){var e,t=this,n=t.inputEl;return t.inputEl=!1,e=t.callParent(arguments),t.inputEl=n,e},setRawValue:function(e){var t,n=this,i=n.inputEl;return n.inputEl=!1,t=n.callParent([e]),n.inputEl=i,t},addValue:function(e){e&&this.setValue(Ext.Array.merge(this.value,Ext.Array.from(e)))},removeValue:function(e){e&&this.setValue(Ext.Array.difference(this.value,Ext.Array.from(e)))},setValue:function(e,t,n){var i,o,r,a,s=this,l=s.valueStore,c=s.valueField,u=[];for(Ext.isEmpty(e)&&(e=null),Ext.isString(e)&&s.multiSelect&&(e=e.split(s.delimiter)),r=0,o=(e=Ext.Array.from(e,!0)).length;r<o;r++)(i=e[r])&&i.isModel||((a=l.findExact(c,i))>=0?e[r]=l.getAt(a):((a=s.findRecord(c,i))||(s.forceSelection?u.push(i):((a={})[s.valueField]=i,a[s.displayField]=i,a=new s.valueStore.model(a))),a&&(e[r]=a)));if(!0!==n&&u.length>0&&"remote"===s.queryMode){var d={};return d[s.valueParam||s.valueField]=u.join(s.delimiter),s.store.load({params:d,callback:function(){s.itemList&&s.itemList.unmask(),s.setValue(e,t,!0),s.autoSize(),s.lastQuery=!1}}),!1}if(!s.multiSelect&&e.length>0){for(r=e.length-1;r>=0;r--)if(e[r].isModel){e=e[r];break}Ext.isArray(e)&&(e=e[e.length-1])}return s.callParent([e,t])},getValueRecords:function(){return this.valueStore.getRange()},getSubmitData:function(){var e=this,t=e.callParent(arguments);return e.multiSelect&&e.encodeSubmitValue&&t&&t[e.name]&&(t[e.name]=Ext.encode(t[e.name])),t},mimicBlur:function(){var e=this;e.selectOnTab&&e.picker&&e.picker.highlightedItem&&(e.inputEl.dom.value=""),e.callParent(arguments)},assertValue:function(){var e=this,t=e.inputEl.dom.value,n=!Ext.isEmpty(t)&&e.findRecordByDisplay(t),i=!1;n||e.forceSelection||!e.createNewOnBlur||Ext.isEmpty(t)?n&&(i=n):i=t,i&&e.addValue(i),e.inputEl.dom.value="",e.collapse()},checkChange:function(){if(!this.suspendCheckChange&&!this.isDestroyed){var e=this,t=e.valueStore,n=e.lastValue||"",i=e.valueField,o=Ext.Array.map(Ext.Array.from(e.value),(function(e){return e.isModel?e.get(i):e}),this).join(this.delimiter),r=e.isEqual(o,n);(!r||o.length>0&&t.getCount()<o.length)&&(t.suspendEvents(),t.removeAll(),Ext.isArray(e.valueModels)&&t.add(e.valueModels),t.resumeEvents(),t.fireEvent("datachanged",t),r||(e.lastValue=o,e.fireEvent("change",e,o,n),e.onChange(o,n)))}},isEqual:function(e,t){var n,i,o=Ext.Array.from,r=this.valueField;if(e=o(e),t=o(t),(i=e.length)!==t.length)return!1;for(n=0;n<i;n++)if((e[n].isModel?e[n].get(r):e[n])!==(t[n].isModel?t[n].get(r):t[n]))return!1;return!0},applyEmptyText:function(){var e,t,n=this,i=n.emptyText;n.rendered&&i&&(t=Ext.isEmpty(n.value)&&!n.hasFocus,e=n.inputEl,t?(e.dom.value="",n.emptyEl.update(i),n.emptyEl.addCls(n.emptyCls),n.emptyEl.removeCls(n.emptyInputCls),n.listWrapper.addCls(n.emptyCls),n.inputEl.addCls(n.emptyInputCls)):(n.emptyEl.addCls(n.emptyInputCls),n.emptyEl.removeCls(n.emptyCls),n.listWrapper.removeCls(n.emptyCls),n.inputEl.removeCls(n.emptyInputCls)),n.autoSize())},preFocus:function(){var e=this,t=e.inputEl,n=""==t.dom.value;e.emptyEl.addCls(e.emptyInputCls),e.emptyEl.removeCls(e.emptyCls),e.listWrapper.removeCls(e.emptyCls),e.inputEl.removeCls(e.emptyInputCls),(e.selectOnFocus||n)&&t.dom.select()},onFocus:function(){var e=this,t=e.focusCls,n=e.itemList;t&&n&&n.addCls(t),e.callParent(arguments)},onBlur:function(){var e=this,t=e.focusCls,n=e.itemList;t&&n&&n.removeCls(t),e.callParent(arguments)},renderActiveError:function(){var e=this,t=e.invalidCls,n=e.itemList,i=e.hasActiveError();t&&n&&n[i?"addCls":"removeCls"](e.invalidCls+"-field"),e.callParent(arguments)},autoSize:function(){var e=this;return e.grow&&e.rendered&&(e.autoSizing=!0,e.updateLayout()),e},afterComponentLayout:function(){const e=this;if(e.autoSizing){let t=e.getHeight();t!==e.lastInputHeight&&(e.isExpanded&&e.alignPicker(),e.fireEvent("autosize",e,t),e.lastInputHeight=t,delete e.autoSizing)}}}),Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",waitForOuterWidthInDom:!0,beginLayout:function(e){var t=this,n=t.owner;t.callParent(arguments),e.inputElCtContext=e.getEl("inputElCt"),n.inputElCt.setStyle("width",""),t.skipInputGrowth=!n.grow||!n.multiSelect},beginLayoutFixed:function(e,t,n){var i=this,o=e.target;o.triggerEl.setStyle("height","24px"),i.callParent(arguments),e.heightModel.fixed&&e.lastBox&&(o.listWrapper.setStyle("height",e.lastBox.height+"px"),o.itemList.setStyle("height","100%"))},publishInnerWidth:function(e){var t=this.owner,n=t.itemList.getWidth(!0)-10,i=t.inputElCt.prev(null,!0);i&&!t.stacked&&(n=n-(i=Ext.fly(i)).getOffsetsTo(i.up(""))[0]-i.getWidth()),!this.skipInputGrowth&&n<35?n-=10:n<1&&(n=1),e.inputElCtContext.setWidth(n)}})},8620:function(){Ext.define("Ext.ux.form.field.PadNumber",{extend:"Ext.form.field.Number",alias:"widget.padnumberfield",padSymbol:"0",padLength:2,rawToValue:function(e){var t=this.callParent(arguments);return null===t&&(t=0),parseFloat(t)},padLeft:function(e,t,n){return Array(t-String(e).length+1).join(n||"0")+e},valueToRaw:function(e){var t=this.callParent(arguments);return this.padLeft(t,this.padLength,this.padSymbol)}})},6195:function(e){e.exports={initAndCall:function(){return window.mxImageBasePath="models/adminui-pub/resources/images",window.mxBasePath="models/adminui-pub/resources",SystemJS.import("mxgraph-js").then((function(e){return window.mxGraph||(window.mxGraph=e.mxGraph,window.mxShape=e.mxShape,window.mxConnectionConstraint=e.mxConnectionConstraint,window.mxPoint=e.mxPoint,window.mxPolyline=e.mxPolyline,window.mxEvent=e.mxEvent,window.mxRubberband=e.mxRubberband,window.mxCellState=e.mxCellState,window.mxClient=e.mxClient,window.mxUtils=e.mxUtils,window.mxConstants=e.mxConstants,window.mxPopupMenu=e.mxPopupMenu,window.mxDefaultPopupMenu=e.mxDefaultPopupMenu,window.mxEditor=e.mxEditor,window.mxGraphModel=e.mxGraphModel,window.mxGraphView=e.mxGraphView,window.mxToolbar=e.mxToolbar,window.mxDefaultToolbar=e.mxDefaultToolbar,window.mxGeometry=e.mxGeometry,window.mxKeyHandler=e.mxKeyHandler,window.mxDefaultKeyHandler=e.mxDefaultKeyHandler,window.mxVertexHandler=e.mxVertexHandler,window.mxStylesheet=e.mxStylesheet,window.mxCellRenderer=e.mxCellRenderer,window.mxCell=e.mxCell,window.mxCodec=e.mxCodec,window.mxDivResizer=e.mxDivResizer,window.mxOutline=e.mxOutline,window.mxUndoManager=e.mxUndoManager,window.mxEdgeStyle=e.mxEdgeStyle,window.mxCompactTreeLayout=e.mxCompactTreeLayout,window.mxLabel=e.mxLabel,window.mxRectangle=e.mxRectangle,window.mxCellOverlay=e.mxCellOverlay,window.mxImage=e.mxImage,window.mxPrintPreview=e.mxPrintPreview),e}))}}},287:function(){Ext.define("Ext.ux.window.Notification",{extend:"Ext.window.Window",alias:"widget.uxNotification",cls:"ux-notification-window",autoClose:!0,autoHeight:!0,plain:!1,draggable:!1,shadow:!1,focus:Ext.emptyFn,manager:null,useXAxis:!1,position:"br",spacing:6,paddingX:30,paddingY:10,slideInAnimation:"easeIn",slideBackAnimation:"bounceOut",slideInDuration:1500,slideBackDuration:1e3,hideDuration:500,autoCloseDelay:7e3,stickOnClick:!0,stickWhileHover:!0,isHiding:!1,readyToHide:!1,destroyAfterHide:!1,closeOnMouseOut:!1,xPos:0,yPos:0,statics:{defaultManager:{el:null}},initComponent:function(){var e=this;Ext.isDefined(e.corner)&&(e.position=e.corner),Ext.isDefined(e.slideDownAnimation)&&(e.slideBackAnimation=e.slideDownAnimation),Ext.isDefined(e.autoDestroyDelay)&&(e.autoCloseDelay=e.autoDestroyDelay),Ext.isDefined(e.autoHideDelay)&&(e.autoCloseDelay=e.autoHideDelay),Ext.isDefined(e.autoHide)&&(e.autoClose=e.autoHide),Ext.isDefined(e.slideInDelay)&&(e.slideInDuration=e.slideInDelay),Ext.isDefined(e.slideDownDelay)&&(e.slideBackDuration=e.slideDownDelay),Ext.isDefined(e.fadeDelay)&&(e.hideDuration=e.fadeDelay),e.position=e.position.replace(/c/,""),e.updateAlignment(e.position),e.setManager(e.manager),e.callParent(arguments)},onRender:function(){var e=this;e.el.hover((function(){e.mouseIsOver=!0}),(function(){e.mouseIsOver=!1,e.closeOnMouseOut&&(e.closeOnMouseOut=!1,e.close())}),e),this.callParent(arguments)},updateAlignment:function(e){var t=this;switch(e){case"br":t.paddingFactorX=-1,t.paddingFactorY=-1,t.siblingAlignment="br-br",t.useXAxis?t.managerAlignment="bl-br":t.managerAlignment="tr-br";break;case"bl":t.paddingFactorX=1,t.paddingFactorY=-1,t.siblingAlignment="bl-bl",t.useXAxis?t.managerAlignment="br-bl":t.managerAlignment="tl-bl";break;case"tr":t.paddingFactorX=-1,t.paddingFactorY=1,t.siblingAlignment="tr-tr",t.useXAxis?t.managerAlignment="tl-tr":t.managerAlignment="br-tr";break;case"tl":t.paddingFactorX=1,t.paddingFactorY=1,t.siblingAlignment="tl-tl",t.useXAxis?t.managerAlignment="tr-tl":t.managerAlignment="bl-tl";break;case"b":t.paddingFactorX=0,t.paddingFactorY=-1,t.siblingAlignment="b-b",t.useXAxis=0,t.managerAlignment="t-b";break;case"t":t.paddingFactorX=0,t.paddingFactorY=1,t.siblingAlignment="t-t",t.useXAxis=0,t.managerAlignment="b-t";break;case"l":t.paddingFactorX=1,t.paddingFactorY=0,t.siblingAlignment="l-l",t.useXAxis=1,t.managerAlignment="r-l";break;case"r":t.paddingFactorX=-1,t.paddingFactorY=0,t.siblingAlignment="r-r",t.useXAxis=1,t.managerAlignment="l-r"}},getXposAlignedToManager:function(){var e=this,t=0;if(e.manager&&e.manager.el&&e.manager.el.dom){if(!e.useXAxis)return e.el.getLeft();"br"==e.position||"tr"==e.position||"r"==e.position?(t+=e.manager.el.getAnchorXY("r")[0],t-=e.el.getWidth()+e.paddingX):(t+=e.manager.el.getAnchorXY("l")[0],t+=e.paddingX)}return t},getYposAlignedToManager:function(){var e=this,t=0;if(e.manager&&e.manager.el&&e.manager.el.dom){if(e.useXAxis)return e.el.getTop();"br"==e.position||"bl"==e.position||"b"==e.position?(t+=e.manager.el.getAnchorXY("b")[1],t-=e.el.getHeight()+e.paddingY):(t+=e.manager.el.getAnchorXY("t")[1],t+=e.paddingY)}return t},getXposAlignedToSibling:function(e){var t=this;return t.useXAxis?"tl"==t.position||"bl"==t.position||"l"==t.position?e.xPos+e.el.getWidth()+e.spacing:e.xPos-t.el.getWidth()-t.spacing:t.el.getLeft()},getYposAlignedToSibling:function(e){var t=this;return t.useXAxis?t.el.getTop():"tr"==t.position||"tl"==t.position||"t"==t.position?e.yPos+e.el.getHeight()+e.spacing:e.yPos-t.el.getHeight()-e.spacing},getNotifications:function(e){var t=this;return t.manager.notifications[e]||(t.manager.notifications[e]=[]),t.manager.notifications[e]},setManager:function(e){var t=this;t.manager=e,"string"==typeof t.manager&&(t.manager=Ext.getCmp(t.manager)),t.manager||(t.manager=t.statics().defaultManager,t.manager.el||(t.manager.el=Ext.getBody())),void 0===t.manager.notifications&&(t.manager.notifications={})},beforeShow:function(){var e=this;e.stickOnClick&&e.body&&e.body.dom&&Ext.fly(e.body.dom).on("click",(function(){e.cancelAutoClose(),e.addCls("notification-fixed")}),e),e.autoClose&&(e.task=new Ext.util.DelayedTask(e.doAutoClose,e),e.task.delay(e.autoCloseDelay)),e.el.setX(-1e4),e.el.setOpacity(1)},afterShow:function(){var e=this,t=e.getNotifications(e.managerAlignment);t.length?(e.el.alignTo(t[t.length-1].el,e.siblingAlignment,[0,0]),e.xPos=e.getXposAlignedToSibling(t[t.length-1]),e.yPos=e.getYposAlignedToSibling(t[t.length-1])):(e.el.alignTo(e.manager.el,e.managerAlignment,[e.paddingX*e.paddingFactorX,e.paddingY*e.paddingFactorY],!1),e.xPos=e.getXposAlignedToManager(),e.yPos=e.getYposAlignedToManager()),Ext.Array.include(t,e),e.el.animate({to:{x:e.xPos,y:e.yPos,opacity:1},easing:e.slideInAnimation,duration:e.slideInDuration,dynamic:!0}),this.callParent(arguments)},slideBack:function(){var e=this,t=e.getNotifications(e.managerAlignment),n=Ext.Array.indexOf(t,e);!e.isHiding&&e.el&&e.manager&&e.manager.el&&e.manager.el.dom&&e.manager.el.isVisible()&&(n?(e.xPos=e.getXposAlignedToSibling(t[n-1]),e.yPos=e.getYposAlignedToSibling(t[n-1])):(e.xPos=e.getXposAlignedToManager(),e.yPos=e.getYposAlignedToManager()),e.stopAnimation(),e.el.animate({to:{x:e.xPos,y:e.yPos},easing:e.slideBackAnimation,duration:e.slideBackDuration,dynamic:!0}))},cancelAutoClose:function(){this.autoClose&&this.task.cancel()},doAutoClose:function(){var e=this;e.stickWhileHover&&e.mouseIsOver?e.closeOnMouseOut=!0:e.close()},removeFromManager:function(){var e=this;if(e.manager){var t=e.getNotifications(e.managerAlignment),n=Ext.Array.indexOf(t,e);if(-1!=n)for(Ext.Array.erase(t,n,1);n<t.length;n++)t[n].slideBack()}},hide:function(){var e=this;!e.isHiding&&e.el&&(e.isHiding=!0,e.cancelAutoClose(),e.stopAnimation(),e.el.animate({to:{opacity:0},easing:"easeIn",duration:e.hideDuration,dynamic:!1,listeners:{afteranimate:function(){e.removeFromManager(),e.readyToHide=!0,e.hide(e.animateTarget,e.doClose,e)}}})),e.readyToHide&&(e.isHiding=!1,e.readyToHide=!1,e.removeCls("notification-fixed"),e.callParent(arguments),e.destroyAfterHide&&e.destroy())},destroy:function(){var e=this;e.hidden?e.callParent(arguments):(e.destroyAfterHide=!0,e.hide(e.animateTarget,e.doClose,e))}})},6430:function(e,t,n){const i=n(1972),o=n(6486),r=n(9274),a=n(8598);SystemJS.has("lodash")||SystemJS.set("lodash",SystemJS.newModule(o)),SystemJS.has("@unitybase/cs-shared")||SystemJS.set("@unitybase/cs-shared",SystemJS.newModule(r)),SystemJS.has("file-saver")||SystemJS.set("file-saver",SystemJS.newModule(a));const s=r.UBDomain,l=r.LocalDataStore;window.UB=i,window._=o,window.UB.LocalDataStore=l,window.UBDomain=s,window.saveAs=a.saveAs,Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{"Ext.ux":"@unitybase/adminui-pub/_src/ux",UB:"@unitybase/adminui-pub/_src/app"}});const{launchApp:c,$App:u}=n(385);c(),e.exports=u,SystemJS.has("@unitybase/adminui-pub")||SystemJS.set("@unitybase/adminui-pub",SystemJS.newModule(u))},4287:function(e,t,n){var i;e.exports=(i=n(667),n(7830),n(6656),n(2815),n(2133),function(){var e=i,t=e.lib.BlockCipher,n=e.algo,o=[],r=[],a=[],s=[],l=[],c=[],u=[],d=[],f=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,i=0;for(t=0;t<256;t++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^255&p^99,o[n]=p,r[p]=n;var m=e[n],g=e[m],y=e[g],x=257*e[p]^16843008*p;a[n]=x<<24|x>>>8,s[n]=x<<16|x>>>16,l[n]=x<<8|x>>>24,c[n]=x,x=16843009*y^65537*g^257*m^16843008*n,u[p]=x<<24|x>>>8,d[p]=x<<16|x>>>16,f[p]=x<<8|x>>>24,h[p]=x,n?(n=m^e[e[e[y^m]]],i^=e[e[i]]):n=i=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=n.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],a=0;a<i;a++)if(a<n)r[a]=t[a];else{var s=r[a-1];a%n?n>6&&a%n==4&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=p[a/n|0]<<24),r[a]=r[a-n]^s}for(var l=this._invKeySchedule=[],c=0;c<i;c++)a=i-c,s=c%4?r[a]:r[a-4],l[c]=c<4||a<=4?s:u[o[s>>>24]]^d[o[s>>>16&255]]^f[o[s>>>8&255]]^h[o[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,l,c,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,d,f,h,r),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,o,r,a,s){for(var l=this._nRounds,c=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],f=e[t+3]^n[3],h=4,p=1;p<l;p++){var m=i[c>>>24]^o[u>>>16&255]^r[d>>>8&255]^a[255&f]^n[h++],g=i[u>>>24]^o[d>>>16&255]^r[f>>>8&255]^a[255&c]^n[h++],y=i[d>>>24]^o[f>>>16&255]^r[c>>>8&255]^a[255&u]^n[h++],x=i[f>>>24]^o[c>>>16&255]^r[u>>>8&255]^a[255&d]^n[h++];c=m,u=g,d=y,f=x}m=(s[c>>>24]<<24|s[u>>>16&255]<<16|s[d>>>8&255]<<8|s[255&f])^n[h++],g=(s[u>>>24]<<24|s[d>>>16&255]<<16|s[f>>>8&255]<<8|s[255&c])^n[h++],y=(s[d>>>24]<<24|s[f>>>16&255]<<16|s[c>>>8&255]<<8|s[255&u])^n[h++],x=(s[f>>>24]<<24|s[c>>>16&255]<<16|s[u>>>8&255]<<8|s[255&d])^n[h++],e[t]=m,e[t+1]=g,e[t+2]=y,e[t+3]=x},keySize:8});e.AES=t._createHelper(m)}(),i.AES)},2133:function(e,t,n){var i,o,r,a,s,l,c,u,d,f,h,p,m,g,y,x,b,v,E;e.exports=void((i=n(667)).lib.Cipher||(o=i,r=o.lib,a=r.Base,s=r.WordArray,l=r.BufferedBlockAlgorithm,c=o.enc,c.Utf8,u=c.Base64,d=o.algo.EvpKDF,f=r.Cipher=l.extend({cfg:a.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?E:b}return function(t){return{encrypt:function(n,i,o){return e(i).encrypt(t,n,i,o)},decrypt:function(n,i,o){return e(i).decrypt(t,n,i,o)}}}}()}),r.StreamCipher=f.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=o.mode={},p=r.BlockCipherMode=a.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),m=h.CBC=function(){var e=p.extend();function t(e,t,n){var i=this._iv;if(i){var o=i;this._iv=void 0}else o=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=o[r]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize;t.call(this,e,n,o),i.encryptBlock(e,n),this._prevBlock=e.slice(n,n+o)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,r=e.slice(n,n+o);i.decryptBlock(e,n),t.call(this,e,n,o),this._prevBlock=r}}),e}(),g=(o.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,o=i<<24|i<<16|i<<8|i,r=[],a=0;a<i;a+=4)r.push(o);var l=s.create(r,i);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.BlockCipher=f.extend({cfg:f.cfg.extend({mode:m,padding:g}),reset:function(){f.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=n.createEncryptor;else i=n.createDecryptor,this._minBufferSize=1;this._mode=i.call(n,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4}),y=r.CipherParams=a.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),x=(o.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var i=s.create([1398893684,1701076831]).concat(n).concat(t);else i=t;return i.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var i=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return y.create({ciphertext:t,salt:i})}},b=r.SerializableCipher=a.extend({cfg:a.extend({format:x}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var o=e.createEncryptor(n,i),r=o.finalize(t),a=o.cfg;return y.create({ciphertext:r,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(o.kdf={}).OpenSSL={execute:function(e,t,n,i){i||(i=s.random(8));var o=d.create({keySize:t+n}).compute(e,i),r=s.create(o.words.slice(t),4*n);return o.sigBytes=4*t,y.create({key:o,iv:r,salt:i})}},E=r.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:v}),encrypt:function(e,t,n,i){var o=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=o.iv;var r=b.encrypt.call(this,e,t,o.key,i);return r.mixIn(o),r},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var o=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);return i.iv=o.iv,b.decrypt.call(this,e,t,o.key,i)}})))},667:function(e,t){var n;e.exports=n=n||function(e,t){var n={},i=n.lib={},o=i.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),r=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,o=e.sigBytes;if(this.clamp(),i%4)for(var r=0;r<o;r++){var a=n[r>>>2]>>>24-r%4*8&255;t[i+r>>>2]|=a<<24-(i+r)%4*8}else if(n.length>65535)for(r=0;r<o;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],o=function(t){t=t;var n=987654321,i=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},a=0;a<t;a+=4){var s=o(4294967296*(n||e.random()));n=987654071*s(),i.push(4294967296*s()|0)}return new r.init(i,t)}}),a=n.enc={},s=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var r=t[o>>>2]>>>24-o%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new r.init(n,t/2)}},l=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var r=t[o>>>2]>>>24-o%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new r.init(n,t)}},c=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),l=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,c=e.min(4*l,o);if(l){for(var u=0;u<l;u+=a)this._doProcessBlock(i,u);var d=i.splice(0,l);n.sigBytes-=c}return new r.init(d,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(i.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math)},7830:function(e,t,n){var i,o,r;e.exports=(r=n(667),o=(i=r).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var o=[],r=0;r<n;r+=3)for(var a=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,s=0;s<4&&r+.75*s<n;s++)o.push(i.charAt(a>>>6*(3-s)&63));var l=i.charAt(64);if(l)for(;o.length%4;)o.push(l);return o.join("")},parse:function(e){var t=e.length,n=this._map,i=n.charAt(64);if(i){var r=e.indexOf(i);-1!=r&&(t=r)}for(var a=[],s=0,l=0;l<t;l++)if(l%4){var c=n.indexOf(e.charAt(l-1))<<l%4*2,u=n.indexOf(e.charAt(l))>>>6-l%4*2;a[s>>>2]|=(c|u)<<24-s%4*8,s++}return o.create(a,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r.enc.Base64)},8963:function(e,t,n){var i;e.exports=(i=n(667),function(){var e=i,t=e.lib.WordArray,n=e.enc;function o(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o+=2){var r=t[o>>>2]>>>16-o%4*8&65535;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var n=e.length,i=[],o=0;o<n;o++)i[o>>>1]|=e.charCodeAt(o)<<16-o%2*16;return t.create(i,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r+=2){var a=o(t[r>>>2]>>>16-r%4*8&65535);i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var n=e.length,i=[],r=0;r<n;r++)i[r>>>1]|=o(e.charCodeAt(r)<<16-r%2*16);return t.create(i,2*n)}}}(),i.enc.Utf16)},2815:function(e,t,n){var i,o,r,a,s,l,c,u;e.exports=(u=n(667),n(7576),n(631),r=(o=(i=u).lib).Base,a=o.WordArray,l=(s=i.algo).MD5,c=s.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:l,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),o=a.create(),r=o.words,s=n.keySize,l=n.iterations;r.length<s;){c&&i.update(c);var c=i.update(e).finalize(t);i.reset();for(var u=1;u<l;u++)c=i.finalize(c),i.reset();o.concat(c)}return o.sigBytes=4*s,o}}),i.EvpKDF=function(e,t,n){return c.create(n).compute(e,t)},u.EvpKDF)},2734:function(e,t,n){var i,o,r,a;e.exports=(a=n(667),n(2133),o=(i=a).lib.CipherParams,r=i.enc.Hex,i.format.Hex={stringify:function(e){return e.ciphertext.toString(r)},parse:function(e){var t=r.parse(e);return o.create({ciphertext:t})}},a.format.Hex)},4168:function(e,t,n){var i;e.exports=(i=n(667),n(245),n(631),i.HmacSHA256)},631:function(e,t,n){var i,o,r;e.exports=(o=(i=n(667)).lib.Base,r=i.enc.Utf8,void(i.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),a=this._iKey=t.clone(),s=o.words,l=a.words,c=0;c<n;c++)s[c]^=1549556828,l[c]^=909522486;o.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},2875:function(e,t,n){var i;e.exports=(i=n(667),n(758),n(4914),n(8963),n(7830),n(6656),n(7576),n(245),n(9852),n(9199),n(8906),n(3844),n(3159),n(631),n(882),n(2815),n(2133),n(3612),n(125),n(463),n(914),n(4475),n(1949),n(7757),n(2180),n(215),n(2921),n(2734),n(4287),n(9211),n(3987),n(6162),n(8449),i)},4914:function(e,t,n){var i;e.exports=(i=n(667),function(){if("function"==typeof ArrayBuffer){var e=i.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,i=[],o=0;o<n;o++)i[o>>>2]|=e[o]<<24-o%4*8;t.call(this,i,n)}else t.apply(this,arguments)}).prototype=e}}(),i.lib.WordArray)},6656:function(e,t,n){var i;e.exports=(i=n(667),function(e){var t=i,n=t.lib,o=n.WordArray,r=n.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=a.MD5=r.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,o=e[i];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var r=this._hash.words,a=e[t+0],l=e[t+1],h=e[t+2],p=e[t+3],m=e[t+4],g=e[t+5],y=e[t+6],x=e[t+7],b=e[t+8],v=e[t+9],E=e[t+10],w=e[t+11],C=e[t+12],I=e[t+13],S=e[t+14],B=e[t+15],D=r[0],A=r[1],T=r[2],k=r[3];D=c(D,A,T,k,a,7,s[0]),k=c(k,D,A,T,l,12,s[1]),T=c(T,k,D,A,h,17,s[2]),A=c(A,T,k,D,p,22,s[3]),D=c(D,A,T,k,m,7,s[4]),k=c(k,D,A,T,g,12,s[5]),T=c(T,k,D,A,y,17,s[6]),A=c(A,T,k,D,x,22,s[7]),D=c(D,A,T,k,b,7,s[8]),k=c(k,D,A,T,v,12,s[9]),T=c(T,k,D,A,E,17,s[10]),A=c(A,T,k,D,w,22,s[11]),D=c(D,A,T,k,C,7,s[12]),k=c(k,D,A,T,I,12,s[13]),T=c(T,k,D,A,S,17,s[14]),D=u(D,A=c(A,T,k,D,B,22,s[15]),T,k,l,5,s[16]),k=u(k,D,A,T,y,9,s[17]),T=u(T,k,D,A,w,14,s[18]),A=u(A,T,k,D,a,20,s[19]),D=u(D,A,T,k,g,5,s[20]),k=u(k,D,A,T,E,9,s[21]),T=u(T,k,D,A,B,14,s[22]),A=u(A,T,k,D,m,20,s[23]),D=u(D,A,T,k,v,5,s[24]),k=u(k,D,A,T,S,9,s[25]),T=u(T,k,D,A,p,14,s[26]),A=u(A,T,k,D,b,20,s[27]),D=u(D,A,T,k,I,5,s[28]),k=u(k,D,A,T,h,9,s[29]),T=u(T,k,D,A,x,14,s[30]),D=d(D,A=u(A,T,k,D,C,20,s[31]),T,k,g,4,s[32]),k=d(k,D,A,T,b,11,s[33]),T=d(T,k,D,A,w,16,s[34]),A=d(A,T,k,D,S,23,s[35]),D=d(D,A,T,k,l,4,s[36]),k=d(k,D,A,T,m,11,s[37]),T=d(T,k,D,A,x,16,s[38]),A=d(A,T,k,D,E,23,s[39]),D=d(D,A,T,k,I,4,s[40]),k=d(k,D,A,T,a,11,s[41]),T=d(T,k,D,A,p,16,s[42]),A=d(A,T,k,D,y,23,s[43]),D=d(D,A,T,k,v,4,s[44]),k=d(k,D,A,T,C,11,s[45]),T=d(T,k,D,A,B,16,s[46]),D=f(D,A=d(A,T,k,D,h,23,s[47]),T,k,a,6,s[48]),k=f(k,D,A,T,x,10,s[49]),T=f(T,k,D,A,S,15,s[50]),A=f(A,T,k,D,g,21,s[51]),D=f(D,A,T,k,C,6,s[52]),k=f(k,D,A,T,p,10,s[53]),T=f(T,k,D,A,E,15,s[54]),A=f(A,T,k,D,l,21,s[55]),D=f(D,A,T,k,b,6,s[56]),k=f(k,D,A,T,B,10,s[57]),T=f(T,k,D,A,y,15,s[58]),A=f(A,T,k,D,I,21,s[59]),D=f(D,A,T,k,m,6,s[60]),k=f(k,D,A,T,w,10,s[61]),T=f(T,k,D,A,h,15,s[62]),A=f(A,T,k,D,v,21,s[63]),r[0]=r[0]+D|0,r[1]=r[1]+A|0,r[2]=r[2]+T|0,r[3]=r[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var r=e.floor(i/4294967296),a=i;n[15+(o+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,l=s.words,c=0;c<4;c++){var u=l[c];l[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return s},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,n,i,o,r,a){var s=e+(t&n|~t&i)+o+a;return(s<<r|s>>>32-r)+t}function u(e,t,n,i,o,r,a){var s=e+(t&i|n&~i)+o+a;return(s<<r|s>>>32-r)+t}function d(e,t,n,i,o,r,a){var s=e+(t^n^i)+o+a;return(s<<r|s>>>32-r)+t}function f(e,t,n,i,o,r,a){var s=e+(n^(t|~i))+o+a;return(s<<r|s>>>32-r)+t}t.MD5=r._createHelper(l),t.HmacMD5=r._createHmacHelper(l)}(Math),i.MD5)},3612:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.mode.CFB=function(){var e=i.lib.BlockCipherMode.extend();function t(e,t,n,i){var o=this._iv;if(o){var r=o.slice(0);this._iv=void 0}else r=this._prevBlock;i.encryptBlock(r,0);for(var a=0;a<n;a++)e[t+a]^=r[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize;t.call(this,e,n,o,i),this._prevBlock=e.slice(n,n+o)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,r=e.slice(n,n+o);t.call(this,e,n,o,i),this._prevBlock=r}}),e}(),i.mode.CFB)},463:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.mode.CTRGladman=function(){var e=i.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}var n=e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,o=i.blockSize,r=this._iv,a=this._counter;r&&(a=this._counter=r.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(a);var s=a.slice(0);i.encryptBlock(s,0);for(var l=0;l<o;l++)e[n+l]^=s[l]}});return e.Decryptor=n,e}(),i.mode.CTRGladman)},125:function(e,t,n){var i,o,r;e.exports=(r=n(667),n(2133),r.mode.CTR=(o=(i=r.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,r=this._counter;o&&(r=this._counter=o.slice(0),this._iv=void 0);var a=r.slice(0);n.encryptBlock(a,0),r[i-1]=r[i-1]+1|0;for(var s=0;s<i;s++)e[t+s]^=a[s]}}),i.Decryptor=o,i),r.mode.CTR)},4475:function(e,t,n){var i,o;e.exports=(o=n(667),n(2133),o.mode.ECB=((i=o.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),o.mode.ECB)},914:function(e,t,n){var i,o,r;e.exports=(r=n(667),n(2133),r.mode.OFB=(o=(i=r.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,r=this._keystream;o&&(r=this._keystream=o.slice(0),this._iv=void 0),n.encryptBlock(r,0);for(var a=0;a<i;a++)e[t+a]^=r[a]}}),i.Decryptor=o,i),r.mode.OFB)},1949:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,i=4*t,o=i-n%i,r=n+o-1;e.clamp(),e.words[r>>>2]|=o<<24-r%4*8,e.sigBytes+=o},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},i.pad.Ansix923)},7757:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.pad.Iso10126={pad:function(e,t){var n=4*t,o=n-e.sigBytes%n;e.concat(i.lib.WordArray.random(o-1)).concat(i.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},i.pad.Iso10126)},2180:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.pad.Iso97971={pad:function(e,t){e.concat(i.lib.WordArray.create([2147483648],1)),i.pad.ZeroPadding.pad(e,t)},unpad:function(e){i.pad.ZeroPadding.unpad(e),e.sigBytes--}},i.pad.Iso97971)},2921:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.pad.NoPadding={pad:function(){},unpad:function(){}},i.pad.NoPadding)},215:function(e,t,n){var i;e.exports=(i=n(667),n(2133),i.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},i.pad.ZeroPadding)},882:function(e,t,n){var i,o,r,a,s,l,c,u,d;e.exports=(d=n(667),n(7576),n(631),r=(o=(i=d).lib).Base,a=o.WordArray,l=(s=i.algo).SHA1,c=s.HMAC,u=s.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:l,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=c.create(n.hasher,e),o=a.create(),r=a.create([1]),s=o.words,l=r.words,u=n.keySize,d=n.iterations;s.length<u;){var f=i.update(t).finalize(r);i.reset();for(var h=f.words,p=h.length,m=f,g=1;g<d;g++){m=i.finalize(m),i.reset();for(var y=m.words,x=0;x<p;x++)h[x]^=y[x]}o.concat(f),l[0]++}return o.sigBytes=4*u,o}}),i.PBKDF2=function(e,t,n){return u.create(n).compute(e,t)},d.PBKDF2)},8449:function(e,t,n){var i;e.exports=(i=n(667),n(7830),n(6656),n(2815),n(2133),function(){var e=i,t=e.lib.StreamCipher,n=e.algo,o=[],r=[],a=[],s=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var o=0;o<4;o++)l.call(this);for(o=0;o<8;o++)i[o]^=n[o+4&7];if(t){var r=t.words,a=r[0],s=r[1],c=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=c>>>16|4294901760&u,f=u<<16|65535&c;for(i[0]^=c,i[1]^=d,i[2]^=u,i[3]^=f,i[4]^=c,i[5]^=d,i[6]^=u,i[7]^=f,o=0;o<4;o++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)r[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],o=65535&i,s=i>>>16,l=((o*o>>>17)+o*s>>>15)+s*s,c=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=l^c}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(s)}(),i.RabbitLegacy)},6162:function(e,t,n){var i;e.exports=(i=n(667),n(7830),n(6656),n(2815),n(2133),function(){var e=i,t=e.lib.StreamCipher,n=e.algo,o=[],r=[],a=[],s=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)l.call(this);for(n=0;n<8;n++)o[n]^=i[n+4&7];if(t){var r=t.words,a=r[0],s=r[1],c=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=c>>>16|4294901760&u,f=u<<16|65535&c;for(o[0]^=c,o[1]^=d,o[2]^=u,o[3]^=f,o[4]^=c,o[5]^=d,o[6]^=u,o[7]^=f,n=0;n<4;n++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)r[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],o=65535&i,s=i>>>16,l=((o*o>>>17)+o*s>>>15)+s*s,c=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=l^c}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(s)}(),i.Rabbit)},3987:function(e,t,n){var i;e.exports=(i=n(667),n(7830),n(6656),n(2815),n(2133),function(){var e=i,t=e.lib.StreamCipher,n=e.algo,o=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,i=this._S=[],o=0;o<256;o++)i[o]=o;o=0;for(var r=0;o<256;o++){var a=o%n,s=t[a>>>2]>>>24-a%4*8&255;r=(r+i[o]+s)%256;var l=i[o];i[o]=i[r],i[r]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=r.call(this)},keySize:8,ivSize:0});function r(){for(var e=this._S,t=this._i,n=this._j,i=0,o=0;o<4;o++){n=(n+e[t=(t+1)%256])%256;var r=e[t];e[t]=e[n],e[n]=r,i|=e[(e[t]+e[n])%256]<<24-8*o}return this._i=t,this._j=n,i}e.RC4=t._createHelper(o);var a=n.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)r.call(this)}});e.RC4Drop=t._createHelper(a)}(),i.RC4)},3159:function(e,t,n){var i;e.exports=(i=n(667),function(e){var t=i,n=t.lib,o=n.WordArray,r=n.Hasher,a=t.algo,s=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=o.create([0,1518500249,1859775393,2400959708,2840853838]),f=o.create([1352829926,1548603684,1836072691,2053994217,0]),h=a.RIPEMD160=r.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,o=e[i];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var r,a,h,v,E,w,C,I,S,B,D,A=this._hash.words,T=d.words,k=f.words,U=s.words,L=l.words,_=c.words,F=u.words;for(w=r=A[0],C=a=A[1],I=h=A[2],S=v=A[3],B=E=A[4],n=0;n<80;n+=1)D=r+e[t+U[n]]|0,D+=n<16?p(a,h,v)+T[0]:n<32?m(a,h,v)+T[1]:n<48?g(a,h,v)+T[2]:n<64?y(a,h,v)+T[3]:x(a,h,v)+T[4],D=(D=b(D|=0,_[n]))+E|0,r=E,E=v,v=b(h,10),h=a,a=D,D=w+e[t+L[n]]|0,D+=n<16?x(C,I,S)+k[0]:n<32?y(C,I,S)+k[1]:n<48?g(C,I,S)+k[2]:n<64?m(C,I,S)+k[3]:p(C,I,S)+k[4],D=(D=b(D|=0,F[n]))+B|0,w=B,B=S,S=b(I,10),I=C,C=D;D=A[1]+h+S|0,A[1]=A[2]+v+B|0,A[2]=A[3]+E+w|0,A[3]=A[4]+r+C|0,A[4]=A[0]+a+I|0,A[0]=D},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,r=o.words,a=0;a<5;a++){var s=r[a];r[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return o},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,n){return e^t^n}function m(e,t,n){return e&t|~e&n}function g(e,t,n){return(e|~t)^n}function y(e,t,n){return e&n|t&~n}function x(e,t,n){return e^(t|~n)}function b(e,t){return e<<t|e>>>32-t}t.RIPEMD160=r._createHelper(h),t.HmacRIPEMD160=r._createHmacHelper(h)}(Math),i.RIPEMD160)},7576:function(e,t,n){var i,o,r,a,s,l,c,u;e.exports=(o=(i=u=n(667)).lib,r=o.WordArray,a=o.Hasher,s=i.algo,l=[],c=s.SHA1=a.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],c=0;c<80;c++){if(c<16)l[c]=0|e[t+c];else{var u=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=u<<1|u>>>31}var d=(i<<5|i>>>27)+s+l[c];d+=c<20?1518500249+(o&r|~o&a):c<40?1859775393+(o^r^a):c<60?(o&r|o&a|r&a)-1894007588:(o^r^a)-899497514,s=a,a=r,r=o<<30|o>>>2,o=i,i=d}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+r|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(c),i.HmacSHA1=a._createHmacHelper(c),u.SHA1)},9852:function(e,t,n){var i,o,r,a,s,l;e.exports=(l=n(667),n(245),o=(i=l).lib.WordArray,r=i.algo,a=r.SHA256,s=r.SHA224=a.extend({_doReset:function(){this._hash=new o.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),i.SHA224=a._createHelper(s),i.HmacSHA224=a._createHmacHelper(s),l.SHA224)},245:function(e,t,n){var i;e.exports=(i=n(667),function(e){var t=i,n=t.lib,o=n.WordArray,r=n.Hasher,a=t.algo,s=[],l=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,o=0;o<64;)t(i)&&(o<8&&(s[o]=n(e.pow(i,.5))),l[o]=n(e.pow(i,1/3)),o++),i++}();var c=[],u=a.SHA256=r.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],u=n[5],d=n[6],f=n[7],h=0;h<64;h++){if(h<16)c[h]=0|e[t+h];else{var p=c[h-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,g=c[h-2],y=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[h]=m+c[h-7]+y+c[h-16]}var x=i&o^i&r^o&r,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),v=f+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&u^~s&d)+l[h]+c[h];f=d,d=u,u=s,s=a+v|0,a=r,r=o,o=i,i=v+(b+x)|0}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+r|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(i/4294967296),n[15+(o+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(u),t.HmacSHA256=r._createHmacHelper(u)}(Math),i.SHA256)},3844:function(e,t,n){var i;e.exports=(i=n(667),n(758),function(e){var t=i,n=t.lib,o=n.WordArray,r=n.Hasher,a=t.x64.Word,s=t.algo,l=[],c=[],u=[];!function(){for(var e=1,t=0,n=0;n<24;n++){l[e+5*t]=(n+1)*(n+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var o=1,r=0;r<24;r++){for(var s=0,d=0,f=0;f<7;f++){if(1&o){var h=(1<<f)-1;h<32?d^=1<<h:s^=1<<h-32}128&o?o=o<<1^113:o<<=1}u[r]=a.create(s,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=a.create()}();var f=s.SHA3=r.extend({cfg:r.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,i=this.blockSize/2,o=0;o<i;o++){var r=e[t+2*o],a=e[t+2*o+1];r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(A=n[o]).high^=a,A.low^=r}for(var s=0;s<24;s++){for(var f=0;f<5;f++){for(var h=0,p=0,m=0;m<5;m++)h^=(A=n[f+5*m]).high,p^=A.low;var g=d[f];g.high=h,g.low=p}for(f=0;f<5;f++){var y=d[(f+4)%5],x=d[(f+1)%5],b=x.high,v=x.low;for(h=y.high^(b<<1|v>>>31),p=y.low^(v<<1|b>>>31),m=0;m<5;m++)(A=n[f+5*m]).high^=h,A.low^=p}for(var E=1;E<25;E++){var w=(A=n[E]).high,C=A.low,I=l[E];I<32?(h=w<<I|C>>>32-I,p=C<<I|w>>>32-I):(h=C<<I-32|w>>>64-I,p=w<<I-32|C>>>64-I);var S=d[c[E]];S.high=h,S.low=p}var B=d[0],D=n[0];for(B.high=D.high,B.low=D.low,f=0;f<5;f++)for(m=0;m<5;m++){var A=n[E=f+5*m],T=d[E],k=d[(f+1)%5+5*m],U=d[(f+2)%5+5*m];A.high=T.high^~k.high&U.high,A.low=T.low^~k.low&U.low}A=n[0];var L=u[s];A.high^=L.high,A.low^=L.low}},_doFinalize:function(){var t=this._data,n=t.words,i=(this._nDataBytes,8*t.sigBytes),r=32*this.blockSize;n[i>>>5]|=1<<24-i%32,n[(e.ceil((i+1)/r)*r>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,l=s/8,c=[],u=0;u<l;u++){var d=a[u],f=d.high,h=d.low;f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),c.push(h),c.push(f)}return new o.init(c,s)},clone:function(){for(var e=r.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=r._createHelper(f),t.HmacSHA3=r._createHmacHelper(f)}(Math),i.SHA3)},8906:function(e,t,n){var i,o,r,a,s,l,c,u;e.exports=(u=n(667),n(758),n(9199),o=(i=u).x64,r=o.Word,a=o.WordArray,s=i.algo,l=s.SHA512,c=s.SHA384=l.extend({_doReset:function(){this._hash=new a.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=l._doFinalize.call(this);return e.sigBytes-=16,e}}),i.SHA384=l._createHelper(c),i.HmacSHA384=l._createHmacHelper(c),u.SHA384)},9199:function(e,t,n){var i;e.exports=(i=n(667),n(758),function(){var e=i,t=e.lib.Hasher,n=e.x64,o=n.Word,r=n.WordArray,a=e.algo;function s(){return o.create.apply(o,arguments)}var l=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=s()}();var u=a.SHA512=t.extend({_doReset:function(){this._hash=new r.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],u=n[5],d=n[6],f=n[7],h=i.high,p=i.low,m=o.high,g=o.low,y=r.high,x=r.low,b=a.high,v=a.low,E=s.high,w=s.low,C=u.high,I=u.low,S=d.high,B=d.low,D=f.high,A=f.low,T=h,k=p,U=m,L=g,_=y,F=x,P=b,M=v,N=E,R=w,O=C,V=I,j=S,W=B,H=D,z=A,q=0;q<80;q++){var $=c[q];if(q<16)var G=$.high=0|e[t+2*q],K=$.low=0|e[t+2*q+1];else{var Y=c[q-15],X=Y.high,J=Y.low,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^X>>>7,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^(J>>>7|X<<25),ee=c[q-2],te=ee.high,ne=ee.low,ie=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),re=c[q-7],ae=re.high,se=re.low,le=c[q-16],ce=le.high,ue=le.low;G=(G=(G=Q+ae+((K=Z+se)>>>0<Z>>>0?1:0))+ie+((K+=oe)>>>0<oe>>>0?1:0))+ce+((K+=ue)>>>0<ue>>>0?1:0),$.high=G,$.low=K}var de,fe=N&O^~N&j,he=R&V^~R&W,pe=T&U^T&_^U&_,me=k&L^k&F^L&F,ge=(T>>>28|k<<4)^(T<<30|k>>>2)^(T<<25|k>>>7),ye=(k>>>28|T<<4)^(k<<30|T>>>2)^(k<<25|T>>>7),xe=(N>>>14|R<<18)^(N>>>18|R<<14)^(N<<23|R>>>9),be=(R>>>14|N<<18)^(R>>>18|N<<14)^(R<<23|N>>>9),ve=l[q],Ee=ve.high,we=ve.low,Ce=H+xe+((de=z+be)>>>0<z>>>0?1:0),Ie=ye+me;H=j,z=W,j=O,W=V,O=N,V=R,N=P+(Ce=(Ce=(Ce=Ce+fe+((de+=he)>>>0<he>>>0?1:0))+Ee+((de+=we)>>>0<we>>>0?1:0))+G+((de+=K)>>>0<K>>>0?1:0))+((R=M+de|0)>>>0<M>>>0?1:0)|0,P=_,M=F,_=U,F=L,U=T,L=k,T=Ce+(ge+pe+(Ie>>>0<ye>>>0?1:0))+((k=de+Ie|0)>>>0<de>>>0?1:0)|0}p=i.low=p+k,i.high=h+T+(p>>>0<k>>>0?1:0),g=o.low=g+L,o.high=m+U+(g>>>0<L>>>0?1:0),x=r.low=x+F,r.high=y+_+(x>>>0<F>>>0?1:0),v=a.low=v+M,a.high=b+P+(v>>>0<M>>>0?1:0),w=s.low=w+R,s.high=E+N+(w>>>0<R>>>0?1:0),I=u.low=I+V,u.high=C+O+(I>>>0<V>>>0?1:0),B=d.low=B+W,d.high=S+j+(B>>>0<W>>>0?1:0),A=f.low=A+z,f.high=D+H+(A>>>0<z>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(i+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),i.SHA512)},9211:function(e,t,n){var i;e.exports=(i=n(667),n(7830),n(6656),n(2815),n(2133),function(){var e=i,t=e.lib,n=t.WordArray,o=t.BlockCipher,r=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=r.DES=o.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var i=a[n]-1;t[n]=e[i>>>5]>>>31-i%32&1}for(var o=this._subKeys=[],r=0;r<16;r++){var c=o[r]=[],u=l[r];for(n=0;n<24;n++)c[n/6|0]|=t[(s[n]-1+u)%28]<<31-n%6,c[4+(n/6|0)]|=t[28+(s[n+24]-1+u)%28]<<31-n%6;for(c[0]=c[0]<<1|c[0]>>>31,n=1;n<7;n++)c[n]=c[n]>>>4*(n-1)+3;c[7]=c[7]<<5|c[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=o[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],f.call(this,4,252645135),f.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),f.call(this,1,1431655765);for(var i=0;i<16;i++){for(var o=n[i],r=this._lBlock,a=this._rBlock,s=0,l=0;l<8;l++)s|=c[l][((a^o[l])&u[l])>>>0];this._lBlock=a,this._rBlock=r^s}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,f.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),f.call(this,16,65535),f.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function f(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=o._createHelper(d);var p=r.TripleDES=o.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(n.create(e.slice(0,2))),this._des2=d.createEncryptor(n.create(e.slice(2,4))),this._des3=d.createEncryptor(n.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=o._createHelper(p)}(),i.TripleDES)},758:function(e,t,n){var i,o,r,a,s,l;e.exports=(i=n(667),r=(o=i).lib,a=r.Base,s=r.WordArray,(l=o.x64={}).Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),l.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var o=e[i];n.push(o.high),n.push(o.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}}),i)},4970:function(e,t,n){const i=n(6486),o=/\[.*]/,r={equal:"isNull",notEqual:"notIsNull",custom:"custom"},a=[];for(let e=0;e<100;e++)a.push(`c${e}`);const s=new Set(["__mip_ondate","__mip_recordhistory","__mip_recordhistory_all","__mip_disablecache","__skipOptimisticLock","__allowSelectSafeDeleted","__skipSelectAfterUpdate","__skipSelectAfterInsert","__skipSelectBeforeUpdate","__skipRls","__skipAclRls","lockType"]);class l{constructor(e){this.fieldList=[],this.groupList=[],this.whereList={},this._whereLength=0,this.logicalPredicates=[],this.joinAs=[],this.orderList=[],this.options={},this.method="select",this.__misc={},this.entityName=e}using(e){return this.method=e,this}attrs(...e){const t=e.length;for(let n=0;n<t;n++)Array.isArray(e[n])?this.fieldList=this.fieldList.concat(e[n]):this.fieldList.push(e[n]);return this}attrsIf(e,...t){return e?this.attrs.apply(this,t):this}where(e,t,n,s){const c=this.UBQLv2;let u=s&&"object"==typeof s?s.clauseName:s;if(!u)for(u=a[++this._whereLength];this.whereList[u];)u+="_";const d=t,f=l.prototype.WhereCondition;if(t=f[t],e&&"custom"!==t&&!o.test(e)&&(e=`[${e}]`),!t)throw new Error("Unknown condition "+d);let h;if(("in"===t||"notIn"===t)&&n instanceof l)h=t,t="subquery",n=n.ubql();else if("subquery"===t)h=d,n instanceof l&&(n=n.ubql());else if("in"!==t&&"notIn"!==t||null!=n)if("in"!==t||Array.isArray(n))if("in"!==t||n&&n.length)if("notIn"!==t||n&&n.length){if(null===n&&("isNull"!==t||"notIsNull"!==t)){const e=t;if(n=void 0,!(t=r[e]))throw new Error(`Condition ${e} is passed to CustomRepository.where but value is null`);console.warn(`Condition ${e} is passed to CustomRepository.where but value is null -> condition transformed to ${t}. Check where logic`)}}else console.warn('Condition "notIn" is passed to CustomRepository.where but value is empty array -> condition transformed to "1=1". Check where logic'),e="1",t=f.equal,n=c?1:{a:1};else console.warn('Condition "in" is passed to CustomRepository.where but value is empty array -> condition transformed to "0=1". Check where logic'),e="0",t=f.equal,n=c?1:{a:1};else console.debug('Condition "in" is passed to CustomRepository.where but value is not an array -> condition transformed to equal. Check where logic'),t=f.equal;else console.warn('Condition "in" is passed to CustomRepository.where but value is null or undefined -> condition transformed to (0=1). Check where logic'),e="0",t=f.equal,n=c?1:{a:1};if("in"===t&&n&&1===n.length&&(t=f.equal,n=n[0]),!c&&void 0!==n&&("object"!=typeof n||Array.isArray(n)||i.isDate(n))){const e={};e[u]=n,n=e}const p={expression:e,condition:t};return"subquery"===t&&(p.subQueryType=h),void 0!==n&&(c?p.value=n:p.values=n),this.whereList[u]=p,s&&"object"==typeof s&&!1===s.clearable&&(this._unclearable||(this._unclearable={}),this._unclearable[u]=!0),this}whereIf(e,t,n,i,o){return e?this.where(t,n,i,o):this}exists(e,t){return this.where("","exists",e,t)}notExists(e,t){return this.where("","notExists",e,t)}correlation(e,t,n,i){return o.test(e)||(e="["+e+"]"),n||(n="="),this.where(e+n+"[{master}."+t+"]","custom",void 0,i)}logic(e){return this.logicalPredicates.push(e),this}join(e){return this.joinAs.push(e),this}joinCondition(e,t,n,i){if(!i)for(i=a[++this._whereLength];this.whereList[i];)i+="_";if(this.joinAs.includes(i))throw new Error(`Join condition with clause name ${i} already exists`);return this.where(e,t,n,i),this.joinAs.push(i),this}orderBy(e,t){const n=this.orderList.findIndex((t=>t.expression===e));return null===t?-1!==n&&this.orderList.splice(n,1):(t=t||"asc",-1===n?this.orderList.push({expression:e,order:t}):this.orderList[n].order=t),this}orderByDesc(e){return this.orderList.push({expression:e,order:"desc"}),this}groupBy(e){return Array.isArray(e)?this.groupList=this.groupList.concat(e):"string"==typeof e&&this.groupList.push(e),this}start(e){return this.options.start=e,this}limit(e){return 0===e?delete this.options.limit:this.options.limit=e,this}ubql(){const e={entity:this.entityName,method:this.method,fieldList:this.fieldList};this.groupList.length>0&&(e.groupList=this.groupList),Object.keys(this.whereList).length&&(e.whereList=this.whereList);const t=this.orderList.length;if(t>0){e.orderList={};for(let n=0;n<t;n++)e.orderList[n]=this.orderList[n]}return Object.keys(this.options).length&&(e.options=this.options),this.logicalPredicates.length&&(e.logicalPredicates=this.logicalPredicates),this.joinAs.length&&(e.joinAs=this.joinAs),Object.assign(e,this.__misc),e}fromUbql(e){const t=i.cloneDeep(e);if(this.entityName=t.entity,t.method&&(this.method=t.method),this.fieldList=t.fieldList,this.groupList=t.groupList||[],this.whereList=t.whereList||{},t.orderList){const e=Object.keys(t.orderList);this.orderList=[],e.forEach((e=>{this.orderList.push(t.orderList[e])}))}return this.options=t.options||{},this.logicalPredicates=t.logicalPredicates||[],this.joinAs=t.joinAs||[],this.__misc={},Object.keys(t).forEach((e=>{!0===t[e]&&s.has(e)&&(this.__misc[e]=!0)})),this}selectAsObject(e){throw new Error("abstract")}selectAsArray(){throw new Error("abstract")}selectAsArrayOfValues(){throw new Error("abstract")}selectAsStore(e){throw new Error("abstract")}select(e){throw new Error("abstract")}selectSingle(e){throw new Error("abstract")}selectScalar(){throw new Error("abstract")}selectById(e,t){throw new Error("abstract")}misc(e){for(const t in e)e.hasOwnProperty(t)&&(e[t]?this.__misc[t]=e[t]:delete this.__misc[t]);return this}miscIf(e,t){return e?this.misc(t):this}withTotal(e=!0){return!1===e?delete this.options.totalRequired:this.options.totalRequired=!0,this}clone(){const e=i.cloneDeep(this);return Object.defineProperty(e,"connection",{enumerable:!1,writable:!1,value:this.connection}),e}clearWhereList(){return this.logicalPredicates=[],this.joinAs.length||this._unclearable?Object.keys(this.whereList).forEach((e=>{this._unclearable&&!this._unclearable[e]&&-1===this.joinAs.indexOf(e)&&delete this.whereList[e]})):this.whereList={},this}}l.prototype.getRunListItem=l.prototype.ubql,l.prototype.ubRequest=l.prototype.ubql,l.prototype.WhereCondition={gt:"more",">":"more",more:"more",lt:"less","<":"less",less:"less",eq:"equal","=":"equal",equal:"equal",ge:"moreEqual",geq:"moreEqual",">=":"moreEqual",moreEqual:"moreEqual",le:"lessEqual",leq:"lessEqual","<=":"lessEqual",lessEqual:"lessEqual",ne:"notEqual",neq:"notEqual","<>":"notEqual","!=":"notEqual","!==":"notEqual",notEqual:"notEqual",contains:"like",like:"like",notContains:"notLike",notLike:"notLike",isNull:"isNull",null:"isNull",notNull:"notIsNull",notIsNull:"notIsNull",isNotNull:"notIsNull",beginWith:"startWith",startWith:"startWith",startsWith:"startWith",startswith:"startWith",notBeginWith:"notStartWith",notStartWith:"notStartWith",notStartsWith:"notStartWith",includes:"in",in:"in",notIncludes:"notIn",notIn:"notIn",match:"match",subquery:"subquery",exists:"subquery",notExists:"subquery",custom:"custom"},l.prototype.UBQLv2=!0,l.prototype.CONSTANTS={selectSingleMoreThanOneRow:"Query for selectSingle returns more than 1 row. MUST be fixed by adding a correct where clause",selectScalarMoreThanOneRow:"Query for selectScalar returns more than 1 row. MUST be fixed by adding a correct where clause"},e.exports=l},9447:function(e,t,n){const i=n(6486),o=n(9602).collationCompare;function r(e,t,n){Object.keys(e);const i=e.whereList;if(!i&&!e.ID)return[];const r=[],a=function(e){return e?(""+e).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""};function s(i){let s=i.expression||"";if("custom"===i.condition)throw new Error('Condition "custom" is not supported for cached entities');s=(s.replace(/(\[)|(])/gi,"")||"").trim();const l=t.indexOf(s);if(-1===l)throw new Error(`Filtering by attribute "${s}" which is not in fieldList is not allowed for cached entity "${e.entity}"`);let c;void 0!==i.value?c=i.value:void 0!==i.values&&(c=i.values[Object.keys(i.values)[0]]);const u=function(e,t,i){let r;const s="string"==typeof i;let l=s?i.toUpperCase():i;if(n&&"subquery"===t)return null;switch(t){case"like":return r=new RegExp(a(i),"i"),function(t){const n=t[e];return n&&r.test(n)};case"equal":return function(t){return t[e]===i};case"notEqual":return function(t){return t[e]!==i};case"more":return s?function(t){return 1===o(t[e],i)}:function(t){return t[e]>i};case"moreEqual":return s?function(t){return o(t[e],i)>=0}:function(t){return t[e]>=i};case"less":return s?function(t){return-1===o(t[e],i)}:function(t){return t[e]<i};case"lessEqual":return s?function(t){return o(t[e],i)<=0}:function(t){return t[e]<=i};case"isNull":return function(t){return null===t[e]};case"notIsNull":return function(t){return null!==t[e]};case"notLike":return r=new RegExp(a(i),"i"),function(t){const n=t[e];return n&&!r.test(n)};case"startWith":return function(t){const n=t[e];return!!n&&0===n.toUpperCase().indexOf(l)};case"notStartWith":return function(t){const n=t[e];return!n||0!==n.toUpperCase().indexOf(l)};case"in":return function(t){const n=t[e];return n&&i.indexOf(n)>=0};case"notIn":return function(t){const n=t[e];return n&&i.indexOf(n)<0};default:throw new Error("Unknown whereList condition")}}(l,i.condition,c);u&&r.push(u)}const l=e.ID;l&&s({expression:"[ID]",condition:"equal",values:{ID:l}});for(const e in i)i.hasOwnProperty(e)&&s(i[e]);return r}e.exports.doFilterAndSort=function(e,t){let n,i=this.doFiltration(e,t);const o=i.length;return this.doSorting(i,e,t),t.options&&(n=t.options.start||0,i=t.options.limit?i.slice(n,n+t.options.limit):i.slice(n)),{resultData:{data:i,fields:e.fields},total:o}},e.exports.byID=function(e,t){return this.doFilterAndSort(e,{ID:t})},e.exports.doFiltration=function(e,t,n){let i,o;const a=e.data,s=Boolean(t.ID),l=r(t,e.fields,n),c=l.length;if(0===c)return a;const u=[],d=a.length;let f=-1;for(;++f<d;){for(o=!0,i=-1;++i<c&&!0===o;)o=l[i](a[f]);if(o&&(u.push(a[f]),s))return u}return u},e.exports.doSorting=function(e,t,n){const r=[];if(n.orderList){i.each(n.orderList,(function(e){const n=t.fields.indexOf(e.expression);if(n<0)throw new Error(`Ordering by "${e.expression}" attribute that not in fieldList is not allowed`);r.push({idx:n,modifier:"desc"===e.order?-1:1})}));const a=r.length;if(a){const t=function(e,t){let n=0,i=-1;for(;++i<a&&0===n;){const a=r[i].idx;e[a]!==t[a]&&(n=o(e[a],t[a])*r[i].modifier)}return n};e.sort(t)}}},e.exports.whereListToFunctions=r,e.exports.selectResultToArrayOfObjects=function(e,t){const n=e.resultData.data,o=e.resultData.fields,r=n.length,a=r?new Array(r):[];t&&i.forEach(t,(function(e,t){const n=o.indexOf(t);n>=0&&(o[n]=e)}));for(let e=0;e<r;e++)a[e]=i.zipObject(o,n[e]);return a},e.exports.flatten=function(e,t){const n=[],i=t.fields;let o=-1,r=-1,a=0;const s=[],l=t.data.length;if(!e||!e.length)throw new Error("fieldList not exist or empty");1===e.length&&"*"===e[0]&&(e=t.fields),e.forEach((function(e){const t=i.indexOf(e);if(-1===t)throw new Error("Invalid field list. Attribute "+e+" not found in local data store");n.push(t)}));const c=e.length;for(s.length=l*(c+1);++r<c;)s[a]=e[a],a++;for(;++o<l;){r=-1;const e=t.data[o];for(;++r<c;)s[a++]=e[n[r]]}return{fieldCount:c,rowCount:l,values:s}},e.exports.arrayOfObjectsToSelectResult=function(e,t){const n=[];return e.forEach((function(e){const i=[];t.forEach((function(t){i.push(e[t])})),n.push(i)})),n},e.exports.truncTimeToUtcNull=function(e){if(!e)return e;let t=e.getMonth()+1;t=t<10?"0"+t:""+t;let n=e.getDate();return n=n<10?"0"+n:""+n,new Date(`${e.getFullYear()}-${t}-${n}T00:00:00Z`)},e.exports.iso8601ParseAsDate=function(e){const t=e?new Date(e):null;return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):t},e.exports.convertResponseDataToJsTypes=function(e,t){if(t.entity&&t.resultData&&!t.resultData.notModified&&t.resultData.fields&&t.resultData.data&&t.resultData.data.length){const n=e.get(t.entity).getConvertRules(t.resultData.fields),i=n.length,o=t.resultData.data;if(i)for(let e=0,t=o.length;e<t;e++)for(let t=0;t<i;t++){const i=n[t].index;o[e][i]=n[t].convertFn(o[e][i])}}return t.resultLock&&t.resultLock.lockTime&&(t.resultLock.lockTime=t.resultLock.lockTime?new Date(t.resultLock.lockTime):null),t}},6357:function(e,t,n){const i=n(6486),o=n(9447).iso8601ParseAsDate;function r(e){const t=this,n=Object.keys(e.domain),i=void 0===e.entityMethods;this.entities={},this.connections=e.connections,this.defaultConnection=void 0,this.connections&&this.connections.forEach((e=>{e.isDefault&&(this.defaultConnection=e)}));for(let o=0,r=n.length;o<r;o++){const r=n[o],a=e.domain[r];if(a.i18n&&a.i18n.attributes&&Array.isArray(a.i18n.attributes)){const e=a.i18n.attributes,t={};for(let n=0,i=e.length;n<i;n++){const i=e[n],o=i.name;if(!o)throw new Error("Invalid localization JSON for entity "+r);delete i.name,t[o]=i}a.i18n.attributes=t}t.entities[r]=i?new c(a,a.entityMethods||{},a.i18n,r,t):new c(a,e.entityMethods[r]||{},e.i18n[r],r,t)}this.orderedModels=[],this.models={},Object.keys(e.models).forEach((function(n){const i=e.models[n];t.models[n]=new a(i,n),t.orderedModels.push(t.models[n])})),t.orderedModels.sort(((e,t)=>e.order-t.order)),this.vendorModels=e.vendorModels?e.vendorModels.split(":"):[],this.customerModels=e.customerModels?e.customerModels.split(":"):[]}function a(e,t){this.name=t,this.path=e.path,e.needInit&&(this.needInit=e.needInit),e.needLocalize&&(this.needLocalize=e.needLocalize),this.order=e.order,this.moduleName=e.moduleName,this.clientRequirePath=e.moduleSuffix&&e.moduleName&&e.moduleName.startsWith("@")?this.moduleName+"/"+e.moduleSuffix:this.path,e.realPublicPath&&(this.realPublicPath=e.realPublicPath),e.realPath&&(this.realPath=e.realPath),this.version=e.version}function s(){}function l(e){this.selectName=e.selectName||"",this.execName=e.execName||this.selectName,this.pkGenerator=e.pkGenerator}function c(e,t,n,o,a){const c=this;let u,d;if(!n||"undefined"!=typeof process&&process.isServer||(i.merge(e,n),i.forEach(e.attributes,((e,t)=>{if(!e.dataType)throw new Error(`Invalid i18n for entity "${o}" - attribute "${t}" not exist in meta or it's dataType is empty`)}))),Object.defineProperty(this,"domain",{enumerable:!1,value:a}),this.code=o,this.modelName=e.modelName,this.overriddenBy=e.overriddenBy,this.name=e.name,e.caption&&(this.caption=e.caption),e.description&&(this.description=e.description),e.documentation&&(this.documentation=e.documentation),e.descriptionAttribute&&(this.descriptionAttribute=e.descriptionAttribute),e.cacheType&&(this.cacheType=e.cacheType),e.dsType&&(this.dsType=e.dsType),e.isUnity&&(this.isUnity=!0),e.isManyManyRef&&(this.isManyManyRef=!0),e.isFTSDataTable&&(this.isFTSDataTable=!0),this.sqlAlias=e.sqlAlias,this.connectionName=e.connectionName,this.connectionConfig=this.connectionName&&this.domain&&this.domain.connections?i.find(this.domain.connections,{name:this.connectionName}):void 0,this.mapping=void 0,e.mapping){const t=Object.keys(e.mapping);if(t.forEach((e=>{if(!r.dialectsPriority[e])throw new Error(`Invalid dialect ${e} in ${this.code} mapping`)})),t.length){const t=this,n=r.dialectsPriority[this.connectionConfig.dialect];i.forEach(n,(function(n){if(e.mapping[n])return t.mapping=new l(e.mapping[n]),!1}))}}this.dbKeys=e.dbKeys&&Object.keys(e.dbKeys).length?e.dbKeys:void 0,this.dbExtensions=e.dbExtensions&&Object.keys(e.dbExtensions).length?e.dbExtensions:void 0,this.attributes=new s,this.blobAttributes=[];const f=Array.isArray(e.attributes);i.forEach(e.attributes,((e,t)=>{f&&(t=e.code||e.name);const n=new g(e,t,c);"mi_dateTo"===n.code&&"undefined"!=typeof window&&(n.allowNull=!0),c.attributes[t]=n,n.dataType===r.ubDataTypes.Document&&this.blobAttributes.push(n)}));const h=Object.keys(e.mixins||{});this.mixins={},h.forEach((function(t){switch(u=e.mixins[t],d=n&&n.mixins?n.mixins[t]:null,t){case"mStorage":c.mixins[t]=new x(u,d,t);break;case"dataHistory":c.mixins[t]=new b(u,d,t);break;case"aclRls":c.mixins[t]=new v(u,d,t);break;case"fts":c.mixins[t]=new E(u,d,t);break;case"als":c.mixins[t]=new w(u,d,t);break;default:c.mixins[t]=new y(u,d,t)}})),this.entityMethods=t||{},e.privateSettings&&(this.privateSettings=e.privateSettings)}r.prototype.isEntityMethodsAccessible=function(e,t){const n=this.entities[e];return!!n&&(Array.isArray(t)?n.haveAccessToMethods(t):n.haveAccessToMethod(t))},r.prototype.get=function(e,t){const n=this.entities[e];if(!1!==t&&!n)throw new Error(`Entity with code '${e}' does not exist or not accessible`);return n},r.prototype.has=function(e){return!!this.entities[e]},r.prototype.eachEntity=function(e){return i.forEach(this.entities,e)},r.prototype.filterEntities=function(e){return i.isFunction(e)?i.filter(this.entities,e):i.filter(this.entities,(function(t){let n=!0;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n=n&&t[i]===e[i]);return n}))},r.ubDataTypes={String:"String",Int:"Int",BigInt:"BigInt",Float:"Float",Currency:"Currency",Boolean:"Boolean",DateTime:"DateTime",Text:"Text",ID:"ID",Entity:"Entity",Document:"Document",Many:"Many",TimeLog:"TimeLog",Enum:"Enum",BLOB:"BLOB",Date:"Date",Json:"Json"},r.prototype.ubDataTypes=r.ubDataTypes,r.FLOATING_SCALE_PRECISION=r.prototype.FLOATING_SCALE_PRECISION=6,r.ExpressionType={Field:"Field",Expression:"Expression"},r.ubMixins={dataHistory:"dataHistory",mStorage:"mStorage",unity:"unity",treePath:"treePath"},r.ubServiceFields={dateFrom:"mi_datefrom",dateTo:"mi_dateto"},r.EntityDataSourceType={Normal:"Normal",External:"External",System:"System",Virtual:"Virtual"},r.EntityCacheTypes={None:"None",Entity:"Entity",Session:"Session",SessionEntity:"SessionEntity"},r.dialectsPriority={MSSQL2012:["MSSQL2012","MSSQL","AnsiSQL"],MSSQL2008:["MSSQL2008","MSSQL","AnsiSQL"],MSSQL:["MSSQL","AnsiSQL"],Oracle11:["Oracle11","Oracle","AnsiSQL"],Oracle10:["Oracle10","Oracle","AnsiSQL"],Oracle9:["Oracle9","Oracle","AnsiSQL"],Oracle:["Oracle","AnsiSQL"],PostgreSQL:["PostgreSQL","AnsiSQL"],AnsiSQL:["AnsiSQL"],Firebird:["Firebird","AnsiSQL"],SQLite3:["SQLite3","AnsiSQL"]},r.getPhysicalDataType=function(e){const t=r.ubDataTypes,n={};return this.physicalTypeMap||(n[t.Int]="int",n[t.Entity]="int",n[t.ID]="int",n[t.BigInt]="int",n[t.String]="string",n[t.Text]="string",n[t.Enum]="string",n[t.Float]="float",n[t.Currency]="float",n[t.Boolean]="boolean",n[t.Date]="date",n[t.DateTime]="date",this.physicalTypeMap=n),this.physicalTypeMap[e]||"auto"},r.jsonReplacer=function(e,t){const n=this.__proto__.forJSONReplacer;if(n){if(Object.prototype.hasOwnProperty.call(n,e)&&null===n[e])return;if("boolean"==typeof t&&t===n[e])return}if(("boolean"==typeof t||t)&&("customSettings"!==e||Object.keys(t).length))return t},a.prototype.needInit=!1,a.prototype.needLocalize=!1,a.prototype.realPublicPath="",s.prototype.asPlainJSON=function(){return JSON.parse(JSON.stringify(this,r.jsonReplacer))},c.prototype.forJSONReplacer={code:null,modelName:null,cacheType:"None",isFTSDataTable:null,isManyManyRef:null,blobAttributes:null,entityMethods:null},c.prototype.caption="",c.prototype.description="",c.prototype.documentation="",c.prototype.descriptionAttribute="",c.prototype.cacheType="None",c.prototype.dsType="Normal",c.prototype.isUnity=!1,c.prototype.isManyManyRef=!1,c.prototype.isFTSDataTable=!1,c.prototype.getEntityCaption=function(){return this.caption||this.description},c.prototype.attr=function(e,t){let n=this.attributes[e];return n||t||(n=this.getEntityAttribute(e)),n},c.prototype.getAttribute=function(e){const t=this.attributes[e];if(!t)throw new Error(`Attribute ${this.code}.${e} doesn't exist`);return t},c.prototype.eachAttribute=function(e){return i.forEach(this.attributes,e)},c.prototype.mixin=function(e){return this.mixins[e]},c.prototype.hasMixin=function(e){const t=this.mixins[e];return"audit"===e&&!t||!!t&&t.enabled},c.prototype.checkMixin=function(e){if(!this.hasMixin(e))throw new Error("Entity "+this.code+" does not have mixin "+e)};const u=["mi_owner","mi_createDate","mi_createUser","mi_modifyDate","mi_modifyUser","mi_deleteDate","mi_deleteUser","mi_data_id","mi_dateFrom","mi_dateTo","mi_unityEntity","mi_treePath"];function d(e){return e?new Date(e):null}function f(e){return"boolean"==typeof e?e:null==e||""===e?null:1===e||"1"===e}function h(e){return e?JSON.parse(e):null}function p(e){return"number"==typeof e?String(e):e||null}function m(e){this.expressionType=e.expressionType,this.expression=e.expression}function g(e,t,n){if(this.code=t,this.name=e.name,Object.defineProperty(this,"entity",{enumerable:!1,value:n}),this.dataType=e.dataType||"String",this.associatedEntity=e.associatedEntity,this.associationAttr=e.associationAttr,this.caption=e.caption||"",this.description=e.description||"",this.documentation=e.documentation||"",this.size=e.size||0,this.allowNull=!1!==e.allowNull,this.allowSort=!1!==e.allowSort,this.isUnique=!0===e.isUnique,this.defaultValue=e.defaultValue,this.readOnly=!0===e.readOnly,this.isMultiLang=!0===e.isMultiLang,this.cascadeDelete=!0===e.cascadeDelete,this.enumGroup=e.enumGroup,this.customSettings=e.customSettings||{},this.associationManyData=e.associationManyData,this.storeName=e.storeName,this.generateFK=!1!==e.generateFK,this.defaultView=!1!==e.defaultView,this.mapping=void 0,e.mapping){const t=this,o=Object.keys(e.mapping);if(o.forEach((function(e){if(!r.dialectsPriority[e])throw new Error(`Invalid dialect ${e} in ${n.code}.${t.code} mapping`)})),o.length){const n=r.dialectsPriority[this.entity.connectionConfig.dialect];i.forEach(n,(function(n){if(e.mapping[n])return t.mapping=new m(e.mapping[n]),!1}))}}this.physicalDataType=r.getPhysicalDataType(this.dataType||"String"),this.hasCatalogueIndex=!0===e.hasCatalogueIndex,e.privateSettings&&(this.privateSettings=e.privateSettings)}function y(e,t,n){this.code=n,i.assign(this,e),t&&i.assign(this,t)}function x(e,t,n){y.apply(this,arguments)}function b(e,t,n){y.apply(this,arguments)}function v(e,t,n){y.apply(this,arguments)}function E(e,t,n){y.apply(this,arguments)}function w(e,t,n){y.apply(this,arguments)}c.prototype.asPlainJSON=function(e=!0,t=!0){const n=JSON.parse(JSON.stringify(this,r.jsonReplacer));if(t&&"Virtual"!==n.dsType&&i.forEach(n.attributes,((e,t)=>{t.startsWith("mi_")&&u.includes(t)&&delete n.attributes[t]})),!e)return n;const o=[];for(const e in n.attributes){const t=Object.assign({name:e},n.attributes[e]);if(t.mapping&&!Array.isArray(t.mapping)){const e=[];for(const n in t.mapping){const i=t.mapping[n],o=Object.assign({name:n},i);e.push(o)}t.mapping=e}o.push(t)}return n.attributes=o,n},c.prototype.haveAccessToMethod=function(e){return"undefined"!=typeof App&&App.els?App.els(this.code,e):1===this.entityMethods[e]},c.prototype.filterAttribute=function(e){return i.isFunction(e)?i.filter(this.attributes,e):i.filter(this.attributes,(function(t){let n=!0;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n=n&&t[i]===e[i]);return n}))},c.prototype.haveAccessToAnyMethods=function(e){const t=this;let n=!1;return(e||[]).forEach((function(e){n=UB.isServer&&process.isServer?n||App.els(t.code,e):n||1===t.entityMethods[e]})),n},c.prototype.haveAccessToMethods=function(e){const t=this;let n=!0;return(e||[]).forEach((function(e){n=UB.isServer&&process.isServer?n&&App.els(t.code,e):n&&1===t.entityMethods[e]})),n},c.prototype.addMethod=function(e){throw new Error("UBEntity.addMethod implemented only in HTTP worker thread")},c.prototype.getConvertRules=function(e){const t=this,n=[],i=r.ubDataTypes;return e.forEach((function(e,r){const a=t.attr(e);a&&(a.dataType===i.DateTime?n.push({index:r,convertFn:d}):a.dataType===i.Date?n.push({index:r,convertFn:o}):a.dataType===i.Boolean?n.push({index:r,convertFn:f}):a.dataType===i.Json?n.push({index:r,convertFn:h}):a.dataType===i.Enum&&n.push({index:r,convertFn:p}))})),n},c.prototype.getDescriptionAttribute=function(e){let t=this.descriptionAttribute||"caption";if(!this.attr(t)){if(!1!==e)throw new Error(`Missing description attribute for entity '${this.code}'`);t=void 0}return t},c.prototype.getEntityAttributeInfo=function(e,t){let n,i,o=this,a=this.code,s=null,l=null,c=[];if(-1===e.indexOf(".")?(i=e,n=1):(c=e.split("."),n=c.length,i=c[0]),t&&t>0)return{entity:a,attribute:o.attr(i),parentAttribute:null,attributeCode:i};-1===t&&(n-=1);let u=0;for(;o&&u<n;){if(i.indexOf("@")>-1){const e=i.split("@");a=e[1],o=this.domain.get(a),i=e[0]}if(s=l,l=o.attributes[i],!l)return;if("Enum"===l.dataType)break;if(l.dataType===r.ubDataTypes.Json&&u+1<n){s=l,l=void 0;break}u+=1,u<n&&(i=c[u],a=l.associatedEntity,o=l.getAssociatedEntity())}return{entity:a,attribute:l,parentAttribute:s,attributeCode:i}},c.prototype.getEntityAttribute=function(e,t){const n=this.getEntityAttributeInfo(e,t);return n?n.attribute:void 0},c.prototype.getAttributeNames=function(e){const t=[];return e?(i.forEach(this.filterAttribute(e),(function(e){t.push(e.code)})),t):Object.keys(this.attributes)},c.prototype.getEntityRequirements=function(e){const t=[];for(let n=0,i=(e=e||this.getAttributeNames()).length;n<i;++n){const i=this.getEntityAttribute(e[n]);i&&i.dataType===r.ubDataTypes.Entity&&-1===t.indexOf(i.associatedEntity)&&t.push(i.associatedEntity)}return t},c.prototype.checkAttributeExist=function(e,t){const n=this;(e=Array.isArray(e)?e:[e]).forEach((function(e){if(!n.getEntityAttributeInfo(e))throw new Error(t+(t?" ":"")+'The entity "'+n.code+'" does not have attribute "'+e+'"')}))},c.prototype.getEntityDescription=function(){return this.description||this.caption},c.prototype.getDetailsForUI=function(){const e=/^ID|mi_/,t=this.name,n=[];return this.domain.eachEntity((function(i){i.name!==t&&i.haveAccessToMethod("select")&&i.eachAttribute((function(i){i.associatedEntity!==t||i.customSettings&&i.customSettings.hiddenInDetails||e.test(i.name)||n.push(i)}))})),n},g.prototype.forJSONReplacer={code:null,name:null,allowNull:!0,allowSort:!0,isUnique:!1,readOnly:!1,isMultiLang:!1,cascadeDelete:!1,generateFK:!0,defaultView:!0,physicalDataType:null,hasCatalogueIndex:null},g.prototype.getAssociatedEntity=function(){return this.associatedEntity?this.entity.domain.get(this.associatedEntity):null},g.prototype.asPlainJSON=function(){return JSON.parse(JSON.stringify(this,r.jsonReplacer))},y.prototype.forJSONReplacer={enabled:!0,code:null},y.prototype.enabled=!0,x.prototype=Object.create(y.prototype),x.prototype.constructor=x,x.prototype.simpleAudit=!1,x.prototype.safeDelete=!1,b.prototype=Object.create(y.prototype),b.prototype.constructor=b,b.prototype.historyType="common",v.prototype=Object.create(y.prototype),v.prototype.constructor=v,v.prototype.aclRlsUseUnityName=!1,v.prototype.aclRlsSelectionRule="exists",E.prototype=Object.create(y.prototype),E.prototype.constructor=E,E.prototype.scope="connection",E.prototype.dataProvider="mixin",w.prototype=Object.create(y.prototype),w.prototype.constructor=w,w.prototype.alsOptimistic=!0,r.UBEntity=c,r.UBModel=a,r.UBEntity.UBEntityAttribute=g,e.exports=r},8713:function(e){function t(e,t,i){const o=e,a=n(o.result.split("+")[0]),s=o.uData?JSON.parse(o.uData):{lang:"en",login:"anonymous"},l=o.result,c=t||"",u="undefined"!=typeof ncrc32?ncrc32(0,l+c):null;s.login||(s.login=o.logonname),Object.defineProperty(this,"sessionID",{enumerable:!0,writable:!1,value:a}),this.logonname=o.logonname,this.userData=s,this.authSchema=i||"UB",this.signature=function(e){let t;switch(this.authSchema){case"None":return"";case"UBIP":return this.logonname;case"ROOT":return process.rootOTP();default:return t=n(e?1:Math.floor(Date.now()/1e3)),e?a+t+n(1):a+t+n("undefined"!=typeof ncrc32?ncrc32(u,t):r(l+c+t))}},this.isAnonymous=function(){return"None"===this.authSchema},this.authHeader=function(e){return this.isAnonymous()?"":("Negotiate"===this.authSchema?"UB":this.authSchema)+" "+this.signature(e)}}e.exports=t,t.prototype.hexa8=function(e){const t=parseInt(e,10);return isNaN(t)?"00000000":t.toString(16).padStart(8,"0")};const n=t.prototype.hexa8,i={};let o;t.prototype.crc32=function(e,t,n,r){r=r||4294967295;let a=n=n||4294967295,s=i[t=t||79764919];s||(o=new TextEncoder,s=i[t]=function(){let e,n,i;const o=[],r=function(e,t){let n=0;for(;t;)n=2*n+e%2,e/=2,e-=e%1,t--;return n};for(e=255;e>=0;e--){for(i=r(e,32),n=0;n<8;n++)i=(2*i^(i>>>31)%2*t)>>>0;o[e]=r(i,32)}return o}());const l=o.encode(e);for(let e=0,t=l.length;e<t;e++)a=(a/256^s[a%256^l[e]])>>>0;return(a^r)>>>0};const r=t.prototype.crc32},9274:function(e,t,n){const i=n(4970),o=n(9447),r=n(6357),a=n(8713),s=n(9602);e.exports={CustomRepository:i,LocalDataStore:o,UBDomain:r,UBSession:a,formatByPattern:s}},9602:function(e){const t={date:{month:"2-digit",day:"2-digit",year:"numeric"},dateFull:{month:"2-digit",day:"2-digit",year:"2-digit"},dateShort:{month:"2-digit",year:"2-digit"},dateFullLong:{month:"long",day:"2-digit",year:"numeric"},dateMYY:{month:"2-digit",year:"numeric"},dateMYLong:{month:"long",year:"numeric"},time:{hour:"2-digit",minute:"2-digit"},timeFull:{hour:"2-digit",minute:"2-digit",second:"2-digit"},dateTime:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"},dateTimeFull:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}},n={sum:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},numberGroup:{style:"decimal",useGrouping:!0,maximumFractionDigits:0},sumDelim:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},number:{style:"decimal",useGrouping:!1,maximumFractionDigits:0},decimal1:{style:"decimal",useGrouping:!0,maximumFractionDigits:1,minimumFractionDigits:1},decimal2:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},decimal3:{style:"decimal",useGrouping:!0,maximumFractionDigits:3,minimumFractionDigits:3},decimal4:{style:"decimal",useGrouping:!0,maximumFractionDigits:4,minimumFractionDigits:4},decimal5:{style:"decimal",useGrouping:!0,maximumFractionDigits:5,minimumFractionDigits:5},decimal6:{style:"decimal",useGrouping:!0,maximumFractionDigits:6,minimumFractionDigits:6}};let i=null;const o={en:"en-US",ru:"ru-RU",uk:"uk-UA",az:"az"};function r(e){return i?i(e):(e=e||_defaultLang).length<3&&o[e]?o[e]:e+"-"+e.toUpperCase()}"undefined"==typeof _defaultLang&&(_defaultLang="en"),_collator=void 0;let a={},s={};e.exports.formatDate=function(e,n,i=_defaultLang){if(!e)return"";if(e instanceof Date||(e=new Date(e)),s[i]||(s[i]={}),!s[i][n]){const e=t[n];if(!e)throw new Error(`Unknown date pattern ${n}`);const o=r(i);s[i][n]=new Intl.DateTimeFormat(o,e)}return s[i][n].format(e)},e.exports.formatNumber=function(e,t,i=_defaultLang){if(!e&&0!==e)return"";const o="number"==typeof e?e:parseFloat(e);if(Number.isNaN(o))return"";if(a[i]||(a[i]={}),!a[i][t]){const e=n[t];if(!e)throw new Error(`Unknown number pattern ${t}`);const o=r(i);a[i][t]=new Intl.NumberFormat(o,e)}return a[i][t].format(e)},e.exports.setLang2LocaleHook=function(e){i=e,a={},s={}},e.exports.datePatterns=Object.keys(t),e.exports.numberPatterns=Object.keys(n),e.exports.setDefaultLang=function(e){_defaultLang!==e&&(_defaultLang=e,_collator=void 0,"object"==typeof Intl&&Intl.Collator&&(_collator=new Intl.Collator(e,{numeric:!0})))},e.exports.collationCompare=function(e,t){return _collator?_collator.compare(e,t):e===t?0:e>t?1:-1}},995:function(e,t,n){const i=n(8134),o=n(5738),r=n(6855).i18n,a=n(645),s=n(9274),l=s.LocalDataStore,c=s.UBSession,u=s.UBDomain,d=n(4375),f=n(667),h=n(245),p=n(4168),m=n(6656),g=n(1810),y=n(9024),x=/(\/|^)(auth|getAppInfo)(\/|\?|$)/,b="auth",v="anonymous",E="None",w=/<<<.*?>>>/,C=/(?:^|")<<<(.*?)>>>(?:\|(\[[^\]]*]))?(?:$|")/,I=/<<<(.*)>>>/,S=!("undefined"==typeof window||!window.localStorage)&&window.localStorage;function B(e){const t=e.host||"http://localhost:8881";let n,r,a=e.appName||"/",l=e.requestAuthParams;i.call(this),Object.assign(this,i.prototype),this.ubNotifier=null,this.appConfig={},this.preferredLocale="en",this.domain=null,this.setRequestAuthParamsFunction=function(e){l=e},"/"!==a.charAt(0)&&(a="/"+a);const u=t+a;function d(e,t,n,i=!1){const o=new c(e,t,n),r=o.userData;return r.lang&&-1!==this.appConfig.supportedLanguages.indexOf(r.lang)||(r.lang=this.appConfig.defaultLang),s.formatByPattern.setDefaultLang(r.lang),i||function(e,t){if("undefined"==typeof document||"undefined"==typeof window||"function"!=typeof btoa)return;if(!document.body||!window.location||!window.encodeURIComponent)return;const n=window.location.hostname,i=e.appConfig.appVersion;if(/(localhost|0.0.1)/.test(n))return;if(/-dev$/.test(window.location.pathname))return;const o=e.appConfig.uiSettings.adminUI;let r=o&&o.applicationName;r&&"object"==typeof r?r=r[Object.keys(r)[0]]:"string"!=typeof r&&(r="-"),r=r.replace(/<\/?[^>]+(>|$)/g,"").slice(0,50).replace(/[:", ]/g,".");const a=btoa(window.encodeURIComponent(`${e.serverVersion}:${m(t)}:${r}:${n}:${i}`)),s=document.createElement("img");s.style.position="absolute",s.style.display="none",s.style.width=s.style.height="0px",s.style.display="none",s.src=`https://unitybase.info/udot.gif?ut=${a}&rn=${Math.trunc(1e6*Math.random())}`,document.body.appendChild(s)}(this,r.login),o}this.serverUrl=u,n="undefined"!=typeof window&&window.location&&window.location.origin===t?a:u,"/"!==n.charAt(n.length-1)&&(n+="/"),this.baseURL=n,this.appName=a,this.allowSessionPersistent=e.allowSessionPersistent&&!1!==S,this.allowSessionPersistent&&(this.__sessionPersistKey=this.serverUrl+":storedSession"),this.cache=null,this._pendingCachedEntityRequests={},this.lastLoginName="",this._bufferedRequests=[],this._bufferTimeoutID=0,this.uiTag="",this.isAuthorized=function(){return void 0!==r},this.userLogin=function(){return this.userData("login")},this.userLang=function(){return this.userData("lang")},this.userData=function(e){const t=this.isAuthorized()?r.userData:{lang:this.appConfig.defaultLang||"en",login:v};return e?t[e]:t},this.authorize=function(e){const t=this;if(r)return Promise.resolve(r);if(this.allowSessionPersistent&&!e){const e=S.getItem(this.__sessionPersistKey);if(e)try{const n=JSON.parse(e);return r=d.call(this,n.data,n.secretWord,n.authSchema,!0),t.emit("authorized",t,r),Promise.resolve(r)}catch(e){S.removeItem(this.__sessionPersistKey)}}return this._pendingAuthPromise||(this.exchangeKeysPromise=null,this._pendingAuthPromise=function(e,t){if(!e.authMethods.length||!l){if(t)throw new o.UBError("Access deny");return Promise.resolve({authSchema:E,login:v})}return l(e,t)}(this,e).then((function(e){const n=e.authSchema;return t.doAuth(e).then((function(i){return t._pendingAuthPromise=null,r=i,S&&(S.setItem(o.LDS_KEYS.LAST_LOGIN,i.logonname),S.setItem(o.LDS_KEYS.LAST_AUTH_SCHEMA,n)),t.emit("authorized",t,i,e),i})).catch((function(e){t._pendingAuthPromise=null,S&&S.removeItem(o.LDS_KEYS.SILENCE_KERBEROS_LOGIN),e&&e instanceof o.UBAbortError||t.emit("authorizationFail",e,t)})).then((function(){return t.authorize(!0)}))}))),this._pendingAuthPromise},this.authorizationClear=function(){this.lastLoginName=this.userLogin(),r=void 0},this.switchCurrentSession=function(e){r=e},this.authHandshakeUBIP=function(e){return e.login?this.post(b,"",{headers:{Authorization:e.authSchema+" "+e.login}}):Promise.reject({errMsg:"invalid user name"})},this.authHandshakeOpenIDConnect=function(e){return Promise.resolve(e).then((function(e){return e.authSchema="UB",e}))},this.authHandshakeUB=function(e){const t=this;let n;return e.login&&e.password?this.post(b,"",{params:{AUTHTYPE:e.authSchema,userName:e.login}}).then((function(i){let o,r,s;const l={params:{AUTHTYPE:e.authSchema,userName:e.login,password:""}},c=t.authMock?h("1234567890abcdef").toString():h((new Date).toISOString().substr(0,16)).toString();l.params.clientNonce=c,i.data.connectionID&&(l.params.connectionID=i.data.connectionID);const u=i.data.realm;if(u){if(o=i.data.nonce,!o)throw new Error("invalid LDAP auth response");i.data.useSasl?(r=m(e.login.split("\\")[1].toUpperCase()+":"+u+":"+e.password),r.concat(f.enc.Utf8.parse(":"+o+":"+c)),s=m(r).toString(),n=s):(s=f.enc.Base64.stringify(f.enc.Utf8.parse(e.password)),n=s)}else{if(o=i.data.result,!o)throw new Error("invalid auth response");r=h("salt"+e.password).toString();const t="/"===a?"/":a.replace(/\//g,"");s=h(t.toLowerCase()+o+c+e.login+r).toString(),n=r}return l.params.password=s,t.post(b,"",l).then((function(e){return e.secretWord=n,e}))})):Promise.reject({errMsg:"invalid user name or password"})},this.doAuth=function(e){if(e.authSchema=e.authSchema||"UB",this.isAuthorized())return Promise.reject({errMsg:"invalid auth call",errDetails:"contact developers"});let t;switch(e.authSchema){case E:t=Promise.resolve({data:{result:"0+0",uData:JSON.stringify({login:v})},secretWord:""});break;case"UB":t=this.authHandshakeUB(e);break;case"CERT":t=this.pki().then((t=>t.authHandshakeCERT(e)));break;case"CERT2":t=this.pki().then((t=>t.authHandshakeCERT2(e)));break;case"UBIP":t=this.authHandshakeUBIP(e);break;case"OpenIDConnect":t=this.authHandshakeOpenIDConnect(e);break;case"Negotiate":t=this.post(b,"",{params:{USERNAME:"",AUTHTYPE:e.authSchema}}).then((function(e){if(e.secretWord=e.headers("X-UB-Nonce"),!e.secretWord)throw new Error("X-UB-Nonce header is required to complete Negotiate authentication. Please, upgrade UB to >= 5.17.9");return e}));break;default:t=Promise.reject({errMsg:"invalid authentication schema "+e.authSchema})}return t=t.then((t=>{const n=d.call(this,t.data,t.secretWord,e.authSchema);return this.allowSessionPersistent&&S.setItem(this.__sessionPersistKey,JSON.stringify({data:t.data,secretWord:t.secretWord,authSchema:t.authSchema})),n}),(t=>{if(t instanceof Error)throw t;{const i=t.data||t,r={errMsg:i.errMsg,errCode:i.errCode,errDetails:i.errMsg};403===t.status?w.test(r.errMsg)&&"<<<Access deny>>>"!==r.errMsg||(r.errMsg="UB"===e.authSchema?"msgInvalidUBAuth":"msgInvalidCertAuth"):0===t.status?(r.errMsg="serverIsBusy",r.errDetails="network error"):r.errMsg||(r.errMsg="unknownError"),w.test(r.errMsg)&&(r.errMsg=(n=r.errMsg,JSON.parse('"'+n.match(I)[1]+'"')));const a=this.serverErrorByCode(r.errCode);throw a&&(r.errDetails=a+" "+r.errDetails),this.allowSessionPersistent&&S.removeItem(this.__sessionPersistKey),new o.UBError(r.errMsg,r.errDetails,r.errCode)}var n})),t},this.recordedXHRs=[],this.recorderEnabled=!1}function D(e){const t=Object.keys(e),n=t.length;let i=!1;for(let o=0;o<n;o++){const n=e[t[o]];if(n&&"object"==typeof n&&!(n instanceof Date)){i=!0;break}}if(!i)return!1;const o={};for(let i=0;i<n;i++){const n=e[t[i]];o[t[i]]=!n||"object"!=typeof n||n instanceof Date?n:JSON.stringify(n)}return o}B.prototype.initCache=function(e){const t="/"===this.baseURL?"UB":this.baseURL;return this.cache=new d(t,e),this.cachedSessionEntityRequested={},this.cache.clear(d.SESSION)},B.prototype.cacheKeyCalculate=function(e,t){const n=[this.userLogin().toLowerCase(),this.userLang(),e];return Array.isArray(t)&&n.push(m(JSON.stringify(t)).toString()),n.join("#").replace(/[\\:.]/g,"#")},B.prototype.cacheOccurrenceRefresh=function(e,t){const n=this;let i=Promise.resolve(!0);if(t===d.cacheTypes.Session||t===d.cacheTypes.SessionEntity){const o=this.domain.get(e);if(o&&o.hasMixin("unity")){const t=o.mixin("unity"),r=this.domain.get(t.entity);r&&t.entity!==e&&r.cacheType!==d.cacheTypes.None&&(i=i.then((()=>n.cacheOccurrenceRefresh(t.entity,r.cacheType))))}const r=n.cacheKeyCalculate(e),a=new RegExp("^"+r);Object.keys(n.cachedSessionEntityRequested).filter((function(e){return a.test(e)})).forEach((function(e){delete n.cachedSessionEntityRequested[e]})),t===d.cacheTypes.Session&&(i=i.then((function(){return n.cache.removeIfMach(a,d.SESSION)})))}return i},B.prototype.cacheOccurrenceRemove=function(e,t){const n=this,i=n.cacheKeyCalculate(e),o=new RegExp("^"+i);Object.keys(n.cachedSessionEntityRequested).filter((function(e){return o.test(e)})).forEach((function(e){delete n.cachedSessionEntityRequested[e]}));const r=t===d.cacheTypes.Session?d.SESSION:d.PERMANENT;return n.cache.removeIfMach(o,r)},B.prototype.cacheClearAll=function(){const e=this;return Object.keys(e.cachedSessionEntityRequested).forEach((function(t){delete e.cachedSessionEntityRequested[t]})),Promise.all([e.cache.clear(d.SESSION),e.cache.clear(d.PERMANENT)])},B.prototype.get=function(e,t){return this.xhr(Object.assign({},t,{method:"GET",url:e}))},B.prototype.post=function(e,t,n){return this.xhr(Object.assign({},n,{method:"POST",url:e,data:t}))},B.prototype.checkChannelEncryption=function(e,t){return!0},B.prototype.xhr=function(e){const t=this,n=Object.assign({headers:{}},e),i=n.url;let s;return t.recorderEnabled&&t.recordedXHRs.push(e),(i.length<t.baseURL.length||i.substring(0,t.baseURL.length)!==t.baseURL)&&(n.url=t.baseURL+n.url),x.test(i)?s=a.xhr(n):(s=t.authorize().then((e=>t.checkChannelEncryption(e,n))),s=s.then((function(){return t.authorize().then((function(e){const i=e.authHeader(t.authMock);return i&&(n.headers.Authorization=i),a.xhr(n)}))})).catch((function(n){let i="";if(401===n.status){if(t.allowSessionPersistent&&S.removeItem(t.__sessionPersistKey),o.logDebug("unauth: %o",n),t.isAuthorized()&&t.authorizationClear(),!n.config.url||!/\/logout/.test(n.config.url))return a.xhr.allowRequestReiteration(),t.xhr(e);t.lastLoginName=""}if(413===n.status)throw new o.UBError("Request Entity Too Large");if(n.data&&n.data.hasOwnProperty("errCode")){const e=n.data.errCode,a=i=n.data.errMsg;if(i=function(e){if(!w.test(e))return r(e);const t=e.match(C);if(!t)return r(e);const[n,i,o]=t;if(!o)return r(JSON.parse('"'+i+'"'));const a=JSON.parse('"'===n[0]?n:'"'+n+'"'),s=a.indexOf("|");if(-1===s)return r(a);const l=a.substring(3,s-3),c=a.substr(s+1),u=JSON.parse(c);return Array.isArray(u)?(u.unshift(l),r.apply(null,u)):r(l,u)}(i),72===e&&t.emit("passwordExpired",t))throw new o.UBAbortError;throw new o.UBError(i,a,e)}throw n}))),s},B.prototype.getAppInfo=function(){const e=this;return e.get("getAppInfo").then((function(t){const n=t.data;Object.defineProperty(e,"trafficEncryption",{enumerable:!0,writable:!1,value:n.trafficEncryption||!1}),Object.defineProperty(e,"serverCertificate",{enumerable:!0,writable:!1,value:n.serverCertificate||""}),Object.defineProperty(e,"encryptionKeyLifetime",{enumerable:!0,writable:!1,value:n.encryptionKeyLifetime||0}),Object.defineProperty(e,"authMethods",{enumerable:!0,writable:!1,value:n.authMethods}),Object.defineProperty(e,"simpleCertAuth",{enumerable:!0,writable:!1,value:n.simpleCertAuth||!1}),Object.defineProperty(e,"supportedWSProtocols",{enumerable:!0,writable:!1,value:n.supportedWSProtocols||[]}),Object.defineProperty(e,"serverVersion",{enumerable:!0,writable:!1,value:n.serverVersion||""}),o.apply(e.appConfig,n.uiSettings.adminUI);const i=n.serverVersion.split("."),r=i[0]>="v5"&&i[1]>=10;return Object.defineProperty(e,"UBQLv2",{enumerable:!0,writable:!1,value:r}),y.prototype.UBQLv2=r,Object.defineProperty(e,"authMock",{enumerable:!1,writable:!1,value:n.authMock||!1}),n}))},B.prototype.getDomainInfo=function(){const e=this;return e.get("getDomainInfo",{params:{v:4,userName:this.userLogin()}}).then((function(t){const n=t.data,i=new u(n);return e.domain=i,i}))},B.prototype.processBuffer=function(){const e=this._bufferedRequests;this._bufferTimeoutID=0,this._bufferedRequests=[];const t=e.map((e=>e.request)),n=`ubql?rq=${k(t)}&uitag=${this.uiTag}`;this.post(n,t).then((t=>{e.forEach((function(e,n){e.deferred.resolve(t.data[n])}))}),(t=>{e.forEach((function(e){e.deferred.reject(t)}))}))},B.prototype.query=function(e,t){const n=this;if(t)return this._bufferTimeoutID||(this._bufferTimeoutID=setTimeout(n.processBuffer.bind(n),20)),new Promise((function(t,i){n._bufferedRequests.push({request:e,deferred:{resolve:t,reject:i}})}));{const t=`ubql?rq=${e.entity}.${e.method}&uitag=${this.uiTag}`;return n.post(t,[e]).then((function(e){return e.data[0]}))}},B.prototype.run=B.prototype.query,B.prototype.queryAsObject=function(e,t,n){if(e.execParams&&("insert"===e.method||"update"===e.method)){const t=D(e.execParams);t&&(e.execParams=t)}return this.query(e,n).then((function(e){return e.resultData&&e.resultData.data&&e.resultData.data.length?l.selectResultToArrayOfObjects(e,t):null}))},B.prototype.convertResponseDataToJsTypes=function(e){return l.convertResponseDataToJsTypes(this.domain,e)},B.prototype.doFilterAndSort=function(e,t){return l.doFilterAndSort(e,t)},B.prototype.addNew=function(e){const t=this;return e.method="addnew",t.query(e,!0).then(t.convertResponseDataToJsTypes.bind(t))},B.prototype.addNewAsObject=function(e,t){return this.addNew(e).then((function(e){return l.selectResultToArrayOfObjects(e,t)[0]}))},B.prototype.invalidateCache=function(e){const t=this.domain.get(e.entity).cacheType;return t===d.cacheTypes.none?Promise.resolve(e):this.cacheOccurrenceRefresh(e.entity,t).then((function(){return e}))},B.prototype.update=function(e,t){const n=this;if(e.method=e.method||"update",e.execParams){const t=D(e.execParams);t&&(e.execParams=t)}return n.query(e,t).then(n.convertResponseDataToJsTypes.bind(n)).then(n.invalidateCache.bind(n))},B.prototype.updateAsObject=function(e,t,n){return this.update(e,n).then((function(e){return e.resultData&&e.resultData.data&&e.resultData.data.length?l.selectResultToArrayOfObjects(e,t)[0]:null}))},B.prototype.insert=function(e,t){const n=this;if(e.method=e.method||"insert",e.execParams){const t=D(e.execParams);t&&(e.execParams=t)}return n.query(e,t).then(n.convertResponseDataToJsTypes.bind(n)).then(n.invalidateCache.bind(n))},B.prototype.insertAsObject=function(e,t,n){return this.insert(e,n).then((function(e){return e.resultData&&e.resultData.data&&e.resultData.data.length?l.selectResultToArrayOfObjects(e,t)[0]:null}))},B.prototype.doDelete=function(e,t){const n=this;return e.method=e.method||"delete",n.query(e,t).then(n.invalidateCache.bind(n))},B.prototype.select=function(e,t){let n;const i=(t=t||!0===e.__mip_disablecache)||e.ID||e.bypassCache?d.cacheTypes.None:this.domain.get(e.entity).cacheType;return e.method||(e.method="select"),i!==d.cacheTypes.None?this._doSelectForCacheableEntity(e,i):(n=this.query(e,!0).then(this.convertResponseDataToJsTypes.bind(this)).then((t=>{const n={};if(o.apply(n,t),t.__totalRecCount)n.total=t.__totalRecCount;else if(t.resultData&&t.resultData.data){const i=t.resultData.data.length;if(e.options){const t=e.options||{},o=t.start?t.start:0,r=t.limit||0;n.total=i<r?o+i:-1}else n.total=i}return n})),n)},B.prototype._doSelectForCacheableEntity=function(e,t){const n=this.cacheKeyCalculate(e.entity,e.fieldList),i=t===d.cacheTypes.Session?d.SESSION:d.PERMANENT;return this.cache.get(n+":v",i).then((o=>{let r;if(!o||o&&t===d.cacheTypes.Entity||o&&t===d.cacheTypes.SessionEntity&&this.cachedSessionEntityRequested[n]!==o){const t={};Object.keys(e).forEach((function(n){-1===["whereList","orderList","options","logicalPredicates"].indexOf(n)&&(t[n]=e[n])})),t.version=o||"-1",r=(this._pendingCachedEntityRequests[n]?this._pendingCachedEntityRequests[n]:this._pendingCachedEntityRequests[n]=this.query(t,!0)).then((e=>(delete this._pendingCachedEntityRequests[n],e)),(e=>{throw delete this._pendingCachedEntityRequests[n],e})).then(this.convertResponseDataToJsTypes.bind(this)).then((e=>this._cacheVersionedResponse(e,i,n)))}else r=this.cache.get(n,i);return r})).then((t=>this.doFilterAndSort(t,e)))},B.prototype._cacheVersionedResponse=function(e,t,n){return e.resultData.notModified?(this.cachedSessionEntityRequested[n]=e.version,this.cache.get(n,t)):this.cache.put([{key:n+":v",value:e.version},{key:n,value:e.resultData}],t).then((()=>(this.cachedSessionEntityRequested[n]=e.version,e.resultData)))},B.selectResultToArrayOfObjects=l.selectResultToArrayOfObjects,B.prototype.runTrans=function(e){for(const t of e)if(t.execParams&&("insert"===t.method||"update"===t.method)){const e=D(t.execParams);e&&(t.execParams=e)}const t=`ubql?rq=${k(e)}&uitag=${this.uiTag}`;return this.post(t,e).then((e=>e.data))},B.prototype.runTransAsObject=function(e,t=[]){for(const t of e)if(t.execParams&&("insert"===t.method||"update"===t.method)){const e=D(t.execParams);e&&(t.execParams=e)}const n=this;return this.post("ubql",e).then((e=>{const i=[],o=e.data;if(o.forEach(((e,o)=>{const r="insert"===e.method||"update"===e.method;if(e.entity&&(r||"delete"===e.method)&&(i.includes(e.entity)||i.push(e.entity)),e.resultData&&e.resultData.data&&e.resultData.data&&e.resultData.fields){n.convertResponseDataToJsTypes(e);const i=l.selectResultToArrayOfObjects(e,t[o]);e.resultData=r?i[0]:i}})),!i.length)return o;const r=i.map((e=>n.invalidateCache({entity:e})));return Promise.all(r).then((()=>o))}))};const A=["entity","attribute","ID","id","isDirty","forceMime","fileName","store","revision"];function T(){}function k(e){const t=e.length;if(!t)return"";if(1===t)return`${e[0].entity}.${e[0].method}`;if(t){const n=[];n.push(`${e[0].entity}.${e[0].method}`);let i=1;for(;i<t;){if(e[i].entity===e[i-1].entity&&e[i].method===e[i-1].method){let o=1;do{o++,i++}while(i<t&&e[i].entity===e[i-1].entity&&e[i].method===e[i-1].method);n.push(o)}if(i<t){if(n.push(`${e[i].entity}.${e[i].method}`),n.length>20){n.push("**");break}i++}}return n.join("*")}}B.prototype.getDocumentURL=async function(e){const t=[];for(const n in e)-1!==A.indexOf(n)&&void 0!==e[n]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));const n=await this.authorize();return t.push("session_signature="+n.signature()),"/getDocument?"+t.join("&")},B.prototype.getDocument=function(e,t){const n=Object.assign({},t),i={url:"getDocument",method:n.bypassCache?"POST":"GET"};return t&&t.resultIsBinary&&(i.responseType="arraybuffer"),n.bypassCache?(i.data=Object.assign({},e),Object.keys(i.data).forEach((function(e){-1===A.indexOf(e)&&(delete i.data[e],o.logDebug('invalid parameter "'+e+'" passed to getDocument request'))}))):i.params=e,this.xhr(i).then((e=>e.data))},B.prototype.setDocument=function(e,t,n){const i={url:"setDocument",method:"POST",data:e,headers:{"Content-Type":"application/octet-stream"},params:t};return n&&(i.onProgress=n),this.xhr(i).then((e=>e.data.result))},B.prototype.hexa8=c.prototype.hexa8,B.prototype.crc32=c.prototype.crc32,B.prototype.logout=function(){if(this.allowSessionPersistent&&S.removeItem(this.__sessionPersistKey),!this.isAuthorized())return Promise.resolve(!0);let e=this.post("logout",{});if(this._pki){const t=this;e=e.then((()=>new Promise((e=>{setTimeout((()=>{t._pki.closePrivateKey(),e(!0)}),20)}))))}return e},T.prototype.libName="",T.prototype.direct={},T.prototype.readPrivateKey=function(){},T.prototype.closePrivateKey=function(){},T.prototype.getPrivateKeyOwnerInfo=function(){},T.prototype.sign=function(e,t,n){},T.prototype.verify=function(e,t,n){},T.prototype.authHandshakeCERT2=function(e){},T.prototype.settingsUI=function(){},T.prototype.verificationUI=function(e,t,n){},B.prototype.pki=async function(){if(this._pki)return this._pki;if(!this.appConfig.uiSettings)throw new Error("connection.pki() can be called either after connect() or inside connection.onGotApplicationConfig");const e=this.appConfig.availableEncryptions;let t;if(e&&(t=1===e.length?e[0].moduleURI:window&&"function"==typeof window.capiSelectionDialog?await window.capiSelectionDialog(this):e[0].moduleURI),!t)throw new Error('"encryptionImplementation" not defined in "appConfig.uiSettings.adminUI" or "@ub-d/crypto-api" model is not added into domain');return await UB.inject(t),this._pki=await UA_CRYPT.getPkiInterface(this),this._pki},B.prototype.serverErrorCodes={1:"ubErrNotImplementedErrnum",2:"ubErrRollbackedErrnum",3:"ubErrNotExecutedErrnum",4:"ubErrInvaliddataforrunmethod",5:"ubErrInvaliddataforrunmethodlist",6:"ubErrNoMethodParameter",7:"ubErrMethodNotExist",8:"ubErrElsAccessDeny",9:"ubErrElsInvalidUserOrPwd",10:"ubErrElsNeedAuth",11:"ubErrNoEntityParameter",13:"ubErrNoSuchRecord",14:"ubErrInvalidDocpropFldContent",15:"ubErrEntityNotExist",16:"ubErrAttributeNotExist",17:"ubErrNotexistEntitymethod",18:"ubErrInvalidSetdocData",19:"ubErrSoftlockExist",20:"ubErrNoErrorDescription",21:"ubErrUnknownStore",22:"ubErrObjdatasrcempty",23:"ubErrObjattrexprbodyempty",24:"ubErrNecessaryfieldNotExist",25:"ubErrRecordmodified",26:"ubErrNotexistnecessparam",27:"ubErrNotexistfieldlist",28:"ubErrUpdaterecnotfound",29:"ubErrNecessaryparamnotexist",30:"ubErrInvalidstoredirs",31:"ubErrNofileinstore",32:"ubErrAppnotsupportconnection",33:"ubErrAppnotsupportstore",34:"ubErrDeleterecnotfound",35:"ubErrNotfoundlinkentity",36:"ubErrEntitynotcontainmixinaslink",37:"ubErrEssnotinherfromessaslink",38:"ubErrInstancedatanameisreadonly",39:"ubErrManyrecordsforsoftlock",40:"ubErrNotfoundidentfieldsl",41:"ubErrInvalidlocktypevalue",42:"ubErrLockedbyanotheruser",43:"ubErrInvalidwherelistinparams",44:"ubErrRecnotlocked",45:"ubErrManyrecordsforchecksign",46:"ubErrNotfoundparamnotrootlevel",47:"ubErrCantcreatedirlogmsg",48:"ubErrCantcreatedirclientmsg",49:"ubErrConnectionNotExist",50:"ubErrDirectUnityModification",51:"ubErrCantdelrecthisvalueusedinassocrec",52:"ubErrAssocattrnotfound",53:"ubErrAttrassociationtoentityisempty",54:"ubErrNotfoundconforentityinapp",55:"ubErrNewversionrecnotfound",56:"ubErrElsAccessDenyEntity",57:"ubErrAlsAccessDenyEntityattr",58:"ubErrDatastoreEmptyentity",67:"ubErrTheServerHasExceededMaximumNumberOfConnections",69:"ubErrFtsForAppDisabled",72:"ubErrElsPwdIsExpired",73:"ELS_USER_NOT_FOUND",74:"VALUE_MUST_ME_UNIQUE"},B.prototype.serverErrorByCode=function(e){return this.serverErrorCodes[e]},B.prototype.Repository=function(e){return"string"==typeof e?new y(this,e):new y(this,"").fromUbql(e)},B.prototype.SHA256=h,B.prototype.HMAC_SHA256=p,B.prototype.setUiTag=function(e){this.uiTag=encodeURIComponent(e||"")},B.prototype.emitEntityChanged=function(e,t){const n=this.domain.get(e,!1);if(this.emit(`${e}:changed`,t),n&&n.hasMixin("unity")&&n.mixins.unity.entity){const e=n.mixins.unity,i={entity:e.entity,method:t.method,resultData:e.defaults||{}},o=new Set(e.attributeList),r=e.mapping||{},a=t.resultData||{};for(const e in a)"ID"===e?i.resultData.ID=a.ID:o.has(e)?i.resultData[e]=a[e]:r[e]&&(i.resultData[r[e]]=a[e]);this.emit(`${n.mixins.unity.entity}:changed`,i)}},B.prototype.userCanChangePassword=function(){if(!S)return!1;const e=S.getItem(o.LDS_KEYS.LAST_AUTH_SCHEMA)||"",t=this.appConfig.uiSettings&&this.appConfig.uiSettings.adminUI||{};return"UB"===e||"Basic"===e||e.startsWith("CERT")&&t.authenticationCert&&t.authenticationCert.requireUserName},e.exports.UBConnection=B,e.exports.connect=function(e,t=null){const n=this.config=Object.assign({},e),i=new B({host:n.host,appName:n.path||"/",requestAuthParams:n.onCredentialRequired,allowSessionPersistent:e.allowSessionPersistent});return t&&(t.connection=i),n.onAuthorizationFail&&i.on("authorizationFail",n.onAuthorizationFail),n.onNeedChangePassword&&i.on("passwordExpired",n.onNeedChangePassword),n.onAuthorized&&i.on("authorized",n.onAuthorized),i.getAppInfo().then((function(e){i.appConfig=Object.assign({applicationName:"UnityBase",applicationTitle:"UnityBase",loginWindowTopLogoURL:"",loginWindowBottomLogoURL:"",themeName:"UBGrayTheme",userDbVersion:null,defaultLang:"en",supportedLanguages:["en"],uiSettings:{}},e),i.ubNotifier=new g(i);let t=null;S&&(t=S.getItem(o.LDS_KEYS.PREFERRED_LOCALE)),t||(t=i.appConfig.defaultLang),-1===i.appConfig.supportedLanguages.indexOf(t)&&(t=i.appConfig.defaultLang),i.preferredLocale=t;const r=i.appConfig.uiSettings.adminUI;if(r.applicationName){const e="string"==typeof r.applicationName?r.applicationName:r.applicationName[i.preferredLocale];e&&(i.appConfig.applicationName=e)}return!n.onGotApplicationConfig||n.onGotApplicationConfig(i)})).then((function(){return i.initCache(i.appConfig.userDbVersion)})).then((function(){return i.authorize()})).then((function(){const e=i.userData("lang");S&&S.setItem(o.LDS_KEYS.PREFERRED_LOCALE,e),i.preferredLocale=e;let t=i.getDomainInfo();return n.onGotApplicationDomain&&(t=t.then((e=>(n.onGotApplicationDomain(e),e)))),t})).then((function(e){return i.domain=e,i}))}},9024:function(e,t,n){const i=n(9274),o=i.LocalDataStore,r=i.CustomRepository;e.exports=class extends r{constructor(e,t){super(t),Object.defineProperty(this,"connection",{enumerable:!1,writable:!1,value:e}),this.rawResult=void 0}addAttrsForCachedEntity(){if(!this.connection||!this.connection.domain)return;const e=this.connection.domain.get(this.entityName,!1);if(!e||!e.cacheType||"None"===e.cacheType)return;if(!0===this.__misc.__mip_disablecache)return;const t=t=>{if(!t)return;let n;n=t&&"["===t[0]?e.attributes[t.slice(1,-1)]:e.attributes[t],!n||this.fieldList.includes(n.name)||this.fieldList.includes(t)||this.attrs(n.name)};for(const e in this.whereList)t(this.whereList[e].expression);for(const e of this.orderList)t(e.expression)}selectAsObject(e){return this.selectAsArray().then((t=>o.selectResultToArrayOfObjects(t,e)))}selectAsArray(){return this.addAttrsForCachedEntity(),this.connection.select(this.ubql()).then((e=>(this.rawResult=e,e)))}selectAsArrayOfValues(){return this.selectAsArray().then((e=>e.resultData.data.map((e=>e[0]))))}selectAsStore(e){return this.selectAsObject(e)}select(e){return this.selectAsObject(e)}selectSingle(e){return this.selectAsObject(e).then((e=>(e.length>1&&console.error(this.CONSTANTS.selectSingleMoreThanOneRow),e[0])))}selectScalar(){return this.selectAsArray().then((e=>{const t=e.resultData.data.length;return t?(t>1&&console.error(this.CONSTANTS.selectScalarMoreThanOneRow),e.resultData.data[0][0]):void 0}))}selectById(e,t){return this.where("[ID]","=",e).selectSingle(t)}}},8338:function(e,t,n){const i=n(9274).LocalDataStore,o=n(9024);e.exports=class extends o{constructor(e,t){super(null,t),Object.defineProperty(this,"_localData",{enumerable:!1,writable:!1,value:e})}selectAsArray(){const e=this.ubql(),t=i.doFilterAndSort(this._localData,e),n=t.resultData;if(!e.fieldList.length||1===e.fieldList.length&&"*"===e.fieldList[0]||!n.data.length||_.isEqual(e.fieldList,n.fields))return Promise.resolve(t);{const t=n.fields,i=e.fieldList.map((e=>t.indexOf(e))),o=n.data.map((e=>i.map((t=>e[t]))));return Promise.resolve({resultData:{data:o,fields:e.fieldList,rowCount:o.length},total:n.total})}}clone(){const e=super.clone();return Object.defineProperty(e,"_localData",{enumerable:!1,writable:!1,value:this._localData}),e}}},4375:function(e){e.exports=i;const t={name:"UB",stores:["permanent","session","userData"],version:1},n="undefined"!=typeof window&&window.indexedDB;function i(e,i){if(this.dbName=e.toLowerCase(),!n)return this.__inMemoryCache={},this;const o=new Promise(((e,o)=>{const r=n.open(this.dbName,i||1);r.onerror=function(e){o(e)},r.onblocked=function(){o({errMsg:"databaseIsBlocked",errDetails:"we need to upgrade database, but some other browser tab also open it"})},r.onsuccess=function(){e(r.result)},r.onupgradeneeded=function(e){const n=e.target.result,i=e.target.transaction;console.debug(`upgrading database "${n.name}" from version ${e.oldVersion} to version ${e.newVersion}...`),t.stores.forEach((function(e){n.objectStoreNames.contains(e)?i.objectStore(e).clear():n.createObjectStore(e)}))}}));this.ready=function(){return o}}i.SESSION="session",i.PERMANENT="permanent",i.cacheTypes={None:"None",Entity:"Entity",Session:"Session",SessionEntity:"SessionEntity"},i.prototype.onTransactionComplete=function(e){},i.prototype.onTransactionAbort=function(e){window.console&&window.console.error("IDB transaction aborted: "+(e.target.error.message||e.target.errorCode))},i.prototype.onTransactionError=function(e){window.console&&window.console.error("IDB transaction failed: "+e.target.errorCode)},i.prototype.get=function(e,t="userData"){if(!n){const n=this.__inMemoryCache[t];return Promise.resolve(n?n[e]:void 0)}const i=this;return this.ready().then((function(n){const o=n.transaction([t],"readwrite");return o.oncomplete=i.onTransactionComplete,o.onabort=i.onTransactionAbort,o.onerror=i.onTransactionError,new Promise(((n,i)=>{const r=o.objectStore(t).get(e);r.onsuccess=function(){n(r.result)},r.onerror=function(){i({errMsg:r.error.name})}}))}))},i.prototype.getAllKeys=function(e="userData"){if(!n){const t=this.__inMemoryCache[e],n=[];if(t)for(const e in t)n.push(t[e]);return Promise.resolve(n)}const t=this;return this.ready().then((function(n){const i=n.transaction([e],"readwrite");return i.oncomplete=t.onTransactionComplete,i.onabort=t.onTransactionAbort,i.onerror=t.onTransactionError,new Promise(((t,n)=>{const o=[],r=i.objectStore(e).openCursor();r.onsuccess=function(e){const n=e.target.result;n?(o.push(n.key),n.continue()):t(o)},r.onerror=function(e){n(e.target.result)}}))}))},i.prototype.put=function(e,t="userData"){if(!n){let n=this.__inMemoryCache[t];return n||(n=this.__inMemoryCache[t]={}),Array.isArray(e)||(e=[e]),e.forEach((function(e){n[e.key]=void 0===e.value?null:e.value})),Promise.resolve(!0)}const i=this;return this.ready().then((function(n){const o=n.transaction([t],"readwrite");return o.oncomplete=i.onTransactionComplete,o.onabort=i.onTransactionAbort,o.onerror=i.onTransactionError,new Promise(((n,i)=>{let r;Array.isArray(e)?e.forEach((function(a,s){r=o.objectStore(t).put(void 0===a.value?null:a.value,a.key),r.onerror=function(e){i(e.target.result)},r.onsuccess=function(t){s===e.length-1&&n(t.target.result)}})):(r=o.objectStore(t).put(void 0===e.value?null:e.value,e.key),r.onsuccess=r.onerror=function(e){n(e.target.result)})}))}))},i.prototype.clear=function(e="userData"){if(!n)return this.__inMemoryCache[e]={},Promise.resolve(!0);const t=this;return this.ready().then((function(n){const i=n.transaction([e],"readwrite");return i.oncomplete=t.onTransactionComplete,i.onabort=t.onTransactionAbort,i.onerror=t.onTransactionError,new Promise(((t,n)=>{const o=i.objectStore(e).clear();o.onsuccess=function(e){t(e.target.result)},o.onerror=function(e){n(e.target.result)}}))}))},i.prototype.remove=function(e,t="userData"){if(!n){const n=this.__inMemoryCache[t];return n&&(Array.isArray(e)?delete n[e]:e.forEach((function(e){delete n[e]}))),Promise.resolve(!0)}const i=this;return this.ready().then((function(n){const o=n.transaction([t],"readwrite");return o.oncomplete=i.onTransactionComplete,o.onabort=i.onTransactionAbort,o.onerror=i.onTransactionError,new Promise(((n,i)=>{let r;"string"==typeof e?(r=o.objectStore(t).delete(e),r.onsuccess=r.onerror=function(e){n(e.target.result)}):Array.isArray(e)?e.length?e.forEach((function(a,s){r=o.objectStore(t).delete(a),r.onerror=function(e){i(e.target.result)},r.onsuccess=function(t){s===e.length-1&&n(t.target.result)}})):n(!0):i({errMsg:"invalid key for UBCache.remove call"})}))}))},i.prototype.removeIfMach=function(e,t){const n=this;return n.getAllKeys(t).then((function(i){const o=i.filter((t=>e.test(t)));return n.remove(o,t)}))}},9597:function(e,t,n){e.exports=s;const i=n(5738),o=n(6855).i18n,r=n(8134),a={host:"none",UIName:"NMUBExtension",minVersion:"1.0.0",installer:"pgffhmifenmomiabibdpnceahangimdi"};function s(e){const t=this;let n=0;if(t.getMessageId=function(){return"m"+ ++n},t._cfg=Object.assign({},e),++s.prototype.idCounter,t.id="UBPlugin"+s.prototype.idCounter,t.pendingMessages={},!t._cfg.host)throw new Error("Host not defined in UBNativeMessage feature config");if(r.call(t),Object.assign(t,r.prototype),t.featureVersion="",t.callTimeOut=3e4,i.isSecureBrowser)t.eventElm={},r.call(t.eventElm),Object.assign(t.eventElm,r.prototype),t.eventElm.addEventListener=t.eventElm.addListener;else if(t.eventElm=document.getElementById("ubExtensionPageMessageObj"),!(t.eventElm||window.parent&&window.parent!==window))throw new Error('Message exchange element with id="ubExtensionPageMessageObj" not found');t.onContentMessage=function(e){const n=e.detail;if(n&&n.hasOwnProperty("msgType")&&n.hasOwnProperty("messageID")&&n.hasOwnProperty("clientID")||console.error("Empty or invalid content message"),-1===n.messageID&&(""===n.clientID||n.clientID===t._cfg.host)&&(n.msgType="reject")){const e=Object.keys(t.pendingMessages)[0];let n=t.pendingMessages[e];if(n?delete t.pendingMessages[e]:n=t.__FFLastMsg,!n)return;return clearTimeout(n.timerID),void t.onMsgTimeOut(n)}if(n.clientID!==t.id)return;const o=n.messageID,r=n.msgType;let a=n.data;const s=t.pendingMessages[o];if(s&&clearTimeout(s.timerID),"disconnected"===r)s&&(delete t.pendingMessages[o],s.deffer.resolve(a)),t.doOnDisconnect(a);else if("notify"===r)!s&&t.onMessage?t.onMessage(a):(s.timerID=setTimeout((function(){t.onMsgTimeOut(o)}),s.timeoutValue),t.emit("notify",t,a,o));else if(s)if("resolve"===r)if(n.hasOwnProperty("part")&&n.hasOwnProperty("totalParts")){const e=n.totalParts,r=n.part;if(s.partials){if(e!==s.partials.length||r>=e)throw s.deffer.reject("Invalid part count"),delete t.pendingMessages[o],new Error("Invalid part count")}else{if(e>100)throw s.deffer.reject(new i.UBError("unknownError","UBNativeMessage. Result exceed 100Mb limit")),delete t.pendingMessages[o],new Error(new i.UBError("unknownError","UBNativeMessage. Result exceed 100Mb limit"));s.partials=new Array(e)}s.partials[r]=a,s.partials.includes(void 0)?s.timerID=setTimeout((function(){t.onMsgTimeOut(o)}),s.timeoutValue):(a=s.partials.join(""),delete t.pendingMessages[o],"{"!==a.charAt(0)&&"["!==a.charAt(0)||(a=JSON.parse(a)),s.deffer.resolve(a))}else delete t.pendingMessages[o],s.deffer.resolve(a);else{if("reject"!==r)throw new Error("UBNativeMessage. Invalid msgType type in: "+n);{delete t.pendingMessages[o];let e=!1;/<<<.*>>>/.test(a)&&(a=a.match(/<<<(.*)>>>/)[1],e=!0);const n=e?new i.UBError(a):new i.UBError("unknownError",a);s.deffer.reject(n)}}else console.error("UBNativeMessage. unknown messageID:"+o)},t.eventElm.addEventListener("UBExtensionMsg",t.onContentMessage),t.onDisconnected=null,t.onMessage=null,t.targetOrign="*",t.targetPage=void 0}function l(e){const t=e.split(".");if(t.length>4)throw new Error("Invalid version number "+e);let n=1,i=0;const o=t.length;for(let e=o-1;e>=0;e--)i+=parseInt(t[e],10)*n,n*=e===o-1?1e4:1e3;return i}function c(e,t,n){const r=i.format(e.installer,e.minVersion),a=i.isOpera?"Opera":i.isChrome?"Chrome":"Firefox",s="NM"+(n?"Update":"Install")+("none"===e.host?"Extension"+a:"Feature");return i.format(o(s),o(e.UIName),e.minVersion,t,r)}s.prototype.invoke=function(e,t,n){const o=this;if(!o.connected&&"__"!==e.substr(0,2))return Promise.reject(new i.UBError("unknownError","UBNativeMessage. Not connected. call connect() first"));n=n||o.callTimeOut;const r=o.getMessageId(),a={clientID:o.id,messageID:r,method:e,params:t};return new Promise(((e,t)=>{o.pendingMessages[r]={request:null,deffer:{resolve:e,reject:t},timerID:setTimeout((function(){o.onMsgTimeOut(r)}),n),partials:null,timeoutValue:n||o.callTimeOut,stTime:Date.now()},o.__FFLastMsg=o.pendingMessages[r],o.iFarmeMode?o.targetPage.postMessage({detail:a,messageType:"UBPageMsg"},o.targetOrign):o.eventElm.dispatchEvent(new CustomEvent("UBPageMsg",{detail:a}))}))},s.extensionExists=function(){if(i.isSecureBrowser)return!0;const e=document.getElementById("ubExtensionPageMessageObj");return!(!window.parent||window.parent===window)||!!e&&"YES"===e.getAttribute("data-extensionAttached")},s.prototype.doOnDisconnect=function(e){const t=this,n=t.pendingMessages;t.pendingMessages={},t.connected=!1,n&&Object.keys(n).forEach((function(t){t&&t.deffer&&t.deffer.reject(e)}))},s.prototype.onParentWinMessage=function(e){e.data&&"UBExtensionMsg"===e.data.messageType&&this.onContentMessage(e.data)},s.prototype.connect=function(e){const t=this;let n;return t.connected?Promise.resolve(t):s.extensionExists()?(window.parent&&window.parent!==window?(t.targetOrign=new URL(document.referrer).origin,t.targetPage=window.parent,n=new Promise(((e,n)=>{let o;const r=function(s){return s.data&&"initUbExtensionParent"===s.data.messageType?(clearTimeout(o),"initUbExtensionReady"!==s.data.detail?(n(new i.UBError(c(a,"-",!1))),s):(t.iFarmeMode=!0,window.removeEventListener("message",r),window.addEventListener("message",t.onParentWinMessage.bind(t),!1),void e(!0))):s};window.addEventListener("message",r,!1),t.targetPage.postMessage({messageType:"initUbExtension"},t.targetOrign),o=setTimeout((function(){n(new i.UBError(c(a,"-",!1)))}),1500)}))):n=Promise.resolve(!0),n.then((function(){return t.invoke("__extensionVersion")})).then((function(e){const t=l(e);if(t<l(a.minVersion))throw i.logDebug("browser extension version",e,"smaller than required",a.minVersion),new i.UBError(c("extension",e,!0));return t!==l(a.minVersion)&&i.logDebug("Current extension version",e,"higher than required",a.minVersion),!0})).then((function(){return t.invoke("__connect",{hostAppName:t._cfg.host},e).then((function(e){const n=t._cfg.minVersion;if(t.connected=!0,t.featureVersion=e,l(e)<l(n))throw new i.UBError(c(t._cfg,e,!0));return e!==n&&i.logDebug("Current feature version",t._cfg.host,e,"higher than required",n),t}),(function(e){throw i.logError(e),new i.UBError(c(t._cfg,"-",!1))}))})).catch((function(e){throw t.disconnect(),e}))):Promise.reject(new i.UBError(c(a,"-",!1)))},s.prototype.disconnect=function(){const e=this;return e.connected?e.invoke("__disconnect").then((function(t){return i.logDebug("UBNativeMessage. Disconnected with message",t),e.connected=!1,e.eventElm&&e.eventElm.removeEventListener("UBExtensionMsg",e.onContentMessage),!0})):Promise.resolve(!0)},s.prototype.onMsgTimeOut=function(e){let t;"string"==typeof e?(t=this.pendingMessages[e],t&&delete this.pendingMessages[e]):t=e,t&&(t.timerID=null,t.deffer.reject(new i.UBError("unknownError","pluginMethodCallTimedOut")))},s.prototype.idCounter=0},1810:function(e,t,n){e.exports=function(e){var t=this,n=-1!==e.supportedWSProtocols.indexOf(o)&&"undefined"!=typeof WebSocket;this.supported=n,i.call(this),Object.assign(this,i.prototype);var r=function(){},a=!1;Object.defineProperty(t,"debugMode",{get:function(){return a},set:function(e){a!==e&&(r=(a=e)?console.debug.bind(console,"ubNotifier"):function(){})},enumerable:!0,configurable:!0});var s="ws"+e.serverUrl.slice(4)+"ws",l=null,c=!1,u=[];this.sendCommand=function(e,t){n&&(c?l.send(JSON.stringify({command:e,params:t})):(u.push({command:e,params:t}),u.length>100&&u.shift()))},e.on("authorized",(function(i,a){c=!1,-1!==e.supportedWSProtocols.indexOf(o)&&function(e){n&&((l=new WebSocket(s+"?SESSION_SIGNATURE="+e.signature(),"ubNotifier")).onopen=function(e){r("connected to",e.target.url,"protocol:",e.target.protocol),t.emit("connected",e.target.url,e.target.protocol)},l.onmessage=function(e){var n;r("Got a raw data",e.data);try{n=JSON.parse(e.data)}catch(t){console.error("ubNotifier: Invalid command from server:",e.data)}var i,o=n.command,a=n.params;switch(r("Got a command",o,"with params",a),o){case"accepted":for(c=!0;(i=u.shift())&&c;)t.sendCommand(i.command,i.params);u=[],t.emit("accepted",a.connectionID);break;case"error":r("Got an error from server",a),t.emit("error",a);break;default:r("Emit event ",o,"with params",a),t.emit(o,a)}},l.onclose=function(e){c=!1,r("Connection closed. Code:",e.code,"Reason:",e.reason),t.emit("disconnected",e.code,e.reason)})}(a)}))},n(6486);const i=n(8134),o="ubNotifier"},8134:function(e){function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function i(e,t,n){if(t)e.call(n);else{const t=e.length,i=h(e,t);for(let e=0;e<t;++e)i[e].call(n)}}function o(e,t,n,i){if(t)e.call(n,i);else{const t=e.length,o=h(e,t);for(let e=0;e<t;++e)o[e].call(n,i)}}function r(e,t,n,i,o){if(t)e.call(n,i,o);else{const t=e.length,r=h(e,t);for(let e=0;e<t;++e)r[e].call(n,i,o)}}function a(e,t,n,i,o,r){if(t)e.call(n,i,o,r);else{const t=e.length,a=h(e,t);for(let e=0;e<t;++e)a[e].call(n,i,o,r)}}function s(e,t,n,i){if(t)e.apply(n,i);else{const t=e.length,o=h(e,t);for(let e=0;e<t;++e)o[e].apply(n,i)}}function l(e){if("function"!=typeof e)throw new TypeError("listener must be a function")}function c(e,t,i,o){let r,a,s;return l(i),a=e._events,a?(a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]):(a=e._events={},e._eventsCount=0),s?("function"==typeof s?s=a[t]=o?[i,s]:[s,i]:o?s.unshift(i):s.push(i),s.warned||(r=n(e),r&&r>0&&s.length>r&&(s.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.",s.length,t),console.trace()))):(s=a[t]=i,++e._eventsCount),e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){const i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=u.bind(i);return o.listener=n,i.wrapFn=o,o}function f(e){const t=this._events;if(t){const n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function h(e,t){const n=new Array(t);for(;t--;)n[t]=e[t];return n}t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=20,t.init=function(){this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={},this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){let t,n,l,c,u,d,f="error"===e;if(d=this._events,d)f=f&&null==d.error;else if(!f)return!1;if(f){if(t=arguments[1],t instanceof Error)throw t;{const e=new Error('Uncaught, unspecified "error" event. ('+t+")");throw e.context=t,e}}if(n=d[e],!n)return!1;const h="function"==typeof n;switch(l=arguments.length,l){case 1:i(n,h,this);break;case 2:o(n,h,this,arguments[1]);break;case 3:r(n,h,this,arguments[1],arguments[2]);break;case 4:a(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(c=new Array(l-1),u=1;u<l;u++)c[u-1]=arguments[u];s(n,h,this,c)}return!0},t.prototype.addListener=function(e,t){return c(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return c(this,e,t,!0)},t.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},t.prototype.removeListener=function(e,t){let n,i,o,r;if("function"!=typeof t)throw new TypeError("listener must be a function");if(i=this._events,!i)return this;if(n=i[e],!n)return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events={}:(delete i[e],i.removeListener&&this.emit("removeListener",e,t));else if("function"!=typeof n){for(o=-1,r=n.length;r-- >0;)if(n[r]===t||n[r].listener&&n[r].listener===t){o=r;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events={},this;delete i[e]}else!function(e,t){let n=t,i=n+1;const o=e.length;for(;i<o;n+=1,i+=1)e[n]=e[i];e.pop()}(n,o);i.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){let t,n;if(n=this._events,!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events={},this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events={}:delete n[e]),this;if(0===arguments.length){const e=Object.keys(n);let t,i=0;for(;i<e.length;++i)t=e[i],"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this._eventsCount=0,this}if(t=n[e],"function"==typeof t)this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},t.prototype.listeners=function(e){let t,n;const i=this._events;return i?(t=i[e],n=t?"function"==typeof t?[t]:h(t,t.length):[]):n=[],n},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},t.prototype.listenerCount=f,e.exports=t},6855:function(e,t,n){const i=n(6486),o={monkeyRequestsDetected:"Your request has been processed, but we found that it is repeated several times. Maybe you key fuse?"},r=/{([0-9a-zA-Z_]+)(?::([^\}]+))?}/g,a=/^(\w+)(\.(\w+))?(#(documentation|description))?$/;function s(e,t){if(e[t])return e[t];let n=t.split("."),i=0,o=n.length;do{e=e[n[i++]]}while(i<o&&"object"==typeof e);return i===o?e:void 0}e.exports.i18n=function e(t,...n){if(null==t)return t;if("string"!=typeof t)return"i18n: expect string but got "+JSON.stringify(t);let i=s(o,t);if(void 0===i&&(i=function(e){if("undefined"==typeof $App)return e;if(null==$App.domainInfo)return e;const t=a.exec(e);if(!t)return e;const[,n,,i,,r="caption"]=t,s=$App.domainInfo.entities[n];if(!s)return e;if(void 0===i)return o[e]=s[r],s[r];let l=s.attributes[i];return l?(o[e]=l[r],l[r]):e}(t)),n&&n.length&&"string"==typeof i){if(1===n.length&&"object"==typeof n[0]){let t=n[0];return i.replace(r,(function(n,i,o){let r=s(t,i);return o&&"i18n"===o&&(r=e(r)),r}))}return i.replace(r,(function(t,i,o){let r=n[i];return o&&"i18n"===o&&(r=e(r)),r}))}return i},e.exports.i18nExtend=function(e){return i.merge(o,e)}},3874:function(e){const t={},n="undefined"!=typeof document&&document.getElementsByTagName("head")[0];e.exports.inject=function(e,i){let o;return o=t[e]?t[e]:t[e]=new Promise((function(o,a){let s=null;const l=/\.css(?:\?|$)/.test(e);l?(s=document.createElement("link"),s.rel="stylesheet",s.async=!0):(s=document.createElement("script"),s.type="text/javascript",i&&(s.charset=i),s.async=!0),s.onerror=function(n){const i="Required "+(n.target.href||n.target.src)+" is not accessible";delete t[e],s.onerror=s.onload=s.onreadystatechange=null,a(new Error(i))},s.onload=function(){s.onerror=s.onload=s.onreadystatechange=null,setTimeout((function(){const e=s;o(),e.parentNode&&!e.rel&&(e.parentNode.removeChild(s),s=null)}),0)},n.appendChild(s),l?s.href=r(e):s.src=r(e)})),o};const i="undefined"!=typeof window&&window.__ubVersion,o=new RegExp("models/(.+?)/");function r(e){const t=function(e){const t=o.test(e)?o.exec(e)[1]:"_web";return i&&i[t]?"ubver="+i[t]:""}(e);if(!t)return e;const n=-1===e.indexOf("?")?"?":"&";return e+n+t}e.exports.addResourceVersion=r},645:function(e,t,n){const i=n(5738);function o(e){return(e||"").toLowerCase()}function r(e){let t="object"==typeof e?e:void 0;return function(n){return t||(t=function(e){const t={};let n,i,r;return e?(e.split("\n").forEach((function(e){r=e.indexOf(":"),n=o(e.substr(0,r).trim()),i=e.substr(r+1).trim(),n&&(t[n]?t[n]+=", "+i:t[n]=i)})),t):t}(e)),n?t[o(n)]:t}}function a(e){return e>=200&&e<300}function s(e,t,n){const i=Object.keys(e);return i.forEach((function(i){t.call(n,e[i],i)})),i}function l(e,t){if(!t)return e;const n=[];return i=t,o=function(e,t){null!=e&&(Array.isArray(e)||(e=[e]),e.forEach((function(e){"object"==typeof e&&(e=JSON.stringify(e)),n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))})))},Object.keys(i).sort().forEach((function(e){o.call(void 0,i[e],e)})),e+(-1===e.indexOf("?")?"?":"&")+n.join("&");var i,o}let c,u,d=Date.now();function f(e){const t=p,n={transformRequest:t.transformRequest,transformResponse:t.transformResponse};let f,h=function(e){let n=t.headers;const r=i.apply({},e.headers);let a,l,c;const u=function(e){s(e,(function(t,n){if("function"==typeof t){const i=t();i?e[n]=i:delete e[n]}}))};n=i.apply({},n.common,n[o(e.method)]),u(n),u(r);e:for(a in n){for(c in l=o(a),r)if(o(c)===l)continue e;r[a]=n[a]}return r}(e);i.apply(n,e),n.headers=h,n.method=n.method?n.method.toUpperCase():"GET";const x=function(e){return function(e,t,n){let i=Promise.resolve(e);return"function"==typeof n?i.then((function(e){return n(e,t)})):(n.forEach((function(e){i=i.then((function(n){return e(n,t)}))})),i)}(e.data,e.headers,n.transformResponse).then((function(t){return e.data=t,a(e.status)?e:Promise.reject(e)}))};return f=Promise.resolve(n),m.filter((function(e){return!!e.request||!!e.requestError})).map((function(e){return{success:e.request,failure:e.requestError}})).concat({success:function(e){h=e.headers;const n=function(e,t,n){return"function"==typeof n?n(e,t):(n.forEach((function(n){e=n(e,t)})),e)}(e.data,r(h),e.transformRequest);if(e.data){if(!i.isNodeJS){const t=d;if(d=Date.now(),u===e.url&&"string"==typeof n&&c===n&&d-t<100)throw i.logError("Quite the same request repeated 2 or more times in the last 100ms (so called monkey request). The request is",n),new i.UBError("monkeyRequestsDetected");c=n,u=e.url}}else s(h,(function(e,t){"content-type"===o(t)&&delete h[t]}));return!e.withCredentials&&t.withCredentials&&(e.withCredentials=t.withCredentials),!e.timeout&&t.timeout&&(e.timeout=t.timeout),function(e,t,n){const i=l(e.url,e.params);return new Promise((function(o,l){let c=new y;let u,d;g.push(e),c.open(e.method,i,!0),s(n,(function(e,t){e&&c.setRequestHeader(t,e)})),c.onreadystatechange=function(){if(4===c.readyState){let t,n;-1!==u&&(n=c.getAllResponseHeaders(),t=c.responseType?c.response:c.responseText),d&&clearTimeout(d),u=u||c.status,c=null,u=Math.max(1223===u?204:u,0);const i=g.indexOf(e);-1!==i&&g.splice(i,1),(a(u)?o:l)({data:t,status:u,headers:r(n),config:e})}},e.onProgress&&(c.upload?c.upload.onprogress=e.onProgress:c.onprogress=e.onProgress),e.withCredentials&&(c.withCredentials=!0),e.responseType&&(c.responseType=e.responseType),c.send(t||null),e.timeout>0&&(d=setTimeout((function(){u=-1,c&&c.abort()}),e.timeout))}))}(e,n,h).then(x,x)}}).concat(m.filter((function(e){return!!e.response||!!e.responseError})).map((function(e){return{success:e.response,failure:e.responseError}}))).forEach((function(e){f=f.then(e.success,e.failure)})),f}f.allowRequestReiteration=function(){c=null};const h={"Content-Type":"application/json;charset=utf-8"},p={transformRequest:function(e){return!e||"object"!=typeof e||e instanceof File||e instanceof ArrayBuffer||e.buffer instanceof ArrayBuffer?e:JSON.stringify(e)},transformResponse:function(e,t){return e&&"string"==typeof e&&(t("content-type")||"").indexOf("json")>=0&&(e=JSON.parse(e)),e},headers:{common:{Accept:"application/json, text/plain, */*"},post:h,put:h,patch:h},timeout:i.isReactNative?5e3:12e4},m=[],g=[],y=XMLHttpRequest;e.exports={interceptors:m,pendingRequests:g,xhrDefaults:p,xhr:f,get:function(e,t){return f(i.apply(t||{},{method:"GET",url:e}))},post:function(e,t,n){return f(i.apply(n||{},{method:"POST",url:e,data:t}))}}},1972:function(e,t,n){const i=n(6855),o=n(5738),r=n(645),a=n(995),s=n(3874),l=n(9024),c=n(8338),u=n(4375),d=n(9274).LocalDataStore,f=d.iso8601ParseAsDate,h=d.truncTimeToUtcNull,p=n(9274).formatByPattern,m=n(2875),g=n(245),y=n(6656),x=(n(7830),n(9597));let b=null,v=null;const E=e.exports={i18n:i.i18n.bind(i),i18nExtend:function(e){return i.i18nExtend(e)},format:function(e,...t){return o.format(e,...t)},formatter:p,apply:function(e,...t){return o.apply(e,...t)},ns:function(e){return o.ns(e)},booleanParse:function(e){return o.booleanParse(e)},iso8601Parse:function(e){return o.iso8601Parse(e)},iso8601ParseAsDate:f,truncTimeToUtcNull:h,base64FromAny:function(e){return o.base64FromAny(e)},file2Uint8Array:function(e){return o.file2Uint8Array(e)},base64toArrayBuffer:function(e){return o.base64toArrayBuffer(e)},UBError:o.UBError,UBAbortError:o.UBAbortError,log:o.log,logError:o.logError,logWarn:o.logWarn,logDebug:o.logDebug,xhr:function(e){return r.xhr(e)},get:function(e,t){return r.get(e,t)},post:function(e,t,n){return r.post(e,t,n)},UBNativeMessage:x,UBConnection:a,UBCache:u,connect:function(e){return a.connect(e,this).then((e=>(v&&v.$i18n&&(v.$i18n.locale=e.userLang()),this.Repository=function(t){return"string"==typeof t?new l(e,t):new l(e,"").fromUbql(t)},e)))},connection:null,ClientRepository:l,Repository:function(e){throw new Error("function defined only after connect()")},LocalRepository:function(e,t){return new c(e,t)},setErrorReporter:function(e){b=e},showErrorWindow:function(e,t,n,i){let r;try{r=o.parseUBError(e,t,n,i),b?b(r):this.userAgent&&"undefined"!=typeof window?window.alert(r.errMsg):"undefined"!=typeof console&&console.error(r.errMsg,r.detail)}catch(e){console.error(e)}},appConfig:null,LocalDataStore:d,userAgent:o.userAgent,isChrome:o.isChrome,isWebKit:o.isWebKit,isGecko:o.isGecko,isOpera:o.isOpera,isMac:o.isMac,isSecureBrowser:o.isSecureBrowser,isReactNative:o.isReactNative,inject:function(e,t){return s.inject(e,t)},addResourceVersion:s.addResourceVersion,CryptoJS:m,SHA256:g,MD5:y,LDS_KEYS:o.LDS_KEYS,ux:{},view:{},core:{},Utils:{},LIMITS:{lookupMaxRows:1e4,lookupWarningRows:2500}};E.xhr.allowRequestReiteration=r.xhr.allowRequestReiteration,E.xhr.defaults=r.xhrDefaults,E.install=function(e){v=e,e.prototype.$UB=E,e.prototype.$ut=E.i18n,e.filter("i18n",E.i18n)};let w=!1,C=null;var I;I=e.exports,"undefined"==typeof window||I.isReactNative||w||(w&&console.error("module @unitybase/ub-pub imported several times. This is wrong situation and should be fixed by app developer. Try `npm ddp`"),w=!0,window.onerror&&(C=window.onerror),window.Q&&window.Q.getBluebirdPromise&&(window.Q.onerror=function(e){window.onerror.apply(I,["","","","",e])}),window.addEventListener("unhandledrejection",(function(e){e.preventDefault();const t=e.detail?e.detail.reason:e.reason,n=e.detail?e.detail.promise:e.promise;window.onerror&&window.onerror.apply(I,["","","","",t]),console.error("UNHANDLED",t,n)})),window.onerror=function(t,n,i,r,a){let s,l="";if(a&&o.UBAbortError&&a instanceof o.UBAbortError)return void console.log(a);let c=a&&o.UBError&&a instanceof o.UBError;if(a&&Error&&a instanceof Error?(s=a.message,l="",n&&!1===/q\.js/.test(n)&&(l+='file: "'+n+'" line: '+i),l+=(a.stack||"").replace(/\?ubver=\w*/g,"").replace(/\?ver=\w*/g,"").replace(/\\n(?!\d)/g,"\n\t"),l=l.replace(new RegExp(window.location.origin.replace(/:/g,"\\$&"),"g"),""),l=l.replace(/\/[\w-]+(\.js)?:/g,"<b>$&</b>&nbsp;line "),l=l.replace(/\n/g,"<br>&nbsp;&nbsp;")):a&&a.data&&a.data.errMsg?s=a.data.errMsg:a&&0===a.status?(s="serverIsBusy",c=!0):a&&a.errMsg?(s=a.errMsg,l=a.detail?a.detail:s):s=a&&"string"==typeof a?a:t,a&&a.detail&&(l=a.detail.replace(/\\n(?!\d)/g,"\n\t\t")+(l?"<br/>"+l:""),"Method Not Allowed"===a.detail&&(s="recordNotExistsOrDontHaveRights")),s||(s="internalServerError"),!c){if("string"==typeof s&&s.startsWith("ResizeObserver"))return void console.warn(s);l=l?`<h4>${s}</h4>${l}`:s,s="unknownError"}try{e.exports.showErrorWindow(s,"","",l)}catch(e){window.alert(s)}C&&C.apply(this,arguments)}),"undefined"!=typeof SystemJS&&(SystemJS.has("@unitybase/cryptojs")||SystemJS.set("@unitybase/cryptojs",SystemJS.newModule(m)),SystemJS.has("@unitybase/ub-pub")||SystemJS.set("@unitybase/ub-pub",SystemJS.newModule(e.exports)))},5738:function(e,t,n){const i=n(6855);e.exports.apply=function(e,t){return Array.prototype.forEach.call(arguments,(function(t){t&&t!==e&&Object.keys(t).forEach((function(n){e[n]=t[n]}))})),e};const o=/{(\d+)}/g;e.exports.format=function(e,...t){return e.replace(o,(function(e,n){return t[n]}))},e.exports.ns=function(e){let t,n,i,o,r=window;for(t=e.split("."),i=0,o=t.length;i<o;i++)n=t[i],r[n]||(r[n]={}),r=r[n];return r},e.exports.iso8601Parse=function(e){return e?new Date(e):null},e.exports.booleanParse=function(e){return"boolean"==typeof e?e:null==e||""===e?null:1===e},e.exports.base64FromAny=function(e){return new Promise(((t,n)=>{const i=new FileReader,o=e instanceof Blob?e:new Blob([e]);i.addEventListener("loadend",(function(){t(i.result.split(",",2)[1])})),i.addEventListener("error",(function(e){n(e)})),i.readAsDataURL(o)}))},e.exports.file2Uint8Array=function(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=function(){t(new Uint8Array(i.result))},i.onerror=function(e){n(e)},i.readAsArrayBuffer(e)}))};const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=[];!function(){for(let e=0,t=r.length-1;e<t;e++)a.push(r[e])}();const s=new Uint8Array(256);function l(e,t,n){this.name="UBError",this.detail=t,this.code=n,this.message=e||"UBError",Error.captureStackTrace?Error.captureStackTrace(this,l):this.stack=(new Error).stack}function c(e,t){this.name="UBAbortError",this.detail=t,this.code="UBAbortError",this.message=e||"UBAbortError",Error.captureStackTrace?Error.captureStackTrace(this,c):this.stack=(new Error).stack}!function(){for(let e=0,t=r.length;e<t;e++)s[r[e].charCodeAt(0)]=e}(),e.exports.base64toArrayBuffer=function(e){let t=.75*e.length;const n=e.length;let i,o,r,a,l=0;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);const c=new ArrayBuffer(t),u=new Uint8Array(c);for(let t=0;t<n;t+=4)i=s[e.charCodeAt(t)],o=s[e.charCodeAt(t+1)],r=s[e.charCodeAt(t+2)],a=s[e.charCodeAt(t+3)],u[l++]=i<<2|o>>4,u[l++]=(15&o)<<4|r>>2,u[l++]=(3&r)<<6|63&a;return c},l.prototype=new Error,l.prototype.constructor=l,e.exports.UBError=l,c.prototype=new Error,c.prototype.constructor=c,e.exports.UBAbortError=c,e.exports.parseUBError=function(e,t,n,o){let r=o||"";return e&&e instanceof l?(t=e.code,r=e.detail,e.stack&&(r+="<br/>stackTrace:"+e.stack),e=e.message):e instanceof Error?(e.stack&&(r+="<br/>stackTrace:"+e.stack),e=e.toString()):e&&"object"==typeof e&&(t=e.errCode,n=e.entity,r=(e=e.errMsg?e.errMsg:JSON.stringify(e)).detail||r),{errMsg:i.i18n(e),errCode:t,entityCode:n,detail:r}},e.exports.log=function(e){console&&console.log.apply(console,arguments)},e.exports.logError=function(e){console&&console.error.apply(console,arguments)},e.exports.logWarn=function(e){console&&console.warn.apply(console,arguments)},e.exports.logDebug=console.info.bind(console);const u="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"nodeJS";e.exports.userAgent=u.toLowerCase(),e.exports.isChrome=/\bchrome\b/.test(u),e.exports.isWebKit=/webkit/.test(u),e.exports.isGecko=!/webkit/.test(u)&&/gecko/.test(u),e.exports.isOpera=/opr|opera/.test(u),e.exports.isMac=/macintosh|mac os x/.test(u),e.exports.isSecureBrowser=/\belectron\b/.test(u),e.exports.isReactNative="undefined"!=typeof navigator&&"ReactNative"===navigator.product,e.exports.isNodeJS=/nodeJS/.test(u),e.exports.LDS_KEYS={LAST_AUTH_SCHEMA:"lastAuthType",SILENCE_KERBEROS_LOGIN:"silenceKerberosLogin",LAST_LOGIN:"lastLogin",USER_DID_LOGOUT:"userDidLogout",PREVENT_CALL_LOGOUT_ON_UNLOAD:"preventLogoutOnUnload",PREFERRED_LOCALE:"preferredLocale"}},8598:function(e,t,n){var i,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,u,d){d||(t=c(t));var f,h=this,p="application/octet-stream"===t.type,m=function(){!function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,e)}catch(e){s(e)}}}(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,o)return f=n().createObjectURL(t),void setTimeout((function(){var e,t;i.href=f,i.download=u,e=i,t=new MouseEvent("click"),e.dispatchEvent(t),m(),l(f),h.readyState=h.DONE}));!function(){if((a||p&&r)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=a?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,h.readyState=h.DONE,m()},i.readAsDataURL(t),void(h.readyState=h.INIT)}f||(f=n().createObjectURL(t)),p?e.location.href=f:e.open(f,"_blank")||(e.location.href=f),h.readyState=h.DONE,m(),l(f)}()},d=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,t,n){return new u(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=o:null!==n.amdD&&null!==n.amdO&&(void 0===(i=function(){return o}.call(t,n,t,e))||(e.exports=i))},6486:function(e,t,n){var i;e=n.nmd(e),function(){var o,r="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",l=32,c=128,u=1/0,d=9007199254740991,f=NaN,h=4294967295,p=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",l],["partialRight",64],["rearg",256]],m="[object Arguments]",g="[object Array]",y="[object Boolean]",x="[object Date]",b="[object Error]",v="[object Function]",E="[object GeneratorFunction]",w="[object Map]",C="[object Number]",I="[object Object]",S="[object Promise]",B="[object RegExp]",D="[object Set]",A="[object String]",T="[object Symbol]",k="[object WeakMap]",U="[object ArrayBuffer]",L="[object DataView]",_="[object Float32Array]",F="[object Float64Array]",P="[object Int8Array]",M="[object Int16Array]",N="[object Int32Array]",R="[object Uint8Array]",O="[object Uint8ClampedArray]",V="[object Uint16Array]",j="[object Uint32Array]",W=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,$=/[&<>"']/g,G=RegExp(q.source),K=RegExp($.source),Y=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,ne=RegExp(te.source),ie=/^\s+|\s+$/g,oe=/^\s+/,re=/\s+$/,ae=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,se=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ue=/\\(\\)?/g,de=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fe=/\w*$/,he=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,me=/^\[object .+?Constructor\]$/,ge=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,xe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be=/($^)/,ve=/['\n\r\u2028\u2029\\]/g,Ee="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="a-z\\xdf-\\xf6\\xf8-\\xff",Ce="A-Z\\xc0-\\xd6\\xd8-\\xde",Ie="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Se="["+Ie+"]",Be="["+Ee+"]",De="\\d+",Ae="["+we+"]",Te="[^\\ud800-\\udfff"+Ie+De+"\\u2700-\\u27bf"+we+Ce+"]",ke="\\ud83c[\\udffb-\\udfff]",Ue="[^\\ud800-\\udfff]",Le="(?:\\ud83c[\\udde6-\\uddff]){2}",_e="[\\ud800-\\udbff][\\udc00-\\udfff]",Fe="["+Ce+"]",Pe="(?:"+Ae+"|"+Te+")",Me="(?:"+Fe+"|"+Te+")",Ne="(?:['’](?:d|ll|m|re|s|t|ve))?",Re="(?:['’](?:D|LL|M|RE|S|T|VE))?",Oe="(?:"+Be+"|"+ke+")?",Ve="[\\ufe0e\\ufe0f]?",je=Ve+Oe+"(?:\\u200d(?:"+[Ue,Le,_e].join("|")+")"+Ve+Oe+")*",We="(?:"+["[\\u2700-\\u27bf]",Le,_e].join("|")+")"+je,He="(?:"+[Ue+Be+"?",Be,Le,_e,"[\\ud800-\\udfff]"].join("|")+")",ze=RegExp("['’]","g"),qe=RegExp(Be,"g"),$e=RegExp(ke+"(?="+ke+")|"+He+je,"g"),Ge=RegExp([Fe+"?"+Ae+"+"+Ne+"(?="+[Se,Fe,"$"].join("|")+")",Me+"+"+Re+"(?="+[Se,Fe+Pe,"$"].join("|")+")",Fe+"?"+Pe+"+"+Ne,Fe+"+"+Re,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",De,We].join("|"),"g"),Ke=RegExp("[\\u200d\\ud800-\\udfff"+Ee+"\\ufe0e\\ufe0f]"),Ye=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Xe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Je=-1,Qe={};Qe[_]=Qe[F]=Qe[P]=Qe[M]=Qe[N]=Qe[R]=Qe[O]=Qe[V]=Qe[j]=!0,Qe[m]=Qe[g]=Qe[U]=Qe[y]=Qe[L]=Qe[x]=Qe[b]=Qe[v]=Qe[w]=Qe[C]=Qe[I]=Qe[B]=Qe[D]=Qe[A]=Qe[k]=!1;var Ze={};Ze[m]=Ze[g]=Ze[U]=Ze[L]=Ze[y]=Ze[x]=Ze[_]=Ze[F]=Ze[P]=Ze[M]=Ze[N]=Ze[w]=Ze[C]=Ze[I]=Ze[B]=Ze[D]=Ze[A]=Ze[T]=Ze[R]=Ze[O]=Ze[V]=Ze[j]=!0,Ze[b]=Ze[v]=Ze[k]=!1;var et={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},tt=parseFloat,nt=parseInt,it="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,ot="object"==typeof self&&self&&self.Object===Object&&self,rt=it||ot||Function("return this")(),at=t&&!t.nodeType&&t,st=at&&e&&!e.nodeType&&e,lt=st&&st.exports===at,ct=lt&&it.process,ut=function(){try{return st&&st.require&&st.require("util").types||ct&&ct.binding&&ct.binding("util")}catch(e){}}(),dt=ut&&ut.isArrayBuffer,ft=ut&&ut.isDate,ht=ut&&ut.isMap,pt=ut&&ut.isRegExp,mt=ut&&ut.isSet,gt=ut&&ut.isTypedArray;function yt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function xt(e,t,n,i){for(var o=-1,r=null==e?0:e.length;++o<r;){var a=e[o];t(i,a,n(a),e)}return i}function bt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function vt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Et(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function wt(e,t){for(var n=-1,i=null==e?0:e.length,o=0,r=[];++n<i;){var a=e[n];t(a,n,e)&&(r[o++]=a)}return r}function Ct(e,t){return!(null==e||!e.length)&&_t(e,t,0)>-1}function It(e,t,n){for(var i=-1,o=null==e?0:e.length;++i<o;)if(n(t,e[i]))return!0;return!1}function St(e,t){for(var n=-1,i=null==e?0:e.length,o=Array(i);++n<i;)o[n]=t(e[n],n,e);return o}function Bt(e,t){for(var n=-1,i=t.length,o=e.length;++n<i;)e[o+n]=t[n];return e}function Dt(e,t,n,i){var o=-1,r=null==e?0:e.length;for(i&&r&&(n=e[++o]);++o<r;)n=t(n,e[o],o,e);return n}function At(e,t,n,i){var o=null==e?0:e.length;for(i&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function Tt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var kt=Nt("length");function Ut(e,t,n){var i;return n(e,(function(e,n,o){if(t(e,n,o))return i=n,!1})),i}function Lt(e,t,n,i){for(var o=e.length,r=n+(i?1:-1);i?r--:++r<o;)if(t(e[r],r,e))return r;return-1}function _t(e,t,n){return t==t?function(e,t,n){for(var i=n-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}(e,t,n):Lt(e,Pt,n)}function Ft(e,t,n,i){for(var o=n-1,r=e.length;++o<r;)if(i(e[o],t))return o;return-1}function Pt(e){return e!=e}function Mt(e,t){var n=null==e?0:e.length;return n?Vt(e,t)/n:f}function Nt(e){return function(t){return null==t?o:t[e]}}function Rt(e){return function(t){return null==e?o:e[t]}}function Ot(e,t,n,i,o){return o(e,(function(e,o,r){n=i?(i=!1,e):t(n,e,o,r)})),n}function Vt(e,t){for(var n,i=-1,r=e.length;++i<r;){var a=t(e[i]);a!==o&&(n=n===o?a:n+a)}return n}function jt(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function Wt(e){return function(t){return e(t)}}function Ht(e,t){return St(t,(function(t){return e[t]}))}function zt(e,t){return e.has(t)}function qt(e,t){for(var n=-1,i=e.length;++n<i&&_t(t,e[n],0)>-1;);return n}function $t(e,t){for(var n=e.length;n--&&_t(t,e[n],0)>-1;);return n}function Gt(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}var Kt=Rt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Yt=Rt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Xt(e){return"\\"+et[e]}function Jt(e){return Ke.test(e)}function Qt(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function Zt(e,t){return function(n){return e(t(n))}}function en(e,t){for(var n=-1,i=e.length,o=0,r=[];++n<i;){var a=e[n];a!==t&&a!==s||(e[n]=s,r[o++]=n)}return r}function tn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function nn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function on(e){return Jt(e)?function(e){for(var t=$e.lastIndex=0;$e.test(e);)++t;return t}(e):kt(e)}function rn(e){return Jt(e)?function(e){return e.match($e)||[]}(e):function(e){return e.split("")}(e)}var an=Rt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),sn=function e(t){var n,i=(t=null==t?rt:sn.defaults(rt.Object(),t,sn.pick(rt,Xe))).Array,Ee=t.Date,we=t.Error,Ce=t.Function,Ie=t.Math,Se=t.Object,Be=t.RegExp,De=t.String,Ae=t.TypeError,Te=i.prototype,ke=Ce.prototype,Ue=Se.prototype,Le=t["__core-js_shared__"],_e=ke.toString,Fe=Ue.hasOwnProperty,Pe=0,Me=(n=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Ne=Ue.toString,Re=_e.call(Se),Oe=rt._,Ve=Be("^"+_e.call(Fe).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=lt?t.Buffer:o,We=t.Symbol,He=t.Uint8Array,$e=je?je.allocUnsafe:o,Ke=Zt(Se.getPrototypeOf,Se),et=Se.create,it=Ue.propertyIsEnumerable,ot=Te.splice,at=We?We.isConcatSpreadable:o,st=We?We.iterator:o,ct=We?We.toStringTag:o,ut=function(){try{var e=cr(Se,"defineProperty");return e({},"",{}),e}catch(e){}}(),kt=t.clearTimeout!==rt.clearTimeout&&t.clearTimeout,Rt=Ee&&Ee.now!==rt.Date.now&&Ee.now,ln=t.setTimeout!==rt.setTimeout&&t.setTimeout,cn=Ie.ceil,un=Ie.floor,dn=Se.getOwnPropertySymbols,fn=je?je.isBuffer:o,hn=t.isFinite,pn=Te.join,mn=Zt(Se.keys,Se),gn=Ie.max,yn=Ie.min,xn=Ee.now,bn=t.parseInt,vn=Ie.random,En=Te.reverse,wn=cr(t,"DataView"),Cn=cr(t,"Map"),In=cr(t,"Promise"),Sn=cr(t,"Set"),Bn=cr(t,"WeakMap"),Dn=cr(Se,"create"),An=Bn&&new Bn,Tn={},kn=Rr(wn),Un=Rr(Cn),Ln=Rr(In),_n=Rr(Sn),Fn=Rr(Bn),Pn=We?We.prototype:o,Mn=Pn?Pn.valueOf:o,Nn=Pn?Pn.toString:o;function Rn(e){if(ts(e)&&!za(e)&&!(e instanceof Wn)){if(e instanceof jn)return e;if(Fe.call(e,"__wrapped__"))return Or(e)}return new jn(e)}var On=function(){function e(){}return function(t){if(!es(t))return{};if(et)return et(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function Vn(){}function jn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function Wn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=h,this.__views__=[]}function Hn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function zn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function qn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function $n(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qn;++t<n;)this.add(e[t])}function Gn(e){var t=this.__data__=new zn(e);this.size=t.size}function Kn(e,t){var n=za(e),i=!n&&Ha(e),o=!n&&!i&&Ka(e),r=!n&&!i&&!o&&cs(e),a=n||i||o||r,s=a?jt(e.length,De):[],l=s.length;for(var c in e)!t&&!Fe.call(e,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||r&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||gr(c,l))||s.push(c);return s}function Yn(e){var t=e.length;return t?e[qi(0,t-1)]:o}function Xn(e,t){return _r(Do(e),ri(t,0,e.length))}function Jn(e){return _r(Do(e))}function Qn(e,t,n){(n!==o&&!Va(e[t],n)||n===o&&!(t in e))&&ii(e,t,n)}function Zn(e,t,n){var i=e[t];Fe.call(e,t)&&Va(i,n)&&(n!==o||t in e)||ii(e,t,n)}function ei(e,t){for(var n=e.length;n--;)if(Va(e[n][0],t))return n;return-1}function ti(e,t,n,i){return ui(e,(function(e,o,r){t(i,e,n(e),r)})),i}function ni(e,t){return e&&Ao(t,Us(t),e)}function ii(e,t,n){"__proto__"==t&&ut?ut(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function oi(e,t){for(var n=-1,r=t.length,a=i(r),s=null==e;++n<r;)a[n]=s?o:Bs(e,t[n]);return a}function ri(e,t,n){return e==e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function ai(e,t,n,i,r,a){var s,l=1&t,c=2&t,u=4&t;if(n&&(s=r?n(e,i,r,a):n(e)),s!==o)return s;if(!es(e))return e;var d=za(e);if(d){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Fe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return Do(e,s)}else{var f=fr(e),h=f==v||f==E;if(Ka(e))return Eo(e,l);if(f==I||f==m||h&&!r){if(s=c||h?{}:pr(e),!l)return c?function(e,t){return Ao(e,dr(e),t)}(e,function(e,t){return e&&Ao(t,Ls(t),e)}(s,e)):function(e,t){return Ao(e,ur(e),t)}(e,ni(s,e))}else{if(!Ze[f])return r?e:{};s=function(e,t,n){var i,o=e.constructor;switch(t){case U:return wo(e);case y:case x:return new o(+e);case L:return function(e,t){var n=t?wo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case _:case F:case P:case M:case N:case R:case O:case V:case j:return Co(e,n);case w:return new o;case C:case A:return new o(e);case B:return function(e){var t=new e.constructor(e.source,fe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case D:return new o;case T:return i=e,Mn?Se(Mn.call(i)):{}}}(e,f,l)}}a||(a=new Gn);var p=a.get(e);if(p)return p;if(a.set(e,s),as(e))return e.forEach((function(i){s.add(ai(i,t,n,i,e,a))})),s;if(ns(e))return e.forEach((function(i,o){s.set(o,ai(i,t,n,o,e,a))})),s;var g=d?o:(u?c?nr:tr:c?Ls:Us)(e);return bt(g||e,(function(i,o){g&&(i=e[o=i]),Zn(s,o,ai(i,t,n,o,e,a))})),s}function si(e,t,n){var i=n.length;if(null==e)return!i;for(e=Se(e);i--;){var r=n[i],a=t[r],s=e[r];if(s===o&&!(r in e)||!a(s))return!1}return!0}function li(e,t,n){if("function"!=typeof e)throw new Ae(r);return Tr((function(){e.apply(o,n)}),t)}function ci(e,t,n,i){var o=-1,r=Ct,a=!0,s=e.length,l=[],c=t.length;if(!s)return l;n&&(t=St(t,Wt(n))),i?(r=It,a=!1):t.length>=200&&(r=zt,a=!1,t=new $n(t));e:for(;++o<s;){var u=e[o],d=null==n?u:n(u);if(u=i||0!==u?u:0,a&&d==d){for(var f=c;f--;)if(t[f]===d)continue e;l.push(u)}else r(t,d,i)||l.push(u)}return l}Rn.templateSettings={escape:Y,evaluate:X,interpolate:J,variable:"",imports:{_:Rn}},Rn.prototype=Vn.prototype,Rn.prototype.constructor=Rn,jn.prototype=On(Vn.prototype),jn.prototype.constructor=jn,Wn.prototype=On(Vn.prototype),Wn.prototype.constructor=Wn,Hn.prototype.clear=function(){this.__data__=Dn?Dn(null):{},this.size=0},Hn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Hn.prototype.get=function(e){var t=this.__data__;if(Dn){var n=t[e];return n===a?o:n}return Fe.call(t,e)?t[e]:o},Hn.prototype.has=function(e){var t=this.__data__;return Dn?t[e]!==o:Fe.call(t,e)},Hn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Dn&&t===o?a:t,this},zn.prototype.clear=function(){this.__data__=[],this.size=0},zn.prototype.delete=function(e){var t=this.__data__,n=ei(t,e);return!(n<0||(n==t.length-1?t.pop():ot.call(t,n,1),--this.size,0))},zn.prototype.get=function(e){var t=this.__data__,n=ei(t,e);return n<0?o:t[n][1]},zn.prototype.has=function(e){return ei(this.__data__,e)>-1},zn.prototype.set=function(e,t){var n=this.__data__,i=ei(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},qn.prototype.clear=function(){this.size=0,this.__data__={hash:new Hn,map:new(Cn||zn),string:new Hn}},qn.prototype.delete=function(e){var t=sr(this,e).delete(e);return this.size-=t?1:0,t},qn.prototype.get=function(e){return sr(this,e).get(e)},qn.prototype.has=function(e){return sr(this,e).has(e)},qn.prototype.set=function(e,t){var n=sr(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},$n.prototype.add=$n.prototype.push=function(e){return this.__data__.set(e,a),this},$n.prototype.has=function(e){return this.__data__.has(e)},Gn.prototype.clear=function(){this.__data__=new zn,this.size=0},Gn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Gn.prototype.get=function(e){return this.__data__.get(e)},Gn.prototype.has=function(e){return this.__data__.has(e)},Gn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof zn){var i=n.__data__;if(!Cn||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new qn(i)}return n.set(e,t),this.size=n.size,this};var ui=Uo(xi),di=Uo(bi,!0);function fi(e,t){var n=!0;return ui(e,(function(e,i,o){return n=!!t(e,i,o)})),n}function hi(e,t,n){for(var i=-1,r=e.length;++i<r;){var a=e[i],s=t(a);if(null!=s&&(l===o?s==s&&!ls(s):n(s,l)))var l=s,c=a}return c}function pi(e,t){var n=[];return ui(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function mi(e,t,n,i,o){var r=-1,a=e.length;for(n||(n=mr),o||(o=[]);++r<a;){var s=e[r];t>0&&n(s)?t>1?mi(s,t-1,n,i,o):Bt(o,s):i||(o[o.length]=s)}return o}var gi=Lo(),yi=Lo(!0);function xi(e,t){return e&&gi(e,t,Us)}function bi(e,t){return e&&yi(e,t,Us)}function vi(e,t){return wt(t,(function(t){return Ja(e[t])}))}function Ei(e,t){for(var n=0,i=(t=yo(t,e)).length;null!=e&&n<i;)e=e[Nr(t[n++])];return n&&n==i?e:o}function wi(e,t,n){var i=t(e);return za(e)?i:Bt(i,n(e))}function Ci(e){return null==e?e===o?"[object Undefined]":"[object Null]":ct&&ct in Se(e)?function(e){var t=Fe.call(e,ct),n=e[ct];try{e[ct]=o;var i=!0}catch(e){}var r=Ne.call(e);return i&&(t?e[ct]=n:delete e[ct]),r}(e):function(e){return Ne.call(e)}(e)}function Ii(e,t){return e>t}function Si(e,t){return null!=e&&Fe.call(e,t)}function Bi(e,t){return null!=e&&t in Se(e)}function Di(e,t,n){for(var r=n?It:Ct,a=e[0].length,s=e.length,l=s,c=i(s),u=1/0,d=[];l--;){var f=e[l];l&&t&&(f=St(f,Wt(t))),u=yn(f.length,u),c[l]=!n&&(t||a>=120&&f.length>=120)?new $n(l&&f):o}f=e[0];var h=-1,p=c[0];e:for(;++h<a&&d.length<u;){var m=f[h],g=t?t(m):m;if(m=n||0!==m?m:0,!(p?zt(p,g):r(d,g,n))){for(l=s;--l;){var y=c[l];if(!(y?zt(y,g):r(e[l],g,n)))continue e}p&&p.push(g),d.push(m)}}return d}function Ai(e,t,n){var i=null==(e=Sr(e,t=yo(t,e)))?e:e[Nr(Xr(t))];return null==i?o:yt(i,e,n)}function Ti(e){return ts(e)&&Ci(e)==m}function ki(e,t,n,i,r){return e===t||(null==e||null==t||!ts(e)&&!ts(t)?e!=e&&t!=t:function(e,t,n,i,r,a){var s=za(e),l=za(t),c=s?g:fr(e),u=l?g:fr(t),d=(c=c==m?I:c)==I,f=(u=u==m?I:u)==I,h=c==u;if(h&&Ka(e)){if(!Ka(t))return!1;s=!0,d=!1}if(h&&!d)return a||(a=new Gn),s||cs(e)?Zo(e,t,n,i,r,a):function(e,t,n,i,o,r,a){switch(n){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case U:return!(e.byteLength!=t.byteLength||!r(new He(e),new He(t)));case y:case x:case C:return Va(+e,+t);case b:return e.name==t.name&&e.message==t.message;case B:case A:return e==t+"";case w:var s=Qt;case D:var l=1&i;if(s||(s=tn),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;i|=2,a.set(e,t);var u=Zo(s(e),s(t),i,o,r,a);return a.delete(e),u;case T:if(Mn)return Mn.call(e)==Mn.call(t)}return!1}(e,t,c,n,i,r,a);if(!(1&n)){var p=d&&Fe.call(e,"__wrapped__"),v=f&&Fe.call(t,"__wrapped__");if(p||v){var E=p?e.value():e,S=v?t.value():t;return a||(a=new Gn),r(E,S,n,i,a)}}return!!h&&(a||(a=new Gn),function(e,t,n,i,r,a){var s=1&n,l=tr(e),c=l.length;if(c!=tr(t).length&&!s)return!1;for(var u=c;u--;){var d=l[u];if(!(s?d in t:Fe.call(t,d)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var h=!0;a.set(e,t),a.set(t,e);for(var p=s;++u<c;){var m=e[d=l[u]],g=t[d];if(i)var y=s?i(g,m,d,t,e,a):i(m,g,d,e,t,a);if(!(y===o?m===g||r(m,g,n,i,a):y)){h=!1;break}p||(p="constructor"==d)}if(h&&!p){var x=e.constructor,b=t.constructor;x==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(h=!1)}return a.delete(e),a.delete(t),h}(e,t,n,i,r,a))}(e,t,n,i,ki,r))}function Ui(e,t,n,i){var r=n.length,a=r,s=!i;if(null==e)return!a;for(e=Se(e);r--;){var l=n[r];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++r<a;){var c=(l=n[r])[0],u=e[c],d=l[1];if(s&&l[2]){if(u===o&&!(c in e))return!1}else{var f=new Gn;if(i)var h=i(u,d,c,e,t,f);if(!(h===o?ki(d,u,3,i,f):h))return!1}}return!0}function Li(e){return!(!es(e)||(t=e,Me&&Me in t))&&(Ja(e)?Ve:me).test(Rr(e));var t}function _i(e){return"function"==typeof e?e:null==e?il:"object"==typeof e?za(e)?Ri(e[0],e[1]):Ni(e):fl(e)}function Fi(e){if(!Er(e))return mn(e);var t=[];for(var n in Se(e))Fe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Pi(e,t){return e<t}function Mi(e,t){var n=-1,o=$a(e)?i(e.length):[];return ui(e,(function(e,i,r){o[++n]=t(e,i,r)})),o}function Ni(e){var t=lr(e);return 1==t.length&&t[0][2]?Cr(t[0][0],t[0][1]):function(n){return n===e||Ui(n,e,t)}}function Ri(e,t){return xr(e)&&wr(t)?Cr(Nr(e),t):function(n){var i=Bs(n,e);return i===o&&i===t?Ds(n,e):ki(t,i,3)}}function Oi(e,t,n,i,r){e!==t&&gi(t,(function(a,s){if(es(a))r||(r=new Gn),function(e,t,n,i,r,a,s){var l=Dr(e,n),c=Dr(t,n),u=s.get(c);if(u)Qn(e,n,u);else{var d=a?a(l,c,n+"",e,t,s):o,f=d===o;if(f){var h=za(c),p=!h&&Ka(c),m=!h&&!p&&cs(c);d=c,h||p||m?za(l)?d=l:Ga(l)?d=Do(l):p?(f=!1,d=Eo(c,!0)):m?(f=!1,d=Co(c,!0)):d=[]:os(c)||Ha(c)?(d=l,Ha(l)?d=ys(l):es(l)&&!Ja(l)||(d=pr(c))):f=!1}f&&(s.set(c,d),r(d,c,i,a,s),s.delete(c)),Qn(e,n,d)}}(e,t,s,n,Oi,i,r);else{var l=i?i(Dr(e,s),a,s+"",e,t,r):o;l===o&&(l=a),Qn(e,s,l)}}),Ls)}function Vi(e,t){var n=e.length;if(n)return gr(t+=t<0?n:0,n)?e[t]:o}function ji(e,t,n){var i=-1;return t=St(t.length?t:[il],Wt(ar())),function(e,t){var i=e.length;for(e.sort((function(e,t){return function(e,t,n){for(var i=-1,o=e.criteria,r=t.criteria,a=o.length,s=n.length;++i<a;){var l=Io(o[i],r[i]);if(l)return i>=s?l:l*("desc"==n[i]?-1:1)}return e.index-t.index}(e,t,n)}));i--;)e[i]=e[i].value;return e}(Mi(e,(function(e,n,o){return{criteria:St(t,(function(t){return t(e)})),index:++i,value:e}})))}function Wi(e,t,n){for(var i=-1,o=t.length,r={};++i<o;){var a=t[i],s=Ei(e,a);n(s,a)&&Xi(r,yo(a,e),s)}return r}function Hi(e,t,n,i){var o=i?Ft:_t,r=-1,a=t.length,s=e;for(e===t&&(t=Do(t)),n&&(s=St(e,Wt(n)));++r<a;)for(var l=0,c=t[r],u=n?n(c):c;(l=o(s,u,l,i))>-1;)s!==e&&ot.call(s,l,1),ot.call(e,l,1);return e}function zi(e,t){for(var n=e?t.length:0,i=n-1;n--;){var o=t[n];if(n==i||o!==r){var r=o;gr(o)?ot.call(e,o,1):lo(e,o)}}return e}function qi(e,t){return e+un(vn()*(t-e+1))}function $i(e,t){var n="";if(!e||t<1||t>d)return n;do{t%2&&(n+=e),(t=un(t/2))&&(e+=e)}while(t);return n}function Gi(e,t){return kr(Ir(e,t,il),e+"")}function Ki(e){return Yn(Vs(e))}function Yi(e,t){var n=Vs(e);return _r(n,ri(t,0,n.length))}function Xi(e,t,n,i){if(!es(e))return e;for(var r=-1,a=(t=yo(t,e)).length,s=a-1,l=e;null!=l&&++r<a;){var c=Nr(t[r]),u=n;if(r!=s){var d=l[c];(u=i?i(d,c,l):o)===o&&(u=es(d)?d:gr(t[r+1])?[]:{})}Zn(l,c,u),l=l[c]}return e}var Ji=An?function(e,t){return An.set(e,t),e}:il,Qi=ut?function(e,t){return ut(e,"toString",{configurable:!0,enumerable:!1,value:el(t),writable:!0})}:il;function Zi(e){return _r(Vs(e))}function eo(e,t,n){var o=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var a=i(r);++o<r;)a[o]=e[o+t];return a}function to(e,t){var n;return ui(e,(function(e,i,o){return!(n=t(e,i,o))})),!!n}function no(e,t,n){var i=0,o=null==e?i:e.length;if("number"==typeof t&&t==t&&o<=2147483647){for(;i<o;){var r=i+o>>>1,a=e[r];null!==a&&!ls(a)&&(n?a<=t:a<t)?i=r+1:o=r}return o}return io(e,t,il,n)}function io(e,t,n,i){t=n(t);for(var r=0,a=null==e?0:e.length,s=t!=t,l=null===t,c=ls(t),u=t===o;r<a;){var d=un((r+a)/2),f=n(e[d]),h=f!==o,p=null===f,m=f==f,g=ls(f);if(s)var y=i||m;else y=u?m&&(i||h):l?m&&h&&(i||!p):c?m&&h&&!p&&(i||!g):!p&&!g&&(i?f<=t:f<t);y?r=d+1:a=d}return yn(a,4294967294)}function oo(e,t){for(var n=-1,i=e.length,o=0,r=[];++n<i;){var a=e[n],s=t?t(a):a;if(!n||!Va(s,l)){var l=s;r[o++]=0===a?0:a}}return r}function ro(e){return"number"==typeof e?e:ls(e)?f:+e}function ao(e){if("string"==typeof e)return e;if(za(e))return St(e,ao)+"";if(ls(e))return Nn?Nn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function so(e,t,n){var i=-1,o=Ct,r=e.length,a=!0,s=[],l=s;if(n)a=!1,o=It;else if(r>=200){var c=t?null:Go(e);if(c)return tn(c);a=!1,o=zt,l=new $n}else l=t?[]:s;e:for(;++i<r;){var u=e[i],d=t?t(u):u;if(u=n||0!==u?u:0,a&&d==d){for(var f=l.length;f--;)if(l[f]===d)continue e;t&&l.push(d),s.push(u)}else o(l,d,n)||(l!==s&&l.push(d),s.push(u))}return s}function lo(e,t){return null==(e=Sr(e,t=yo(t,e)))||delete e[Nr(Xr(t))]}function co(e,t,n,i){return Xi(e,t,n(Ei(e,t)),i)}function uo(e,t,n,i){for(var o=e.length,r=i?o:-1;(i?r--:++r<o)&&t(e[r],r,e););return n?eo(e,i?0:r,i?r+1:o):eo(e,i?r+1:0,i?o:r)}function fo(e,t){var n=e;return n instanceof Wn&&(n=n.value()),Dt(t,(function(e,t){return t.func.apply(t.thisArg,Bt([e],t.args))}),n)}function ho(e,t,n){var o=e.length;if(o<2)return o?so(e[0]):[];for(var r=-1,a=i(o);++r<o;)for(var s=e[r],l=-1;++l<o;)l!=r&&(a[r]=ci(a[r]||s,e[l],t,n));return so(mi(a,1),t,n)}function po(e,t,n){for(var i=-1,r=e.length,a=t.length,s={};++i<r;){var l=i<a?t[i]:o;n(s,e[i],l)}return s}function mo(e){return Ga(e)?e:[]}function go(e){return"function"==typeof e?e:il}function yo(e,t){return za(e)?e:xr(e,t)?[e]:Mr(xs(e))}var xo=Gi;function bo(e,t,n){var i=e.length;return n=n===o?i:n,!t&&n>=i?e:eo(e,t,n)}var vo=kt||function(e){return rt.clearTimeout(e)};function Eo(e,t){if(t)return e.slice();var n=e.length,i=$e?$e(n):new e.constructor(n);return e.copy(i),i}function wo(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function Co(e,t){var n=t?wo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Io(e,t){if(e!==t){var n=e!==o,i=null===e,r=e==e,a=ls(e),s=t!==o,l=null===t,c=t==t,u=ls(t);if(!l&&!u&&!a&&e>t||a&&s&&c&&!l&&!u||i&&s&&c||!n&&c||!r)return 1;if(!i&&!a&&!u&&e<t||u&&n&&r&&!i&&!a||l&&n&&r||!s&&r||!c)return-1}return 0}function So(e,t,n,o){for(var r=-1,a=e.length,s=n.length,l=-1,c=t.length,u=gn(a-s,0),d=i(c+u),f=!o;++l<c;)d[l]=t[l];for(;++r<s;)(f||r<a)&&(d[n[r]]=e[r]);for(;u--;)d[l++]=e[r++];return d}function Bo(e,t,n,o){for(var r=-1,a=e.length,s=-1,l=n.length,c=-1,u=t.length,d=gn(a-l,0),f=i(d+u),h=!o;++r<d;)f[r]=e[r];for(var p=r;++c<u;)f[p+c]=t[c];for(;++s<l;)(h||r<a)&&(f[p+n[s]]=e[r++]);return f}function Do(e,t){var n=-1,o=e.length;for(t||(t=i(o));++n<o;)t[n]=e[n];return t}function Ao(e,t,n,i){var r=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var l=t[a],c=i?i(n[l],e[l],l,n,e):o;c===o&&(c=e[l]),r?ii(n,l,c):Zn(n,l,c)}return n}function To(e,t){return function(n,i){var o=za(n)?xt:ti,r=t?t():{};return o(n,e,ar(i,2),r)}}function ko(e){return Gi((function(t,n){var i=-1,r=n.length,a=r>1?n[r-1]:o,s=r>2?n[2]:o;for(a=e.length>3&&"function"==typeof a?(r--,a):o,s&&yr(n[0],n[1],s)&&(a=r<3?o:a,r=1),t=Se(t);++i<r;){var l=n[i];l&&e(t,l,i,a)}return t}))}function Uo(e,t){return function(n,i){if(null==n)return n;if(!$a(n))return e(n,i);for(var o=n.length,r=t?o:-1,a=Se(n);(t?r--:++r<o)&&!1!==i(a[r],r,a););return n}}function Lo(e){return function(t,n,i){for(var o=-1,r=Se(t),a=i(t),s=a.length;s--;){var l=a[e?s:++o];if(!1===n(r[l],l,r))break}return t}}function _o(e){return function(t){var n=Jt(t=xs(t))?rn(t):o,i=n?n[0]:t.charAt(0),r=n?bo(n,1).join(""):t.slice(1);return i[e]()+r}}function Fo(e){return function(t){return Dt(Js(Hs(t).replace(ze,"")),e,"")}}function Po(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=On(e.prototype),i=e.apply(n,t);return es(i)?i:n}}function Mo(e){return function(t,n,i){var r=Se(t);if(!$a(t)){var a=ar(n,3);t=Us(t),n=function(e){return a(r[e],e,r)}}var s=e(t,n,i);return s>-1?r[a?t[s]:s]:o}}function No(e){return er((function(t){var n=t.length,i=n,a=jn.prototype.thru;for(e&&t.reverse();i--;){var s=t[i];if("function"!=typeof s)throw new Ae(r);if(a&&!l&&"wrapper"==or(s))var l=new jn([],!0)}for(i=l?i:n;++i<n;){var c=or(s=t[i]),u="wrapper"==c?ir(s):o;l=u&&br(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[or(u[0])].apply(l,u[3]):1==s.length&&br(s)?l[c]():l.thru(s)}return function(){var e=arguments,i=e[0];if(l&&1==e.length&&za(i))return l.plant(i).value();for(var o=0,r=n?t[o].apply(this,e):i;++o<n;)r=t[o].call(this,r);return r}}))}function Ro(e,t,n,r,a,s,l,u,d,f){var h=t&c,p=1&t,m=2&t,g=24&t,y=512&t,x=m?o:Po(e);return function o(){for(var c=arguments.length,b=i(c),v=c;v--;)b[v]=arguments[v];if(g)var E=rr(o),w=Gt(b,E);if(r&&(b=So(b,r,a,g)),s&&(b=Bo(b,s,l,g)),c-=w,g&&c<f){var C=en(b,E);return qo(e,t,Ro,o.placeholder,n,b,C,u,d,f-c)}var I=p?n:this,S=m?I[e]:e;return c=b.length,u?b=Br(b,u):y&&c>1&&b.reverse(),h&&d<c&&(b.length=d),this&&this!==rt&&this instanceof o&&(S=x||Po(S)),S.apply(I,b)}}function Oo(e,t){return function(n,i){return function(e,t,n,i){return xi(e,(function(e,o,r){t(i,n(e),o,r)})),i}(n,e,t(i),{})}}function Vo(e,t){return function(n,i){var r;if(n===o&&i===o)return t;if(n!==o&&(r=n),i!==o){if(r===o)return i;"string"==typeof n||"string"==typeof i?(n=ao(n),i=ao(i)):(n=ro(n),i=ro(i)),r=e(n,i)}return r}}function jo(e){return er((function(t){return t=St(t,Wt(ar())),Gi((function(n){var i=this;return e(t,(function(e){return yt(e,i,n)}))}))}))}function Wo(e,t){var n=(t=t===o?" ":ao(t)).length;if(n<2)return n?$i(t,e):t;var i=$i(t,cn(e/on(t)));return Jt(t)?bo(rn(i),0,e).join(""):i.slice(0,e)}function Ho(e){return function(t,n,r){return r&&"number"!=typeof r&&yr(t,n,r)&&(n=r=o),t=hs(t),n===o?(n=t,t=0):n=hs(n),function(e,t,n,o){for(var r=-1,a=gn(cn((t-e)/(n||1)),0),s=i(a);a--;)s[o?a:++r]=e,e+=n;return s}(t,n,r=r===o?t<n?1:-1:hs(r),e)}}function zo(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=gs(t),n=gs(n)),e(t,n)}}function qo(e,t,n,i,r,a,s,c,u,d){var f=8&t;t|=f?l:64,4&(t&=~(f?64:l))||(t&=-4);var h=[e,t,r,f?a:o,f?s:o,f?o:a,f?o:s,c,u,d],p=n.apply(o,h);return br(e)&&Ar(p,h),p.placeholder=i,Ur(p,e,t)}function $o(e){var t=Ie[e];return function(e,n){if(e=gs(e),n=null==n?0:yn(ps(n),292)){var i=(xs(e)+"e").split("e");return+((i=(xs(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var Go=Sn&&1/tn(new Sn([,-0]))[1]==u?function(e){return new Sn(e)}:ll;function Ko(e){return function(t){var n=fr(t);return n==w?Qt(t):n==D?nn(t):function(e,t){return St(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Yo(e,t,n,a,u,d,f,h){var p=2&t;if(!p&&"function"!=typeof e)throw new Ae(r);var m=a?a.length:0;if(m||(t&=-97,a=u=o),f=f===o?f:gn(ps(f),0),h=h===o?h:ps(h),m-=u?u.length:0,64&t){var g=a,y=u;a=u=o}var x=p?o:ir(e),b=[e,t,n,a,u,g,y,d,f,h];if(x&&function(e,t){var n=e[1],i=t[1],o=n|i,r=o<131,a=i==c&&8==n||i==c&&256==n&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==n;if(!r&&!a)return e;1&i&&(e[2]=t[2],o|=1&n?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?So(u,l,t[4]):l,e[4]=u?en(e[3],s):t[4]}(l=t[5])&&(u=e[5],e[5]=u?Bo(u,l,t[6]):l,e[6]=u?en(e[5],s):t[6]),(l=t[7])&&(e[7]=l),i&c&&(e[8]=null==e[8]?t[8]:yn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(b,x),e=b[0],t=b[1],n=b[2],a=b[3],u=b[4],!(h=b[9]=b[9]===o?p?0:e.length:gn(b[9]-m,0))&&24&t&&(t&=-25),t&&1!=t)v=8==t||16==t?function(e,t,n){var r=Po(e);return function a(){for(var s=arguments.length,l=i(s),c=s,u=rr(a);c--;)l[c]=arguments[c];var d=s<3&&l[0]!==u&&l[s-1]!==u?[]:en(l,u);return(s-=d.length)<n?qo(e,t,Ro,a.placeholder,o,l,d,o,o,n-s):yt(this&&this!==rt&&this instanceof a?r:e,this,l)}}(e,t,h):t!=l&&33!=t||u.length?Ro.apply(o,b):function(e,t,n,o){var r=1&t,a=Po(e);return function t(){for(var s=-1,l=arguments.length,c=-1,u=o.length,d=i(u+l),f=this&&this!==rt&&this instanceof t?a:e;++c<u;)d[c]=o[c];for(;l--;)d[c++]=arguments[++s];return yt(f,r?n:this,d)}}(e,t,n,a);else var v=function(e,t,n){var i=1&t,o=Po(e);return function t(){return(this&&this!==rt&&this instanceof t?o:e).apply(i?n:this,arguments)}}(e,t,n);return Ur((x?Ji:Ar)(v,b),e,t)}function Xo(e,t,n,i){return e===o||Va(e,Ue[n])&&!Fe.call(i,n)?t:e}function Jo(e,t,n,i,r,a){return es(e)&&es(t)&&(a.set(t,e),Oi(e,t,o,Jo,a),a.delete(t)),e}function Qo(e){return os(e)?o:e}function Zo(e,t,n,i,r,a){var s=1&n,l=e.length,c=t.length;if(l!=c&&!(s&&c>l))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var d=-1,f=!0,h=2&n?new $n:o;for(a.set(e,t),a.set(t,e);++d<l;){var p=e[d],m=t[d];if(i)var g=s?i(m,p,d,t,e,a):i(p,m,d,e,t,a);if(g!==o){if(g)continue;f=!1;break}if(h){if(!Tt(t,(function(e,t){if(!zt(h,t)&&(p===e||r(p,e,n,i,a)))return h.push(t)}))){f=!1;break}}else if(p!==m&&!r(p,m,n,i,a)){f=!1;break}}return a.delete(e),a.delete(t),f}function er(e){return kr(Ir(e,o,qr),e+"")}function tr(e){return wi(e,Us,ur)}function nr(e){return wi(e,Ls,dr)}var ir=An?function(e){return An.get(e)}:ll;function or(e){for(var t=e.name+"",n=Tn[t],i=Fe.call(Tn,t)?n.length:0;i--;){var o=n[i],r=o.func;if(null==r||r==e)return o.name}return t}function rr(e){return(Fe.call(Rn,"placeholder")?Rn:e).placeholder}function ar(){var e=Rn.iteratee||ol;return e=e===ol?_i:e,arguments.length?e(arguments[0],arguments[1]):e}function sr(e,t){var n,i,o=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function lr(e){for(var t=Us(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,wr(o)]}return t}function cr(e,t){var n=function(e,t){return null==e?o:e[t]}(e,t);return Li(n)?n:o}var ur=dn?function(e){return null==e?[]:(e=Se(e),wt(dn(e),(function(t){return it.call(e,t)})))}:ml,dr=dn?function(e){for(var t=[];e;)Bt(t,ur(e)),e=Ke(e);return t}:ml,fr=Ci;function hr(e,t,n){for(var i=-1,o=(t=yo(t,e)).length,r=!1;++i<o;){var a=Nr(t[i]);if(!(r=null!=e&&n(e,a)))break;e=e[a]}return r||++i!=o?r:!!(o=null==e?0:e.length)&&Za(o)&&gr(a,o)&&(za(e)||Ha(e))}function pr(e){return"function"!=typeof e.constructor||Er(e)?{}:On(Ke(e))}function mr(e){return za(e)||Ha(e)||!!(at&&e&&e[at])}function gr(e,t){var n=typeof e;return!!(t=null==t?d:t)&&("number"==n||"symbol"!=n&&ye.test(e))&&e>-1&&e%1==0&&e<t}function yr(e,t,n){if(!es(n))return!1;var i=typeof t;return!!("number"==i?$a(n)&&gr(t,n.length):"string"==i&&t in n)&&Va(n[t],e)}function xr(e,t){if(za(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ls(e))||Z.test(e)||!Q.test(e)||null!=t&&e in Se(t)}function br(e){var t=or(e),n=Rn[t];if("function"!=typeof n||!(t in Wn.prototype))return!1;if(e===n)return!0;var i=ir(n);return!!i&&e===i[0]}(wn&&fr(new wn(new ArrayBuffer(1)))!=L||Cn&&fr(new Cn)!=w||In&&fr(In.resolve())!=S||Sn&&fr(new Sn)!=D||Bn&&fr(new Bn)!=k)&&(fr=function(e){var t=Ci(e),n=t==I?e.constructor:o,i=n?Rr(n):"";if(i)switch(i){case kn:return L;case Un:return w;case Ln:return S;case _n:return D;case Fn:return k}return t});var vr=Le?Ja:gl;function Er(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ue)}function wr(e){return e==e&&!es(e)}function Cr(e,t){return function(n){return null!=n&&n[e]===t&&(t!==o||e in Se(n))}}function Ir(e,t,n){return t=gn(t===o?e.length-1:t,0),function(){for(var o=arguments,r=-1,a=gn(o.length-t,0),s=i(a);++r<a;)s[r]=o[t+r];r=-1;for(var l=i(t+1);++r<t;)l[r]=o[r];return l[t]=n(s),yt(e,this,l)}}function Sr(e,t){return t.length<2?e:Ei(e,eo(t,0,-1))}function Br(e,t){for(var n=e.length,i=yn(t.length,n),r=Do(e);i--;){var a=t[i];e[i]=gr(a,n)?r[a]:o}return e}function Dr(e,t){if("__proto__"!=t)return e[t]}var Ar=Lr(Ji),Tr=ln||function(e,t){return rt.setTimeout(e,t)},kr=Lr(Qi);function Ur(e,t,n){var i=t+"";return kr(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(ae,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return bt(p,(function(n){var i="_."+n[0];t&n[1]&&!Ct(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(se);return t?t[1].split(le):[]}(i),n)))}function Lr(e){var t=0,n=0;return function(){var i=xn(),r=16-(i-n);if(n=i,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(o,arguments)}}function _r(e,t){var n=-1,i=e.length,r=i-1;for(t=t===o?i:t;++n<t;){var a=qi(n,r),s=e[a];e[a]=e[n],e[n]=s}return e.length=t,e}var Fr,Pr,Mr=(Fr=Fa((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,(function(e,n,i,o){t.push(i?o.replace(ue,"$1"):n||e)})),t}),(function(e){return 500===Pr.size&&Pr.clear(),e})),Pr=Fr.cache,Fr);function Nr(e){if("string"==typeof e||ls(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Rr(e){if(null!=e){try{return _e.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Or(e){if(e instanceof Wn)return e.clone();var t=new jn(e.__wrapped__,e.__chain__);return t.__actions__=Do(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Vr=Gi((function(e,t){return Ga(e)?ci(e,mi(t,1,Ga,!0)):[]})),jr=Gi((function(e,t){var n=Xr(t);return Ga(n)&&(n=o),Ga(e)?ci(e,mi(t,1,Ga,!0),ar(n,2)):[]})),Wr=Gi((function(e,t){var n=Xr(t);return Ga(n)&&(n=o),Ga(e)?ci(e,mi(t,1,Ga,!0),o,n):[]}));function Hr(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var o=null==n?0:ps(n);return o<0&&(o=gn(i+o,0)),Lt(e,ar(t,3),o)}function zr(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return n!==o&&(r=ps(n),r=n<0?gn(i+r,0):yn(r,i-1)),Lt(e,ar(t,3),r,!0)}function qr(e){return null!=e&&e.length?mi(e,1):[]}function $r(e){return e&&e.length?e[0]:o}var Gr=Gi((function(e){var t=St(e,mo);return t.length&&t[0]===e[0]?Di(t):[]})),Kr=Gi((function(e){var t=Xr(e),n=St(e,mo);return t===Xr(n)?t=o:n.pop(),n.length&&n[0]===e[0]?Di(n,ar(t,2)):[]})),Yr=Gi((function(e){var t=Xr(e),n=St(e,mo);return(t="function"==typeof t?t:o)&&n.pop(),n.length&&n[0]===e[0]?Di(n,o,t):[]}));function Xr(e){var t=null==e?0:e.length;return t?e[t-1]:o}var Jr=Gi(Qr);function Qr(e,t){return e&&e.length&&t&&t.length?Hi(e,t):e}var Zr=er((function(e,t){var n=null==e?0:e.length,i=oi(e,t);return zi(e,St(t,(function(e){return gr(e,n)?+e:e})).sort(Io)),i}));function ea(e){return null==e?e:En.call(e)}var ta=Gi((function(e){return so(mi(e,1,Ga,!0))})),na=Gi((function(e){var t=Xr(e);return Ga(t)&&(t=o),so(mi(e,1,Ga,!0),ar(t,2))})),ia=Gi((function(e){var t=Xr(e);return t="function"==typeof t?t:o,so(mi(e,1,Ga,!0),o,t)}));function oa(e){if(!e||!e.length)return[];var t=0;return e=wt(e,(function(e){if(Ga(e))return t=gn(e.length,t),!0})),jt(t,(function(t){return St(e,Nt(t))}))}function ra(e,t){if(!e||!e.length)return[];var n=oa(e);return null==t?n:St(n,(function(e){return yt(t,o,e)}))}var aa=Gi((function(e,t){return Ga(e)?ci(e,t):[]})),sa=Gi((function(e){return ho(wt(e,Ga))})),la=Gi((function(e){var t=Xr(e);return Ga(t)&&(t=o),ho(wt(e,Ga),ar(t,2))})),ca=Gi((function(e){var t=Xr(e);return t="function"==typeof t?t:o,ho(wt(e,Ga),o,t)})),ua=Gi(oa),da=Gi((function(e){var t=e.length,n=t>1?e[t-1]:o;return n="function"==typeof n?(e.pop(),n):o,ra(e,n)}));function fa(e){var t=Rn(e);return t.__chain__=!0,t}function ha(e,t){return t(e)}var pa=er((function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,r=function(t){return oi(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Wn&&gr(n)?((i=i.slice(n,+n+(t?1:0))).__actions__.push({func:ha,args:[r],thisArg:o}),new jn(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(o),e}))):this.thru(r)})),ma=To((function(e,t,n){Fe.call(e,n)?++e[n]:ii(e,n,1)})),ga=Mo(Hr),ya=Mo(zr);function xa(e,t){return(za(e)?bt:ui)(e,ar(t,3))}function ba(e,t){return(za(e)?vt:di)(e,ar(t,3))}var va=To((function(e,t,n){Fe.call(e,n)?e[n].push(t):ii(e,n,[t])})),Ea=Gi((function(e,t,n){var o=-1,r="function"==typeof t,a=$a(e)?i(e.length):[];return ui(e,(function(e){a[++o]=r?yt(t,e,n):Ai(e,t,n)})),a})),wa=To((function(e,t,n){ii(e,n,t)}));function Ca(e,t){return(za(e)?St:Mi)(e,ar(t,3))}var Ia=To((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),Sa=Gi((function(e,t){if(null==e)return[];var n=t.length;return n>1&&yr(e,t[0],t[1])?t=[]:n>2&&yr(t[0],t[1],t[2])&&(t=[t[0]]),ji(e,mi(t,1),[])})),Ba=Rt||function(){return rt.Date.now()};function Da(e,t,n){return t=n?o:t,t=e&&null==t?e.length:t,Yo(e,c,o,o,o,o,t)}function Aa(e,t){var n;if("function"!=typeof t)throw new Ae(r);return e=ps(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var Ta=Gi((function(e,t,n){var i=1;if(n.length){var o=en(n,rr(Ta));i|=l}return Yo(e,i,t,n,o)})),ka=Gi((function(e,t,n){var i=3;if(n.length){var o=en(n,rr(ka));i|=l}return Yo(t,i,e,n,o)}));function Ua(e,t,n){var i,a,s,l,c,u,d=0,f=!1,h=!1,p=!0;if("function"!=typeof e)throw new Ae(r);function m(t){var n=i,r=a;return i=a=o,d=t,l=e.apply(r,n)}function g(e){return d=e,c=Tr(x,t),f?m(e):l}function y(e){var n=e-u;return u===o||n>=t||n<0||h&&e-d>=s}function x(){var e=Ba();if(y(e))return b(e);c=Tr(x,function(e){var n=t-(e-u);return h?yn(n,s-(e-d)):n}(e))}function b(e){return c=o,p&&i?m(e):(i=a=o,l)}function v(){var e=Ba(),n=y(e);if(i=arguments,a=this,u=e,n){if(c===o)return g(u);if(h)return c=Tr(x,t),m(u)}return c===o&&(c=Tr(x,t)),l}return t=gs(t)||0,es(n)&&(f=!!n.leading,s=(h="maxWait"in n)?gn(gs(n.maxWait)||0,t):s,p="trailing"in n?!!n.trailing:p),v.cancel=function(){c!==o&&vo(c),d=0,i=u=a=c=o},v.flush=function(){return c===o?l:b(Ba())},v}var La=Gi((function(e,t){return li(e,1,t)})),_a=Gi((function(e,t,n){return li(e,gs(t)||0,n)}));function Fa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ae(r);var n=function(){var i=arguments,o=t?t.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);var a=e.apply(this,i);return n.cache=r.set(o,a)||r,a};return n.cache=new(Fa.Cache||qn),n}function Pa(e){if("function"!=typeof e)throw new Ae(r);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Fa.Cache=qn;var Ma=xo((function(e,t){var n=(t=1==t.length&&za(t[0])?St(t[0],Wt(ar())):St(mi(t,1),Wt(ar()))).length;return Gi((function(i){for(var o=-1,r=yn(i.length,n);++o<r;)i[o]=t[o].call(this,i[o]);return yt(e,this,i)}))})),Na=Gi((function(e,t){var n=en(t,rr(Na));return Yo(e,l,o,t,n)})),Ra=Gi((function(e,t){var n=en(t,rr(Ra));return Yo(e,64,o,t,n)})),Oa=er((function(e,t){return Yo(e,256,o,o,o,t)}));function Va(e,t){return e===t||e!=e&&t!=t}var ja=zo(Ii),Wa=zo((function(e,t){return e>=t})),Ha=Ti(function(){return arguments}())?Ti:function(e){return ts(e)&&Fe.call(e,"callee")&&!it.call(e,"callee")},za=i.isArray,qa=dt?Wt(dt):function(e){return ts(e)&&Ci(e)==U};function $a(e){return null!=e&&Za(e.length)&&!Ja(e)}function Ga(e){return ts(e)&&$a(e)}var Ka=fn||gl,Ya=ft?Wt(ft):function(e){return ts(e)&&Ci(e)==x};function Xa(e){if(!ts(e))return!1;var t=Ci(e);return t==b||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!os(e)}function Ja(e){if(!es(e))return!1;var t=Ci(e);return t==v||t==E||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Qa(e){return"number"==typeof e&&e==ps(e)}function Za(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=d}function es(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ts(e){return null!=e&&"object"==typeof e}var ns=ht?Wt(ht):function(e){return ts(e)&&fr(e)==w};function is(e){return"number"==typeof e||ts(e)&&Ci(e)==C}function os(e){if(!ts(e)||Ci(e)!=I)return!1;var t=Ke(e);if(null===t)return!0;var n=Fe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&_e.call(n)==Re}var rs=pt?Wt(pt):function(e){return ts(e)&&Ci(e)==B},as=mt?Wt(mt):function(e){return ts(e)&&fr(e)==D};function ss(e){return"string"==typeof e||!za(e)&&ts(e)&&Ci(e)==A}function ls(e){return"symbol"==typeof e||ts(e)&&Ci(e)==T}var cs=gt?Wt(gt):function(e){return ts(e)&&Za(e.length)&&!!Qe[Ci(e)]},us=zo(Pi),ds=zo((function(e,t){return e<=t}));function fs(e){if(!e)return[];if($a(e))return ss(e)?rn(e):Do(e);if(st&&e[st])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[st]());var t=fr(e);return(t==w?Qt:t==D?tn:Vs)(e)}function hs(e){return e?(e=gs(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ps(e){var t=hs(e),n=t%1;return t==t?n?t-n:t:0}function ms(e){return e?ri(ps(e),0,h):0}function gs(e){if("number"==typeof e)return e;if(ls(e))return f;if(es(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=es(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ie,"");var n=pe.test(e);return n||ge.test(e)?nt(e.slice(2),n?2:8):he.test(e)?f:+e}function ys(e){return Ao(e,Ls(e))}function xs(e){return null==e?"":ao(e)}var bs=ko((function(e,t){if(Er(t)||$a(t))Ao(t,Us(t),e);else for(var n in t)Fe.call(t,n)&&Zn(e,n,t[n])})),vs=ko((function(e,t){Ao(t,Ls(t),e)})),Es=ko((function(e,t,n,i){Ao(t,Ls(t),e,i)})),ws=ko((function(e,t,n,i){Ao(t,Us(t),e,i)})),Cs=er(oi),Is=Gi((function(e,t){e=Se(e);var n=-1,i=t.length,r=i>2?t[2]:o;for(r&&yr(t[0],t[1],r)&&(i=1);++n<i;)for(var a=t[n],s=Ls(a),l=-1,c=s.length;++l<c;){var u=s[l],d=e[u];(d===o||Va(d,Ue[u])&&!Fe.call(e,u))&&(e[u]=a[u])}return e})),Ss=Gi((function(e){return e.push(o,Jo),yt(Fs,o,e)}));function Bs(e,t,n){var i=null==e?o:Ei(e,t);return i===o?n:i}function Ds(e,t){return null!=e&&hr(e,t,Bi)}var As=Oo((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ne.call(t)),e[t]=n}),el(il)),Ts=Oo((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ne.call(t)),Fe.call(e,t)?e[t].push(n):e[t]=[n]}),ar),ks=Gi(Ai);function Us(e){return $a(e)?Kn(e):Fi(e)}function Ls(e){return $a(e)?Kn(e,!0):function(e){if(!es(e))return function(e){var t=[];if(null!=e)for(var n in Se(e))t.push(n);return t}(e);var t=Er(e),n=[];for(var i in e)("constructor"!=i||!t&&Fe.call(e,i))&&n.push(i);return n}(e)}var _s=ko((function(e,t,n){Oi(e,t,n)})),Fs=ko((function(e,t,n,i){Oi(e,t,n,i)})),Ps=er((function(e,t){var n={};if(null==e)return n;var i=!1;t=St(t,(function(t){return t=yo(t,e),i||(i=t.length>1),t})),Ao(e,nr(e),n),i&&(n=ai(n,7,Qo));for(var o=t.length;o--;)lo(n,t[o]);return n})),Ms=er((function(e,t){return null==e?{}:function(e,t){return Wi(e,t,(function(t,n){return Ds(e,n)}))}(e,t)}));function Ns(e,t){if(null==e)return{};var n=St(nr(e),(function(e){return[e]}));return t=ar(t),Wi(e,n,(function(e,n){return t(e,n[0])}))}var Rs=Ko(Us),Os=Ko(Ls);function Vs(e){return null==e?[]:Ht(e,Us(e))}var js=Fo((function(e,t,n){return t=t.toLowerCase(),e+(n?Ws(t):t)}));function Ws(e){return Xs(xs(e).toLowerCase())}function Hs(e){return(e=xs(e))&&e.replace(xe,Kt).replace(qe,"")}var zs=Fo((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),qs=Fo((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),$s=_o("toLowerCase"),Gs=Fo((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),Ks=Fo((function(e,t,n){return e+(n?" ":"")+Xs(t)})),Ys=Fo((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Xs=_o("toUpperCase");function Js(e,t,n){return e=xs(e),(t=n?o:t)===o?function(e){return Ye.test(e)}(e)?function(e){return e.match(Ge)||[]}(e):function(e){return e.match(ce)||[]}(e):e.match(t)||[]}var Qs=Gi((function(e,t){try{return yt(e,o,t)}catch(e){return Xa(e)?e:new we(e)}})),Zs=er((function(e,t){return bt(t,(function(t){t=Nr(t),ii(e,t,Ta(e[t],e))})),e}));function el(e){return function(){return e}}var tl=No(),nl=No(!0);function il(e){return e}function ol(e){return _i("function"==typeof e?e:ai(e,1))}var rl=Gi((function(e,t){return function(n){return Ai(n,e,t)}})),al=Gi((function(e,t){return function(n){return Ai(e,n,t)}}));function sl(e,t,n){var i=Us(t),o=vi(t,i);null!=n||es(t)&&(o.length||!i.length)||(n=t,t=e,e=this,o=vi(t,Us(t)));var r=!(es(n)&&"chain"in n&&!n.chain),a=Ja(e);return bt(o,(function(n){var i=t[n];e[n]=i,a&&(e.prototype[n]=function(){var t=this.__chain__;if(r||t){var n=e(this.__wrapped__),o=n.__actions__=Do(this.__actions__);return o.push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,Bt([this.value()],arguments))})})),e}function ll(){}var cl=jo(St),ul=jo(Et),dl=jo(Tt);function fl(e){return xr(e)?Nt(Nr(e)):function(e){return function(t){return Ei(t,e)}}(e)}var hl=Ho(),pl=Ho(!0);function ml(){return[]}function gl(){return!1}var yl,xl=Vo((function(e,t){return e+t}),0),bl=$o("ceil"),vl=Vo((function(e,t){return e/t}),1),El=$o("floor"),wl=Vo((function(e,t){return e*t}),1),Cl=$o("round"),Il=Vo((function(e,t){return e-t}),0);return Rn.after=function(e,t){if("function"!=typeof t)throw new Ae(r);return e=ps(e),function(){if(--e<1)return t.apply(this,arguments)}},Rn.ary=Da,Rn.assign=bs,Rn.assignIn=vs,Rn.assignInWith=Es,Rn.assignWith=ws,Rn.at=Cs,Rn.before=Aa,Rn.bind=Ta,Rn.bindAll=Zs,Rn.bindKey=ka,Rn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return za(e)?e:[e]},Rn.chain=fa,Rn.chunk=function(e,t,n){t=(n?yr(e,t,n):t===o)?1:gn(ps(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var a=0,s=0,l=i(cn(r/t));a<r;)l[s++]=eo(e,a,a+=t);return l},Rn.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,o=[];++t<n;){var r=e[t];r&&(o[i++]=r)}return o},Rn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=i(e-1),n=arguments[0],o=e;o--;)t[o-1]=arguments[o];return Bt(za(n)?Do(n):[n],mi(t,1))},Rn.cond=function(e){var t=null==e?0:e.length,n=ar();return e=t?St(e,(function(e){if("function"!=typeof e[1])throw new Ae(r);return[n(e[0]),e[1]]})):[],Gi((function(n){for(var i=-1;++i<t;){var o=e[i];if(yt(o[0],this,n))return yt(o[1],this,n)}}))},Rn.conforms=function(e){return function(e){var t=Us(e);return function(n){return si(n,e,t)}}(ai(e,1))},Rn.constant=el,Rn.countBy=ma,Rn.create=function(e,t){var n=On(e);return null==t?n:ni(n,t)},Rn.curry=function e(t,n,i){var r=Yo(t,8,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},Rn.curryRight=function e(t,n,i){var r=Yo(t,16,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},Rn.debounce=Ua,Rn.defaults=Is,Rn.defaultsDeep=Ss,Rn.defer=La,Rn.delay=_a,Rn.difference=Vr,Rn.differenceBy=jr,Rn.differenceWith=Wr,Rn.drop=function(e,t,n){var i=null==e?0:e.length;return i?eo(e,(t=n||t===o?1:ps(t))<0?0:t,i):[]},Rn.dropRight=function(e,t,n){var i=null==e?0:e.length;return i?eo(e,0,(t=i-(t=n||t===o?1:ps(t)))<0?0:t):[]},Rn.dropRightWhile=function(e,t){return e&&e.length?uo(e,ar(t,3),!0,!0):[]},Rn.dropWhile=function(e,t){return e&&e.length?uo(e,ar(t,3),!0):[]},Rn.fill=function(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&yr(e,t,n)&&(n=0,i=r),function(e,t,n,i){var r=e.length;for((n=ps(n))<0&&(n=-n>r?0:r+n),(i=i===o||i>r?r:ps(i))<0&&(i+=r),i=n>i?0:ms(i);n<i;)e[n++]=t;return e}(e,t,n,i)):[]},Rn.filter=function(e,t){return(za(e)?wt:pi)(e,ar(t,3))},Rn.flatMap=function(e,t){return mi(Ca(e,t),1)},Rn.flatMapDeep=function(e,t){return mi(Ca(e,t),u)},Rn.flatMapDepth=function(e,t,n){return n=n===o?1:ps(n),mi(Ca(e,t),n)},Rn.flatten=qr,Rn.flattenDeep=function(e){return null!=e&&e.length?mi(e,u):[]},Rn.flattenDepth=function(e,t){return null!=e&&e.length?mi(e,t=t===o?1:ps(t)):[]},Rn.flip=function(e){return Yo(e,512)},Rn.flow=tl,Rn.flowRight=nl,Rn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var o=e[t];i[o[0]]=o[1]}return i},Rn.functions=function(e){return null==e?[]:vi(e,Us(e))},Rn.functionsIn=function(e){return null==e?[]:vi(e,Ls(e))},Rn.groupBy=va,Rn.initial=function(e){return null!=e&&e.length?eo(e,0,-1):[]},Rn.intersection=Gr,Rn.intersectionBy=Kr,Rn.intersectionWith=Yr,Rn.invert=As,Rn.invertBy=Ts,Rn.invokeMap=Ea,Rn.iteratee=ol,Rn.keyBy=wa,Rn.keys=Us,Rn.keysIn=Ls,Rn.map=Ca,Rn.mapKeys=function(e,t){var n={};return t=ar(t,3),xi(e,(function(e,i,o){ii(n,t(e,i,o),e)})),n},Rn.mapValues=function(e,t){var n={};return t=ar(t,3),xi(e,(function(e,i,o){ii(n,i,t(e,i,o))})),n},Rn.matches=function(e){return Ni(ai(e,1))},Rn.matchesProperty=function(e,t){return Ri(e,ai(t,1))},Rn.memoize=Fa,Rn.merge=_s,Rn.mergeWith=Fs,Rn.method=rl,Rn.methodOf=al,Rn.mixin=sl,Rn.negate=Pa,Rn.nthArg=function(e){return e=ps(e),Gi((function(t){return Vi(t,e)}))},Rn.omit=Ps,Rn.omitBy=function(e,t){return Ns(e,Pa(ar(t)))},Rn.once=function(e){return Aa(2,e)},Rn.orderBy=function(e,t,n,i){return null==e?[]:(za(t)||(t=null==t?[]:[t]),za(n=i?o:n)||(n=null==n?[]:[n]),ji(e,t,n))},Rn.over=cl,Rn.overArgs=Ma,Rn.overEvery=ul,Rn.overSome=dl,Rn.partial=Na,Rn.partialRight=Ra,Rn.partition=Ia,Rn.pick=Ms,Rn.pickBy=Ns,Rn.property=fl,Rn.propertyOf=function(e){return function(t){return null==e?o:Ei(e,t)}},Rn.pull=Jr,Rn.pullAll=Qr,Rn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Hi(e,t,ar(n,2)):e},Rn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Hi(e,t,o,n):e},Rn.pullAt=Zr,Rn.range=hl,Rn.rangeRight=pl,Rn.rearg=Oa,Rn.reject=function(e,t){return(za(e)?wt:pi)(e,Pa(ar(t,3)))},Rn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,o=[],r=e.length;for(t=ar(t,3);++i<r;){var a=e[i];t(a,i,e)&&(n.push(a),o.push(i))}return zi(e,o),n},Rn.rest=function(e,t){if("function"!=typeof e)throw new Ae(r);return Gi(e,t=t===o?t:ps(t))},Rn.reverse=ea,Rn.sampleSize=function(e,t,n){return t=(n?yr(e,t,n):t===o)?1:ps(t),(za(e)?Xn:Yi)(e,t)},Rn.set=function(e,t,n){return null==e?e:Xi(e,t,n)},Rn.setWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:Xi(e,t,n,i)},Rn.shuffle=function(e){return(za(e)?Jn:Zi)(e)},Rn.slice=function(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&yr(e,t,n)?(t=0,n=i):(t=null==t?0:ps(t),n=n===o?i:ps(n)),eo(e,t,n)):[]},Rn.sortBy=Sa,Rn.sortedUniq=function(e){return e&&e.length?oo(e):[]},Rn.sortedUniqBy=function(e,t){return e&&e.length?oo(e,ar(t,2)):[]},Rn.split=function(e,t,n){return n&&"number"!=typeof n&&yr(e,t,n)&&(t=n=o),(n=n===o?h:n>>>0)?(e=xs(e))&&("string"==typeof t||null!=t&&!rs(t))&&!(t=ao(t))&&Jt(e)?bo(rn(e),0,n):e.split(t,n):[]},Rn.spread=function(e,t){if("function"!=typeof e)throw new Ae(r);return t=null==t?0:gn(ps(t),0),Gi((function(n){var i=n[t],o=bo(n,0,t);return i&&Bt(o,i),yt(e,this,o)}))},Rn.tail=function(e){var t=null==e?0:e.length;return t?eo(e,1,t):[]},Rn.take=function(e,t,n){return e&&e.length?eo(e,0,(t=n||t===o?1:ps(t))<0?0:t):[]},Rn.takeRight=function(e,t,n){var i=null==e?0:e.length;return i?eo(e,(t=i-(t=n||t===o?1:ps(t)))<0?0:t,i):[]},Rn.takeRightWhile=function(e,t){return e&&e.length?uo(e,ar(t,3),!1,!0):[]},Rn.takeWhile=function(e,t){return e&&e.length?uo(e,ar(t,3)):[]},Rn.tap=function(e,t){return t(e),e},Rn.throttle=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new Ae(r);return es(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),Ua(e,t,{leading:i,maxWait:t,trailing:o})},Rn.thru=ha,Rn.toArray=fs,Rn.toPairs=Rs,Rn.toPairsIn=Os,Rn.toPath=function(e){return za(e)?St(e,Nr):ls(e)?[e]:Do(Mr(xs(e)))},Rn.toPlainObject=ys,Rn.transform=function(e,t,n){var i=za(e),o=i||Ka(e)||cs(e);if(t=ar(t,4),null==n){var r=e&&e.constructor;n=o?i?new r:[]:es(e)&&Ja(r)?On(Ke(e)):{}}return(o?bt:xi)(e,(function(e,i,o){return t(n,e,i,o)})),n},Rn.unary=function(e){return Da(e,1)},Rn.union=ta,Rn.unionBy=na,Rn.unionWith=ia,Rn.uniq=function(e){return e&&e.length?so(e):[]},Rn.uniqBy=function(e,t){return e&&e.length?so(e,ar(t,2)):[]},Rn.uniqWith=function(e,t){return t="function"==typeof t?t:o,e&&e.length?so(e,o,t):[]},Rn.unset=function(e,t){return null==e||lo(e,t)},Rn.unzip=oa,Rn.unzipWith=ra,Rn.update=function(e,t,n){return null==e?e:co(e,t,go(n))},Rn.updateWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:co(e,t,go(n),i)},Rn.values=Vs,Rn.valuesIn=function(e){return null==e?[]:Ht(e,Ls(e))},Rn.without=aa,Rn.words=Js,Rn.wrap=function(e,t){return Na(go(t),e)},Rn.xor=sa,Rn.xorBy=la,Rn.xorWith=ca,Rn.zip=ua,Rn.zipObject=function(e,t){return po(e||[],t||[],Zn)},Rn.zipObjectDeep=function(e,t){return po(e||[],t||[],Xi)},Rn.zipWith=da,Rn.entries=Rs,Rn.entriesIn=Os,Rn.extend=vs,Rn.extendWith=Es,sl(Rn,Rn),Rn.add=xl,Rn.attempt=Qs,Rn.camelCase=js,Rn.capitalize=Ws,Rn.ceil=bl,Rn.clamp=function(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=(n=gs(n))==n?n:0),t!==o&&(t=(t=gs(t))==t?t:0),ri(gs(e),t,n)},Rn.clone=function(e){return ai(e,4)},Rn.cloneDeep=function(e){return ai(e,5)},Rn.cloneDeepWith=function(e,t){return ai(e,5,t="function"==typeof t?t:o)},Rn.cloneWith=function(e,t){return ai(e,4,t="function"==typeof t?t:o)},Rn.conformsTo=function(e,t){return null==t||si(e,t,Us(t))},Rn.deburr=Hs,Rn.defaultTo=function(e,t){return null==e||e!=e?t:e},Rn.divide=vl,Rn.endsWith=function(e,t,n){e=xs(e),t=ao(t);var i=e.length,r=n=n===o?i:ri(ps(n),0,i);return(n-=t.length)>=0&&e.slice(n,r)==t},Rn.eq=Va,Rn.escape=function(e){return(e=xs(e))&&K.test(e)?e.replace($,Yt):e},Rn.escapeRegExp=function(e){return(e=xs(e))&&ne.test(e)?e.replace(te,"\\$&"):e},Rn.every=function(e,t,n){var i=za(e)?Et:fi;return n&&yr(e,t,n)&&(t=o),i(e,ar(t,3))},Rn.find=ga,Rn.findIndex=Hr,Rn.findKey=function(e,t){return Ut(e,ar(t,3),xi)},Rn.findLast=ya,Rn.findLastIndex=zr,Rn.findLastKey=function(e,t){return Ut(e,ar(t,3),bi)},Rn.floor=El,Rn.forEach=xa,Rn.forEachRight=ba,Rn.forIn=function(e,t){return null==e?e:gi(e,ar(t,3),Ls)},Rn.forInRight=function(e,t){return null==e?e:yi(e,ar(t,3),Ls)},Rn.forOwn=function(e,t){return e&&xi(e,ar(t,3))},Rn.forOwnRight=function(e,t){return e&&bi(e,ar(t,3))},Rn.get=Bs,Rn.gt=ja,Rn.gte=Wa,Rn.has=function(e,t){return null!=e&&hr(e,t,Si)},Rn.hasIn=Ds,Rn.head=$r,Rn.identity=il,Rn.includes=function(e,t,n,i){e=$a(e)?e:Vs(e),n=n&&!i?ps(n):0;var o=e.length;return n<0&&(n=gn(o+n,0)),ss(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&_t(e,t,n)>-1},Rn.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var o=null==n?0:ps(n);return o<0&&(o=gn(i+o,0)),_t(e,t,o)},Rn.inRange=function(e,t,n){return t=hs(t),n===o?(n=t,t=0):n=hs(n),function(e,t,n){return e>=yn(t,n)&&e<gn(t,n)}(e=gs(e),t,n)},Rn.invoke=ks,Rn.isArguments=Ha,Rn.isArray=za,Rn.isArrayBuffer=qa,Rn.isArrayLike=$a,Rn.isArrayLikeObject=Ga,Rn.isBoolean=function(e){return!0===e||!1===e||ts(e)&&Ci(e)==y},Rn.isBuffer=Ka,Rn.isDate=Ya,Rn.isElement=function(e){return ts(e)&&1===e.nodeType&&!os(e)},Rn.isEmpty=function(e){if(null==e)return!0;if($a(e)&&(za(e)||"string"==typeof e||"function"==typeof e.splice||Ka(e)||cs(e)||Ha(e)))return!e.length;var t=fr(e);if(t==w||t==D)return!e.size;if(Er(e))return!Fi(e).length;for(var n in e)if(Fe.call(e,n))return!1;return!0},Rn.isEqual=function(e,t){return ki(e,t)},Rn.isEqualWith=function(e,t,n){var i=(n="function"==typeof n?n:o)?n(e,t):o;return i===o?ki(e,t,o,n):!!i},Rn.isError=Xa,Rn.isFinite=function(e){return"number"==typeof e&&hn(e)},Rn.isFunction=Ja,Rn.isInteger=Qa,Rn.isLength=Za,Rn.isMap=ns,Rn.isMatch=function(e,t){return e===t||Ui(e,t,lr(t))},Rn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:o,Ui(e,t,lr(t),n)},Rn.isNaN=function(e){return is(e)&&e!=+e},Rn.isNative=function(e){if(vr(e))throw new we("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Li(e)},Rn.isNil=function(e){return null==e},Rn.isNull=function(e){return null===e},Rn.isNumber=is,Rn.isObject=es,Rn.isObjectLike=ts,Rn.isPlainObject=os,Rn.isRegExp=rs,Rn.isSafeInteger=function(e){return Qa(e)&&e>=-9007199254740991&&e<=d},Rn.isSet=as,Rn.isString=ss,Rn.isSymbol=ls,Rn.isTypedArray=cs,Rn.isUndefined=function(e){return e===o},Rn.isWeakMap=function(e){return ts(e)&&fr(e)==k},Rn.isWeakSet=function(e){return ts(e)&&"[object WeakSet]"==Ci(e)},Rn.join=function(e,t){return null==e?"":pn.call(e,t)},Rn.kebabCase=zs,Rn.last=Xr,Rn.lastIndexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return n!==o&&(r=(r=ps(n))<0?gn(i+r,0):yn(r,i-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):Lt(e,Pt,r,!0)},Rn.lowerCase=qs,Rn.lowerFirst=$s,Rn.lt=us,Rn.lte=ds,Rn.max=function(e){return e&&e.length?hi(e,il,Ii):o},Rn.maxBy=function(e,t){return e&&e.length?hi(e,ar(t,2),Ii):o},Rn.mean=function(e){return Mt(e,il)},Rn.meanBy=function(e,t){return Mt(e,ar(t,2))},Rn.min=function(e){return e&&e.length?hi(e,il,Pi):o},Rn.minBy=function(e,t){return e&&e.length?hi(e,ar(t,2),Pi):o},Rn.stubArray=ml,Rn.stubFalse=gl,Rn.stubObject=function(){return{}},Rn.stubString=function(){return""},Rn.stubTrue=function(){return!0},Rn.multiply=wl,Rn.nth=function(e,t){return e&&e.length?Vi(e,ps(t)):o},Rn.noConflict=function(){return rt._===this&&(rt._=Oe),this},Rn.noop=ll,Rn.now=Ba,Rn.pad=function(e,t,n){e=xs(e);var i=(t=ps(t))?on(e):0;if(!t||i>=t)return e;var o=(t-i)/2;return Wo(un(o),n)+e+Wo(cn(o),n)},Rn.padEnd=function(e,t,n){e=xs(e);var i=(t=ps(t))?on(e):0;return t&&i<t?e+Wo(t-i,n):e},Rn.padStart=function(e,t,n){e=xs(e);var i=(t=ps(t))?on(e):0;return t&&i<t?Wo(t-i,n)+e:e},Rn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),bn(xs(e).replace(oe,""),t||0)},Rn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&yr(e,t,n)&&(t=n=o),n===o&&("boolean"==typeof t?(n=t,t=o):"boolean"==typeof e&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=hs(e),t===o?(t=e,e=0):t=hs(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=vn();return yn(e+r*(t-e+tt("1e-"+((r+"").length-1))),t)}return qi(e,t)},Rn.reduce=function(e,t,n){var i=za(e)?Dt:Ot,o=arguments.length<3;return i(e,ar(t,4),n,o,ui)},Rn.reduceRight=function(e,t,n){var i=za(e)?At:Ot,o=arguments.length<3;return i(e,ar(t,4),n,o,di)},Rn.repeat=function(e,t,n){return t=(n?yr(e,t,n):t===o)?1:ps(t),$i(xs(e),t)},Rn.replace=function(){var e=arguments,t=xs(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Rn.result=function(e,t,n){var i=-1,r=(t=yo(t,e)).length;for(r||(r=1,e=o);++i<r;){var a=null==e?o:e[Nr(t[i])];a===o&&(i=r,a=n),e=Ja(a)?a.call(e):a}return e},Rn.round=Cl,Rn.runInContext=e,Rn.sample=function(e){return(za(e)?Yn:Ki)(e)},Rn.size=function(e){if(null==e)return 0;if($a(e))return ss(e)?on(e):e.length;var t=fr(e);return t==w||t==D?e.size:Fi(e).length},Rn.snakeCase=Gs,Rn.some=function(e,t,n){var i=za(e)?Tt:to;return n&&yr(e,t,n)&&(t=o),i(e,ar(t,3))},Rn.sortedIndex=function(e,t){return no(e,t)},Rn.sortedIndexBy=function(e,t,n){return io(e,t,ar(n,2))},Rn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=no(e,t);if(i<n&&Va(e[i],t))return i}return-1},Rn.sortedLastIndex=function(e,t){return no(e,t,!0)},Rn.sortedLastIndexBy=function(e,t,n){return io(e,t,ar(n,2),!0)},Rn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=no(e,t,!0)-1;if(Va(e[n],t))return n}return-1},Rn.startCase=Ks,Rn.startsWith=function(e,t,n){return e=xs(e),n=null==n?0:ri(ps(n),0,e.length),t=ao(t),e.slice(n,n+t.length)==t},Rn.subtract=Il,Rn.sum=function(e){return e&&e.length?Vt(e,il):0},Rn.sumBy=function(e,t){return e&&e.length?Vt(e,ar(t,2)):0},Rn.template=function(e,t,n){var i=Rn.templateSettings;n&&yr(e,t,n)&&(t=o),e=xs(e),t=Es({},t,i,Xo);var r,a,s=Es({},t.imports,i.imports,Xo),l=Us(s),c=Ht(s,l),u=0,d=t.interpolate||be,f="__p += '",h=Be((t.escape||be).source+"|"+d.source+"|"+(d===J?de:be).source+"|"+(t.evaluate||be).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Je+"]")+"\n";e.replace(h,(function(t,n,i,o,s,l){return i||(i=o),f+=e.slice(u,l).replace(ve,Xt),n&&(r=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),f+="';\n";var m=t.variable;m||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(W,""):f).replace(H,"$1").replace(z,"$1;"),f="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=Qs((function(){return Ce(l,p+"return "+f).apply(o,c)}));if(g.source=f,Xa(g))throw g;return g},Rn.times=function(e,t){if((e=ps(e))<1||e>d)return[];var n=h,i=yn(e,h);t=ar(t),e-=h;for(var o=jt(i,t);++n<e;)t(n);return o},Rn.toFinite=hs,Rn.toInteger=ps,Rn.toLength=ms,Rn.toLower=function(e){return xs(e).toLowerCase()},Rn.toNumber=gs,Rn.toSafeInteger=function(e){return e?ri(ps(e),-9007199254740991,d):0===e?e:0},Rn.toString=xs,Rn.toUpper=function(e){return xs(e).toUpperCase()},Rn.trim=function(e,t,n){if((e=xs(e))&&(n||t===o))return e.replace(ie,"");if(!e||!(t=ao(t)))return e;var i=rn(e),r=rn(t);return bo(i,qt(i,r),$t(i,r)+1).join("")},Rn.trimEnd=function(e,t,n){if((e=xs(e))&&(n||t===o))return e.replace(re,"");if(!e||!(t=ao(t)))return e;var i=rn(e);return bo(i,0,$t(i,rn(t))+1).join("")},Rn.trimStart=function(e,t,n){if((e=xs(e))&&(n||t===o))return e.replace(oe,"");if(!e||!(t=ao(t)))return e;var i=rn(e);return bo(i,qt(i,rn(t))).join("")},Rn.truncate=function(e,t){var n=30,i="...";if(es(t)){var r="separator"in t?t.separator:r;n="length"in t?ps(t.length):n,i="omission"in t?ao(t.omission):i}var a=(e=xs(e)).length;if(Jt(e)){var s=rn(e);a=s.length}if(n>=a)return e;var l=n-on(i);if(l<1)return i;var c=s?bo(s,0,l).join(""):e.slice(0,l);if(r===o)return c+i;if(s&&(l+=c.length-l),rs(r)){if(e.slice(l).search(r)){var u,d=c;for(r.global||(r=Be(r.source,xs(fe.exec(r))+"g")),r.lastIndex=0;u=r.exec(d);)var f=u.index;c=c.slice(0,f===o?l:f)}}else if(e.indexOf(ao(r),l)!=l){var h=c.lastIndexOf(r);h>-1&&(c=c.slice(0,h))}return c+i},Rn.unescape=function(e){return(e=xs(e))&&G.test(e)?e.replace(q,an):e},Rn.uniqueId=function(e){var t=++Pe;return xs(e)+t},Rn.upperCase=Ys,Rn.upperFirst=Xs,Rn.each=xa,Rn.eachRight=ba,Rn.first=$r,sl(Rn,(yl={},xi(Rn,(function(e,t){Fe.call(Rn.prototype,t)||(yl[t]=e)})),yl),{chain:!1}),Rn.VERSION="4.17.11",bt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Rn[e].placeholder=Rn})),bt(["drop","take"],(function(e,t){Wn.prototype[e]=function(n){n=n===o?1:gn(ps(n),0);var i=this.__filtered__&&!t?new Wn(this):this.clone();return i.__filtered__?i.__takeCount__=yn(n,i.__takeCount__):i.__views__.push({size:yn(n,h),type:e+(i.__dir__<0?"Right":"")}),i},Wn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),bt(["filter","map","takeWhile"],(function(e,t){var n=t+1,i=1==n||3==n;Wn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ar(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}})),bt(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Wn.prototype[e]=function(){return this[n](1).value()[0]}})),bt(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Wn.prototype[e]=function(){return this.__filtered__?new Wn(this):this[n](1)}})),Wn.prototype.compact=function(){return this.filter(il)},Wn.prototype.find=function(e){return this.filter(e).head()},Wn.prototype.findLast=function(e){return this.reverse().find(e)},Wn.prototype.invokeMap=Gi((function(e,t){return"function"==typeof e?new Wn(this):this.map((function(n){return Ai(n,e,t)}))})),Wn.prototype.reject=function(e){return this.filter(Pa(ar(e)))},Wn.prototype.slice=function(e,t){e=ps(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Wn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(n=(t=ps(t))<0?n.dropRight(-t):n.take(t-e)),n)},Wn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Wn.prototype.toArray=function(){return this.take(h)},xi(Wn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),r=Rn[i?"take"+("last"==t?"Right":""):t],a=i||/^find/.test(t);r&&(Rn.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,l=t instanceof Wn,c=s[0],u=l||za(t),d=function(e){var t=r.apply(Rn,Bt([e],s));return i&&f?t[0]:t};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var f=this.__chain__,h=!!this.__actions__.length,p=a&&!f,m=l&&!h;if(!a&&u){t=m?t:new Wn(this);var g=e.apply(t,s);return g.__actions__.push({func:ha,args:[d],thisArg:o}),new jn(g,f)}return p&&m?e.apply(this,s):(g=this.thru(d),p?i?g.value()[0]:g.value():g)})})),bt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Te[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);Rn.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var o=this.value();return t.apply(za(o)?o:[],e)}return this[n]((function(n){return t.apply(za(n)?n:[],e)}))}})),xi(Wn.prototype,(function(e,t){var n=Rn[t];if(n){var i=n.name+"";(Tn[i]||(Tn[i]=[])).push({name:t,func:n})}})),Tn[Ro(o,2).name]=[{name:"wrapper",func:o}],Wn.prototype.clone=function(){var e=new Wn(this.__wrapped__);return e.__actions__=Do(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Do(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Do(this.__views__),e},Wn.prototype.reverse=function(){if(this.__filtered__){var e=new Wn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Wn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=za(e),i=t<0,o=n?e.length:0,r=function(e,t,n){for(var i=-1,o=n.length;++i<o;){var r=n[i],a=r.size;switch(r.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=yn(t,e+a);break;case"takeRight":e=gn(e,t-a)}}return{start:e,end:t}}(0,o,this.__views__),a=r.start,s=r.end,l=s-a,c=i?s:a-1,u=this.__iteratees__,d=u.length,f=0,h=yn(l,this.__takeCount__);if(!n||!i&&o==l&&h==l)return fo(e,this.__actions__);var p=[];e:for(;l--&&f<h;){for(var m=-1,g=e[c+=t];++m<d;){var y=u[m],x=y.iteratee,b=y.type,v=x(g);if(2==b)g=v;else if(!v){if(1==b)continue e;break e}}p[f++]=g}return p},Rn.prototype.at=pa,Rn.prototype.chain=function(){return fa(this)},Rn.prototype.commit=function(){return new jn(this.value(),this.__chain__)},Rn.prototype.next=function(){this.__values__===o&&(this.__values__=fs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?o:this.__values__[this.__index__++]}},Rn.prototype.plant=function(e){for(var t,n=this;n instanceof Vn;){var i=Or(n);i.__index__=0,i.__values__=o,t?r.__wrapped__=i:t=i;var r=i;n=n.__wrapped__}return r.__wrapped__=e,t},Rn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wn){var t=e;return this.__actions__.length&&(t=new Wn(this)),(t=t.reverse()).__actions__.push({func:ha,args:[ea],thisArg:o}),new jn(t,this.__chain__)}return this.thru(ea)},Rn.prototype.toJSON=Rn.prototype.valueOf=Rn.prototype.value=function(){return fo(this.__wrapped__,this.__actions__)},Rn.prototype.first=Rn.prototype.head,st&&(Rn.prototype[st]=function(){return this}),Rn}();rt._=sn,(i=function(){return sn}.call(t,n,t,e))===o||(e.exports=i)}.call(this)}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return o[e].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}return a.m=o,a.amdD=function(){throw new Error("define cannot be used indirect")},a.amdO={},t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},a.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var o=Object.create(null);a.r(o);var r={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){r[e]=function(){return n[e]}}));return r.default=function(){return n},a.d(o,r),o},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,n){return a.f[n](e,t),t}),[]))},a.u=function(e){return"adminui."+e+".min.js"},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n={},i="adminUI:",a.l=function(e,t,o,r){if(n[e])n[e].push(t);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==i+o){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",i+o),s.src=e),n[e]=[t];var f=function(t,i){s.onerror=s.onload=null,clearTimeout(h);var o=n[e];if(delete n[e],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(i)})),t)return t(i)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},a.p="/clientRequire/@unitybase/adminui-pub/dist/",function(){var e={143:0};a.f.j=function(t,n){var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise((function(n,o){i=e[t]=[n,o]}));n.push(i[2]=o);var r=a.p+a.u(t),s=new Error;a.l(r,(function(n){if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",s.name="ChunkLoadError",s.type=o,s.request=r,i[1](s)}}),"chunk-"+t,t)}};var t=function(t,n){var i,o,r=n[0],s=n[1],l=n[2],c=0;for(i in s)a.o(s,i)&&(a.m[i]=s[i]);for(l&&l(a),t&&t(n);c<r.length;c++)o=r[c],a.o(e,o)&&e[o]&&e[o][0](),e[r[c]]=0},n=self.webpackChunkadminUI=self.webpackChunkadminUI||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),a(6430)}()}));