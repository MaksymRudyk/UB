const {iterateList, transform} = require('../metadata/utility')
const {EntityFormat} = require('../metadata')

module.exports = {
  contactsChild
}

function contactsChild(attr, parentKeyAttr = 'code') {
  return {
    context: {[attr]: parentKeyAttr},
    iterate(val, ctx) {
      return transform(
        iterateList(val),
        new EntityFormat()
          .key('contactType')
          .caption('value')
          .fromContext({[attr]: attr})
          .wrapAsEntity('cdn_contact'),
        ctx
      )
    }
  }
}
